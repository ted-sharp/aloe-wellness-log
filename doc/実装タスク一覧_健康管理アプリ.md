# ダイエット・健康管理アプリ 実装タスク一覧

---

## 1. プロジェクトセットアップ
- [ ] Vite + React + TypeScript プロジェクトの新規作成
- [ ] 必要なパッケージのインストール（react, react-dom, react-router-dom, zustand, tailwindcss, clsx, axios, etc.）
- [ ] Tailwind CSS のセットアップ
- [ ] プロジェクトのディレクトリ構成設計

---

## 2. 設定ファイル（fields.json）対応
- [ ] fields.json の初期設計（体重・血圧・運動有無・食事有無・睡眠有無）
- [ ] HTTP経由でfields.jsonを取得するロジックの実装
- [ ] 設定ファイルのキャッシュ・リロード機能の実装
- [ ] 設定ファイルのバリデーション

---

## 3. 型定義・データモデル設計
- [ ] 記録データ（Record型）のTypeScript型定義
- [ ] 記録項目（Field型）のTypeScript型定義
- [ ] indexed-db用のスキーマ設計

---

## 4. データストア・永続化
- [ ] Zustandによる状態管理ストアの実装
- [ ] indexed-dbとの連携ユーティリティの実装
- [ ] 記録データの保存・取得・削除・更新ロジック
- [ ] 記録項目（Field）の追加・編集・削除ロジック

---

## 5. UI実装
### 5.1 共通
- [ ] ルーティング設計（react-router-dom）
- [ ] レイアウト・ナビゲーションの実装

### 5.2 記録入力画面
- [x] 基本的な入力項目（体重、血圧、運動、食事、睡眠）
- [x] カード型デザインでの表示
- [x] 日時選択機能（現在時刻ボタン付き）
- [x] 備考・メモ機能（500文字制限、文字数カウンター）
- [x] 前回値取得機能
- [x] 項目編集機能
- [x] **項目順序指定機能** ✨
  - Field型にorder属性を追加
  - 新しい項目追加時に表示順序を指定可能
  - グリッドレイアウトの美しい項目追加フォーム
  - 項目の自動ソート表示

### 5.3 記録一覧画面
- [ ] 日付・時刻ごとのグループ化表示
- [x] カード型デザインでの表示
- [x] 編集・削除ボタンの配置改善
- [x] 日付アイコン（📅）の追加
- [x] ホバー効果とフォーカス状態
- [x] **項目順序の統一表示** ✨ 完了！
  - 備考 → 体重 → 血圧 → 運動 → 食事 → 睡眠の統一順序
  - マイグレーション機能でorder属性を自動付与
  - sortRecordsByFieldOrder関数による順序制御
- [x] **ブール値表示改善** ✨ 完了！
  - false値の「なし」表示対応
  - true値の「あり」表示維持
  - 記録保存時のfalse値明示化

### 5.4 設定画面（オプション）
- [ ] 記録項目テンプレートの選択・追加
- [ ] 設定ファイルの再取得・リロードUI

### 完了済み実装
#### UI/UX改善
- [x] ボタンの視認性向上（背景色・アイコン・ホバー効果）
- [x] react-calendarのスタイル調整（日本式カレンダー色・今日の日付色）
- [x] CSSの競合解決（global vs Tailwind CSS）
- [x] 記録入力画面のレイアウト最適化（カードベース・サイズ統一）
- [x] 記録一覧画面のボタン配置問題解決（項目名長さによるガタガタ配置の修正）
- [x] エクスポート機能の専用画面分離とUI簡素化
- [x] 記録一覧画面のカードデザイン統一（美しいUI改善）
- [x] 記録入力画面の日時変更機能実装（過去・未来の記録対応）
- [x] 記録入力画面の備考・メモ機能実装（体調・状況記録対応）

#### データ管理
- [x] IndexedDBを使用したデータ永続化
- [x] 日付・時間の時差問題修正（toISOString→手動フォーマット）

### 記録一覧画面のボタン配置改善（2025-06-18）
**問題**: 項目名の長さが異なるため、編集・削除ボタンの位置がガタガタになっていた

**解決策**: Flexbox の `justify-between` を使用した両端配置レイアウト
```jsx
<li className="border-b pb-1 flex items-center justify-between">
  <div className="flex items-center gap-2">
    <span className="font-bold">{項目名}:</span>
    <span>{値}</span>
  </div>
  <div className="flex gap-1">
    <button>✏️ 編集</button>
    <button>🗑️ 削除</button>
  </div>
</li>
```

**効果**:
- すべてのボタンが右端に整列
- 視覚的統一感の向上
- 使いやすさの向上

---

## 6. ユーザー体験向上
- [ ] 入力補助（例：前回値の自動入力、単位の表示）
- [ ] フィードバックメッセージ（保存成功・失敗時）
- [ ] ダークモード対応（必要に応じて）

---

## 7. データエクスポート
- [ ] 記録データのCSVエクスポート機能
- [ ] 記録データのJSONエクスポート機能

---

## 8. テスト・品質保証
- [ ] ユニットテスト（型・ロジック）
- [ ] E2Eテスト（主要なユーザーフロー）
- [ ] 手動テスト（各種ブラウザ・デバイス）

---

## 9. ドキュメント整備
- [ ] READMEの作成・更新
- [ ] 利用方法・FAQの記載
- [ ] 設定ファイル仕様のドキュメント化

---

## 10. 将来的な拡張（MVP後）
- [ ] グラフ表示機能の設計・実装
- [ ] カレンダー表示機能の設計・実装
- [ ] データのインポート機能
- [ ] PWA対応・オフライン対応強化

## エクスポート画面（RecordExport.tsx）
- [x] 専用ページとして独立
- [x] シンプルなインターフェース
- [x] JSON・CSV形式での出力

## 記録グラフ画面（RecordGraph.tsx）
- [x] 基本実装

## 記録カレンダー画面（RecordCalendar.tsx）
- [x] カレンダー表示
- [x] 日本風カスタマイズ（土曜青、日曜赤、今日緑）
- [x] データ保存・表示機能
- [x] タイムゾーン対応

## データ構造
- [x] Field型にorder属性追加
- [x] 縦持ちスキーマ（fieldId-value構造）
- [x] IndexedDB永続化
- [x] **既存データマイグレーション機能** ✨
  - orderマッピングによる正確な順序付与
  - loadFields時の自動マイグレーション実行
- [x] **ブール値保存改善** ✨
  - 未設定boolean項目のfalse値明示保存
  - 型安全なデータ処理

## 技術実装
- [x] TypeScript対応
- [x] Tailwind CSS統一デザイン
- [x] Zustand状態管理
- [x] エラーハンドリング

## 🎉 主要機能完成！
✅ **カスタム項目順序指定機能**
✅ **統一項目順序表示**
✅ **ブール値の適切な表示（あり/なし）**
✅ **美しいUI/UXデザイン**
✅ **データ永続化とマイグレーション**

## 今後の拡張可能性
- 既存項目への順序再設定機能
- データエクスポート時の順序統一
- グラフ機能の拡張
- より高度なフィルタリング・検索機能

### IndexedDBの保存処理修正 (2024年12月頃)
**問題**: 起動直後に昨日入力した内容が記録されていない
**原因**:
1. IndexedDBの`addRecord`で`store.add()`使用により、重複IDでエラー発生
2. 同じ日時に記録すると同じIDが生成される問題
3. エラーハンドリング不足

**修正内容**:
- `./src/db/indexedDb.ts`: `store.add()`を`store.put()`に変更
- `./src/pages/RecordInput.tsx`:
  - ID生成にuniqueTimestampを追加
  - try-catch文でエラーハンドリング追加
  - TypeScript型安全性向上（any型除去）
- `./src/store/records.ts`: デバッグログ追加

**結果**: データ保存・読み込みの安定化を実現

## 今後の改善予定 📋

### 1. パフォーマンス最適化
- [ ] 大量データでの表示速度改善
- [ ] グラフ描画の最適化

### 2. ユーザビリティ向上
- [ ] オフライン対応強化
- [ ] データエクスポート機能強化

### 3. 保守性向上
- [ ] テストコード追加
- [ ] ドキュメント整備

## 技術的知見 🔧

### IndexedDB使用時の注意点
1. `store.add()`は重複IDでエラー → `store.put()`で解決
2. ID生成は一意性を保つため timestamp + unique suffix 推奨
3. エラーハンドリングは必須（特にDB操作）

### TypeScript型安全性
- `any`型使用を避け、適切なUnion型を使用
- HTMLinput要素のvalue属性はboolean型を受け取れない点に注意
