import{j as e}from"./ui-vendor-Z70llhoy.js";import{a as r,b as a}from"./react-vendor-DRLO6cO2.js";import{u as t,H as s,a as d,b as i,c as n,d as l,e as o,f as c,g as u,h as g,i as m,j as f,k as x,l as p,p as b,B as h,m as y,n as v,o as w,q as k,r as j,s as N,t as S,v as F,w as I,x as E}from"./index-_gBeLdnQ.js";import{u as C,a as D,D as M,c as $,S as T,v as A,s as P,K as G,P as R,b as O,C as q,d as z}from"./dnd-vendor-Blco1Psf.js";import"./icons-vendor-DbsR8xvJ.js";import"./state-vendor-Crk1RRDk.js";const _=r.memo(({recordDate:r,recordTime:a,onDateChange:i,onTimeChange:n,onSetCurrentDateTime:l})=>{const{t:o}=t();return e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md",children:e.jsxs("fieldset",{className:"space-y-4",children:[e.jsxs("legend",{className:"text-2xl font-semibold text-gray-800 dark:text-white flex items-center gap-2",children:[e.jsx(s,{className:"w-6 h-6 text-blue-600 dark:text-blue-400","aria-hidden":"true"}),o("pages.input.recordDateTime")]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"record-date",className:"block text-base font-medium text-gray-700 dark:text-gray-200 mb-2",children:o("pages.input.date")}),e.jsx("input",{id:"record-date",type:"date",value:r,onChange:e=>i(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400","aria-describedby":"record-date-desc",required:!0,"aria-required":"true"}),e.jsx("div",{id:"record-date-desc",className:"sr-only",children:o("pages.input.dateDescription")})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"record-time",className:"block text-base font-medium text-gray-700 dark:text-gray-200 mb-2",children:o("pages.input.time")}),e.jsx("input",{id:"record-time",type:"time",value:a,onChange:e=>n(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400","aria-describedby":"record-time-desc",required:!0,"aria-required":"true"}),e.jsx("div",{id:"record-time-desc",className:"sr-only",children:o("pages.input.timeDescription")})]}),e.jsxs("div",{className:"flex items-end",children:[e.jsxs("button",{type:"button",onClick:l,className:"bg-blue-500 dark:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-600 dark:hover:bg-blue-700 transition-colors duration-200 font-medium flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800","aria-label":o("pages.input.setCurrentDateTime"),"aria-describedby":"current-time-desc",children:[e.jsx(d,{className:"w-5 h-5","aria-hidden":"true"}),o("pages.input.setCurrentDateTime")]}),e.jsx("div",{id:"current-time-desc",className:"sr-only",children:o("pages.input.currentTimeDescription")})]})]})]})})});_.displayName="DateTimeSelector";const B=r.memo(({value:a,onChange:s,maxLength:d=500,placeholder:n})=>{const{t:l}=t(),o=r.useCallback(e=>{s(e.target.value)},[s]),c=a.length,u=d-c,g=c>.8*d,m=n||l("pages.input.notesPlaceholder");return e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{htmlFor:"notes-input",className:"text-2xl font-semibold text-gray-800 dark:text-white flex items-center gap-2",children:[e.jsx(i,{className:"w-6 h-6 text-blue-600 dark:text-blue-400","aria-hidden":"true"}),l("pages.input.notes")]}),e.jsxs("div",{children:[e.jsx("textarea",{id:"notes-input",value:a,onChange:o,placeholder:m,className:"w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 h-24 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400 resize-none placeholder:text-gray-500 dark:placeholder:text-gray-400",maxLength:d,"aria-describedby":"notes-char-count notes-description","aria-label":l("pages.input.notesPlaceholder")}),e.jsx("div",{id:"notes-description",className:"sr-only",children:l("pages.input.notesDescription",{maxLength:d})}),e.jsxs("div",{id:"notes-char-count",className:"text-right text-sm mt-2 "+(g?"text-orange-600 dark:text-orange-400 font-medium":"text-gray-600 dark:text-gray-400"),"aria-live":"polite","aria-label":l("aria.charactersEntered",{count:c,remaining:u}),children:[l("pages.input.characterCount",{count:c,max:d}),g&&e.jsxs("span",{className:"ml-2 text-orange-600 dark:text-orange-400",children:["(残り",u,"文字)"]})]})]})]})})});function H({field:a,onToggleDisplay:s}){const{t:d}=t(),{attributes:i,listeners:n,setNodeRef:c,transform:u,transition:g,isDragging:f}=O({id:a.fieldId}),{announcePolite:x}=l(),p={transform:q.Transform.toString(u),transition:g,opacity:f?.5:1},b=r.useCallback(e=>{e.stopPropagation(),e.preventDefault();const r=!a.defaultDisplay;s(a.fieldId),x(`${a.name}${d("dialogs.sortModal.toggledAnnouncement",{state:d(r?"dialogs.sortModal.visible":"dialogs.sortModal.hidden")})}`)},[a.fieldId,a.defaultDisplay,a.name,s,x,d]),h=r.useCallback(()=>{const e=!a.defaultDisplay;s(a.fieldId),x(`${a.name}${d("dialogs.sortModal.toggledAnnouncement",{state:d(e?"dialogs.sortModal.visible":"dialogs.sortModal.hidden")})}`)},[a.fieldId,a.defaultDisplay,a.name,s,x,d]),y={onEnter:h,onSpace:h},{handleKeyDown:v}=o(y),w=a.defaultDisplay?d("dialogs.sortModal.visibleDescription"):d("dialogs.sortModal.hiddenDescription");return e.jsx("div",{ref:c,style:p,className:"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-2 sm:p-3 hover:shadow-md transition-all duration-200 hover:border-purple-300 dark:hover:border-purple-400",...i,role:"listitem","aria-label":`${a.name}${d("common.item")} - ${w} ${d("accessibility.sortable")}`,children:e.jsxs("div",{className:"flex flex-col sm:grid sm:gap-3 sm:items-center gap-2",style:{gridTemplateColumns:"auto 1fr 1fr auto"},children:[e.jsxs("div",{className:"flex justify-between items-center sm:hidden",children:[e.jsx("div",{className:"text-lg font-medium text-gray-700 dark:text-gray-200",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400","aria-label":`${d("dialogs.sortModal.unit")}: ${a.unit||d("dialogs.sortModal.noUnit")}`,children:a.unit?`(${a.unit})`:"―"})]}),e.jsxs("div",{className:"flex justify-between items-center sm:hidden",children:[e.jsx("div",{children:a.defaultDisplay?e.jsx("button",{onClick:b,onKeyDown:v,className:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:bg-green-200 dark:hover:bg-green-900/50 focus:outline-none focus:ring-2 focus:ring-green-500 dark:focus:ring-green-400 focus:ring-offset-1 transition-colors duration-150","aria-label":`${a.name}${d("dialogs.sortModal.makeHidden")}`,"aria-pressed":"true",children:d("dialogs.sortModal.visible")}):e.jsx("button",{onClick:b,onKeyDown:v,className:"bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 dark:focus:ring-gray-400 focus:ring-offset-1 transition-colors duration-150","aria-label":`${a.name}${d("dialogs.sortModal.makeVisible")}`,"aria-pressed":"false",children:d("dialogs.sortModal.hidden")})}),e.jsx("div",{className:"flex justify-center cursor-move focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 focus:ring-offset-1 rounded p-1",tabIndex:0,role:"button","aria-label":`${a.name}${d("dialogs.sortModal.dragToSort")}`,...n,children:e.jsx(m,{className:"w-5 h-5 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-150","aria-hidden":"true"})})]}),e.jsxs("div",{className:"hidden sm:contents",children:[e.jsx("div",{className:"text-center border-r border-gray-200 dark:border-gray-600 pr-3",children:a.defaultDisplay?e.jsx("button",{onClick:b,onKeyDown:v,className:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:bg-green-200 dark:hover:bg-green-900/50 focus:outline-none focus:ring-2 focus:ring-green-500 dark:focus:ring-green-400 focus:ring-offset-1 transition-colors duration-150","aria-label":`${a.name}${d("dialogs.sortModal.makeHidden")}`,"aria-pressed":"true",children:d("dialogs.sortModal.visible")}):e.jsx("button",{onClick:b,onKeyDown:v,className:"bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 dark:focus:ring-gray-400 focus:ring-offset-1 transition-colors duration-150","aria-label":`${a.name}${d("dialogs.sortModal.makeVisible")}`,"aria-pressed":"false",children:d("dialogs.sortModal.hidden")})}),e.jsx("div",{className:"text-lg font-medium text-gray-700 dark:text-gray-200 border-r border-gray-200 dark:border-gray-600 pr-3 text-right",children:a.name}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400 border-r border-gray-200 dark:border-gray-600 pr-3 text-left","aria-label":`${d("dialogs.sortModal.unit")}: ${a.unit||d("dialogs.sortModal.noUnit")}`,children:a.unit?`(${a.unit})`:"―"}),e.jsx("div",{className:"flex justify-center cursor-move focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 focus:ring-offset-1 rounded p-1",tabIndex:0,role:"button","aria-label":`${a.name}${d("dialogs.sortModal.dragToSort")}`,...n,children:e.jsx(m,{className:"w-5 h-5 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-150","aria-hidden":"true"})})]})]})})}B.displayName="NotesInput";const L=({isOpen:s,onClose:d,fields:i,onDragEnd:m,onSave:f,onToggleDisplay:x})=>{const{t:p}=t(),{modalProps:b}=n(s),{announcePolite:h}=l(),y={onEscape:d},{handleKeyDown:v}=o(y),w=C(D(R),D(G,{coordinateGetter:P})),k=r.useCallback(e=>{const{active:r,over:a}=e;if(r.id!==(null==a?void 0:a.id)){m(e);const t=i.find(e=>e.fieldId===r.id),s=i.find(e=>e.fieldId===(null==a?void 0:a.id));t&&s&&h(`${t.name}${p("dialogs.sortModal.dragEndAnnouncement",{target:s.name})}`)}},[m,i,h,p]),j=r.useCallback(()=>{f(),h(p("dialogs.sortModal.savedAnnouncement"))},[f,h,p]);return r.useEffect(()=>{s&&h(p("dialogs.sortModal.openedAnnouncement"))},[s,h,p]),r.useEffect(()=>(s&&(document.body.style.overflow="hidden",document.body.style.paddingRight="0px"),()=>{document.body.style.overflow="",document.body.style.paddingRight=""}),[s]),s?a.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",...b,children:[e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.3)"},onClick:d}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsxs("div",{className:"relative w-full max-w-sm sm:max-w-xl transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 p-4 sm:p-6 text-left align-middle shadow-xl transition-all",onKeyDown:v,onClick:e=>e.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold leading-6 text-gray-900 dark:text-white mb-4 sm:mb-6 flex items-center gap-2",id:"sort-modal-title",children:[e.jsx(c,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-600 dark:text-purple-400","aria-hidden":"true"}),p("dialogs.sortModal.title")]}),e.jsx("div",{className:"mb-4",id:"sort-modal-description",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-xs sm:text-sm",children:p("dialogs.sortModal.description")})}),e.jsx(M,{sensors:w,collisionDetection:$,onDragEnd:k,accessibility:{announcements:{onDragStart:({active:e})=>{const r=i.find(r=>r.fieldId===e.id);return`${(null==r?void 0:r.name)||"アイテム"}${p("dialogs.sortModal.dragStartAnnouncement")}`},onDragOver:({active:e,over:r})=>{const a=i.find(r=>r.fieldId===e.id),t=i.find(e=>e.fieldId===(null==r?void 0:r.id));return a&&t?`${a.name}${p("dialogs.sortModal.dragOverAnnouncement",{target:t.name})}`:""},onDragEnd:({active:e,over:r})=>{const a=i.find(r=>r.fieldId===e.id),t=i.find(e=>e.fieldId===(null==r?void 0:r.id));return e.id===(null==r?void 0:r.id)?`${(null==a?void 0:a.name)||"アイテム"}${p("dialogs.sortModal.dragReturnAnnouncement")}`:a&&t?`${a.name}${p("dialogs.sortModal.dragEndAnnouncement",{target:t.name})}`:`${(null==a?void 0:a.name)||"アイテム"}${p("dialogs.sortModal.dragCompleteAnnouncement")}`},onDragCancel:({active:e})=>{const r=i.find(r=>r.fieldId===e.id);return`${(null==r?void 0:r.name)||"アイテム"}${p("dialogs.sortModal.dragCancelAnnouncement")}`}}},children:e.jsx(T,{items:i.map(e=>e.fieldId),strategy:A,children:e.jsx("div",{className:"space-y-2 max-h-[50vh] sm:max-h-[60vh] overflow-y-auto pr-1 sm:pr-2",role:"list","aria-label":p("dialogs.sortModal.listLabel"),"aria-describedby":"sort-modal-description",children:i.map(r=>e.jsx(H,{field:r,onToggleDisplay:x},r.fieldId))})})}),e.jsxs("div",{className:"mt-4 sm:mt-6 flex flex-col sm:flex-row gap-3 sm:justify-end",role:"group","aria-label":p("dialogs.sortModal.buttonsLabel"),children:[e.jsxs("button",{type:"button",className:"bg-gray-400 dark:bg-gray-600 text-white px-4 sm:px-6 py-2 rounded-lg shadow-md hover:bg-gray-500 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 dark:focus:ring-gray-400 focus:ring-offset-2 transition-colors duration-200 font-medium flex items-center justify-center gap-2 text-sm sm:text-base",onClick:d,"aria-label":p("dialogs.sortModal.cancelLabel"),children:[e.jsx(u,{className:"w-4 h-4","aria-hidden":"true"}),p("common.cancel")]}),e.jsxs("button",{type:"button",className:"bg-purple-600 dark:bg-purple-700 text-white px-4 sm:px-6 py-2 rounded-lg shadow-md hover:bg-purple-700 dark:hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 focus:ring-offset-2 transition-colors duration-200 font-medium flex items-center justify-center gap-2 text-sm sm:text-base",onClick:j,"aria-label":p("dialogs.sortModal.saveLabel"),children:[e.jsx(g,{className:"w-4 h-4","aria-hidden":"true"}),p("common.save")]})]})]})})]}),document.body):null};var K=(e=>(e.CONNECTION_FAILED="connection_failed",e.TRANSACTION_FAILED="transaction_failed",e.DATA_CORRUPTED="data_corrupted",e.QUOTA_EXCEEDED="quota_exceeded",e.VERSION_ERROR="version_error",e.UNKNOWN="unknown",e))(K||{});function V(){const{showError:e,showWarning:a}=f(),t=r.useCallback((r,t={})=>{const{showToast:s=!0,logToConsole:d=!0,context:i,fallbackMessage:n}=t,l=function(e){if(e&&"object"==typeof e&&"type"in e&&"retryable"in e&&"message"in e){const r=e;if(Object.values(K).includes(r.type)){const r=e;return{type:"database",message:r.message,originalError:r.originalError,context:{dbErrorType:r.type,retryable:r.retryable}}}}if(e instanceof Error){const r=e.message.toLowerCase();return r.includes("indexeddb")||r.includes("database")||r.includes("store")?{type:"database",message:"データベース操作でエラーが発生しました",originalError:e}:r.includes("parse")||r.includes("json")||r.includes("csv")?{type:"parse",message:"データの解析でエラーが発生しました",originalError:e}:r.includes("validation")||r.includes("必須")||r.includes("形式")?{type:"validation",message:e.message,originalError:e}:r.includes("network")||r.includes("fetch")||r.includes("request")?{type:"network",message:"ネットワークエラーが発生しました",originalError:e}:{type:"unknown",message:e.message,originalError:e}}return{type:"unknown",message:"予期しないエラーが発生しました",context:{originalError:e}}}(r);d&&function(e,r){var a;const t=r?`[${r}] ${e.message}`:e.message;e.originalError?console.error(t,e.originalError):console.error(t,e.context),"database"===e.type&&(null==(a=e.context)?void 0:a.dbErrorType)&&console.error("Database Error Details:",{dbErrorType:e.context.dbErrorType,retryable:e.context.retryable,context:r})}(l,i);const o=n||function(e){var r;switch(e.type){case"validation":return e.message;case"database":if(null==(r=e.context)?void 0:r.dbErrorType){const r=e.context.dbErrorType,a=e.context.retryable;switch(r){case"quota_exceeded":return"ストレージ容量が不足しています。不要なデータを削除してから再度お試しくださいませ。";case"connection_failed":return a?"データベース接続に失敗しました。しばらく待ってから再度お試しくださいませ。":"データベース接続に問題があります。ページを再読み込みしてお試しくださいませ。";case"transaction_failed":return"データベース処理中にエラーが発生しました。もう一度お試しくださいませ。";case"data_corrupted":return"データが破損している可能性があります。管理画面からデータの確認をお勧めいたします。";case"version_error":return"データベースの更新中です。ページを再読み込みしてお試しくださいませ。";default:return e.message||"データベース操作でエラーが発生いたしました。"}}return"データの保存・読み込みに失敗いたしました。もう一度お試しくださいませ。";case"parse":return"ファイルの形式が正しくありません。ファイルの内容をご確認くださいませ。";case"network":return"ネットワーク接続に問題があります。接続状況をご確認くださいませ。";case"permission":return"この操作を実行する権限がありません。";default:return e.message||"予期しないエラーが発生いたしました。"}}(l);return s&&("validation"===l.type?a(o):e(o)),l},[e,a]),s=r.useCallback(async(e,r={})=>{try{return await e()}catch(a){return t(a,r),null}},[t]),d=r.useCallback((e,r={})=>e.map(({error:e,context:a})=>t(e,{...r,context:a})),[t]);return{handleError:t,handleAsyncError:s,handleBatchErrors:d}}const Y=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,U=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,W=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`;function Q(){const{t:a,translateFieldName:s,translateError:d,getAriaLabel:n,getAnnouncement:o}=t(),{announcePolite:m}=l();p(),V();const{fields:C,loadFields:D,addRecord:M,loadRecords:$,records:T,fieldsOperation:A}=x(),{showSuccess:P,showError:G}=f(),R=function(){const{t:e,getAnnouncement:a}=t(),{fields:s,loadFields:d,addField:i,updateField:n,deleteField:l}=x(),{showSuccess:o,showError:c}=f(),{handleAsyncError:u}=V(),[g,m]=r.useState(!1),[p,b]=r.useState(!1),[h,y]=r.useState({name:"",type:"number",unit:"",excludeFromGraph:!1}),[v,w]=r.useState(null),[k,j]=r.useState({excludeFromGraph:!1}),[N,S]=r.useState(null),[F,I]=r.useState(null),[E,C]=r.useState({excludeFromGraph:!1}),[D,M]=r.useState(new Set),[$,T]=r.useState(new Set),[A,P]=r.useState(new Set),[G,R]=r.useState(!1),[O,q]=r.useState([]),_=r.useRef([]),B=r.useCallback(()=>0===s.length?1:Math.max(...s.map(e=>e.order||0))+1,[s]),H=r.useCallback(()=>s.filter(e=>!1===e.defaultDisplay).sort((e,r)=>(e.order||999)-(r.order||999)),[s]),L=r.useCallback(async r=>{if(r.preventDefault(),S(null),!h.name.trim())return void S(e("validation.fieldNameInput"));if(s.some(e=>e.name===h.name.trim()))return void S(e("validation.duplicateFieldName"));const t=h.name.trim().replace(/\s+/g,"_").toLowerCase();await u(async()=>{var e;return await i({fieldId:t,name:h.name.trim(),type:h.type,unit:(null==(e=h.unit)?void 0:e.trim())||void 0,order:B(),defaultDisplay:!1,excludeFromGraph:!!h.excludeFromGraph}),M(e=>new Set([...e,t])),y({name:"",type:"number",unit:"",excludeFromGraph:!1}),b(!1),m(!1),await d(),!0},{context:e("actions.add"),fallbackMessage:e("errors.general")})&&o(a("fieldAddedSuccess"))},[h,s,i,B,u,d,o]),K=r.useCallback(e=>{w(e.fieldId),j({name:e.name,unit:e.unit,excludeFromGraph:e.excludeFromGraph??!1})},[]),Y=r.useCallback(async()=>{var r;if(!v||!(null==(r=k.name)?void 0:r.trim()))return w(null),j({excludeFromGraph:!1}),void T(new Set);const t=s.find(e=>e.fieldId===v);t&&(await u(async()=>{var e;return await n({...t,name:k.name.trim(),unit:(null==(e=k.unit)?void 0:e.trim())||void 0,excludeFromGraph:!!k.excludeFromGraph}),await d(),!0},{context:e("actions.edit"),fallbackMessage:e("errors.general")})&&o(a("fieldEditedSuccess")),w(null),j({excludeFromGraph:!1}),T(new Set))},[v,k,s,n,u,d,o]),U=r.useCallback(e=>{s.find(r=>r.fieldId===e)&&(M(r=>new Set([...r,e])),m(!1),P(new Set),o(a("fieldTempDisplayAdded")))},[s,o]),W=r.useCallback(async e=>{const r=s.find(r=>r.fieldId===e);if(!r)return;const t={...r,defaultDisplay:!0},i=s.map(r=>r.fieldId===e?t:r);x.setState({fields:i});try{await n(t),M(r=>{const a=new Set(r);return a.delete(e),a}),P(new Set),m(!1),await d(),o(a("fieldDisplayChanged"))}catch(l){x.setState({fields:s});const e=l instanceof Error?l.message:"表示状態の変更に失敗しました";c(e),console.error("表示状態変更エラー:",l)}},[s,n,u,d,o]),Q=r.useCallback(e=>{I(e.fieldId),C({name:e.name,unit:e.unit,excludeFromGraph:e.excludeFromGraph??!1}),P(new Set)},[]),X=r.useCallback(async()=>{var r;if(!F||!(null==(r=E.name)?void 0:r.trim()))return I(null),C({excludeFromGraph:!1}),void P(new Set);const t=s.find(e=>e.fieldId===F);t&&(await u(async()=>{var e;return await n({...t,name:E.name.trim(),unit:(null==(e=E.unit)?void 0:e.trim())||void 0,order:t.order,defaultDisplay:t.defaultDisplay,excludeFromGraph:!!E.excludeFromGraph}),await d(),!0},{context:e("actions.edit"),fallbackMessage:e("errors.general")})&&o(a("fieldEditedSuccess")),I(null),C({excludeFromGraph:!1}),P(new Set))},[F,E,s,n,u,d,o]),J=r.useCallback(async r=>{window.confirm(e("common.confirmDeleteField",{fieldName:r.name}))&&await u(async()=>(await l(r.fieldId),await d(),P(new Set),!0),{context:e("actions.delete"),fallbackMessage:e("errors.general")})&&o(a("fieldDeletedSuccess"))},[l,u,d,o]),Z=r.useCallback(e=>{T(r=>{const a=new Set(r);return a.has(e)?a.delete(e):a.add(e),a})},[]),ee=r.useCallback(e=>$.has(e),[$]),re=r.useCallback(()=>{T(new Set)},[]),ae=r.useCallback(e=>{P(r=>{const a=new Set(r);return a.has(e)?a.delete(e):a.add(e),a})},[]),te=r.useCallback(e=>A.has(e),[A]),se=r.useCallback(()=>{P(new Set)},[]),de=r.useCallback(async()=>{let r=s;if(0===r.length)try{await d();const{fields:a}=x.getState();if(r=a,0===r.length)return void c(e("errors.fieldDataNotFound"))}catch(t){return void c(e("errors.fieldDataLoadFailed"))}const a=[...r].sort((e,r)=>(e.order||999)-(r.order||999));q(a),_.current=a,R(!0)},[s,d,c]),ie=r.useCallback(e=>{const{active:r,over:a}=e;if(a&&r.id!==a.id){const e=O.findIndex(e=>e.fieldId===r.id),t=O.findIndex(e=>e.fieldId===a.id),s=z(O,e,t);q(s),_.current=s}},[O]),ne=r.useCallback(async()=>{await u(async()=>{const e=_.current.map((e,r)=>{const a={...e,order:r+1};return n(a)});return await Promise.all(e),await new Promise(e=>setTimeout(e,50)),await d(),R(!1),!0},{context:e("actions.sort"),fallbackMessage:e("errors.general")})&&o(a("sortOrderSaved"))},[n,u,d,o]),le=r.useCallback(async e=>{await u(async()=>(await n({...e,defaultDisplay:!1}),M(r=>{const a=new Set(r);return a.delete(e.fieldId),a}),T(new Set),await d(),!0),{context:"項目非表示",fallbackMessage:"項目の非表示に失敗しました"})&&o(a("fieldHidden"))},[n,u,d,o]),oe=r.useCallback(async e=>{const r=O.find(r=>r.fieldId===e);if(!r)return;const a={...r,defaultDisplay:!r.defaultDisplay};await u(async()=>{await n(a);const r=O.map(r=>r.fieldId===e?a:r);q(r),_.current=r;const t=s.map(r=>r.fieldId===e?a:r);return x.setState({fields:t}),a.defaultDisplay?M(r=>{const a=new Set(r);return a.delete(e),a}):s.some(r=>r.fieldId===e&&(r.defaultDisplay||D.has(e)))&&M(r=>new Set([...r,e])),!0},{context:"モーダル内表示状態変更",fallbackMessage:"表示状態の変更に失敗しました"})},[O,s,D,n,u]);return{showSelectField:g,setShowSelectField:m,showAddField:p,setShowAddField:b,newField:h,setNewField:y,editFieldId:v,setEditFieldId:w,editField:k,setEditField:j,addFieldError:N,editingExistingFieldId:F,setEditingExistingFieldId:I,editingExistingField:E,setEditingExistingField:C,temporaryDisplayFields:D,showSortModal:G,setShowSortModal:R,sortableFields:O,getHiddenFields:H,handleAddField:L,handleEditField:K,handleEditFieldSave:Y,handleShowExistingField:U,handleShowExistingFieldPermanently:W,handleEditExistingField:Q,handleEditExistingFieldSave:X,handleDeleteExistingField:J,toggleButtons:Z,areButtonsShown:ee,toggleSelectButtons:ae,areSelectButtonsShown:te,handleOpenSortModal:de,handleDragEnd:ie,handleSaveSortOrder:ne,handleHideField:le,handleToggleDisplayInModal:oe,clearButtons:re,clearSelectButtons:se}}(),[O,q]=r.useState({}),[H,K]=r.useState(null),[Q,X]=r.useState(()=>Y(new Date)),[J,Z]=r.useState(()=>U(new Date)),[ee,re]=r.useState(""),[ae,te]=r.useState(!1),[se,de]=r.useState({});r.useEffect(()=>(b.trackRender.start("RecordInput"),()=>{b.trackRender.end("RecordInput")})),r.useEffect(()=>{(async()=>{try{await S("load-fields-input",async()=>{await D()}),await S("load-records-input",async()=>{await $()})}catch(e){console.error("Data loading error:",e)}})()},[D,$]),r.useEffect(()=>{},[C.length,T.length,O,Q,J]);const ie=(e,r)=>{const t=b.trackInteraction.start("field-change");q(a=>({...a,[e]:r})),K(null);const d=C.find(r=>r.fieldId===e);"boolean"===(null==d?void 0:d.type)&&"boolean"==typeof r&&m(o("fieldChanged",{fieldName:s(d.fieldId),value:a(r?"fields.yes":"fields.no")})),b.trackInteraction.end(t,"field-change")},ne=(e,r)=>null!=r&&("boolean"===e.type?!0===r||!1===r:"number"===e.type?"number"==typeof r&&!isNaN(r):"string"==typeof r&&r.trim().length>0),le=e=>{const r=b.trackInteraction.start("set-last-value"),a=(e=>{const r=[...T].filter(r=>r.fieldId===e).sort((e,r)=>new Date(r.datetime).getTime()-new Date(e.datetime).getTime())[0];return(null==r?void 0:r.value)??""})(e);if(""!==a){ie(e,a);const r=C.find(r=>r.fieldId===e);r&&m(o("previousValueSet",{fieldName:s(r.fieldId)}))}b.trackInteraction.end(r,"set-last-value")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-sky-50 to-blue-100 dark:from-gray-800 dark:to-gray-900 p-2 sm:p-4",children:e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto px-2 sm:px-0",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold text-gray-800 dark:text-white mb-2 whitespace-nowrap",children:a("pages.input.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm sm:text-base",children:a("pages.input.description")})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const r=b.trackInteraction.start("form-submit"),t=(()=>{if(!F(Q))return"日付の形式が正しくありません (YYYY-MM-DD)";if(!I(J))return"時刻の形式が正しくありません (HH:mm)";for(const e of C){const r=O[e.fieldId];if(ne(e,r)){const a=E(r,e.type,{required:!1,min:"number"===e.type?0:void 0,max:"number"===e.type?1e4:void 0});if(!a.isValid)return`${e.name}: ${a.errors.join(", ")}`}}return ee.length>500?"備考は500文字以内で入力してください":""!==ee.trim()||C.some(e=>ne(e,O[e.fieldId]))?null:a("validation.required")})();if(t)return K(t),m(a("errors.inputError",{message:t})),void b.trackInteraction.end(r,"form-submit-validation-error");try{let e=0;const t=[];for(const r of C){const a=O[r.fieldId];if(ne(r,a)){const s=new Date(`${Q}T${J}:00`);t.push({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fieldId:r.fieldId,value:a,date:Q,time:J,datetime:W(s),excludeFromGraph:!!se[r.fieldId]}),e++}}if(""!==ee.trim()){const r=new Date(`${Q}T${J}:00`);t.push({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fieldId:"notes",value:ee.trim(),date:Q,time:J,datetime:W(r),excludeFromGraph:!1}),e++}await S("add-records-batch",async()=>{for(const e of t)await M(e)},t.length),m(o("recordSaved",{count:e})),q({}),P(a("pages.input.recordSuccess")),re("");const s=new Date;X(Y(s)),Z(U(s)),de({}),b.trackInteraction.end(r,"form-submit-success")}catch(s){console.error("Save error:",s);const e=d("database",a("pages.input.recordError"));K(e),G(e),b.trackInteraction.end(r,"form-submit-error")}},className:"space-y-8 mb-12",children:[e.jsx(_,{recordDate:Q,recordTime:J,onDateChange:X,onTimeChange:Z,onSetCurrentDateTime:()=>{const e=new Date;X(Y(e)),Z(U(e)),m(o("currentTimeSet"))}}),e.jsx(B,{value:ee,onChange:re}),[...C].filter(e=>!1!==e.defaultDisplay||R.temporaryDisplayFields.has(e.fieldId)).sort((e,r)=>(e.order||999)-(r.order||999)).map(r=>e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md",children:R.editFieldId===r.fieldId?e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch mb-4",children:[e.jsx("div",{className:"text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 pb-2 sm:pb-0",children:e.jsx("input",{type:"text",value:R.editField.name??"",onChange:e=>R.setEditField(r=>({...r,name:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:a("pages.input.fieldManagement.fieldName")})}),e.jsx("div",{className:"pl-0 sm:pl-2 pt-2 sm:pt-0 flex flex-col gap-2",children:"boolean"===r.type?e.jsx("div",{className:"h-full"}):e.jsx("input",{type:"text",value:R.editField.unit??"",onChange:e=>R.setEditField(r=>({...r,unit:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:a("pages.input.fieldManagement.unitPlaceholder")})})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsx(h,{variant:"success",size:"md",icon:g,onClick:R.handleEditFieldSave,className:"flex-1 sm:min-w-[120px]",children:a("actions.save")}),e.jsx(h,{variant:"secondary",size:"md",icon:u,onClick:()=>{R.setEditFieldId(null),R.setEditField({}),R.clearButtons()},className:"flex-1 sm:min-w-[120px]",children:a("actions.cancel")})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center w-full cursor-pointer",onClick:()=>R.toggleButtons(r.fieldId),children:[e.jsx("span",{className:"text-right text-lg font-semibold text-gray-700 dark:text-gray-200 select-none truncate",children:s(r.fieldId)}),e.jsxs("div",{className:"flex items-center gap-2 w-full",children:["boolean"===r.type?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{type:"button",variant:!0===O[r.fieldId]?"primary":"secondary",size:"sm",onClick:e=>{e.stopPropagation(),q(e=>{if(!0===e[r.fieldId]){const a={...e};return delete a[r.fieldId],a}return{...e,[r.fieldId]:!0}})},className:(!0===O[r.fieldId]?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600")+" min-w-[48px] h-10 px-0 text-sm rounded-lg border-2 font-medium transition-colors duration-200","aria-label":n("setToYes",{fieldName:s(r.fieldId)}),children:a("fields.yes")}),e.jsx(h,{type:"button",variant:!1===O[r.fieldId]?"primary":"secondary",size:"sm",onClick:e=>{e.stopPropagation(),q(e=>{if(!1===e[r.fieldId]){const a={...e};return delete a[r.fieldId],a}return{...e,[r.fieldId]:!1}})},className:(!1===O[r.fieldId]?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600")+" min-w-[48px] h-10 px-0 text-sm rounded-lg border-2 font-medium transition-colors duration-200","aria-label":n("setToNo",{fieldName:s(r.fieldId)}),children:a("fields.no")})]}):e.jsx("input",{type:"number"===r.type?"number":"text",value:String(O[r.fieldId]||""),onChange:e=>{e.stopPropagation(),ie(r.fieldId,"number"===r.type?Number(e.target.value)||"":e.target.value)},className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400","aria-label":n("inputField",{fieldName:s(r.fieldId)})}),r.unit&&e.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-300 whitespace-nowrap",children:r.unit})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{type:"button",variant:se[r.fieldId]?"primary":"secondary",size:"sm",onClick:e=>{e.stopPropagation(),de(e=>({...e,[r.fieldId]:!e[r.fieldId]}))},className:(se[r.fieldId]?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600")+" min-w-[48px] h-10 px-0 text-sm rounded-lg border-2 font-medium transition-colors duration-200","aria-label":a("pages.input.excludeFromGraphShort"),children:a("pages.input.excludeFromGraphShort")||"除外"})})]}),R.areButtonsShown(r.fieldId)&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-gray-200",children:[e.jsx(h,{variant:"primary",size:"sm",icon:y,onClick:e=>{e.stopPropagation(),R.handleEditField(r)},"aria-label":n("editField",{fieldName:s(r.fieldId)}),children:a("actions.edit")}),e.jsx(h,{variant:"danger",size:"sm",icon:v,onClick:e=>{e.stopPropagation(),R.handleHideField(r)},"aria-label":n("hideField",{fieldName:s(r.fieldId)}),children:a("actions.hide")}),e.jsx(h,{variant:"sky",size:"sm",icon:w,onClick:e=>{e.stopPropagation(),le(r.fieldId)},"aria-label":n("setPreviousValue",{fieldName:s(r.fieldId)}),children:a("actions.lastValue")})]})]})},r.fieldId)),H&&e.jsxs("div",{id:"form-error",className:"text-red-600 dark:text-red-400 font-semibold bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",role:"alert","aria-live":"polite",children:[e.jsx("span",{className:"sr-only",children:a("aria.formError")}),H]}),e.jsx(h,{type:"submit",variant:"success",size:"lg",icon:i,fullWidth:!0,"aria-describedby":H?"form-error":void 0,children:a("pages.input.record")})]}),e.jsx("div",{className:"mb-8",children:R.showSelectField?e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md",children:[e.jsxs("h3",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),a("pages.input.fieldManagement.selectFieldsTitle")]}),e.jsxs("div",{className:"space-y-4",children:[R.getHiddenFields().length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left",children:a("pages.input.fieldManagement.existingFields")}),e.jsx("div",{className:"space-y-3",children:R.getHiddenFields().map(r=>e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:R.editingExistingFieldId===r.fieldId?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch",children:[e.jsx("div",{className:"text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 pb-2 sm:pb-0",children:e.jsx("input",{type:"text",value:R.editingExistingField.name??"",onChange:e=>R.setEditingExistingField(r=>({...r,name:e.target.value})),className:"w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400",placeholder:a("pages.input.fieldManagement.fieldName")})}),e.jsx("div",{className:"pl-0 sm:pl-2 pt-2 sm:pt-0",children:e.jsx("input",{type:"text",value:R.editingExistingField.unit??"",onChange:e=>R.setEditingExistingField(r=>({...r,unit:e.target.value})),className:"w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400",placeholder:a("pages.input.fieldManagement.unitPlaceholder")})})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center pt-2 border-t border-gray-200",children:[e.jsx(h,{variant:"success",size:"md",icon:g,onClick:R.handleEditExistingFieldSave,className:"flex-1 sm:min-w-[120px]",children:a("actions.save")}),e.jsx(h,{variant:"secondary",size:"md",icon:u,onClick:()=>{R.setEditingExistingFieldId(null),R.clearSelectButtons()},className:"flex-1 sm:min-w-[120px]",children:a("actions.cancel")})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch cursor-pointer",onClick:()=>R.toggleSelectButtons(r.fieldId),children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 pb-2 sm:pb-0",children:r.name}),e.jsx("div",{className:"text-lg text-gray-800 dark:text-gray-200 font-semibold pl-0 sm:pl-2 text-left pt-2 sm:pt-0",children:r.unit?`(${r.unit})`:""})]}),R.areSelectButtonsShown(r.fieldId)&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mt-4 pt-4 border-t border-gray-200",children:[e.jsx(h,{variant:"success",size:"sm",icon:g,onClick:()=>R.handleShowExistingFieldPermanently(r.fieldId),children:a("actions.display")}),e.jsx(h,{variant:"teal",size:"sm",icon:k,onClick:()=>R.handleShowExistingField(r.fieldId),children:a("actions.add")}),e.jsx(h,{variant:"primary",size:"sm",icon:y,onClick:()=>R.handleEditExistingField(r),children:a("actions.edit")}),e.jsx(h,{variant:"danger",size:"sm",icon:j,onClick:()=>R.handleDeleteExistingField(r),children:a("actions.delete")})]})]})},r.fieldId))})]}),R.showAddField&&e.jsxs("form",{onSubmit:R.handleAddField,className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 mb-4 text-left flex items-center gap-2",children:[e.jsx(k,{className:"w-6 h-6 text-green-600 dark:text-green-400","aria-hidden":"true"}),a("pages.input.fieldManagement.addNewField")]}),e.jsxs("fieldset",{className:"space-y-4",children:[e.jsx("legend",{className:"sr-only",children:a("aria.newFieldDetails")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"new-field-name",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:[a("pages.input.fieldManagement.fieldNameRequired")," ",e.jsx("span",{className:"text-red-600","aria-label":a("fields.required"),children:"*"})]}),e.jsx("input",{id:"new-field-name",type:"text",value:R.newField.name,onChange:e=>R.setNewField(r=>({...r,name:e.target.value})),className:"w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400",placeholder:a("pages.input.fieldManagement.fieldNamePlaceholder"),required:!0,"aria-required":"true","aria-describedby":"new-field-name-desc","aria-invalid":R.addFieldError&&R.addFieldError.includes(a("validation.fieldNameRequired"))?"true":"false"}),e.jsx("div",{id:"new-field-name-desc",className:"sr-only",children:a("aria.fieldNameDescription")})]}),e.jsxs("div",{className:"w-full sm:w-32",children:[e.jsxs("label",{htmlFor:"new-field-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:[a("pages.input.fieldManagement.dataTypeRequired")," ",e.jsx("span",{className:"text-red-600","aria-label":a("fields.required"),children:"*"})]}),e.jsxs("select",{id:"new-field-type",value:R.newField.type,onChange:e=>R.setNewField(r=>({...r,type:e.target.value})),className:"w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400",required:!0,"aria-required":"true","aria-describedby":"new-field-type-desc",children:[e.jsx("option",{value:"number",children:a("fields.types.number")}),e.jsx("option",{value:"string",children:a("fields.types.string")}),e.jsx("option",{value:"boolean",children:a("fields.types.boolean")})]}),e.jsx("div",{id:"new-field-type-desc",className:"sr-only",children:a("aria.dataTypeDescription")})]}),e.jsxs("div",{className:"w-full sm:w-32 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"new-field-unit",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:a("pages.input.fieldManagement.unitOptional")}),e.jsx("input",{id:"new-field-unit",type:"text",value:R.newField.unit,onChange:e=>R.setNewField(r=>({...r,unit:e.target.value})),placeholder:a("fields.inputPlaceholder",{example:"kg"}),className:"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 dark:focus:ring-blue-400 focus:border-blue-600 dark:focus:border-blue-400","aria-describedby":"unit-description","aria-label":a("aria.unitFieldDescription")})]})]}),R.addFieldError&&e.jsxs("div",{id:"add-field-error",className:"text-red-600 dark:text-red-400 font-semibold bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-200 dark:border-red-800",role:"alert","aria-live":"polite",children:[e.jsx("span",{className:"sr-only",children:a("aria.formError")}),R.addFieldError]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 pt-2",children:[e.jsxs("button",{type:"submit",className:"bg-teal-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md hover:bg-teal-600 transition-colors duration-200 font-medium flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 text-sm sm:text-base flex-1 sm:min-w-[120px]","aria-describedby":R.addFieldError?"add-field-error":void 0,children:[e.jsx(k,{className:"w-4 h-4","aria-hidden":"true"}),a("actions.add")]}),e.jsxs("button",{type:"button",onClick:()=>R.setShowAddField(!1),className:"bg-gray-400 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 text-sm sm:text-base flex-1 sm:min-w-[120px]",children:[e.jsx(u,{className:"w-4 h-4","aria-hidden":"true"}),a("actions.cancel")]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[!R.showAddField&&e.jsxs("button",{type:"button",onClick:()=>R.setShowAddField(!0),className:"bg-teal-500 text-white px-3 sm:px-4 py-2 rounded-lg shadow-md hover:bg-teal-600 transition-colors duration-200 font-medium flex items-center justify-center gap-2 text-sm sm:text-base whitespace-nowrap",children:[e.jsx(k,{className:"w-4 h-4"}),a("pages.input.fieldManagement.addNewField")]}),e.jsxs("button",{type:"button",onClick:()=>R.setShowSelectField(!1),className:"bg-gray-500 text-white px-3 sm:px-4 py-2 rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-200 font-medium flex items-center justify-center gap-2 text-sm sm:text-base",children:[e.jsx(N,{className:"w-4 h-4 sm:w-5 sm:h-5"}),a("actions.back")]})]})]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>R.setShowSelectField(!0),className:"bg-blue-500 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 font-medium flex items-center justify-center gap-2 text-sm sm:text-base","aria-label":n("showField",{fieldName:a("pages.input.selectFields")}),children:[e.jsx(w,{className:"w-4 h-4 sm:w-5 sm:h-5","aria-hidden":"true"}),a("pages.input.selectFields")]}),e.jsxs("button",{type:"button",onClick:R.handleOpenSortModal,disabled:A.loading||0===C.length,className:"px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors duration-200 font-medium flex items-center justify-center gap-2 text-sm sm:text-base "+(A.loading||0===C.length?"bg-gray-400 text-white cursor-not-allowed":"bg-purple-500 text-white hover:bg-purple-600"),"aria-label":n("sort",{fieldName:a("pages.input.sortFields")}),children:[e.jsx(c,{className:"w-4 h-4 sm:w-5 sm:h-5","aria-hidden":"true"}),A.loading?a("common.loading"):a("pages.input.sortFields")]})]})}),e.jsx(L,{isOpen:R.showSortModal,onClose:()=>R.setShowSortModal(!1),fields:R.sortableFields,onDragEnd:R.handleDragEnd,onSave:R.handleSaveSortOrder,onToggleDisplay:R.handleToggleDisplayInModal})]})})}export{Q as default};
