import{j as e}from"./ui-vendor-D7AUAfXm.js";import{a as t}from"./react-vendor-BzNAZZ5j.js";import{D as a,E as r,w as s,h as l,u as i,k as n,F as o,H as d,m as c,G as m,I as x,J as g,q as u}from"./index-_d5zLM54.js";import"./icons-vendor-DoCnAwwa.js";import"./state-vendor-O6FgWrPy.js";const p={primary:"bg-blue-500 hover:bg-blue-600 focus:ring-blue-500 text-white",success:"bg-green-600 hover:bg-green-700 focus:ring-green-600 text-white",warning:"bg-amber-500 hover:bg-amber-600 focus:ring-amber-500 text-white",danger:"bg-red-600 hover:bg-red-700 focus:ring-red-600 text-white",secondary:"bg-gray-400 hover:bg-gray-500 focus:ring-gray-400 text-white",purple:"bg-purple-600 hover:bg-purple-700 focus:ring-purple-600 text-white",teal:"bg-teal-500 hover:bg-teal-600 focus:ring-teal-500 text-white",sky:"bg-sky-500 hover:bg-sky-600 focus:ring-sky-500 text-white"},h={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},f="rounded-lg font-medium shadow-md transition-all duration-200 flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",b=({variant:t="primary",size:a="md",icon:r,iconPosition:s="left",loading:l=!1,fullWidth:i=!1,className:n="",children:o,disabled:d,...c})=>{const m=d||l,x=[f,p[t],h[a],i?"w-full":"w-auto","hover:shadow-lg",n].join(" "),g="lg"===a?"w-6 h-6":"sm"===a?"w-4 h-4":"w-5 h-5";return e.jsx("button",{className:x,disabled:m,...c,children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`animate-spin rounded-full border-2 border-current border-t-transparent ${g}`}),"読み込み中..."]}):e.jsxs(e.Fragment,{children:[r&&"left"===s&&e.jsx(r,{className:g,"aria-hidden":"true"}),o,r&&"right"===s&&e.jsx(r,{className:g,"aria-hidden":"true"})]})})},w={primary:"bg-blue-600",success:"bg-green-600",warning:"bg-amber-500",error:"bg-red-600"},j={sm:"h-2",md:"h-3",lg:"h-4"},v=({value:t,max:a=100,showPercentage:r=!0,showValue:s=!1,label:l,size:i="md",variant:n="primary",className:o="",animated:d=!0})=>{const c=Math.min(Math.max(t,0),a),m=c/a*100,x=["w-full bg-gray-200 rounded-full overflow-hidden",j[i],o].join(" "),g=["h-full transition-all duration-300 ease-out",w[n],d?"transition-all duration-300":""].join(" ");return e.jsxs("div",{className:"w-full",children:[(l||r||s)&&e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:l}),e.jsxs("div",{className:"text-sm text-gray-600 flex gap-2",children:[s&&e.jsxs("span",{children:[c," / ",a]}),r&&e.jsxs("span",{children:[Math.round(m),"%"]})]})]}),e.jsx("div",{className:x,role:"progressbar","aria-valuenow":c,"aria-valuemin":0,"aria-valuemax":a,children:e.jsx("div",{className:g,style:{width:`${m}%`}})})]})},y={success:{containerClass:"bg-green-50 border-green-200 text-green-700",iconClass:"text-green-600",defaultIcon:l},error:{containerClass:"bg-red-50 border-red-200 text-red-700",iconClass:"text-red-600",defaultIcon:s},warning:{containerClass:"bg-amber-50 border-amber-200 text-amber-700",iconClass:"text-amber-600",defaultIcon:r},info:{containerClass:"bg-blue-50 border-blue-200 text-blue-700",iconClass:"text-blue-600",defaultIcon:a}},N="p-4 rounded-lg border font-medium flex items-start gap-3 shadow-sm",k=({type:a,message:r,autoHide:s=!1,hideDelay:l=3e3,onHide:i,className:n="",icon:o})=>{const[d,c]=t.useState(!0),m=y[a],x=o||m.defaultIcon;if(t.useEffect(()=>{if(s&&l>0){const e=setTimeout(()=>{c(!1),null==i||i()},l);return()=>clearTimeout(e)}},[s,l,i]),!d)return null;const g=[N,m.containerClass,n].join(" ");return e.jsxs("div",{className:g,role:"alert","aria-live":"polite",children:[e.jsx(x,{className:`w-5 h-5 ${m.iconClass} flex-shrink-0 mt-0.5`,"aria-hidden":"true"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm leading-relaxed",children:r})})]})},$=t=>e.jsx(k,{type:"success",...t}),S=t=>e.jsx(k,{type:"error",...t}),D=t=>e.jsx(k,{type:"info",...t});function M(e){return`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}${String(e.getSeconds()).padStart(2,"0")}`}function I(){var a,s;const{t:l}=i(),{records:p,fields:h,loadRecords:f,loadFields:w,deleteAllData:j,initializeFields:y,addRecord:N}=n(),[k,I]=t.useState(null),[C,E]=t.useState(null),[F,O]=t.useState(0),[R,T]=t.useState(!1);t.useEffect(()=>{w(),f()},[w,f]);const U=[...p].sort((e,t)=>{const a=`${e.date} ${e.time}`;return`${t.date} ${t.time}`.localeCompare(a)}),z=async(e,t)=>{I(l("pages.export.importing"));try{const r=await e.text();let s;if("json"===t){if(s=JSON.parse(r),!Array.isArray(s))throw new Error("JSON file format is incorrect")}else s=(e=>{const t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim().split("\n");if(t.length<2)throw new Error("CSVファイルが空または形式が正しくありません");const a=e=>{const t=[];let a="",r=!1,s=0;for(;s<e.length;){const l=e[s];'"'===l?r&&'"'===e[s+1]?(a+='"',s+=2):(r=!r,s++):","!==l||r?(a+=l,s++):(t.push(a),a="",s++)}return t.push(a),t},r=a(t[0]),s=["id","date","time","datetime","fieldId","fieldName","value"];if(!s.every(e=>r.includes(e)))throw new Error(`CSV file format is incorrect. Required columns: ${s.join(", ")}`);const i=[];for(let o=1;o<t.length;o++)try{if(!t[o].trim())continue;const e=a(t[o]);if(e.length!==r.length)continue;const s={id:e[r.indexOf("id")],date:e[r.indexOf("date")],time:e[r.indexOf("time")],datetime:e[r.indexOf("datetime")],fieldId:e[r.indexOf("fieldId")],value:e[r.indexOf("value")]};if(!(s.id&&s.date&&s.time&&s.fieldId))continue;s.value===l("fields.yes")||"あり"===s.value?s.value=!0:s.value===l("fields.no")||"なし"===s.value?s.value=!1:isNaN(Number(s.value))||""===s.value||(s.value=Number(s.value)),i.push(s)}catch(n){throw new Error(`${o}行目の処理でエラーが発生しました: ${n instanceof Error?n.message:"不明なエラー"}`)}return i})(r);for(const e of s)if(!(e.id&&e.date&&e.time&&e.fieldId))throw new Error("Data is missing required fields");let i=0;for(const e of s)try{await N(e),i++}catch(a){}await f(),I(`✅ ${i}${l("pages.export.importSuccess")}`),setTimeout(()=>I(null),3e3)}catch(a){const e=a instanceof Error?a:new Error("Unknown error");I(`${l("pages.export.importError")} ${e.message}`),setTimeout(()=>I(null),5e3)}};return e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto px-2 sm:px-0",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white mb-12",children:l("pages.export.title")}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:l("pages.export.dataDetails")}),e.jsxs("div",{className:"text-base text-gray-600 dark:text-gray-300 space-y-3",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:l("pages.export.totalRecords")})," ",U.length]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:l("pages.export.period")})," ",U.length>0?`${null==(a=U[U.length-1])?void 0:a.date} 〜 ${null==(s=U[0])?void 0:s.date}`:l("pages.export.noData")]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:l("pages.export.fields")})," ",l("pages.export.allHealthFields")]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:l("pages.export.exportData")}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:l("pages.export.exportDescription")}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsx(b,{variant:"purple",size:"lg",icon:m,onClick:()=>{const e=function(e,t,a){return[["id","date","time","datetime","fieldId","fieldName","value"],...e.map(e=>{const r=t.find(t=>t.fieldId===e.fieldId);return[e.id,e.date,e.time,e.datetime,e.fieldId,r?r.name:"","boolean"==typeof e.value?e.value?a("fields.yes"):a("fields.no"):e.value]})].map(e=>e.map(String).map(e=>`"${e.replace(/"/g,'""')}"`).join(",")).join("\r\n")}(U,h,l),t=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`records-${M(new Date)}.csv`,r.click(),URL.revokeObjectURL(a)},fullWidth:!1,children:l("pages.export.exportCSV")}),e.jsx(b,{variant:"purple",size:"lg",icon:m,onClick:()=>{const e=JSON.stringify(U,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`records-${M(new Date)}.json`,r.click(),URL.revokeObjectURL(a)},fullWidth:!1,children:l("pages.export.exportJSON")})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:l("pages.export.importData")}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:l("pages.export.importDescription")}),k&&e.jsxs("div",{className:"mb-6",children:[k.includes("✅")&&e.jsx($,{message:k.replace("✅ ","")}),k.includes("❌")&&e.jsx(S,{message:k.replace("❌ ","")}),!k.includes("✅")&&!k.includes("❌")&&e.jsx(D,{message:k})]}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".csv,.json",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){const t=a.name.toLowerCase();let r;if(t.endsWith(".csv"))r="csv";else{if(!t.endsWith(".json"))return I(l("pages.export.unsupportedFileFormat")),setTimeout(()=>I(null),3e3),void(e.target.value="");r="json"}z(a,r)}e.target.value=""},className:"hidden",id:"data-import"}),e.jsxs("label",{htmlFor:"data-import",className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-medium shadow-md hover:bg-purple-700 hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2 w-auto cursor-pointer",children:[e.jsx(x,{className:"w-5 h-5"}),l("pages.export.selectFile")]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:l("pages.export.testData")}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:l("pages.export.testDataDescription")}),C&&e.jsxs("div",{className:"mb-6",children:[C.includes("✅")&&e.jsx($,{message:C.replace("✅ ","")}),C.includes("❌")&&e.jsx(S,{message:C.replace("❌ ","")}),!C.includes("✅")&&!C.includes("❌")&&e.jsx(D,{message:C})]}),R&&e.jsx("div",{className:"mb-6",children:e.jsx(v,{value:F,label:l("pages.export.generatingTestData"),showPercentage:!0,variant:"primary",size:"md"})}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsx(b,{variant:"purple",size:"lg",icon:g,onClick:()=>{window.confirm(l("pages.export.confirmGenerateTestData"))&&(async()=>{E(l("pages.export.generatingTestData")),T(!0),O(0);try{if(await w(),0===h.length)throw new Error("No fields exist. Please initialize fields first.");const t=100,a=30;let r=0;for(let s=0;s<t;s++){const i=Math.floor(Math.random()*a),n=new Date;n.setDate(n.getDate()-i);const o=n.getFullYear(),d=`${o}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,c=Math.floor(24*Math.random()),m=Math.floor(60*Math.random()),x=`${c.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`,g=`${d} ${x}`,u=h[Math.floor(Math.random()*h.length)];let p;if("boolean"===u.type)p=Math.random()>.5;else if("number"===u.type)p="weight"===u.fieldId?Math.round(10*(50+50*Math.random()))/10:"systolic_bp"===u.fieldId?Math.round(90+60*Math.random()):"diastolic_bp"===u.fieldId?Math.round(60+40*Math.random()):"heart_rate"===u.fieldId?Math.round(60+60*Math.random()):"body_temperature"===u.fieldId?Math.round(10*(35.5+2*Math.random()))/10:Math.round(100*Math.random()*10)/10;else if("notes"===u.fieldId){const e=["Feeling good today","A bit tired","Refreshed after exercise","Food was delicious","Want to sleep early","Great weather, feeling refreshed","Busy day at work","Nice weekend break",""];p=e[Math.floor(Math.random()*e.length)]}else p=`Test value ${Math.floor(1e3*Math.random())}`;const f={id:`test_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,date:d,time:x,datetime:g,fieldId:u.fieldId,value:p};try{await N(f),r++}catch(e){}O((s+1)/t*100),(s+1)%10==0&&E(`${l("pages.export.generatingTestData")}... ${s+1}${l("pages.export.testDataOf")}${t}`)}await f(),E(`✅ ${r}${l("pages.export.testDataSuccess")}`),setTimeout(()=>{E(null),O(0)},3e3)}catch(e){E(`${l("pages.export.testDataError")} ${e instanceof Error?e.message:"Unknown error"}`),setTimeout(()=>{E(null),O(0)},5e3)}finally{T(!1)}})()},fullWidth:!1,disabled:R,loading:R,children:l("pages.export.generateTestData")})})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-2xl shadow-md p-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-red-800 dark:text-red-400 mb-6 flex items-center gap-2",children:[e.jsx(r,{className:"w-6 h-6 text-red-600 dark:text-red-500"}),l("pages.export.dangerZone")]}),e.jsx("div",{className:"mb-6 text-left",children:e.jsx("p",{className:"text-base text-red-700 dark:text-red-300 mb-3",children:l("pages.export.dangerZoneDescription")})}),e.jsx(b,{variant:"danger",size:"lg",icon:u,onClick:async()=>{if(window.confirm(l("pages.export.confirmDeleteAll"))){if(window.confirm(l("pages.export.confirmDeleteAllFinal")))try{await j(),await y(),alert(l("pages.export.deleteAllSuccess"))}catch(e){alert(l("pages.export.deleteAllError"))}}},fullWidth:!1,children:l("pages.export.deleteAllData")})]})]})}export{I as default};
