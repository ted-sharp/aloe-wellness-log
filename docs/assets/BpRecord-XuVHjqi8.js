import{j as e}from"./ui-vendor-J9A7wRLG.js";import{a}from"./react-vendor-C4GzcRrE.js";import{u as t,H as l,a as s,b as r,g as i,d as n,c as o,e as c,f as d}from"./index-iJ_8w1vn.js";import{u as m,a as x,P as h,N as u,T as g}from"./useRecordForm-YTvlEujv.js";import{B as f}from"./Button-BI56QuZy.js";import{u as p,D as b}from"./useDateSelection-Cixq52XB.js";import"./icons-vendor-DCv9Y2bB.js";import"./state-vendor-RA6ewXRt.js";const y=[{min:0,max:90,color:"#6ec6f1",label:"低",range:"<90"},{min:90,max:120,color:"#7edfa0",label:"正常",range:"90-119"},{min:120,max:130,color:"#e6f7b2",label:"正常高値",range:"120-129"},{min:130,max:140,color:"#fff59d",label:"高値",range:"130-139"},{min:140,max:160,color:"#ffb74d",label:"Ⅰ度",range:"140-159"},{min:160,max:180,color:"#ff7043",label:"Ⅱ度",range:"160-179"},{min:180,max:300,color:"#d32f2f",label:"Ⅲ度",range:"180+"}],j=[{min:0,max:60,color:"#6ec6f1",label:"低",range:"<60"},{min:60,max:80,color:"#7edfa0",label:"正常",range:"60-79"},{min:80,max:90,color:"#fff59d",label:"高値",range:"80-89"},{min:90,max:100,color:"#ffb74d",label:"Ⅰ度",range:"90-99"},{min:100,max:110,color:"#ff7043",label:"Ⅱ度",range:"100-109"},{min:110,max:200,color:"#d32f2f",label:"Ⅲ度",range:"110+"}];function w(e,a){if(null==a)return 0;let t=0;for(let l=0;l<e.length;l++){const s=e[l];if(a<s.max){return t+100/e.length*((a-s.min)/(s.max-s.min))}t+=100/e.length}return 100}const v=({recordsOfDay:a})=>{const t=a.length?Math.min(...a.map(e=>e.systolic)):null,l=a.length?Math.min(...a.map(e=>e.diastolic)):null,s=w(y,t),r=w(j,l);return e.jsxs("div",{className:"w-full max-w-md mx-auto flex flex-col items-center gap-2 mb-2",children:[e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-full h-7 flex rounded overflow-hidden shadow",style:{minWidth:240},children:[y.map(a=>e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center",style:{background:a.color,minWidth:0},children:e.jsx("span",{className:"text-[10px] font-bold text-gray-800 dark:text-gray-900 select-none",style:{lineHeight:1},children:a.label})},a.label)),null!=t&&e.jsx("div",{className:"absolute left-0 top-0 w-full pointer-events-none",style:{height:"100%"},children:e.jsx("div",{style:{position:"absolute",left:`calc(${s}% - 0.65em)`,top:"50%",transform:"translateY(-50%)",color:"#dc2626",fontSize:"1.3em",textShadow:"0 0 2px #fff, 0 0 2px #fff, 1px 1px 2px #0002",zIndex:2},"aria-label":"現在の収縮期位置",children:"▼"})})]}),e.jsx("div",{className:"w-full flex justify-between mt-0.5 px-1",children:y.map(a=>e.jsx("span",{className:"text-[10px] text-gray-700 dark:text-gray-200",style:{minWidth:0},children:a.range},a.label+"-range"))})]}),e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-full h-7 flex rounded overflow-hidden shadow",style:{minWidth:240},children:[j.map(a=>e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center",style:{background:a.color,minWidth:0},children:e.jsx("span",{className:"text-[10px] font-bold text-gray-800 dark:text-gray-900 select-none",style:{lineHeight:1},children:a.label})},a.label)),null!=l&&e.jsx("div",{className:"absolute left-0 top-0 w-full pointer-events-none",style:{height:"100%"},children:e.jsx("div",{style:{position:"absolute",left:`calc(${r}% - 0.65em)`,top:"50%",transform:"translateY(-50%)",color:"#dc2626",fontSize:"1.3em",textShadow:"0 0 2px #fff, 0 0 2px #fff, 1px 1px 2px #0002",zIndex:2},"aria-label":"現在の拡張期位置",children:"▼"})})]}),e.jsx("div",{className:"w-full flex justify-between mt-0.5 px-1",children:j.map(a=>e.jsx("span",{className:"text-[10px] text-gray-700 dark:text-gray-200",style:{minWidth:0},children:a.range},a.label+"-range"))})]})]})},N={systolic:"",diastolic:"",heartRate:"",time:i(),note:"",excludeFromGraph:!1},k=()=>{const i=(()=>{const e=a.useCallback((e,a)=>e<120&&a<80?{category:"正常血圧",color:"text-green-600",risk:"low"}:e<130&&a<85?{category:"正常高値",color:"text-blue-600",risk:"normal"}:e<140&&a<90?{category:"高値血圧",color:"text-yellow-600",risk:"normal"}:e<160&&a<100?{category:"Ⅰ度高血圧",color:"text-orange-600",risk:"high"}:e<180&&a<110?{category:"Ⅱ度高血圧",color:"text-red-600",risk:"high"}:{category:"Ⅲ度高血圧",color:"text-red-800",risk:"very_high"},[]),t=a.useCallback(e=>{if(0===e.length)return{avgSystolic:0,avgDiastolic:0,avgHeartRate:0};const a=e.reduce((e,a)=>e+a.systolic,0),t=e.reduce((e,a)=>e+a.diastolic,0),l=e.reduce((e,a)=>e+(a.heartRate||0),0),s=e.filter(e=>null!==e.heartRate).length;return{avgSystolic:Math.round(a/e.length),avgDiastolic:Math.round(t/e.length),avgHeartRate:s>0?Math.round(l/s):0}},[]),l=a.useCallback(e=>{if(0===e.length)return{maxSystolic:0,minSystolic:0,maxDiastolic:0,minDiastolic:0};const a=e.map(e=>e.systolic),t=e.map(e=>e.diastolic);return{maxSystolic:Math.max(...a),minSystolic:Math.min(...a),maxDiastolic:Math.max(...t),minDiastolic:Math.min(...t)}},[]),s=a.useCallback(e=>!!(e.systolic&&e.diastolic&&e.systolic>0&&e.diastolic>0&&e.systolic<300&&e.diastolic<200),[]),r=a.useCallback(e=>!(!e.systolic||!e.diastolic),[]),i=a.useCallback(e=>[...e].sort((e,a)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${a.date}T${a.time}`).getTime()),[]),n=a.useCallback(e=>{if(e.length<2)return{systolicTrend:"stable",diastolicTrend:"stable",trendMessage:"データが不足しています"};const a=i(e),l=a.slice(-3),s=a.slice(0,-3);if(0===s.length)return{systolicTrend:"stable",diastolicTrend:"stable",trendMessage:"トレンド判定には更多データが必要です"};const r=t(l),n=t(s),o=r.avgSystolic-n.avgSystolic,c=r.avgDiastolic-n.avgDiastolic,d=o>5?"up":o<-5?"down":"stable",m=c>5?"up":c<-5?"down":"stable";let x="";return x="up"===d||"up"===m?"血圧が上昇傾向にあります":"down"===d||"down"===m?"血圧が下降傾向にあります":"血圧は安定しています",{systolicTrend:d,diastolicTrend:m,trendMessage:x}},[t,i]);return{getBpCategory:e,isValidRecord:s,hasRecordData:r,calculateAverageBp:t,calculateBpRange:l,calculateBpTrend:n,sortRecordsByDateTime:i}})(),{checkpointDates:y}=t(),{records:j,isLoading:w,error:k,handleAdd:D,handleUpdate:R,handleDelete:C,clearError:F}=m({getAllRecords:d,addRecord:c,updateRecord:o,deleteRecord:n}),{selectedDate:S,setSelectedDate:G,centerDate:M,setCenterDate:T,today:z,recordDate:H,recordsOfDay:B,isRecorded:$}=p({records:j,getRecordDate:e=>e.date}),{formData:W,updateField:V,resetForm:A,createRecordFromForm:O}=x({initialValues:N,createRecord:(e,a)=>({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:a,time:e.time,systolic:Number(e.systolic),diastolic:Number(e.diastolic),heartRate:""!==e.heartRate?Number(e.heartRate):null,note:e.note||null,excludeFromGraph:e.excludeFromGraph||!1}),resetValues:N}),I=a.useCallback(async()=>{if(i.hasRecordData(W))try{const e=O(H);await D(e),A()}catch(e){}},[i,W,O,H,D,A]);return e.jsxs("div",{className:"bg-transparent",children:[e.jsx(b,{selectedDate:S,setSelectedDate:G,centerDate:M,setCenterDate:T,today:z,isRecorded:$,checkpointDates:y,"data-testid":"date-picker"}),e.jsx("div",{className:"w-full max-w-md mx-auto mt-3 mb-3 flex justify-start pl-4",children:e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:[S.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}),$(S)&&e.jsx(l,{className:"inline-block w-6 h-6 text-green-500 ml-2 align-middle","aria-label":"入力済み"})]})}),e.jsx(v,{recordsOfDay:B}),e.jsxs("div",{className:"flex flex-col items-center justify-start min-h-[60vh]",children:[k&&e.jsx("div",{className:"w-full max-w-md mb-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-800 text-sm",children:k}),e.jsx("button",{onClick:F,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"エラーを閉じる"})]})}),e.jsx("div",{className:"flex flex-col gap-2 w-full max-w-md",children:B.map(a=>e.jsxs("div",{className:"flex flex-col gap-1 bg-white dark:bg-gray-800 rounded-xl shadow p-2 mb-1",children:[e.jsxs("div",{className:"flex items-center w-full mb-1 justify-between",children:[e.jsx("input",{type:"time",className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-inherit text-gray-700 dark:text-gray-200 w-[6.5em]",value:a.time,onChange:e=>R({...a,time:e.target.value})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"danger",size:"sm",icon:s,"aria-label":"削除",onClick:()=>C(a.id),children:""}),e.jsxs(f,{variant:a.excludeFromGraph?"secondary":"sky",size:"sm","aria-label":a.excludeFromGraph?"グラフ除外":"グラフ表示",onClick:()=>R({...a,excludeFromGraph:!a.excludeFromGraph}),children:["",e.jsxs("span",{className:"relative inline-block w-5 h-5",children:[e.jsx(h,{className:"w-5 h-5 text-white"}),a.excludeFromGraph&&e.jsx(r,{className:"w-5 h-5 text-red-500 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 w-full",children:[e.jsx(u,{value:a.systolic,onChange:e=>R({...a,systolic:Number(e)}),placeholder:"収縮",step:"1",min:"0",max:"300",width:"md"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500 text-sm",children:"mmHg"}),e.jsx(u,{value:a.diastolic,onChange:e=>R({...a,diastolic:Number(e)}),placeholder:"拡張",step:"1",min:"0",max:"200",width:"md"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500 text-sm",children:"mmHg"}),e.jsx(u,{value:a.heartRate??"",onChange:e=>R({...a,heartRate:""===e?null:Number(e)}),placeholder:"心拍",step:"1",min:"0",max:"300",width:"md"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500 text-sm",children:"bpm"})]}),e.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full pr-2 mb-0",defaultValue:a.note??"",onBlur:e=>R({...a,note:e.target.value}),placeholder:"補足・メモ（任意）"})]},a.id))}),e.jsx("div",{className:"w-full max-w-md mt-2 mb-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-2 mb-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center w-full mb-1 justify-between",children:[e.jsx(g,{value:W.time,onChange:e=>V("time",e)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"success",size:"sm",icon:l,"aria-label":"保存",onClick:I,"data-testid":"save-btn",disabled:w||!i.hasRecordData(W),children:""}),e.jsxs(f,{variant:W.excludeFromGraph?"secondary":"sky",size:"sm","aria-label":W.excludeFromGraph?"グラフ除外":"グラフ表示",onClick:()=>V("excludeFromGraph",!W.excludeFromGraph),children:["",e.jsxs("span",{className:"relative inline-block w-5 h-5",children:[e.jsx(h,{className:"w-5 h-5 text-white"}),W.excludeFromGraph&&e.jsx(r,{className:"w-5 h-5 text-red-500 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 w-full mb-1",children:[e.jsx(u,{value:W.systolic,onChange:e=>V("systolic",e),placeholder:"収縮",step:"1",min:"0",max:"300",width:"md"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500 text-sm",children:"mmHg"}),e.jsx(u,{value:W.diastolic,onChange:e=>V("diastolic",e),placeholder:"拡張",step:"1",min:"0",max:"200",width:"md"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500 text-sm",children:"mmHg"}),e.jsx(u,{value:W.heartRate,onChange:e=>V("heartRate",e),placeholder:"心拍",step:"1",min:"0",max:"300",width:"md"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500 text-sm",children:"bpm"})]}),e.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full pr-2 mb-1",rows:1,value:W.note,onChange:e=>V("note",e.target.value),placeholder:"補足・メモ（任意）"})]})}),e.jsx("div",{className:"w-full max-w-md mx-auto mb-2 px-4",children:e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400 text-yellow-800 dark:text-yellow-100 p-3 rounded shadow-sm text-sm text-left",children:[e.jsx("strong",{children:"【ワンポイント】"})," ","血圧は安静時に測定し、可能であれば毎日同じ時間帯（朝・夜など）に記録することをお勧めします。運動後や食事直後の測定は避けましょう。"]})})]})]})};export{k as default};
