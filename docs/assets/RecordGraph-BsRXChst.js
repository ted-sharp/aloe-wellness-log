import{j as e,R as a,L as r,C as t,X as s,Y as d,T as l,a as o,b as n}from"./ui-vendor-Z70llhoy.js";import{a as i}from"./react-vendor-DRLO6cO2.js";import{u as c,k as g,p,t as u}from"./index-B-h-GPlA.js";import"./icons-vendor-DbsR8xvJ.js";import"./state-vendor-Crk1RRDk.js";function h(){var h;const{t:m}=c(),{records:f,fields:x,loadRecords:b,loadFields:y}=g();i.useEffect(()=>(p.trackRender.start("RecordGraph"),()=>{p.trackRender.end("RecordGraph")})),i.useEffect(()=>{(async()=>{try{await u("load-fields-graph",async()=>{await y()}),await u("load-records-graph",async()=>{await b()})}catch(e){console.error("Data loading error:",e)}})()},[y,b]);const j=[{label:m("pages.graph.periods.week"),value:7},{label:m("pages.graph.periods.month"),value:30},{label:m("pages.graph.periods.all"),value:0}],k=x.filter(e=>"number"===e.type||"string"===e.type).sort((e,a)=>(e.order||999)-(a.order||999)),[v,w]=i.useState(k.length>0?k[0].fieldId:""),[I,N]=i.useState(7),D=i.useMemo(()=>{performance.now();if(!v)return[];let e=f.filter(e=>e.fieldId===v).map(e=>{var a;return{...e,date:e.date||(null==(a=e.datetime)?void 0:a.slice(0,10))}}).sort((e,a)=>e.date.localeCompare(a.date));if(I>0){const a=new Date;a.setDate(a.getDate()-I+1),e=e.filter(e=>new Date(e.date)>=a)}return performance.now(),e},[f,v,I]);return i.useEffect(()=>{},[f.length,x.length,k.length,D.length,v,I]),e.jsxs("div",{className:"p-2 sm:p-4 max-w-full sm:max-w-2xl mx-auto bg-gray-50 dark:bg-gray-900 min-h-screen px-2 sm:px-0",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white mb-12",children:m("pages.graph.title")}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsxs("label",{className:"text-gray-700 dark:text-gray-300",children:[m("pages.graph.field"),e.jsx("select",{value:v,onChange:e=>(e=>{const a=p.trackInteraction.start("field-select");w(e),p.trackInteraction.end(a,"field-select")})(e.target.value),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded px-2 py-1 ml-2 focus:outline-none focus:ring-2 focus:ring-blue-600 dark:focus:ring-blue-400",children:k.map(a=>e.jsx("option",{value:a.fieldId,children:a.name},a.fieldId))})]}),e.jsxs("label",{className:"text-gray-700 dark:text-gray-300",children:[m("pages.graph.period"),e.jsx("select",{value:I,onChange:e=>(e=>{const a=p.trackInteraction.start("period-select");N(e),p.trackInteraction.end(a,"period-select")})(Number(e.target.value)),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded px-2 py-1 ml-2 focus:outline-none focus:ring-2 focus:ring-blue-600 dark:focus:ring-blue-400",children:j.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded shadow p-4",children:e.jsx(a,{width:"100%",height:300,children:e.jsxs(r,{data:D,margin:{top:20,right:30,left:0,bottom:0},children:[e.jsx(t,{strokeDasharray:"3 3"}),e.jsx(s,{dataKey:"date"}),e.jsx(d,{}),e.jsx(l,{}),e.jsx(o,{}),e.jsx(n,{type:"monotone",dataKey:"value",stroke:"#8884d8",name:null==(h=k.find(e=>e.fieldId===v))?void 0:h.name})]})})})]})}export{h as default};
//# sourceMappingURL=RecordGraph-BsRXChst.js.map
