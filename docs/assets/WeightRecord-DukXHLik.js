import{j as e,F as t,u as a,a as l,b as s,c as r,d as n,o,f as i,s as d}from"./ui-vendor-J9A7wRLG.js";import{o as c}from"./state-vendor-RA6ewXRt.js";import{a as m,d as x}from"./react-vendor-C4GzcRrE.js";import{z as h,u as g,C as u,g as b,H as f,a as p,b as w}from"./index-iJ_8w1vn.js";import{u as y,a as j,P as N,N as v,T as k,M as F}from"./useRecordForm-YTvlEujv.js";import{B as C}from"./Button-BI56QuZy.js";import{u as D,D as M}from"./useDateSelection-Cixq52XB.js";import"./icons-vendor-DCv9Y2bB.js";const R=[{min:0,max:18.5,color:"#6ec6f1",label:"‰Ωé‰ΩìÈáç",range:"<18.5"},{min:18.5,max:25,color:"#7edfa0",label:"ÊôÆÈÄö‰ΩìÈáç",range:"18.5-24.9"},{min:25,max:30,color:"#b6d97a",label:"ËÇ•Ê∫Ä(1Â∫¶)",range:"25-29.9"},{min:30,max:35,color:"#ffe066",label:"ËÇ•Ê∫Ä(2Â∫¶)",range:"30-34.9"},{min:35,max:40,color:"#ff9800",label:"ËÇ•Ê∫Ä(3Â∫¶)",range:"35-39.9"},{min:40,max:100,color:"#f44336",label:"ËÇ•Ê∫Ä(4Â∫¶)",range:"40.0+"}],W=function({currentWeight:t,goal:a,showWeightDiff:l=!0}){if(!a)return null;const s=null==a?void 0:a.height,r=null==a?void 0:a.startWeight,n=t&&s?t/Math.pow(s/100,2):null,o="number"!=typeof n||isNaN(n)?0:n,i=(()=>{if(null===n)return 0;let e=0;for(let t=0;t<R.length;t++){const a=R[t];if(n<a.max){return e+100/R.length*((n-a.min)/(a.max-a.min))}e+=100/R.length}return 100})(),[d,c]=m.useState(0);m.useEffect(()=>{if("number"!=typeof n||isNaN(n))return;const e=performance.now();requestAnimationFrame(function t(a){const l=a-e,s=Math.min(l/800,1);c(0+(o-0)*s),s<1?requestAnimationFrame(t):c(o)})},[o,n]);const[x,h]=m.useState(0);return m.useEffect(()=>{if(l&&void 0!==r&&null!==t&&t-r<0){let e=function(t){const r=t-n,o=Math.min(r/s,1);h(l+(a-l)*o),o<1?requestAnimationFrame(e):h(a)};const a=t-r,l=0,s=800,n=performance.now();requestAnimationFrame(e)}else h(0)},[r,t,l]),n&&s?e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[l&&e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsxs("span",{className:"text-base font-semibold text-blue-700 dark:text-blue-200",children:["BMI"," ",e.jsx("span",{style:{display:"inline-block",minWidth:"4ch",textAlign:"right",fontFamily:"monospace"},children:d.toFixed(1)})]}),l&&x<0&&e.jsxs("span",{className:"ml-2 text-base font-semibold text-green-600 dark:text-green-400",children:["üèÜ",x.toFixed(1),"kg"]})]}),e.jsxs("div",{className:"flex flex-col items-center mb-2",children:[e.jsxs("div",{className:"relative w-full h-8 flex rounded overflow-hidden shadow",style:{minWidth:240},children:[R.map(t=>e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center",style:{backgroundColor:t.color},title:`${t.label} (${t.range})`,children:e.jsx("span",{className:"text-[10px] font-bold text-gray-800 dark:text-gray-900",children:t.label})},t.label)),e.jsx("div",{className:"absolute top-0 text-red-600 text-lg font-bold",style:{left:`${i}%`,transform:"translateX(-50%)",lineHeight:"32px",fontSize:"20px",fontWeight:"bold",textShadow:"0 0 2px #fff, 0 0 2px #fff, 1px 1px 2px #0002",zIndex:2},"aria-label":"ÁèæÂú®„ÅÆBMI‰ΩçÁΩÆ",children:"‚ñº"})]}),e.jsx("div",{className:"w-full flex justify-between mt-1 px-1",children:R.map(t=>e.jsx("span",{className:"text-[10px] text-gray-700 dark:text-gray-200",style:{flex:1,textAlign:"center"},children:t.range},t.label+"-range"))})]})]}):null},S=["Êúù‰∏Ä","ÊúùÈ£üÂæå","Â§ïÈ£üÂâç","Â§ïÈ£üÂæå","Â∞±ÂØùÂâç","ÈÅãÂãïÂæå„Å´Ê∏¨ÂÆö","Â§ñÈ£ü„ÅÇ„Çä"],G={weight:"",bodyFat:"",waist:"",time:b(),note:"",excludeFromGraph:!1};const B=c(({showTipsModal:c})=>{const{goal:b,loadGoal:R}=h(),{checkpointDates:B}=g(),I=m.useCallback(async()=>{const e=await u.getAll();if(!e.success)throw new Error(e.error||"Failed to fetch records");return e.data||[]},[]),$=m.useCallback(async e=>{const t=await u.add(e);if(!t.success)throw new Error(t.error||"Failed to add record")},[]),z=m.useCallback(async e=>{const t=await u.update(e);if(!t.success)throw new Error(t.error||"Failed to update record")},[]),A=m.useCallback(async e=>{const t=await u.delete(e);if(!t.success)throw new Error(t.error||"Failed to delete record")},[]),{records:E,isLoading:P,error:T,handleAdd:O,handleUpdate:q,handleDelete:L,clearError:V}=y({getAllRecords:I,addRecord:$,updateRecord:z,deleteRecord:A,onRecordAdded:c}),{selectedDate:H,setSelectedDate:J,centerDate:U,setCenterDate:X,today:K,recordDate:Q,recordsOfDay:Y,isRecorded:Z}=D({records:E,getRecordDate:e=>e.date}),{formData:_,updateField:ee,resetForm:te,createRecordFromForm:ae}=j({initialValues:G,createRecord:(e,t)=>({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:t,time:e.time,weight:Number(e.weight),bodyFat:""!==e.bodyFat?Number(e.bodyFat):null,waist:""!==e.waist?Number(e.waist):null,note:e.note||null,excludeFromGraph:e.excludeFromGraph}),resetValues:G}),le=(()=>{const e=m.useCallback((e,t)=>t<=0?0:Number((e/Math.pow(t/100,2)).toFixed(2)),[]),t=m.useCallback((e,t)=>Number((e-t).toFixed(2)),[]),a=m.useCallback(e=>0===e.length?0:Math.min(...e.map(e=>Number(e.weight))),[]),l=m.useCallback(e=>!!(e.weight||e.bodyFat||e.waist),[]),s=m.useCallback((l,s)=>{const r=l.length>0,n=s&&s.height&&s.height>0;if(!r||!n)return{shouldShowBMI:!1,bmi:0,weightChange:0,lowestWeight:0};const o=a(l);return{shouldShowBMI:!0,bmi:e(o,s.height),weightChange:t(o,s.startWeight||0),lowestWeight:o}},[e,t,a]),r=m.useCallback(e=>e<18.5?{category:"‰Ωé‰ΩìÈáç",color:"text-blue-600"}:e<25?{category:"ÊôÆÈÄö‰ΩìÈáç",color:"text-green-600"}:e<30?{category:"ËÇ•Ê∫ÄÂ∫¶1",color:"text-yellow-600"}:{category:"ËÇ•Ê∫ÄÂ∫¶2‰ª•‰∏ä",color:"text-red-600"},[]),n=m.useCallback(e=>e>0?{text:`+${e}kg`,color:"text-red-600",icon:"‚Üó"}:e<0?{text:`${e}kg`,color:"text-blue-600",icon:"‚Üò"}:{text:"¬±0kg",color:"text-gray-600",icon:"‚Üí"},[]),o=m.useCallback(e=>!!(e.weight&&e.weight>0),[]),i=m.useCallback(e=>[...e].sort((e,t)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${t.date}T${t.time}`).getTime()),[]);return{calculateBMI:e,calculateWeightChange:t,calculateLowestWeight:a,calculateBMIDisplayInfo:s,hasRecordData:l,isValidRecord:o,getBMICategory:r,getWeightChangeDisplay:n,sortRecordsByDateTime:i,noteExamples:S}})(),se=m.useMemo(()=>0===Y.length?null:le.calculateLowestWeight(Y),[Y,le]),re=m.useMemo(()=>se&&b&&b.height?le.calculateBMI(se,b.height):null,[se,b,le]),ne=m.useMemo(()=>se&&b&&b.startWeight?le.calculateWeightChange(se,b.startWeight):null,[se,b,le]),oe=!!b,ie=!!(null==b?void 0:b.height);x.useEffect(()=>{oe&&ie||R()},[oe,ie,R]);const de=le.hasRecordData(_),ce=m.useCallback(async()=>{if(de)try{const e=ae(Q);await O(e),te()}catch(e){}},[de,ae,Q,O,te]),me=function(){const[e,t]=m.useState(!1),{refs:c,floatingStyles:x,context:h}=a({open:e,onOpenChange:t,middleware:[o(6),i(),d()],placement:"bottom-end"}),g=l(h),u=s(h),b=r(h),{getReferenceProps:f,getFloatingProps:p}=n([g,u,b]);return{open:e,setOpen:t,refs:c,floatingStyles:x,getReferenceProps:f,getFloatingProps:p}}();return e.jsxs("div",{className:"bg-transparent",children:[e.jsx(M,{selectedDate:H,setSelectedDate:J,centerDate:U,setCenterDate:X,today:K,isRecorded:Z,checkpointDates:B,"data-testid":"date-picker"}),e.jsx("div",{className:"w-full max-w-md mx-auto mt-3 mb-3 flex justify-start pl-4",children:e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:[H.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}),Z(H)&&e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"inline-block w-6 h-6 text-green-500 ml-2 align-middle","aria-label":"ÂÖ•ÂäõÊ∏à„Åø"}),null!==re&&e.jsxs("span",{className:"ml-3 text-base font-semibold text-blue-700 dark:text-blue-200 align-middle",children:["BMI ",re.toFixed(1),null!==ne&&ne<0&&e.jsxs("span",{className:"ml-2 text-base font-semibold text-green-600 dark:text-green-400",children:["üèÜ",ne.toFixed(1),"kg"]})]})]})]})}),e.jsx(W,{currentWeight:se,goal:b,showWeightDiff:!1}),e.jsxs("div",{className:"flex flex-col items-center justify-start min-h-[60vh]",children:[T&&e.jsx("div",{className:"w-full max-w-md mb-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-800 text-sm",children:T}),e.jsx("button",{onClick:V,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"„Ç®„É©„Éº„ÇíÈñâ„Åò„Çã"})]})}),e.jsx("div",{className:"flex flex-col gap-2 w-full max-w-md",children:Y.map(t=>e.jsxs("div",{className:"flex flex-col gap-1 bg-white dark:bg-gray-800 rounded-xl shadow p-2 mb-1",children:[e.jsxs("div",{className:"flex items-center w-full mb-1 justify-between",children:[e.jsx("input",{type:"time",className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-inherit text-gray-700 dark:text-gray-200 w-[6.5em]",value:t.time,onChange:e=>q({...t,time:e.target.value})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"danger",size:"sm",icon:p,"aria-label":"ÂâäÈô§",onClick:()=>L(t.id),children:""}),e.jsxs(C,{variant:t.excludeFromGraph?"secondary":"sky",size:"sm","aria-label":t.excludeFromGraph?"„Ç∞„É©„ÉïÈô§Â§ñ":"„Ç∞„É©„ÉïË°®Á§∫",onClick:()=>q({...t,excludeFromGraph:!t.excludeFromGraph}),children:["",e.jsxs("span",{className:"relative inline-block w-5 h-5",children:[e.jsx(N,{className:"w-5 h-5 text-white"}),t.excludeFromGraph&&e.jsx(w,{className:"w-5 h-5 text-red-500 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 w-full",children:[e.jsx(v,{value:t.weight,onChange:e=>q({...t,weight:Number(e)}),placeholder:"‰ΩìÈáç",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"kg"}),e.jsx(v,{value:t.bodyFat??"",onChange:e=>q({...t,bodyFat:""===e?null:Number(e)}),placeholder:"‰ΩìËÑÇËÇ™",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"%"}),e.jsx(v,{value:t.waist??"",onChange:e=>q({...t,waist:""===e?null:Number(e)}),placeholder:"ËÖπÂõ≤",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"cm"})]}),e.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full pr-10 mb-0",defaultValue:t.note??"",onBlur:e=>q({...t,note:e.target.value}),placeholder:"Ë£úË∂≥„Éª„É°„É¢Ôºà‰ªªÊÑèÔºâ"})]},t.id))}),e.jsx("div",{className:"w-full max-w-md mt-2 mb-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-2 mb-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center w-full mb-1 justify-between",children:[e.jsx(k,{value:_.time,onChange:e=>ee("time",e)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"success",size:"sm",icon:f,"aria-label":"‰øùÂ≠ò",onClick:ce,"data-testid":"save-btn",disabled:P||!de,children:""}),e.jsxs(C,{variant:_.excludeFromGraph?"secondary":"sky",size:"sm","aria-label":_.excludeFromGraph?"„Ç∞„É©„ÉïÈô§Â§ñ":"„Ç∞„É©„ÉïË°®Á§∫",onClick:()=>ee("excludeFromGraph",!_.excludeFromGraph),children:["",e.jsxs("span",{className:"relative inline-block w-5 h-5",children:[e.jsx(N,{className:"w-5 h-5 text-white"}),_.excludeFromGraph&&e.jsx(w,{className:"w-5 h-5 text-red-500 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 w-full mb-1",children:[e.jsx(v,{value:_.weight,onChange:e=>ee("weight",e),placeholder:"‰ΩìÈáç",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"kg"}),e.jsx(v,{value:_.bodyFat,onChange:e=>ee("bodyFat",e),placeholder:"‰ΩìËÑÇËÇ™",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"%"}),e.jsx(v,{value:_.waist,onChange:e=>ee("waist",e),placeholder:"ËÖπÂõ≤",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"cm"})]}),e.jsxs("div",{className:"relative w-full mt-0",children:[e.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full pr-10 mb-0",rows:1,value:_.note,onChange:e=>ee("note",e.target.value),placeholder:"Ë£úË∂≥„Éª„É°„É¢Ôºà‰ªªÊÑèÔºâ"}),e.jsx("div",{ref:me.refs.setReference,...me.getReferenceProps({}),className:"absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"ÂÆöÂûãÊñá„ÇíÊåøÂÖ•",onClick:()=>me.setOpen(e=>!e),children:e.jsx(F,{className:"w-6 h-6"})}),me.open&&e.jsx(t,{children:e.jsx("div",{ref:me.refs.setFloating,style:me.floatingStyles,...me.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:le.noteExamples.map(t=>e.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{ee("note",t),me.setOpen(!1)},children:t},t))})})]})]})}),e.jsx("div",{className:"w-full max-w-md mx-auto mb-2 px-4",children:e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400 text-yellow-800 dark:text-yellow-100 p-3 rounded shadow-sm text-sm text-left",children:[e.jsx("strong",{children:"„Äê„ÉØ„É≥„Éù„Ç§„É≥„Éà„Äë"})," ","‰ΩìÈáç„ÅØ„Åß„Åç„Çã„Å†„ÅëÊØéÊó•Âêå„Åò„Çø„Ç§„Éü„É≥„Ç∞Ôºà‰æãÔºöÊúùËµ∑„Åç„Å¶„Éà„Ç§„É¨Âæå„ÄÅÈ£ü‰∫ãÂâç„Å™„Å©Ôºâ„ÅßÊ∏¨„Çã„Å®„ÄÅÊó•„ÄÖ„ÅÆÂ§âÂåñ„Åå„Çà„ÇäÊ≠£Á¢∫„Å´„Çè„Åã„Çä„Åæ„Åô„ÄÇÂêå„Åò„Çø„Ç§„Éü„É≥„Ç∞„Åß„ÅØ„Å™„ÅÑË®òÈå≤„ÅØ„Ç∞„É©„Éï„Åã„ÇâÈô§Â§ñ„Åß„Åç„Åæ„Åô„ÄÇ"]})})]})]})});export{B as default};
