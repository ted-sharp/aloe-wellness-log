import{j as e}from"./ui-vendor-D7AUAfXm.js";import{a as t}from"./react-vendor-BzNAZZ5j.js";import{u as s,h as a,g as r,w as l,n,q as o,k as d,x as i,y as c,z as m,A as g,B as x,C as u,H as b}from"./index-B2p52sU7.js";import"./icons-vendor-DoCnAwwa.js";import"./state-vendor-O6FgWrPy.js";const p=(e,t=30)=>e.length<=t?e:e.substring(0,t)+"...",h=t.memo(({record:d,field:i,editId:c,editValue:m,expandedTexts:g,showButtons:x,onEdit:u,onEditSave:b,onEditCancel:h,onDelete:f,onEditValueChange:y,onToggleTextExpansion:j,onToggleButtons:w})=>{const{t:v,getAriaLabel:N}=s(),k=c===d.id,C=g.has(d.id),I=x.has(d.id),P=t.useCallback(()=>{w(d.id)},[w,d.id]),E=t.useCallback(()=>{u(d)},[u,d]),S=t.useCallback(()=>{b(d)},[b,d]),T=t.useCallback(()=>{h(d.id)},[h,d.id]),R=t.useCallback(()=>{f(d)},[f,d]),B=t.useCallback(e=>{e.stopPropagation(),j(d.id)},[j,d.id]),M=t.useCallback(e=>{y(e.target.value)},[y]),V=t.useCallback(e=>{y(e??"")},[y]);return e.jsx("li",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors duration-200",children:k?e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:d.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>V(!0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===m?"bg-green-100 border-green-500 text-green-700":"bg-gray-100 border-gray-300 text-gray-600 hover:bg-gray-200"),"aria-label":N("setToYes",{fieldName:i.name}),children:v("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===m?"bg-red-100 border-red-500 text-red-700":"bg-gray-100 border-gray-300 text-gray-600 hover:bg-gray-200"),"aria-label":N("setToNo",{fieldName:i.name}),children:v("fields.no")}),void 0!==m&&""!==m&&e.jsx("button",{type:"button",onClick:()=>V(void 0),className:"px-2 py-1.5 rounded-lg border-2 border-gray-300 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex-shrink-0","aria-label":N("clearSelection",{fieldName:i.name}),title:v("fields.clearSelection"),children:"×"})]}):e.jsx("textarea",{value:String(m),onChange:M,className:"border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 w-full h-24 resize-none"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 pb-2 sm:pb-0",children:i?i.name:d.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>V(!0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===m?"bg-green-100 border-green-500 text-green-700":"bg-gray-100 border-gray-300 text-gray-600 hover:bg-gray-200"),"aria-label":N("setToYes",{fieldName:i.name}),children:v("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===m?"bg-red-100 border-red-500 text-red-700":"bg-gray-100 border-gray-300 text-gray-600 hover:bg-gray-200"),"aria-label":N("setToNo",{fieldName:i.name}),children:v("fields.no")}),void 0!==m&&""!==m&&e.jsx("button",{type:"button",onClick:()=>V(void 0),className:"px-2 py-1.5 rounded-lg border-2 border-gray-300 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex-shrink-0","aria-label":N("clearSelection",{fieldName:i.name}),title:v("fields.clearSelection"),children:"×"})]}):e.jsx("input",{type:"number"===(null==i?void 0:i.type)?"number":"text",value:String(m),onChange:M,className:"border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 w-full"})})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:S,className:"bg-green-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(a,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.save")]}),e.jsxs("button",{onClick:T,className:"bg-gray-400 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(r,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.cancel")]})]})]}):e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:d.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 font-semibold pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"string"==typeof d.value&&d.value.length>30?e.jsx("button",{onClick:B,className:"text-left hover:text-blue-600 transition-colors break-words w-full",title:v("common.clickToExpand"),children:C?d.value:p(d.value)}):e.jsx("span",{className:"break-words",children:d.value})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 pb-2 sm:pb-0",children:i?i.name:d.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 font-semibold pl-0 sm:pl-2 text-left pt-2 sm:pt-0",children:"boolean"==typeof d.value?d.value?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-600",children:[e.jsx(a,{className:"w-6 h-6"}),v("fields.yes")]}):e.jsxs("span",{className:"inline-flex items-center gap-2 text-red-600",children:[e.jsx(l,{className:"w-6 h-6"}),v("fields.no")]}):e.jsxs("span",{className:"break-words",children:[d.value,(null==i?void 0:i.unit)&&"boolean"!=typeof d.value&&e.jsx("span",{className:"text-gray-600 ml-1",children:i.unit})]})})]}),I&&e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:E,className:"bg-blue-500 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(n,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.edit")]}),e.jsxs("button",{onClick:R,className:"bg-red-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(o,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.delete")]})]})]})})});h.displayName="RecordItem";const f=t.memo(({datetime:s,records:a,getField:r,sortRecordsByFieldOrder:l,editId:n,editValue:o,expandedTexts:d,showButtons:c,onEdit:m,onEditSave:g,onEditCancel:x,onDelete:u,onEditValueChange:p,onToggleTextExpansion:f,onToggleButtons:y})=>(t.useEffect(()=>(i.trackRender.start(`RecordGroup-${s}`),()=>{i.trackRender.end(`RecordGroup-${s}`)})),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"text-2xl font-semibold text-gray-800 mb-8 border-b border-gray-200 pb-4 flex items-center gap-2",children:[e.jsx(b,{className:"w-6 h-6 text-blue-600"}),s]}),e.jsx("ul",{className:"space-y-4",children:l(a).map(t=>e.jsx(h,{record:t,field:r(t.fieldId),editId:n,editValue:o,expandedTexts:d,showButtons:c,onEdit:m,onEditSave:g,onEditCancel:x,onDelete:u,onEditValueChange:p,onToggleTextExpansion:f,onToggleButtons:y},t.id))})]})));function y(){const{t:a,translateFieldName:r}=s(),{records:l,fields:n,loadRecords:o,loadFields:b,updateRecord:p,deleteRecord:h}=d(),[y,j]=t.useState(null),[w,v]=t.useState(""),[N,k]=t.useState(new Set),[C,I]=t.useState(new Set),[P,E]=t.useState(1),[S,T]=t.useState(10);t.useEffect(()=>(i.trackRender.start("RecordList"),()=>{i.trackRender.end("RecordList")})),t.useEffect(()=>{(async()=>{try{await c("load-fields",async()=>{await b()}),await c("load-records",async()=>{await o()},l.length)}catch(e){}})()},[b,o,l.length]);const R=t.useCallback(e=>{if("notes"===e)return{fieldId:"notes",name:r("notes"),type:"string",order:0};let t=n.find(t=>t.fieldId===e);return t||(t=n.find(t=>t.name===e)),t},[n,r]),B=t.useCallback(e=>{performance.now();const t=[...e].sort((e,t)=>{const s=R(e.fieldId),a=R(t.fieldId);return((null==s?void 0:s.order)??999)-((null==a?void 0:a.order)??999)});return performance.now(),t},[R]),M=t.useMemo(()=>{performance.now();const e=[...l].sort((e,t)=>{const s=`${e.date} ${e.time}`;return`${t.date} ${t.time}`.localeCompare(s)});return performance.now(),e},[l]),V=t.useMemo(()=>{performance.now();const e=M.reduce((e,t)=>{const s=`${t.date} ${t.time}`;return e[s]||(e[s]=[]),e[s].push(t),e},{});return performance.now(),e},[M]),$=t.useMemo(()=>{performance.now();const e=Object.entries(V),t=e.length,s=Math.max(1,Math.ceil(t/S));P>s&&E(1);const a=(P-1)*S,r=a+S,l=e.slice(a,r),n={groups:Object.fromEntries(l),totalGroups:t,totalPages:s,currentPage:Math.min(P,s)};return performance.now(),n},[V,P,S]),G=t.useCallback(e=>{const t=i.trackInteraction.start("page-change");E(Math.max(1,Math.min(e,$.totalPages))),i.trackInteraction.end(t,"page-change")},[$.totalPages]),F=t.useCallback(e=>{const t=i.trackInteraction.start("edit-start");j(e.id),v(e.value),i.trackInteraction.end(t,"edit-start")},[]),O=t.useCallback(async e=>{const t=i.trackInteraction.start("edit-save");try{await c("update-record",async()=>{await p({...e,value:w})},1),j(null),v(""),I(t=>{const s=new Set(t);return s.delete(e.id),s})}catch(s){}finally{i.trackInteraction.end(t,"edit-save")}},[w,p]),D=t.useCallback(e=>{const t=i.trackInteraction.start("edit-cancel");j(null),v(""),I(t=>{const s=new Set(t);return s.delete(e),s}),i.trackInteraction.end(t,"edit-cancel")},[]),z=t.useCallback(async e=>{const t=i.trackInteraction.start("delete-record");try{window.confirm(a("pages.list.confirmDelete"))&&(await c("delete-record",async()=>{await h(e.id)},1),I(t=>{const s=new Set(t);return s.delete(e.id),s}))}catch(s){}finally{i.trackInteraction.end(t,"delete-record")}},[h,a]),L=t.useCallback(e=>{v(e)},[]),A=t.useCallback(e=>{const t=i.trackInteraction.start("toggle-text");k(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s}),i.trackInteraction.end(t,"toggle-text")},[]),Y=t.useCallback(e=>{const t=i.trackInteraction.start("toggle-buttons");I(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s}),i.trackInteraction.end(t,"toggle-buttons")},[]),q=t.useCallback(e=>{const t=i.trackInteraction.start("page-size-change");T(e),E(1),i.trackInteraction.end(t,"page-size-change")},[]);return t.useEffect(()=>{},[l.length,$.totalGroups,$.currentPage,$.totalPages,S]),e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto px-2 sm:px-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-6 sm:mb-8",children:a("pages.list.title")}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 sm:p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold text-gray-800",children:$.totalGroups}),e.jsx("span",{className:"text-sm sm:text-base text-gray-600 ml-1",children:a("pages.list.recordGroups")})]}),e.jsxs("div",{className:"flex items-center justify-center sm:justify-end gap-2",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-600 whitespace-nowrap",children:a("pages.list.displayCount")}),e.jsxs("select",{value:S,onChange:e=>q(Number(e.target.value)),className:"border border-gray-300 rounded-lg px-3 py-1.5 sm:py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 text-sm sm:text-base min-w-[80px]",children:[e.jsx("option",{value:10,children:a("pages.list.items10")}),e.jsx("option",{value:20,children:a("pages.list.items20")}),e.jsx("option",{value:50,children:a("pages.list.items50")}),e.jsx("option",{value:100,children:a("pages.list.items100")})]})]})]})}),$.totalPages>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-3 sm:p-4 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G(1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(m,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.currentPage-1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(g,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 whitespace-nowrap",children:[$.currentPage," / ",$.totalPages," ",a("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G($.currentPage+1),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(x,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.totalPages),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(u,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]})}),0===Object.entries($.groups).length&&e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 sm:p-8 text-center text-gray-500",children:e.jsx("p",{className:"text-base sm:text-lg",children:a("pages.list.noRecords")})}),e.jsx("div",{className:"space-y-8",children:Object.entries($.groups).map(([t,s])=>e.jsx(f,{datetime:t,records:s,getField:R,sortRecordsByFieldOrder:B,editId:y,editValue:w,expandedTexts:N,showButtons:C,onEdit:F,onEditSave:O,onEditCancel:D,onDelete:z,onEditValueChange:L,onToggleTextExpansion:A,onToggleButtons:Y},t))}),$.totalPages>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-3 sm:p-4 mt-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G(1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(m,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.currentPage-1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(g,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 whitespace-nowrap",children:[$.currentPage," / ",$.totalPages," ",a("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G($.currentPage+1),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(x,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.totalPages),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(u,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]})})]})}f.displayName="RecordGroup";export{y as default};
