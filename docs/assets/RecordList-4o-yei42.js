import{j as e}from"./ui-vendor-D7AUAfXm.js";import{a as r}from"./react-vendor-BzNAZZ5j.js";import{u as a,h as t,g as s,w as d,n as o,q as l,k as n,x as i,y as c,z as g,A as m,B as x,C as b,H as u}from"./index-_d5zLM54.js";import"./icons-vendor-DoCnAwwa.js";import"./state-vendor-O6FgWrPy.js";const p=(e,r=30)=>e.length<=r?e:e.substring(0,r)+"...",y=r.memo(({record:n,field:i,editId:c,editValue:g,expandedTexts:m,showButtons:x,onEdit:b,onEditSave:u,onEditCancel:y,onDelete:h,onEditValueChange:k,onToggleTextExpansion:f,onToggleButtons:w})=>{const{t:j,getAriaLabel:v}=a(),N=c===n.id,C=m.has(n.id),I=x.has(n.id),P=r.useCallback(()=>{w(n.id)},[w,n.id]),E=r.useCallback(()=>{b(n)},[b,n]),S=r.useCallback(()=>{u(n)},[u,n]),T=r.useCallback(()=>{y(n.id)},[y,n.id]),R=r.useCallback(()=>{h(n)},[h,n]),B=r.useCallback(e=>{e.stopPropagation(),f(n.id)},[f,n.id]),M=r.useCallback(e=>{k(e.target.value)},[k]),V=r.useCallback(e=>{k(e??"")},[k]);return e.jsx("li",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200",children:N?e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:n.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>V(!0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===g?"bg-green-100 dark:bg-green-900/30 border-green-500 dark:border-green-400 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":v("setToYes",{fieldName:i.name}),children:j("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===g?"bg-red-100 dark:bg-red-900/30 border-red-500 dark:border-red-400 text-red-700 dark:text-red-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":v("setToNo",{fieldName:i.name}),children:j("fields.no")}),void 0!==g&&""!==g&&e.jsx("button",{type:"button",onClick:()=>V(void 0),className:"px-2 py-1.5 rounded-lg border-2 border-gray-300 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex-shrink-0","aria-label":v("clearSelection",{fieldName:i.name}),title:j("fields.clearSelection"),children:"×"})]}):e.jsx("textarea",{value:String(g),onChange:M,className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400 w-full h-24 resize-none"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 pb-2 sm:pb-0",children:i?i.name:n.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>V(!0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===g?"bg-green-100 dark:bg-green-900/30 border-green-500 dark:border-green-400 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":v("setToYes",{fieldName:i.name}),children:j("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===g?"bg-red-100 dark:bg-red-900/30 border-red-500 dark:border-red-400 text-red-700 dark:text-red-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":v("setToNo",{fieldName:i.name}),children:j("fields.no")}),void 0!==g&&""!==g&&e.jsx("button",{type:"button",onClick:()=>V(void 0),className:"px-2 py-1.5 rounded-lg border-2 border-gray-300 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex-shrink-0","aria-label":v("clearSelection",{fieldName:i.name}),title:j("fields.clearSelection"),children:"×"})]}):e.jsx("input",{type:"number"===(null==i?void 0:i.type)?"number":"text",value:String(g),onChange:M,className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400 w-full"})})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:S,className:"bg-green-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(t,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),j("actions.save")]}),e.jsxs("button",{onClick:T,className:"bg-gray-400 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(s,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),j("actions.cancel")]})]})]}):e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:n.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 dark:text-gray-200 font-semibold pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"string"==typeof n.value&&n.value.length>30?e.jsx("button",{onClick:B,className:"text-left hover:text-blue-600 transition-colors break-words w-full",title:j("common.clickToExpand"),children:C?n.value:p(n.value)}):e.jsx("span",{className:"break-words",children:n.value})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 pb-2 sm:pb-0",children:i?i.name:n.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 dark:text-gray-200 font-semibold pl-0 sm:pl-2 text-left pt-2 sm:pt-0",children:"boolean"==typeof n.value?n.value?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-600",children:[e.jsx(t,{className:"w-6 h-6"}),j("fields.yes")]}):e.jsxs("span",{className:"inline-flex items-center gap-2 text-red-600",children:[e.jsx(d,{className:"w-6 h-6"}),j("fields.no")]}):e.jsxs("span",{className:"break-words",children:[n.value,(null==i?void 0:i.unit)&&"boolean"!=typeof n.value&&e.jsx("span",{className:"text-gray-600 dark:text-gray-400 ml-1",children:i.unit})]})})]}),I&&e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:E,className:"bg-blue-500 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(o,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),j("actions.edit")]}),e.jsxs("button",{onClick:R,className:"bg-red-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(l,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),j("actions.delete")]})]})]})})});y.displayName="RecordItem";const h=r.memo(({datetime:a,records:t,getField:s,sortRecordsByFieldOrder:d,editId:o,editValue:l,expandedTexts:n,showButtons:c,onEdit:g,onEditSave:m,onEditCancel:x,onDelete:b,onEditValueChange:p,onToggleTextExpansion:h,onToggleButtons:k})=>(r.useEffect(()=>(i.trackRender.start(`RecordGroup-${a}`),()=>{i.trackRender.end(`RecordGroup-${a}`)})),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-8 border-b border-gray-200 dark:border-gray-600 pb-4 flex items-center gap-2",children:[e.jsx(u,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),a]}),e.jsx("ul",{className:"space-y-4",children:d(t).map(r=>e.jsx(y,{record:r,field:s(r.fieldId),editId:o,editValue:l,expandedTexts:n,showButtons:c,onEdit:g,onEditSave:m,onEditCancel:x,onDelete:b,onEditValueChange:p,onToggleTextExpansion:h,onToggleButtons:k},r.id))})]})));function k(){const{t:t,translateFieldName:s}=a(),{records:d,fields:o,loadRecords:l,loadFields:u,updateRecord:p,deleteRecord:y}=n(),[k,f]=r.useState(null),[w,j]=r.useState(""),[v,N]=r.useState(new Set),[C,I]=r.useState(new Set),[P,E]=r.useState(1),[S,T]=r.useState(10);r.useEffect(()=>(i.trackRender.start("RecordList"),()=>{i.trackRender.end("RecordList")})),r.useEffect(()=>{(async()=>{try{await c("load-fields",async()=>{await u()}),await c("load-records",async()=>{await l()},d.length)}catch(e){}})()},[u,l,d.length]);const R=r.useCallback(e=>{if("notes"===e)return{fieldId:"notes",name:s("notes"),type:"string",order:0};let r=o.find(r=>r.fieldId===e);return r||(r=o.find(r=>r.name===e)),r},[o,s]),B=r.useCallback(e=>{performance.now();const r=[...e].sort((e,r)=>{const a=R(e.fieldId),t=R(r.fieldId);return((null==a?void 0:a.order)??999)-((null==t?void 0:t.order)??999)});return performance.now(),r},[R]),M=r.useMemo(()=>{performance.now();const e=[...d].sort((e,r)=>{const a=`${e.date} ${e.time}`;return`${r.date} ${r.time}`.localeCompare(a)});return performance.now(),e},[d]),V=r.useMemo(()=>{performance.now();const e=M.reduce((e,r)=>{const a=`${r.date} ${r.time}`;return e[a]||(e[a]=[]),e[a].push(r),e},{});return performance.now(),e},[M]),$=r.useMemo(()=>{performance.now();const e=Object.entries(V),r=e.length,a=Math.max(1,Math.ceil(r/S));P>a&&E(1);const t=(P-1)*S,s=t+S,d=e.slice(t,s),o={groups:Object.fromEntries(d),totalGroups:r,totalPages:a,currentPage:Math.min(P,a)};return performance.now(),o},[V,P,S]),G=r.useCallback(e=>{const r=i.trackInteraction.start("page-change");E(Math.max(1,Math.min(e,$.totalPages))),i.trackInteraction.end(r,"page-change")},[$.totalPages]),F=r.useCallback(e=>{const r=i.trackInteraction.start("edit-start");f(e.id),j(e.value),i.trackInteraction.end(r,"edit-start")},[]),O=r.useCallback(async e=>{const r=i.trackInteraction.start("edit-save");try{await c("update-record",async()=>{await p({...e,value:w})},1),f(null),j(""),I(r=>{const a=new Set(r);return a.delete(e.id),a})}catch(a){}finally{i.trackInteraction.end(r,"edit-save")}},[w,p]),D=r.useCallback(e=>{const r=i.trackInteraction.start("edit-cancel");f(null),j(""),I(r=>{const a=new Set(r);return a.delete(e),a}),i.trackInteraction.end(r,"edit-cancel")},[]),z=r.useCallback(async e=>{const r=i.trackInteraction.start("delete-record");try{window.confirm(t("pages.list.confirmDelete"))&&(await c("delete-record",async()=>{await y(e.id)},1),I(r=>{const a=new Set(r);return a.delete(e.id),a}))}catch(a){}finally{i.trackInteraction.end(r,"delete-record")}},[y,t]),L=r.useCallback(e=>{j(e)},[]),A=r.useCallback(e=>{const r=i.trackInteraction.start("toggle-text");N(r=>{const a=new Set(r);return a.has(e)?a.delete(e):a.add(e),a}),i.trackInteraction.end(r,"toggle-text")},[]),Y=r.useCallback(e=>{const r=i.trackInteraction.start("toggle-buttons");I(r=>{const a=new Set(r);return a.has(e)?a.delete(e):a.add(e),a}),i.trackInteraction.end(r,"toggle-buttons")},[]),q=r.useCallback(e=>{const r=i.trackInteraction.start("page-size-change");T(e),E(1),i.trackInteraction.end(r,"page-size-change")},[]);return r.useEffect(()=>{},[d.length,$.totalGroups,$.currentPage,$.totalPages,S]),e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto px-2 sm:px-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-white mb-6 sm:mb-8",children:t("pages.list.title")}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 sm:p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:$.totalGroups}),e.jsx("span",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300 ml-1",children:t("pages.list.recordGroups")})]}),e.jsxs("div",{className:"flex items-center justify-center sm:justify-end gap-2",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300 whitespace-nowrap",children:t("pages.list.displayCount")}),e.jsxs("select",{value:S,onChange:e=>q(Number(e.target.value)),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg px-3 py-1.5 sm:py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 dark:focus:ring-blue-400 text-sm sm:text-base min-w-[80px]",children:[e.jsx("option",{value:10,children:t("pages.list.items10")}),e.jsx("option",{value:20,children:t("pages.list.items20")}),e.jsx("option",{value:50,children:t("pages.list.items50")}),e.jsx("option",{value:100,children:t("pages.list.items100")})]})]})]})}),$.totalPages>1&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-3 sm:p-4 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G(1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(g,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.currentPage-1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(m,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[$.currentPage," / ",$.totalPages," ",t("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G($.currentPage+1),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(x,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.totalPages),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(b,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]})}),0===Object.entries($.groups).length&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 sm:p-8 text-center text-gray-500 dark:text-gray-400",children:e.jsx("p",{className:"text-base sm:text-lg",children:t("pages.list.noRecords")})}),e.jsx("div",{className:"space-y-8",children:Object.entries($.groups).map(([r,a])=>e.jsx(h,{datetime:r,records:a,getField:R,sortRecordsByFieldOrder:B,editId:k,editValue:w,expandedTexts:v,showButtons:C,onEdit:F,onEditSave:O,onEditCancel:D,onDelete:z,onEditValueChange:L,onToggleTextExpansion:A,onToggleButtons:Y},r))}),$.totalPages>1&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-3 sm:p-4 mt-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G(1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(g,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.currentPage-1),disabled:1===$.currentPage,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(m,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[$.currentPage," / ",$.totalPages," ",t("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>G($.currentPage+1),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(x,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{onClick:()=>G($.totalPages),disabled:$.currentPage===$.totalPages,className:"p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-600",children:e.jsx(b,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]})})]})}h.displayName="RecordGroup";export{k as default};
