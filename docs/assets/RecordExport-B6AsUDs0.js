import{j as e}from"./ui-vendor-Bpjs_4Uy.js";import{a}from"./react-vendor-9hcqHTTy.js";import{g as t,a as s,b as l,c as r,H as n,B as i,d,e as c,f as o,h as x,i as m,j as u,k as h,l as f,m as g,n as j,o as y,u as b,p,q as w,r as N,s as v}from"./index-dy8cmDfH.js";import"./icons-vendor-BLJDdPqg.js";import"./dnd-vendor-B-r8cpST.js";import"./state-vendor-CZRBIdKG.js";const k=a.memo(function({onStatusChange:c}){const o=a.useCallback(async()=>{try{null==c||c("データをエクスポート中...");const[a,n,i,d]=await Promise.all([t(),s(),l(),r()]),o={weightRecords:a,bpRecords:n,dailyRecords:i,dailyFields:d},x=JSON.stringify(o,null,2),m=new Blob([x],{type:"application/json"}),u=URL.createObjectURL(m),h=document.createElement("a");h.href=u,h.download=`records-v2-${e=new Date,`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}${String(e.getSeconds()).padStart(2,"0")}`}.json`,h.click(),URL.revokeObjectURL(u),null==c||c("JSONエクスポートが完了しました")}catch(a){null==c||c(`エクスポートエラー: ${a instanceof Error?a.message:"Unknown error"}`)}var e},[c]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-gray-700 dark:text-gray-200 flex items-center gap-2 justify-center",children:[e.jsx(n,{className:"w-6 h-6"}),"データエクスポート"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 flex justify-center",children:e.jsx("div",{className:"text-left max-w-md",children:e.jsx("p",{children:"記録したデータをファイルとしてダウンロードできます。"})})}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:e.jsx(i,{variant:"primary",icon:d,onClick:o,children:"JSON形式でエクスポート"})}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:"• JSON形式: アプリに再インポートできる形式"})})]})]})}),S={success:{containerClass:"bg-green-50 border-green-200 text-green-700",iconClass:"text-green-600",defaultIcon:m},error:{containerClass:"bg-red-50 border-red-200 text-red-700",iconClass:"text-red-600",defaultIcon:x},warning:{containerClass:"bg-amber-50 border-amber-200 text-amber-700",iconClass:"text-amber-600",defaultIcon:o},info:{containerClass:"bg-blue-50 border-blue-200 text-blue-700",iconClass:"text-blue-600",defaultIcon:c}},$="p-4 rounded-lg border font-medium flex items-start gap-3 shadow-sm",C=({type:t,message:s,autoHide:l=!1,hideDelay:r=3e3,onHide:n,className:i="",icon:d})=>{const[c,o]=a.useState(!0),x=S[t],m=d||x.defaultIcon;if(a.useEffect(()=>{if(l&&r>0){const e=setTimeout(()=>{o(!1),null==n||n()},r);return()=>clearTimeout(e)}},[l,r,n]),!c)return null;const u=[$,x.containerClass,i].join(" ");return e.jsxs("div",{className:u,role:"alert","aria-live":"polite",children:[e.jsx(m,{className:`w-5 h-5 ${x.iconClass} flex-shrink-0 mt-0.5`,"aria-hidden":"true"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm leading-relaxed",children:s})})]})},M=a=>e.jsx(C,{type:"success",...a}),D=a=>e.jsx(C,{type:"error",...a}),I=a=>e.jsx(C,{type:"info",...a}),E=a.memo(function({onStatusChange:t,onDataUpdated:s}){const[l,r]=a.useState(null),n=a.useRef(null),d=a.useCallback(async e=>{r("データをインポート中..."),null==t||t("データをインポート中...");try{const l=await e.text(),n=JSON.parse(l);if(!n||"object"!=typeof n)throw new Error("無効なJSONファイルです");const{weightRecords:i=[],bpRecords:d=[],dailyRecords:c=[],dailyFields:o=[]}=n;let x=0;if(Array.isArray(o))for(const e of o)if(e&&"object"==typeof e&&e.fieldId&&e.name)try{await u({fieldId:e.fieldId,name:e.name,order:e.order||0,display:!1!==e.display}),x++}catch(a){a instanceof Error&&a.message.includes("already exists")}if(Array.isArray(i))for(const e of i)if(e&&"object"==typeof e&&e.id&&e.date&&"number"==typeof e.weight)try{await h({id:e.id,date:e.date,time:e.time||"",weight:e.weight,bodyFat:e.bodyFat||null,waist:e.waist||null,note:e.note||null,excludeFromGraph:e.excludeFromGraph||!1}),x++}catch(a){}if(Array.isArray(d))for(const e of d)if(e&&"object"==typeof e&&e.id&&e.date&&"number"==typeof e.systolic&&"number"==typeof e.diastolic)try{await f({id:e.id,date:e.date,time:e.time||"",systolic:e.systolic,diastolic:e.diastolic,heartRate:e.heartRate||e.pulse||null,note:e.note||null}),x++}catch(a){}if(Array.isArray(c))for(const e of c)if(e&&"object"==typeof e&&e.id&&e.date&&e.fieldId&&"number"==typeof e.value)try{await g({id:e.id,date:e.date,fieldId:e.fieldId,value:e.value}),x++}catch(a){}r(`インポート完了: ${x}件のレコードを追加しました`),null==t||t(`インポート完了: ${x}件のレコードを追加しました`),null==s||s()}catch(a){const e=a instanceof Error?a.message:"不明なエラー";r(`インポートに失敗しました: ${e}`),null==t||t(`インポートに失敗しました: ${e}`)}},[t,s]),c=a.useCallback(e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&("application/json"===s.type||s.name.endsWith(".json")?d(s):(r("JSONファイルを選択してください"),null==t||t("JSONファイルを選択してください")))},[d,t]),x=a.useCallback(()=>{var e;null==(e=n.current)||e.click()},[]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-gray-700 dark:text-gray-200 flex items-center gap-2 justify-center",children:[e.jsx(j,{className:"w-6 h-6"}),"データインポート"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 flex justify-center",children:e.jsx("div",{className:"text-left max-w-md",children:e.jsx("p",{children:"以前にエクスポートしたJSONファイルからデータを復元できます。"})})}),e.jsxs("div",{className:"flex items-center gap-4 justify-center",children:[e.jsx(i,{variant:"primary",icon:y,onClick:x,children:"JSONファイルを選択"}),e.jsx("input",{ref:n,type:"file",accept:".json,application/json",onChange:c,className:"hidden"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 max-w-md",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"}),e.jsx("p",{className:"font-semibold text-sm text-yellow-800 dark:text-yellow-200",children:"注意事項"})]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-yellow-800 dark:text-yellow-200 text-left",children:[e.jsx("li",{children:"既存のデータは保持され、新しいデータが追加されます"}),e.jsx("li",{children:"同じIDのレコードがある場合は、既存データが優先されます"}),e.jsx("li",{children:"インポート前に現在のデータをバックアップすることをお勧めします"}),e.jsx("li",{children:"このアプリでエクスポートしたJSONファイルのみ対応しています"})]})]})})}),l&&e.jsx("div",{className:"mt-4",children:l.includes("失敗")||l.includes("エラー")?e.jsx(D,{message:l}):l.includes("完了")?e.jsx(M,{message:l}):e.jsx(I,{message:l})})]})]})}),U=a.memo(function({onStatusChange:t,onDataUpdated:s}){const{deleteAllData:l}=b(),[r,n]=a.useState(null),[d,c]=a.useState(!1),x=a.useCallback(async()=>{if(!window.confirm("本当にすべてのデータを削除しますか？\n\nこの操作は取り消せません。削除前にデータをエクスポートしてバックアップを作成することをお勧めします。\n\n続行しますか？"))return;if(window.confirm("最終確認です。\n\nすべての記録データ（体重、血圧、日課、目標）が完全に削除されます。\n\nこの操作は取り消せません。本当に実行しますか？")){c(!0),n("すべてのデータを削除中..."),null==t||t("すべてのデータを削除中...");try{await l(),n("すべてのデータを削除しました"),null==t||t("すべてのデータを削除しました"),null==s||s()}catch(e){const a=e instanceof Error?e.message:"不明なエラー";n(`削除に失敗しました: ${a}`),null==t||t(`削除に失敗しました: ${a}`)}finally{c(!1)}}},[l,t,s]),m=a.useCallback(()=>{n(null),null==t||t(null)},[t]);return e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-gray-700 dark:text-gray-200 flex items-center gap-2 justify-center",children:[e.jsx(o,{className:"w-6 h-6 text-red-600 dark:text-red-400"}),"危険な操作"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-red-800 dark:text-red-200 mb-4 flex justify-center",children:e.jsxs("div",{className:"text-left max-w-md",children:[e.jsx("p",{className:"mb-2",children:"この操作により、すべての記録データが完全に削除されます："}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 mb-3",children:[e.jsx("li",{children:"体重記録"}),e.jsx("li",{children:"血圧記録"}),e.jsx("li",{children:"日課記録"}),e.jsx("li",{children:"日課項目設定"}),e.jsx("li",{children:"目標設定"})]}),e.jsx("p",{className:"font-semibold",children:"削除前に必ずデータをエクスポートしてバックアップを作成してください。"})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(i,{variant:"danger",icon:p,onClick:x,disabled:d,children:d?"削除中...":"すべてのデータを削除"})}),r&&e.jsx("div",{className:"mt-4",children:r.includes("失敗")||r.includes("エラー")?e.jsx(D,{message:r,onHide:m}):r.includes("削除しました")?e.jsx(M,{message:r,onHide:m}):e.jsx(I,{message:r})}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:e.jsx("p",{children:"データは復元できません。慎重に操作してください。"})})]})]})}),R={primary:"bg-blue-600",success:"bg-green-600",warning:"bg-amber-500",error:"bg-red-600"},O={sm:"h-2",md:"h-3",lg:"h-4"},F=({value:a,max:t=100,showPercentage:s=!0,showValue:l=!1,label:r,size:n="md",variant:i="primary",className:d="",animated:c=!0})=>{const o=Math.min(Math.max(a,0),t),x=o/t*100,m=["w-full bg-gray-200 rounded-full overflow-hidden",O[n],d].join(" "),u=["h-full transition-all duration-300 ease-out",R[i],c?"transition-all duration-300":""].join(" ");return e.jsxs("div",{className:"w-full",children:[(r||s||l)&&e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r}),e.jsxs("div",{className:"text-sm text-gray-600 flex gap-2",children:[l&&e.jsxs("span",{children:[o," / ",t]}),s&&e.jsxs("span",{children:[Math.round(x),"%"]})]})]}),e.jsx("div",{className:m,role:"progressbar","aria-valuenow":o,"aria-valuemin":0,"aria-valuemax":t,children:e.jsx("div",{className:u,style:{width:`${x}%`}})})]})};function J({showTipsModal:t}){const[s,l]=a.useState(null),[r,n]=a.useState(null);a.useEffect(()=>{if(r)throw r},[r]);const i=a.useCallback(e=>{l(e)},[]),d=a.useCallback(()=>{t&&t()},[t]),c=a.useCallback(()=>{l(null)},[]);return a.useCallback(()=>{n(new Error("これは意図的なテストエラーです"))},[]),e.jsx("div",{className:"flex flex-col items-center justify-start py-4 bg-transparent min-h-screen",children:e.jsxs("div",{className:"w-full max-w-4xl space-y-6 px-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-2",children:"データ管理"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"データのエクスポート、インポート、テストデータ生成を行えます"})]}),s&&e.jsx("div",{className:"w-full",children:s.includes("エラー")||s.includes("失敗")?e.jsx(D,{message:s,onHide:c}):s.includes("完了")||s.includes("削除しました")?e.jsx(M,{message:s,onHide:c}):e.jsx(I,{message:s})}),e.jsx(k,{onStatusChange:i}),e.jsx(E,{onStatusChange:i,onDataUpdated:d}),e.jsx(U,{onStatusChange:i,onDataUpdated:d}),w,w,e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-800 dark:text-blue-200 text-center",children:"使用上の注意"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-blue-700 dark:text-blue-300 text-left max-w-md",children:[e.jsx("li",{children:"データは端末内のみに保存され、外部サーバーには送信されません"}),e.jsx("li",{children:"定期的にデータをエクスポートしてバックアップを作成することをお勧めします"}),e.jsx("li",{children:"ブラウザのデータを削除すると、記録したデータも失われます"}),e.jsx("li",{children:"インポート時は既存データに新しいデータが追加されます（上書きではありません）"})]})})]})]})})}a.memo(function({onStatusChange:r}){const[n,d]=a.useState(null),[c,o]=a.useState(0),[x,m]=a.useState(!1),[u,j]=a.useState(0),[y,b]=a.useState(0),[p,w]=a.useState(0),[k,S]=a.useState(""),[$,C]=a.useState(""),[E,U]=a.useState(""),R=a.useCallback(async()=>{try{const[e,a,r]=await Promise.all([t(),l(),s()]);if(j(e.length),b(a.length),w(r.length),e.length>0){const a=e.map(e=>e.date).sort();S(`${a[0]} ～ ${a[a.length-1]}`)}else S("");if(a.length>0){const e=a.map(e=>e.date).sort();C(`${e[0]} ～ ${e[e.length-1]}`)}else C("");if(r.length>0){const e=r.map(e=>e.date).sort();U(`${e[0]} ～ ${e[e.length-1]}`)}else U("")}catch(e){}},[]),O=a.useCallback(async()=>{d("体重テストデータを生成中..."),m(!0),o(0),null==r||r("体重テストデータを生成中...");try{const a=180,t=75,s=50,l=100;let n=0;for(let r=a-1;r>=0;r--){const i=new Date;i.setDate(i.getDate()-r);const d=i.getFullYear(),c=String(i.getMonth()+1).padStart(2,"0"),x=`${d}-${c}-${String(i.getDate()).padStart(2,"0")}`,m="08:00";let u=t-.05*(a-r)+2*(Math.random()-.5);u=Math.max(s,Math.min(l,Math.round(10*u)/10));const f={id:`test_weight_${x}_${Math.random().toString(36).substr(2,6)}`,date:x,time:m,weight:u,bodyFat:Math.random()>.2?Math.round(10*(15+20*Math.random()))/10:null,waist:Math.random()>.2?Math.round(10*(65+25*Math.random()))/10:null,note:Math.random()>.7?"テストメモ":null,excludeFromGraph:Math.random()>.5};try{await h(f),n++,o(n/a*50)}catch(e){}}d(`体重テストデータ生成完了: ${n}/${a}件`),null==r||r(`体重テストデータ生成完了: ${n}/${a}件`),await R()}catch(e){d(`エラー: ${e instanceof Error?e.message:"Unknown error"}`),null==r||r(`エラー: ${e instanceof Error?e.message:"Unknown error"}`)}finally{m(!1)}},[r,R]),J=a.useCallback(async()=>{d("日課テストデータを生成中..."),m(!0),o(50),null==r||r("日課テストデータを生成中...");try{const a=[{fieldId:"exercise"},{fieldId:"meal"},{fieldId:"sleep"},{fieldId:"smoke"},{fieldId:"alcohol"}],t=180;let s=0;for(let l=t-1;l>=0;l--){const r=new Date;r.setDate(r.getDate()-l);const n=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),d=`${n}-${i}-${String(r.getDate()).padStart(2,"0")}`;for(const t of a){const a=Math.random();let s;s=a<.3?1:a<.6?.5:0;const l={id:`test_daily_${t.fieldId}_${d}_${Math.random().toString(36).substr(2,6)}`,date:d,fieldId:t.fieldId,value:s};try{await g(l)}catch(e){}}s++,o(50+s/t*25)}d(`日課テストデータ生成完了: ${s*a.length}件`),null==r||r(`日課テストデータ生成完了: ${s*a.length}件`),await R()}catch(e){d(`エラー: ${e instanceof Error?e.message:"Unknown error"}`),null==r||r(`エラー: ${e instanceof Error?e.message:"Unknown error"}`)}},[r,R]),_=a.useCallback(async()=>{d("血圧テストデータを生成中..."),o(75),null==r||r("血圧テストデータを生成中...");try{const a=180;let t=0;for(let s=a-1;s>=0;s--){const l=new Date;l.setDate(l.getDate()-s);const r=l.getFullYear(),n=String(l.getMonth()+1).padStart(2,"0"),i=`${r}-${n}-${String(l.getDate()).padStart(2,"0")}`,d=["08:00","22:00"];for(const a of d){const t=110+Math.round(30*Math.random()),s=60+Math.round(30*Math.random()),l=60+Math.round(40*Math.random()),r={id:`test_bp_${i}_${a.replace(":","")}_${Math.random().toString(36).substr(2,6)}`,date:i,time:a,systolic:t,diastolic:s,heartRate:l,note:Math.random()>.8?"テストメモ":null};try{await f(r)}catch(e){}}t++,o(75+t/a*25)}d(`血圧テストデータ生成完了: ${2*t}件`),null==r||r(`血圧テストデータ生成完了: ${2*t}件`),await R()}catch(e){d(`エラー: ${e instanceof Error?e.message:"Unknown error"}`),null==r||r(`エラー: ${e instanceof Error?e.message:"Unknown error"}`)}finally{m(!1),o(100)}},[r,R]),A=a.useCallback(async()=>{const e=`generate-test-data-${Date.now()}`;N.trackDatabase.start(e,"generate-test-data");try{await O(),await J(),await _(),d("すべてのテストデータ生成が完了しました"),null==r||r("すべてのテストデータ生成が完了しました")}catch(a){d(`エラー: ${a instanceof Error?a.message:"Unknown error"}`),null==r||r(`エラー: ${a instanceof Error?a.message:"Unknown error"}`)}finally{N.trackDatabase.end(e,"generate-test-data"),m(!1)}},[O,J,_,r]);return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-gray-700 dark:text-gray-200 flex items-center gap-2 justify-center",children:[e.jsx(v,{className:"w-6 h-6"}),"テストデータ生成"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 flex justify-center",children:e.jsxs("div",{className:"text-left max-w-md",children:[e.jsxs("p",{children:["• 体重: ",u,"件 ",k&&`(${k})`]}),e.jsxs("p",{children:["• 日課: ",y,"件 ",$&&`(${$})`]}),e.jsxs("p",{children:["• 血圧: ",p,"件 ",E&&`(${E})`]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(i,{variant:"primary",icon:v,onClick:O,disabled:x,children:"体重テストデータ生成"}),e.jsx(i,{variant:"primary",icon:v,onClick:J,disabled:x,children:"日課テストデータ生成"}),e.jsx(i,{variant:"primary",icon:v,onClick:_,disabled:x,children:"血圧テストデータ生成"}),e.jsx(i,{variant:"success",icon:v,onClick:A,disabled:x,children:"すべて生成"})]}),x&&e.jsx(F,{value:c,label:"テストデータを生成中..."}),n&&e.jsx("div",{className:"mt-4",children:n.includes("エラー")?e.jsx(D,{message:n}):n.includes("完了")?e.jsx(M,{message:n}):e.jsx(I,{message:n})})]})]})})});export{J as default};
