import{j as e,F as t,u as a,a as l,b as s,c as r,d as n,o,f as i,s as d}from"./ui-vendor-BuGzxEnB.js";import{a as c,d as m}from"./react-vendor-9hcqHTTy.js";import{o as x}from"./state-vendor-DgseLVVv.js";import{y as h,B as g,g as u,H as b,a as f,b as p}from"./index-C0f7XZnR.js";import{u as w,a as y,P as j,N,T as v,M as k}from"./useRecordForm-BqhG4utG.js";import{B as F}from"./Button-Dy_TAhW8.js";import{u as C,D}from"./useDateSelection-Dkv6rEpB.js";import"./icons-vendor-BLJDdPqg.js";const M=[{min:0,max:18.5,color:"#6ec6f1",label:"ä½ä½“é‡",range:"<18.5"},{min:18.5,max:25,color:"#7edfa0",label:"æ™®é€šä½“é‡",range:"18.5-24.9"},{min:25,max:30,color:"#b6d97a",label:"è‚¥æº€(1åº¦)",range:"25-29.9"},{min:30,max:35,color:"#ffe066",label:"è‚¥æº€(2åº¦)",range:"30-34.9"},{min:35,max:40,color:"#ff9800",label:"è‚¥æº€(3åº¦)",range:"35-39.9"},{min:40,max:100,color:"#f44336",label:"è‚¥æº€(4åº¦)",range:"40.0+"}],R=function({currentWeight:t,goal:a,showWeightDiff:l=!0}){if(!a)return null;const s=null==a?void 0:a.height,r=null==a?void 0:a.startWeight,n=t&&s?t/Math.pow(s/100,2):null,o="number"!=typeof n||isNaN(n)?0:n,i=(()=>{if(null===n)return 0;let e=0;for(let t=0;t<M.length;t++){const a=M[t];if(n<a.max){return e+100/M.length*((n-a.min)/(a.max-a.min))}e+=100/M.length}return 100})(),[d,m]=c.useState(0);c.useEffect(()=>{if("number"!=typeof n||isNaN(n))return;const e=performance.now();requestAnimationFrame(function t(a){const l=a-e,s=Math.min(l/800,1);m(0+(o-0)*s),s<1?requestAnimationFrame(t):m(o)})},[o,n]);const[x,h]=c.useState(0);return c.useEffect(()=>{if(l&&void 0!==r&&null!==t&&t-r<0){let e=function(t){const r=t-n,o=Math.min(r/s,1);h(l+(a-l)*o),o<1?requestAnimationFrame(e):h(a)};const a=t-r,l=0,s=800,n=performance.now();requestAnimationFrame(e)}else h(0)},[r,t,l]),n&&s?e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[l&&e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsxs("span",{className:"text-base font-semibold text-blue-700 dark:text-blue-200",children:["BMI"," ",e.jsx("span",{style:{display:"inline-block",minWidth:"4ch",textAlign:"right",fontFamily:"monospace"},children:d.toFixed(1)})]}),l&&x<0&&e.jsxs("span",{className:"ml-2 text-base font-semibold text-green-600 dark:text-green-400",children:["ğŸ†",x.toFixed(1),"kg"]})]}),e.jsxs("div",{className:"flex flex-col items-center mb-2",children:[e.jsxs("div",{className:"relative w-full h-8 flex rounded overflow-hidden shadow",style:{minWidth:240},children:[M.map(t=>e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center",style:{backgroundColor:t.color},title:`${t.label} (${t.range})`,children:e.jsx("span",{className:"text-[10px] font-bold text-gray-800 dark:text-gray-900",children:t.label})},t.label)),e.jsx("div",{className:"absolute top-0 text-red-600 text-lg font-bold",style:{left:`${i}%`,transform:"translateX(-50%)",lineHeight:"32px",fontSize:"20px",fontWeight:"bold",textShadow:"0 0 2px #fff, 0 0 2px #fff, 1px 1px 2px #0002",zIndex:2},"aria-label":"ç¾åœ¨ã®BMIä½ç½®",children:"â–¼"})]}),e.jsx("div",{className:"w-full flex justify-between mt-1 px-1",children:M.map(t=>e.jsx("span",{className:"text-[10px] text-gray-700 dark:text-gray-200",style:{flex:1,textAlign:"center"},children:t.range},t.label+"-range"))})]})]}):null},W=["æœä¸€","æœé£Ÿå¾Œ","å¤•é£Ÿå‰","å¤•é£Ÿå¾Œ","å°±å¯å‰","é‹å‹•å¾Œã«æ¸¬å®š","å¤–é£Ÿã‚ã‚Š"],S={weight:"",bodyFat:"",waist:"",time:u(),note:"",excludeFromGraph:!1};const G=x(({showTipsModal:x})=>{const{goal:u,loadGoal:M}=h(),G=c.useCallback(async()=>{const e=await g.getAll();if(!e.success)throw new Error(e.error||"Failed to fetch records");return e.data||[]},[]),B=c.useCallback(async e=>{const t=await g.add(e);if(!t.success)throw new Error(t.error||"Failed to add record")},[]),I=c.useCallback(async e=>{const t=await g.update(e);if(!t.success)throw new Error(t.error||"Failed to update record")},[]),$=c.useCallback(async e=>{const t=await g.delete(e);if(!t.success)throw new Error(t.error||"Failed to delete record")},[]),{records:A,isLoading:E,error:z,handleAdd:P,handleUpdate:T,handleDelete:O,clearError:q}=w({getAllRecords:G,addRecord:B,updateRecord:I,deleteRecord:$,onRecordAdded:x}),{selectedDate:L,setSelectedDate:V,centerDate:H,setCenterDate:J,today:U,recordDate:X,recordsOfDay:K,isRecorded:Q}=C({records:A,getRecordDate:e=>e.date}),{formData:Y,updateField:Z,resetForm:_,createRecordFromForm:ee}=y({initialValues:S,createRecord:(e,t)=>({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:t,time:e.time,weight:Number(e.weight),bodyFat:""!==e.bodyFat?Number(e.bodyFat):null,waist:""!==e.waist?Number(e.waist):null,note:e.note||null,excludeFromGraph:e.excludeFromGraph}),resetValues:S}),te=(()=>{const e=c.useCallback((e,t)=>t<=0?0:Number((e/Math.pow(t/100,2)).toFixed(2)),[]),t=c.useCallback((e,t)=>Number((e-t).toFixed(2)),[]),a=c.useCallback(e=>0===e.length?0:Math.min(...e.map(e=>Number(e.weight))),[]),l=c.useCallback(e=>!!(e.weight||e.bodyFat||e.waist),[]),s=c.useCallback((l,s)=>{const r=l.length>0,n=s&&s.height&&s.height>0;if(!r||!n)return{shouldShowBMI:!1,bmi:0,weightChange:0,lowestWeight:0};const o=a(l);return{shouldShowBMI:!0,bmi:e(o,s.height),weightChange:t(o,s.startWeight||0),lowestWeight:o}},[e,t,a]),r=c.useCallback(e=>e<18.5?{category:"ä½ä½“é‡",color:"text-blue-600"}:e<25?{category:"æ™®é€šä½“é‡",color:"text-green-600"}:e<30?{category:"è‚¥æº€åº¦1",color:"text-yellow-600"}:{category:"è‚¥æº€åº¦2ä»¥ä¸Š",color:"text-red-600"},[]),n=c.useCallback(e=>e>0?{text:`+${e}kg`,color:"text-red-600",icon:"â†—"}:e<0?{text:`${e}kg`,color:"text-blue-600",icon:"â†˜"}:{text:"Â±0kg",color:"text-gray-600",icon:"â†’"},[]),o=c.useCallback(e=>!!(e.weight&&e.weight>0),[]),i=c.useCallback(e=>[...e].sort((e,t)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${t.date}T${t.time}`).getTime()),[]);return{calculateBMI:e,calculateWeightChange:t,calculateLowestWeight:a,calculateBMIDisplayInfo:s,hasRecordData:l,isValidRecord:o,getBMICategory:r,getWeightChangeDisplay:n,sortRecordsByDateTime:i,noteExamples:W}})(),ae=c.useMemo(()=>0===K.length?null:te.calculateLowestWeight(K),[K,te]),le=c.useMemo(()=>ae&&u&&u.height?te.calculateBMI(ae,u.height):null,[ae,u,te]),se=c.useMemo(()=>ae&&u&&u.startWeight?te.calculateWeightChange(ae,u.startWeight):null,[ae,u,te]),re=!!u,ne=!!(null==u?void 0:u.height);m.useEffect(()=>{re&&ne||M()},[re,ne,M]);const oe=te.hasRecordData(Y),ie=c.useCallback(async()=>{if(oe)try{const e=ee(X);await P(e),_()}catch(e){}},[oe,ee,X,P,_]),de=function(){const[e,t]=c.useState(!1),{refs:m,floatingStyles:x,context:h}=a({open:e,onOpenChange:t,middleware:[o(6),i(),d()],placement:"bottom-end"}),g=l(h),u=s(h),b=r(h),{getReferenceProps:f,getFloatingProps:p}=n([g,u,b]);return{open:e,setOpen:t,refs:m,floatingStyles:x,getReferenceProps:f,getFloatingProps:p}}();return e.jsxs("div",{className:"bg-transparent",children:[e.jsx(D,{selectedDate:L,setSelectedDate:V,centerDate:H,setCenterDate:J,today:U,isRecorded:Q,"data-testid":"date-picker"}),e.jsx("div",{className:"w-full max-w-md mx-auto mt-3 mb-3 flex justify-start pl-4",children:e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:[L.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}),Q(L)&&e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"inline-block w-6 h-6 text-green-500 ml-2 align-middle","aria-label":"å…¥åŠ›æ¸ˆã¿"}),null!==le&&e.jsxs("span",{className:"ml-3 text-base font-semibold text-blue-700 dark:text-blue-200 align-middle",children:["BMI ",le.toFixed(1),null!==se&&se<0&&e.jsxs("span",{className:"ml-2 text-base font-semibold text-green-600 dark:text-green-400",children:["ğŸ†",se.toFixed(1),"kg"]})]})]})]})}),e.jsx(R,{currentWeight:ae,goal:u,showWeightDiff:!1}),e.jsxs("div",{className:"flex flex-col items-center justify-start min-h-[60vh]",children:[z&&e.jsx("div",{className:"w-full max-w-md mb-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-800 text-sm",children:z}),e.jsx("button",{onClick:q,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"ã‚¨ãƒ©ãƒ¼ã‚’é–‰ã˜ã‚‹"})]})}),e.jsx("div",{className:"flex flex-col gap-2 w-full max-w-md",children:K.map(t=>e.jsxs("div",{className:"flex flex-col gap-1 bg-white dark:bg-gray-800 rounded-xl shadow p-2 mb-1",children:[e.jsxs("div",{className:"flex items-center w-full mb-1 justify-between",children:[e.jsx("input",{type:"time",className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-inherit text-gray-700 dark:text-gray-200 w-[6.5em]",value:t.time,onChange:e=>T({...t,time:e.target.value})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{variant:"danger",size:"sm",icon:f,"aria-label":"å‰Šé™¤",onClick:()=>O(t.id),children:""}),e.jsxs(F,{variant:t.excludeFromGraph?"secondary":"sky",size:"sm","aria-label":t.excludeFromGraph?"ã‚°ãƒ©ãƒ•é™¤å¤–":"ã‚°ãƒ©ãƒ•è¡¨ç¤º",onClick:()=>T({...t,excludeFromGraph:!t.excludeFromGraph}),children:["",e.jsxs("span",{className:"relative inline-block w-5 h-5",children:[e.jsx(j,{className:"w-5 h-5 text-white"}),t.excludeFromGraph&&e.jsx(p,{className:"w-5 h-5 text-red-500 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 w-full",children:[e.jsx(N,{value:t.weight,onChange:e=>T({...t,weight:Number(e)}),placeholder:"ä½“é‡",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"kg"}),e.jsx(N,{value:t.bodyFat??"",onChange:e=>T({...t,bodyFat:""===e?null:Number(e)}),placeholder:"ä½“è„‚è‚ª",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"%"}),e.jsx(N,{value:t.waist??"",onChange:e=>T({...t,waist:""===e?null:Number(e)}),placeholder:"è…¹å›²",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"cm"})]}),e.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full pr-10 mb-0",value:t.note??"",onChange:e=>T({...t,note:e.target.value}),placeholder:"è£œè¶³ãƒ»ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"})]},t.id))}),e.jsx("div",{className:"w-full max-w-md mt-2 mb-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-2 mb-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center w-full mb-1 justify-between",children:[e.jsx(v,{value:Y.time,onChange:e=>Z("time",e)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{variant:"success",size:"sm",icon:b,"aria-label":"ä¿å­˜",onClick:ie,"data-testid":"save-btn",disabled:E||!oe,children:""}),e.jsxs(F,{variant:Y.excludeFromGraph?"secondary":"sky",size:"sm","aria-label":Y.excludeFromGraph?"ã‚°ãƒ©ãƒ•é™¤å¤–":"ã‚°ãƒ©ãƒ•è¡¨ç¤º",onClick:()=>Z("excludeFromGraph",!Y.excludeFromGraph),children:["",e.jsxs("span",{className:"relative inline-block w-5 h-5",children:[e.jsx(j,{className:"w-5 h-5 text-white"}),Y.excludeFromGraph&&e.jsx(p,{className:"w-5 h-5 text-red-500 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 w-full mb-1",children:[e.jsx(N,{value:Y.weight,onChange:e=>Z("weight",e),placeholder:"ä½“é‡",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"kg"}),e.jsx(N,{value:Y.bodyFat,onChange:e=>Z("bodyFat",e),placeholder:"ä½“è„‚è‚ª",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"%"}),e.jsx(N,{value:Y.waist,onChange:e=>Z("waist",e),placeholder:"è…¹å›²",step:"0.1",min:"0",width:"lg"}),e.jsx("span",{className:"ml-0.5 mr-3 text-gray-500",children:"cm"})]}),e.jsxs("div",{className:"relative w-full mt-0",children:[e.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full pr-10 mb-0",rows:1,value:Y.note,onChange:e=>Z("note",e.target.value),placeholder:"è£œè¶³ãƒ»ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰"}),e.jsx("div",{ref:de.refs.setReference,...de.getReferenceProps({}),className:"absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"å®šå‹æ–‡ã‚’æŒ¿å…¥",onClick:()=>de.setOpen(e=>!e),children:e.jsx(k,{className:"w-6 h-6"})}),de.open&&e.jsx(t,{children:e.jsx("div",{ref:de.refs.setFloating,style:de.floatingStyles,...de.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:te.noteExamples.map(t=>e.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{Z("note",t),de.setOpen(!1)},children:t},t))})})]})]})}),e.jsx("div",{className:"w-full max-w-md mx-auto mb-2 px-4",children:e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400 text-yellow-800 dark:text-yellow-100 p-3 rounded shadow-sm text-sm text-left",children:[e.jsx("strong",{children:"ã€ãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆã€‘"})," ","ä½“é‡ã¯ã§ãã‚‹ã ã‘æ¯æ—¥åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆä¾‹ï¼šæœèµ·ãã¦ãƒˆã‚¤ãƒ¬å¾Œã€é£Ÿäº‹å‰ãªã©ï¼‰ã§æ¸¬ã‚‹ã¨ã€æ—¥ã€…ã®å¤‰åŒ–ãŒã‚ˆã‚Šæ­£ç¢ºã«ã‚ã‹ã‚Šã¾ã™ã€‚åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã¯ãªã„è¨˜éŒ²ã¯ã‚°ãƒ©ãƒ•ã‹ã‚‰é™¤å¤–ã§ãã¾ã™ã€‚"]})})]})]})});export{G as default};
