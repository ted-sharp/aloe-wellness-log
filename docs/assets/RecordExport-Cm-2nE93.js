import{j as e}from"./ui-vendor-Bfl5gO4l.js";import{a as t}from"./react-vendor-BOksNuje.js";import{H as a,a as s,b as r,c as l,u as d,g as i,d as n,e as c,p as o,i as x,f as m,B as h,h as g,j as u,k as b,l as f,m as p,n as j,o as w,q as y,r as N,s as k,t as v}from"./index-CSQQWXIt.js";import"./icons-vendor-CuPH0hr8.js";import"./dnd-vendor-MWhKAIwc.js";import"./state-vendor-BSG_ROek.js";const S={success:{containerClass:"bg-green-50 border-green-200 text-green-700",iconClass:"text-green-600",defaultIcon:l},error:{containerClass:"bg-red-50 border-red-200 text-red-700",iconClass:"text-red-600",defaultIcon:r},warning:{containerClass:"bg-amber-50 border-amber-200 text-amber-700",iconClass:"text-amber-600",defaultIcon:s},info:{containerClass:"bg-blue-50 border-blue-200 text-blue-700",iconClass:"text-blue-600",defaultIcon:a}},R="p-4 rounded-lg border font-medium flex items-start gap-3 shadow-sm",$=({type:a,message:s,autoHide:r=!1,hideDelay:l=3e3,onHide:d,className:i="",icon:n})=>{const[c,o]=t.useState(!0),x=S[a],m=n||x.defaultIcon;if(t.useEffect(()=>{if(r&&l>0){const e=setTimeout(()=>{o(!1),null==d||d()},l);return()=>clearTimeout(e)}},[r,l,d]),!c)return null;const h=[R,x.containerClass,i].join(" ");return e.jsxs("div",{className:h,role:"alert","aria-live":"polite",children:[e.jsx(m,{className:`w-5 h-5 ${x.iconClass} flex-shrink-0 mt-0.5`,"aria-hidden":"true"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm leading-relaxed",children:s})})]})},C=t=>e.jsx($,{type:"success",...t}),E=t=>e.jsx($,{type:"error",...t}),A=t=>e.jsx($,{type:"info",...t});function V({showTipsModal:a}){const{records:r,fields:l,loadRecords:S,loadFields:R,deleteAllData:$,initializeFields:V}=d(),[O,T]=t.useState(null),[F,I]=t.useState(null),[z,J]=t.useState(0),[W,L]=t.useState(!1),[U,D]=t.useState(null),[H,M]=t.useState(0),[P,B]=t.useState(0),[q,Y]=t.useState(0),[G,K]=t.useState(""),[Q,X]=t.useState(""),[Z,_]=t.useState("");if(t.useEffect(()=>{i().then(e=>{if(M(e.length),e.length>0){const t=e.map(e=>e.date).sort();K(`${t[0]} 〜 ${t[t.length-1]}`)}else K("データなし")}),n().then(e=>{if(B(e.length),e.length>0){const t=e.map(e=>e.date).sort();X(`${t[0]} 〜 ${t[t.length-1]}`)}else X("データなし")}),c().then(e=>{if(Y(e.length),e.length>0){const t=e.map(e=>e.date).sort();_(`${t[0]} 〜 ${t[t.length-1]}`)}else _("データなし")})},[]),U)throw U;t.useEffect(()=>(o.trackRender.start("RecordExport"),()=>{o.trackRender.end("RecordExport")})),t.useEffect(()=>{},[r.length,l.length,O,F,z,W]);return e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto sm:px-0",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:"データの詳細"}),e.jsxs("div",{className:"text-base text-gray-600 dark:text-gray-300 space-y-3",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:"体重レコード数"})," ",H,e.jsx("span",{className:"ml-4 text-sm text-gray-500 dark:text-gray-400",children:G})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:"日課レコード数"})," ",P,e.jsx("span",{className:"ml-4 text-sm text-gray-500 dark:text-gray-400",children:Q})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:"血圧レコード数"})," ",q,e.jsx("span",{className:"ml-4 text-sm text-gray-500 dark:text-gray-400",children:Z})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:"データのエクスポート"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:"体重・血圧・日課（記録・項目）すべてを1つのJSONファイル（V2形式）でエクスポートします。"}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsx(h,{variant:"purple",size:"lg",icon:g,onClick:async()=>{const[e,t,a,s]=await Promise.all([i(),c(),n(),w()]),r={weightRecords:e,bpRecords:t,dailyRecords:a,dailyFields:s},l=JSON.stringify(r,null,2),d=new Blob([l],{type:"application/json"}),o=URL.createObjectURL(d),x=document.createElement("a");var m;x.href=o,x.download=`records-v2-${m=new Date,`${m.getFullYear()}${String(m.getMonth()+1).padStart(2,"0")}${String(m.getDate()).padStart(2,"0")}${String(m.getHours()).padStart(2,"0")}${String(m.getMinutes()).padStart(2,"0")}${String(m.getSeconds()).padStart(2,"0")}`}.json`,x.click(),URL.revokeObjectURL(o)},fullWidth:!1,"data-testid":"download-json-btn",children:"JSON形式でエクスポート"})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:"データのインポート"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:"体重・血圧・日課（記録・項目）すべてを1つのJSONファイル（V2形式）でインポートします。"}),O&&e.jsxs("div",{className:"mb-6",children:[O.includes("✅")&&e.jsx(C,{message:O.replace("✅ ","")}),O.includes("❌")&&e.jsx(E,{message:O.replace("❌ ","")}),!O.includes("✅")&&!O.includes("❌")&&e.jsx(A,{message:O})]}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".json",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){if(!a.name.toLowerCase().endsWith(".json"))return T("サポートされていないファイル形式です"),setTimeout(()=>T(null),3e3),void(e.target.value="");(async e=>{T("データをインポート中...");try{const a=await e.text(),s=JSON.parse(a);if(!(s&&"object"==typeof s&&Array.isArray(s.weightRecords)&&Array.isArray(s.bpRecords)&&Array.isArray(s.dailyRecords)&&Array.isArray(s.dailyFields)))throw new Error("V2 JSON file format is incorrect");let r=0;for(const e of s.weightRecords)try{await y(e),r++}catch(t){}for(const e of s.bpRecords)try{await N(e),r++}catch(t){}for(const e of s.dailyFields)try{await k(e)}catch(t){}for(const e of s.dailyRecords)try{await v(e),r++}catch(t){}await S(),await R(),T(`✅ ${r}件のデータをインポートしました`),setTimeout(()=>T(null),3e3)}catch(t){const e=t instanceof Error?t:new Error("Unknown error");T(`❌ データのインポートに失敗しました: ${e.message}`),setTimeout(()=>T(null),5e3)}})(a)}e.target.value=""},className:"hidden",id:"data-import"}),e.jsxs("label",{htmlFor:"data-import",className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-medium shadow-md hover:bg-purple-700 hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2 w-auto cursor-pointer",children:[e.jsx(u,{className:"w-5 h-5"}),"ファイルを選択"]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-4",children:"TIPS"}),e.jsx(h,{variant:"purple",size:"lg",icon:b,onClick:()=>a&&a(),fullWidth:!0,children:"TIPSを表示"})]}),x,x,e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-2xl shadow-md p-6 mb-8",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-red-800 dark:text-red-400 mb-6 flex items-center gap-2",children:[e.jsx(s,{className:"w-6 h-6 text-red-600 dark:text-red-500"}),"危険ゾーン"]}),e.jsx("div",{className:"mb-6 text-left",children:e.jsx("p",{className:"text-base text-red-700 dark:text-red-300 mb-3",children:"すべてのデータを削除してもよろしいですか？この操作は元に戻せません。"})}),e.jsx(h,{variant:"danger",size:"lg",icon:f,onClick:async()=>{if(window.confirm("すべてのデータを削除してもよろしいですか？")){if(window.confirm("本当に削除してもよろしいですか？この操作は元に戻せません。"))try{await $(),await V(),await R(),await S(),alert("すべてのデータを削除しました")}catch(e){alert("データの削除に失敗しました")}}},fullWidth:!1,children:"すべてのデータを削除"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-2xl shadow-md p-6 mt-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 dark:text-blue-400 mb-4 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-blue-600 dark:text-blue-500"}),"データV2移行（管理者用）"]}),e.jsx("div",{className:"mb-4 text-left",children:e.jsxs("p",{className:"text-base text-blue-700 dark:text-blue-300 mb-2",children:["既存の体重データ（V1）・日課データ（V1）を新しいテーブル（V2）へ一括移行します。",e.jsx("br",{}),"※通常利用時は不要です。管理者のみご利用ください。"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(h,{variant:"primary",size:"lg",icon:b,onClick:async()=>{const e=await p();window.alert(`体重データ移行が完了しました（${e}件）`)},fullWidth:!1,children:"体重データV2へ移行（管理者用）"}),e.jsx(h,{variant:"teal",size:"lg",icon:b,onClick:async()=>{const e=await j();window.alert(`日課データ移行が完了しました（${e}件）`)},fullWidth:!1,children:"日課データV2へ移行（管理者用）"})]})]})]})}export{V as default};
