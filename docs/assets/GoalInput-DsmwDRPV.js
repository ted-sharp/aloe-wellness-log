import{j as e,F as t,u as a,o as s,f as r,s as l,a as n,b as i,c as o,d as c}from"./ui-vendor-J9A7wRLG.js";import{o as d}from"./state-vendor-RA6ewXRt.js";import{B as x}from"./Button-DQwbRege.js";import{a as u}from"./react-vendor-C4GzcRrE.js";import{z as g,A as m,B as h,h as p,m as b,a as f}from"./index-iR6G4H9o.js";import{u as j}from"./useSaveState-DbkjJmWD.js";import"./icons-vendor-DCv9Y2bB.js";const N=u.memo(function({startWeight:t,targetWeight:a,targetStart:s,targetEnd:r,gender:l,type:n="total"}){const{isValid:i,totalCalories:o,dailyCalories:c}=u.useMemo(()=>{const e="female"===l?7e3:6500;if(!(t&&a&&s&&r&&!isNaN(Number(t))&&!isNaN(Number(a))&&Number(a)<Number(t)&&/^\d{4}-\d{2}-\d{2}$/.test(s)&&/^\d{4}-\d{2}-\d{2}$/.test(r)&&new Date(r)>=new Date(s)))return{isValid:!1,totalCalories:0,dailyCalories:0};const n=(Number(t)-Number(a))*e,i=new Date(s),o=new Date(r),c=Math.floor((o.getTime()-i.getTime())/864e5)+1;if(c<=0)return{isValid:!1,totalCalories:0,dailyCalories:0};return{isValid:!0,totalCalories:n,dailyCalories:Math.round(n/c)}},[t,a,s,r,l]);if(!i)return null;const d=(Number(t)-Number(a)).toFixed(1);switch(n){case"total":return e.jsxs("div",{className:"text-sm mb-2 text-black dark:text-white",children:["あと",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-bold text-xl",children:[d,"kg"]}),"減らすには",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-bold text-xl",children:["約",Math.round(o).toLocaleString(),"kcal"]}),"の消費が必要です。"]});case"daily":return e.jsxs("div",{className:"text-sm mb-2 text-black dark:text-white",children:["期間中に一日あたり",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-bold text-xl",children:["約",c.toLocaleString(),"kcal"]}),"の消費が必要です。"]});case"exercise":return e.jsxs("div",{className:"text-sm text-black dark:text-white",children:["運動で一日あたり",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-bold text-xl",children:["約",Math.round(c/2).toLocaleString(),"kcal"]}),"の消費を目標にしましょう。"]});case"diet":return e.jsxs("div",{className:"text-sm text-black dark:text-white",children:["減食で一日あたり",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-bold text-xl",children:["約",Math.round(c/2).toLocaleString(),"kcal"]}),"の消費を目標にしましょう。"]});default:return null}});const y=u.memo(function({examples:d,onSelect:x,label:m="定型文を挿入",className:h=""}){const p=function(){const[e,t]=u.useState(!1),{refs:d,floatingStyles:x,context:g}=a({open:e,onOpenChange:t,middleware:[s(6),r(),l()],placement:"bottom-end"}),m=n(g),h=i(g),p=o(g),{getReferenceProps:b,getFloatingProps:f}=c([m,h,p]);return{open:e,setOpen:t,refs:d,floatingStyles:x,getReferenceProps:b,getFloatingProps:f}}();return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:p.refs.setReference,...p.getReferenceProps({}),className:`absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none ${h}`,tabIndex:0,"aria-label":m,onClick:()=>p.setOpen(e=>!e),children:e.jsx(g,{className:"w-6 h-6"})}),p.open&&e.jsx(t,{children:e.jsx("div",{ref:p.refs.setFloating,style:p.floatingStyles,...p.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:d.map((t,a)=>e.jsx("button",{type:"button",className:"block w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-none bg-transparent focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-700",onClick:()=>(e=>{x(e),p.setOpen(!1)})(t),children:t},a))})})]})});function v(e,t){return u.useMemo(()=>{if(t.required&&!e.trim())return`${t.fieldName}は必須です。`;if(!e.trim())return null;if(isNaN(Number(e)))return`${t.fieldName}は数値で入力してください。`;const a=Number(e);if(a<t.min||a>t.max)return`${t.fieldName}は${t.min}～${t.max}の範囲で入力してください。`;if(t.step&&1!==t.step){const e=10*a%(10*t.step);if(Math.abs(e)>1e-4)return`${t.fieldName}は${t.step}刻みで入力してください。`}return null},[e,t.min,t.max,t.required,t.fieldName,t.step])}function S(e,t="体重"){return v(e,{min:30,max:200,required:!0,fieldName:`${t}[kg]`,step:.1})}const k=()=>{const{goal:e,setGoal:t,loadGoal:a}=m(),[s,r]=u.useState("unknown"),[l,n]=u.useState(""),[i,o]=u.useState(""),[c,d]=u.useState(""),[x,g]=u.useState(""),[f,j]=u.useState(""),[N,y]=u.useState(""),[k,C]=u.useState(""),[w,W]=u.useState(""),[G,E]=u.useState(""),[T,D]=u.useState(""),[$,z]=u.useState(""),[Y,F]=u.useState(null),[A,M]=u.useState(null),[q,O]=u.useState(null),P=function(e,t="生年"){return v(e,{min:1900,max:(new Date).getFullYear(),required:!0,fieldName:t})}(l,"生年"),L=function(e,t="身長"){return v(e,{min:100,max:250,required:!0,fieldName:`${t}[cm]`,step:.1})}(i,"身長"),B=S(c,"開始体重"),R=S(N,"目標体重"),V=u.useCallback((e,t)=>e&&/^\d{4}-\d{2}-\d{2}$/.test(e)?null:`${t}はYYYY-MM-DD形式で入力してください。`,[]),I=V(x,"目標開始日"),H=V(f,"目標終了日"),J=x&&f&&x>f?"目標終了日は開始日以降の日付にしてください。":null,K=u.useCallback(()=>P||L||B||I||H||J||R,[P,L,B,I,H,J,R]),Q=u.useCallback(async()=>{try{const[e,t,a]=await Promise.all([h(),p(),b()]);if(e.length>0){const t=[...e].sort((e,t)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${t.date}T${t.time}`).getTime());M(t[0].weight),F(t[t.length-1].weight)}else F(null),M(null);const s=[];if(e.forEach(e=>{s.push(e.date)}),t.forEach(e=>{s.push(e.date)}),a.forEach(e=>{s.push(e.date)}),s.length>0){const e=s.sort();O(e[0])}else O(null)}catch(e){F(null),M(null),O(null)}},[]);u.useEffect(()=>{Q()},[Q]),u.useEffect(()=>{a()},[a]),u.useEffect(()=>{e&&(r(e.gender||"unknown"),n(e.birthYear?e.birthYear.toString():""),o(e.height?e.height.toString():""),d(e.startWeight?e.startWeight.toString():""),g(e.targetStart||""),j(e.targetEnd||e.targetDate||""),y(e.targetWeight.toString()),C(e.exerciseGoal||""),W(e.dietGoal||""),E(e.sleepGoal||""),D(e.smokingGoal||""),z(e.alcoholGoal||""))},[e]);const U=u.useCallback(()=>{if(!K()&&s&&l&&i&&c&&x&&f&&N){const e={gender:s,birthYear:Number(l),height:Number(i),startWeight:Number(c),targetStart:x,targetEnd:f,targetDate:f,targetWeight:Number(N),exerciseGoal:k,dietGoal:w,sleepGoal:G,smokingGoal:T,alcoholGoal:$};t(e)}},[s,l,i,c,x,f,N,k,w,G,T,$,t,K]);u.useEffect(()=>{const e=setTimeout(U,300);return()=>clearTimeout(e)},[U]);const X=(new Date).getFullYear(),Z=u.useCallback(e=>(X-e).toString(),[X]),_=Number(i)||170,ee=u.useCallback(()=>{null!==Y&&d(Y.toString())},[Y]),te=u.useCallback(()=>{null!==A&&d(A.toString())},[A]),ae=u.useCallback(()=>{g((new Date).toISOString().slice(0,10))},[]),se=u.useCallback(()=>{q&&g(q)},[q]),re=u.useCallback(e=>{const t=x?new Date(x):new Date;t.setMonth(t.getMonth()+e),j(t.toISOString().slice(0,10))},[x]),le=u.useCallback(e=>{c&&!isNaN(Number(c))&&y((Math.round(10*(Number(c)+e))/10).toString())},[c]);return{gender:s,setGender:r,birthYear:l,setBirthYear:n,height:i,setHeight:o,startWeight:c,setStartWeight:d,targetStart:x,setTargetStart:g,targetEnd:f,setTargetEnd:j,targetWeight:N,setTargetWeight:y,exerciseGoal:k,setExerciseGoal:C,dietGoal:w,setDietGoal:W,sleepGoal:G,setSleepGoal:E,smokingGoal:T,setSmokingGoal:D,alcoholGoal:$,setAlcoholGoal:z,latestWeight:Y,oldestWeight:A,oldestDate:q,birthYearError:P,heightError:L,startWeightError:B,targetWeightError:R,targetStartError:I,targetEndError:H,dateRangeError:J,validate:K,currentYear:X,yearFromAge:Z,heightNum:_,setLatestWeightAsStart:ee,setOldestWeightAsStart:te,setTodayAsTargetStart:ae,setOldestDateAsTargetStart:se,setTargetEndFromStart:re,setTargetWeightFromStart:le,saveGoal:U}},C=["毎日ラジオ体操(第1,2)をする","なるべく階段を使う","通勤で早歩きする","一駅歩く","毎日30分歩く","毎日5000歩歩く","毎日ジョギングをする"],w=["清涼飲料水を 0 cal にする","間食、夜食を控える","野菜を多く食べる","よく噛んで20分以上かける","夜はお米を食べない","毎食ご飯を半分にする"],W=["7時間以上寝る","23時までに就寝する","就寝90分前に入浴し体温調節をする","寝室の温度を 18–22 ℃ に保つ","寝室の照明を 300 lx 以下に落とす","寝る前にスマホを見ない"],G=["家では吸わない","会社では吸わない","電子タバコへ移行し本数を半減する","1週間に1本ずつ減らす","禁煙外来に通う"],E=["休肝日を作る","1日1杯までにする","週2回までにする","飲み会は月1回まで","ノンアルコール飲料にする"],T=[{value:"male",label:"男性"},{value:"female",label:"女性"},{value:"unknown",label:"未回答"}],D=d(function(){const t=f(),{saveState:a,executeSave:s}=j({onSuccess:()=>{t.showSuccess("目標設定を保存しました！")},onError:e=>{t.showError(`保存に失敗しました: ${e.message}`)}}),{gender:r,setGender:l,birthYear:n,setBirthYear:i,height:o,setHeight:c,startWeight:d,setStartWeight:u,targetStart:g,setTargetStart:m,targetEnd:h,setTargetEnd:p,targetWeight:b,setTargetWeight:v,exerciseGoal:S,setExerciseGoal:D,dietGoal:$,setDietGoal:z,sleepGoal:Y,setSleepGoal:F,smokingGoal:A,setSmokingGoal:M,alcoholGoal:q,setAlcoholGoal:O,latestWeight:P,oldestWeight:L,oldestDate:B,birthYearError:R,heightError:V,startWeightError:I,currentYear:H,yearFromAge:J,heightNum:K,setLatestWeightAsStart:Q,setOldestWeightAsStart:U,setTodayAsTargetStart:X,setOldestDateAsTargetStart:Z,setTargetEndFromStart:_,setTargetWeightFromStart:ee,saveGoal:te}=k();return e.jsx("div",{className:"bg-transparent",children:e.jsx("form",{onSubmit:async e=>{e.preventDefault(),await s(async()=>{te()})},children:e.jsxs("div",{className:"flex flex-col items-center justify-start min-h-[60vh]",children:[e.jsxs("div",{className:"flex flex-col gap-1 w-full max-w-md",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3",children:"プロフィール"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"性別"}),e.jsx("div",{className:"flex gap-4 mt-1",children:T.map(t=>e.jsxs("label",{className:"flex items-center gap-1 text-base",children:[e.jsx("input",{type:"radio",name:"gender",value:t.value,checked:r===t.value,onChange:()=>l(t.value),className:"accent-blue-500"}),t.label]},t.value))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"生年（例: 1990）"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1900",max:H,value:n,onChange:e=>i(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 1990"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>i(J(40)),children:"40"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>i((Number(n)-5).toString()),children:"-5"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>i((Number(n)+5).toString()),children:"+5"})]}),R&&e.jsx("span",{className:"text-red-500 text-sm",children:R})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"身長[cm] (例: 165.0)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"100",max:"250",value:o,onChange:e=>c(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 165.0"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>c("170"),children:"170"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>c((K-5).toString()),children:"-5"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>c((K+5).toString()),children:"+5"})]}),V&&e.jsx("span",{className:"text-red-500 text-sm",children:V})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3",children:"体重目標"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"開始体重[kg] (例: 68.0)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"30",max:"200",step:"0.1",value:d,onChange:e=>u(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 68.0","data-testid":"goal-weight-input"}),null!==P&&e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:Q,children:"最新"}),null!==L&&e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:U,children:"最古"})]}),I&&e.jsx("span",{className:"text-red-500 text-sm",children:I})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"目標体重[kg] (例: 75.0)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"30",max:"200",step:"0.1",value:b,onChange:e=>v(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 75.0"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>ee(-2),children:"-2kg"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>ee(-5),children:"-5kg"})]})]}),e.jsx(N,{startWeight:d,targetWeight:b,targetStart:g,targetEnd:h,gender:r,type:"total"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"目標開始日"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:g,onChange:e=>m(e.target.value),className:"border rounded px-3 py-2 text-base",required:!0}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:X,children:"今日"}),B&&e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:Z,children:"最古"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"目標終了日"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:h,onChange:e=>p(e.target.value),className:"border rounded px-3 py-2 text-base",required:!0}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>_(3),children:"3か月後"}),e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:()=>_(6),children:"半年後"})]})]}),e.jsx(N,{startWeight:d,targetWeight:b,targetStart:g,targetEnd:h,gender:r,type:"daily"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3",children:"生活習慣目標"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"運動目標 (例: なるべく階段を使う)"}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx("input",{type:"text",value:S,onChange:e=>D(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 毎日30分歩く"}),e.jsx(y,{examples:C,onSelect:e=>D(e),label:"運動目標の定型文を挿入"})]})]}),e.jsx(N,{startWeight:d,targetWeight:b,targetStart:g,targetEnd:h,gender:r,type:"exercise"}),e.jsx("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:"簡単に取り組める日常の動作の延長が効果的です。"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"減食目標 (例: 間食を控える)"}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx("input",{type:"text",value:$,onChange:e=>z(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 間食を控える"}),e.jsx(y,{examples:w,onSelect:e=>z(e),label:"減食目標の定型文を挿入"})]})]}),e.jsx(N,{startWeight:d,targetWeight:b,targetStart:g,targetEnd:h,gender:r,type:"diet"}),e.jsx("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:"カロリーコントロールが一番効果があります。"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"睡眠目標 (例: 23時までに就寝する)"}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx("input",{type:"text",value:Y,onChange:e=>F(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 7時間以上寝る"}),e.jsx(y,{examples:W,onSelect:e=>F(e),label:"睡眠目標の定型文を挿入"})]})]}),e.jsx("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:"十分な睡眠(7時間以上)をとると痩せやすくなります。"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"喫煙目標 (例: 1日○本までにする)"}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx("input",{type:"text",value:A,onChange:e=>M(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 1日○本までにする"}),e.jsx(y,{examples:G,onSelect:e=>M(e),label:"喫煙目標の定型文を挿入"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"飲酒目標 (例: 週2回までにする)"}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx("input",{type:"text",value:q,onChange:e=>O(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 週2回までにする"}),e.jsx(y,{examples:E,onSelect:e=>O(e),label:"飲酒目標の定型文を挿入"})]})]})]})]})]}),e.jsx("div",{className:"w-full max-w-md mt-2 mb-2",children:e.jsx(x,{type:"submit",size:"lg",variant:"primary",fullWidth:!0,"data-testid":"save-btn",loading:"saving"===a,success:"success"===a,pulseOnClick:!0,children:"保存"})})]})})})});export{D as default};
