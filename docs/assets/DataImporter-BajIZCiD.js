import{j as e}from"./ui-vendor-BuGzxEnB.js";import{a as s}from"./react-vendor-9hcqHTTy.js";import{k as t,l as a,m as l,n as i,o as r,B as d,p as o,a as n}from"./index-B3dfifTo.js";import{E as c,S as m,I as f}from"./RecordExport-DckEpHYm.js";import"./icons-vendor-BLJDdPqg.js";import"./dnd-vendor-B-r8cpST.js";import"./state-vendor-CZRBIdKG.js";const x=s.memo(function({onStatusChange:x,onDataUpdated:y}){const[u,j]=s.useState(null),p=s.useRef(null),h=s.useCallback(async e=>{j("データをインポート中..."),null==x||x("データをインポート中...");try{const r=await e.text(),d=JSON.parse(r);if(!d||"object"!=typeof d)throw new Error("無効なJSONファイルです");const{weightRecords:o=[],bpRecords:n=[],dailyRecords:c=[],dailyFields:m=[]}=d;let f=0;if(Array.isArray(m))for(const e of m)if(e&&"object"==typeof e&&e.fieldId&&e.name)try{await t({fieldId:e.fieldId,name:e.name,order:e.order||0,display:!1!==e.display}),f++}catch(s){s instanceof Error&&s.message.includes("already exists")}if(Array.isArray(o))for(const e of o)if(e&&"object"==typeof e&&e.id&&e.date&&"number"==typeof e.weight)try{await a({id:e.id,date:e.date,time:e.time||"",weight:e.weight,bodyFat:e.bodyFat||null,waist:e.waist||null,note:e.note||null,excludeFromGraph:e.excludeFromGraph||!1}),f++}catch(s){}if(Array.isArray(n))for(const e of n)if(e&&"object"==typeof e&&e.id&&e.date&&"number"==typeof e.systolic&&"number"==typeof e.diastolic)try{await l({id:e.id,date:e.date,time:e.time||"",systolic:e.systolic,diastolic:e.diastolic,heartRate:e.heartRate||e.pulse||null,note:e.note||null}),f++}catch(s){}if(Array.isArray(c))for(const e of c)if(e&&"object"==typeof e&&e.id&&e.date&&e.fieldId&&"number"==typeof e.value)try{await i({id:e.id,date:e.date,fieldId:e.fieldId,value:e.value}),f++}catch(s){}j(`インポート完了: ${f}件のレコードを追加しました`),null==x||x(`インポート完了: ${f}件のレコードを追加しました`),null==y||y()}catch(s){const e=s instanceof Error?s.message:"不明なエラー";j(`インポートに失敗しました: ${e}`),null==x||x(`インポートに失敗しました: ${e}`)}},[x,y]),w=s.useCallback(e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];t&&("application/json"===t.type||t.name.endsWith(".json")?h(t):(j("JSONファイルを選択してください"),null==x||x("JSONファイルを選択してください")))},[h,x]),b=s.useCallback(()=>{var e;null==(e=p.current)||e.click()},[]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-gray-700 dark:text-gray-200 flex items-center gap-2 justify-center",children:[e.jsx(r,{className:"w-6 h-6"}),"データインポート"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 flex justify-center",children:e.jsx("div",{className:"text-left max-w-md",children:e.jsx("p",{children:"以前にエクスポートしたJSONファイルからデータを復元できます。"})})}),e.jsxs("div",{className:"flex items-center gap-4 justify-center",children:[e.jsx(d,{variant:"primary",icon:o,onClick:b,children:"JSONファイルを選択"}),e.jsx("input",{ref:p,type:"file",accept:".json,application/json",onChange:w,className:"hidden"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 max-w-md",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"}),e.jsx("p",{className:"font-semibold text-sm text-yellow-800 dark:text-yellow-200",children:"注意事項"})]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-yellow-800 dark:text-yellow-200 text-left",children:[e.jsx("li",{children:"既存のデータは保持され、新しいデータが追加されます"}),e.jsx("li",{children:"同じIDのレコードがある場合は、既存データが優先されます"}),e.jsx("li",{children:"インポート前に現在のデータをバックアップすることをお勧めします"}),e.jsx("li",{children:"このアプリでエクスポートしたJSONファイルのみ対応しています"})]})]})})}),u&&e.jsx("div",{className:"mt-4",children:u.includes("失敗")||u.includes("エラー")?e.jsx(c,{message:u}):u.includes("完了")?e.jsx(m,{message:u}):e.jsx(f,{message:u})})]})]})});export{x as default};
