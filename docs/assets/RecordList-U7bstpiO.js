import{j as e}from"./ui-vendor-NppzeDv9.js";import{r as t}from"./react-vendor-C0LY84C9.js";import{e as a,d as s,n as r,i as n,l,g as o,p as d,t as c,o as i,q as u,r as g,s as x,H as m}from"./index-C5oYGPPY.js";import"./icons-vendor-dw3RmBrp.js";import"./state-vendor-B_eAjXv5.js";const b=(e,t=30)=>e.length<=t?e:e.substring(0,t)+"...",h=t.memo(({record:o,field:d,editId:c,editValue:i,expandedTexts:u,showButtons:g,onEdit:x,onEditSave:m,onEditCancel:h,onDelete:p,onEditValueChange:f,onToggleTextExpansion:j,onToggleButtons:y})=>{const v=c===o.id,w=u.has(o.id),N=g.has(o.id),k=t.useCallback(()=>{y(o.id)},[y,o.id]),C=t.useCallback(()=>{x(o)},[x,o]),I=t.useCallback(()=>{m(o)},[m,o]),P=t.useCallback(()=>{h(o.id)},[h,o.id]),E=t.useCallback(()=>{p(o)},[p,o]),S=t.useCallback(e=>{e.stopPropagation(),j(o.id)},[j,o.id]),T=t.useCallback(e=>{"boolean"===(null==d?void 0:d.type)?f(e.target.checked):f(e.target.value)},[null==d?void 0:d.type,f]);return e.jsx("li",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors duration-200",children:v?e.jsxs("div",{children:["notes"===(null==d?void 0:d.fieldId)?e.jsxs("div",{className:"flex items-stretch gap-2 mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 pr-2 border-r border-gray-200 flex-shrink-0",children:d?d.name:o.fieldId}),e.jsx("div",{className:"pl-2 flex-1 min-w-0",children:e.jsx("textarea",{value:String(i),onChange:T,className:"border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 w-full h-24 resize-none"})})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-stretch mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 text-right pr-2 border-r border-gray-200",children:d?d.name:o.fieldId}),e.jsx("div",{className:"pl-2",children:e.jsx("input",{type:"number"===(null==d?void 0:d.type)?"number":"boolean"===(null==d?void 0:d.type)?"checkbox":"text",value:"boolean"===(null==d?void 0:d.type)?void 0:String(i),checked:"boolean"===(null==d?void 0:d.type)?!!i:void 0,onChange:T,className:"boolean"===(null==d?void 0:d.type)?"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 block":"border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 w-full"})})]}),e.jsxs("div",{className:"flex gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:I,className:"bg-green-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(a,{className:"w-4 h-4"}),"保存"]}),e.jsxs("button",{onClick:P,className:"bg-gray-400 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(s,{className:"w-4 h-4"}),"キャンセル"]})]})]}):e.jsxs("div",{children:["notes"===(null==d?void 0:d.fieldId)?e.jsxs("div",{className:"flex items-stretch gap-2 cursor-pointer",onClick:k,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 pr-2 border-r border-gray-200 flex-shrink-0",children:d?d.name:o.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 font-semibold pl-2 flex-1 min-w-0",children:"string"==typeof o.value&&o.value.length>30?e.jsx("button",{onClick:S,className:"text-left hover:text-blue-600 transition-colors break-words max-w-80",title:"クリックして全文表示",children:w?o.value:b(o.value)}):e.jsx("span",{className:"break-words",children:o.value})})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-stretch cursor-pointer",onClick:k,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 text-right pr-2 border-r border-gray-200",children:d?d.name:o.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 font-semibold pl-2 text-left",children:"boolean"==typeof o.value?o.value?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-600",children:[e.jsx(a,{className:"w-6 h-6"}),"あり"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 text-red-600",children:[e.jsx(r,{className:"w-6 h-6"}),"なし"]}):e.jsxs("span",{className:"break-words",children:[o.value,(null==d?void 0:d.unit)&&"boolean"!=typeof o.value&&e.jsx("span",{className:"text-gray-600 ml-1",children:d.unit})]})})]}),N&&e.jsxs("div",{className:"flex gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:C,className:"bg-blue-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(n,{className:"w-4 h-4"}),"編集"]}),e.jsxs("button",{onClick:E,className:"bg-red-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4"}),"削除"]})]})]})})});h.displayName="RecordItem";const p=t.memo(({datetime:a,records:s,getField:r,sortRecordsByFieldOrder:n,editId:l,editValue:o,expandedTexts:c,showButtons:i,onEdit:u,onEditSave:g,onEditCancel:x,onDelete:b,onEditValueChange:p,onToggleTextExpansion:f,onToggleButtons:j})=>(t.useEffect(()=>(d.trackRender.start(`RecordGroup-${a}`),()=>{d.trackRender.end(`RecordGroup-${a}`)})),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"text-2xl font-semibold text-gray-800 mb-8 border-b border-gray-200 pb-4 flex items-center gap-2",children:[e.jsx(m,{className:"w-6 h-6 text-blue-600"}),a]}),e.jsx("ul",{className:"space-y-4",children:n(s).map(t=>e.jsx(h,{record:t,field:r(t.fieldId),editId:l,editValue:o,expandedTexts:c,showButtons:i,onEdit:u,onEditSave:g,onEditCancel:x,onDelete:b,onEditValueChange:p,onToggleTextExpansion:f,onToggleButtons:j},t.id))})]})));function f(){const{records:a,fields:s,loadRecords:r,loadFields:n,updateRecord:l,deleteRecord:m}=o(),[b,h]=t.useState(null),[f,j]=t.useState(""),[y,v]=t.useState(new Set),[w,N]=t.useState(new Set),[k,C]=t.useState(1),[I,P]=t.useState(20);t.useEffect(()=>(d.trackRender.start("RecordList"),()=>{d.trackRender.end("RecordList")})),t.useEffect(()=>{(async()=>{try{await c("load-fields",async()=>{await n()}),await c("load-records",async()=>{await r()},a.length)}catch(e){}})()},[n,r,a.length]);const E=t.useCallback(e=>{if("notes"===e)return{fieldId:"notes",name:"備考",type:"string",order:0};let t=s.find(t=>t.fieldId===e);return t||(t=s.find(t=>t.name===e)),t},[s]),S=t.useCallback(e=>{performance.now();const t=[...e].sort((e,t)=>{const a=E(e.fieldId),s=E(t.fieldId);return((null==a?void 0:a.order)??999)-((null==s?void 0:s.order)??999)});return performance.now(),t},[E]),T=t.useMemo(()=>{performance.now();const e=[...a].sort((e,t)=>{const a=`${e.date} ${e.time}`;return`${t.date} ${t.time}`.localeCompare(a)});return performance.now(),e},[a]),R=t.useMemo(()=>{performance.now();const e=T.reduce((e,t)=>{const a=`${t.date} ${t.time}`;return e[a]||(e[a]=[]),e[a].push(t),e},{});return performance.now(),e},[T]),B=t.useMemo(()=>{performance.now();const e=Object.entries(R),t=e.length,a=Math.max(1,Math.ceil(t/I));k>a&&C(1);const s=(k-1)*I,r=s+I,n=e.slice(s,r),l={groups:Object.fromEntries(n),totalGroups:t,totalPages:a,currentPage:Math.min(k,a)};return performance.now(),l},[R,k,I]),M=t.useCallback(e=>{const t=d.trackInteraction.start("page-change");C(Math.max(1,Math.min(e,B.totalPages))),d.trackInteraction.end(t,"page-change")},[B.totalPages]),V=t.useCallback(e=>{const t=d.trackInteraction.start("edit-start");h(e.id),j(e.value),d.trackInteraction.end(t,"edit-start")},[]),$=t.useCallback(async e=>{const t=d.trackInteraction.start("edit-save");try{await c("update-record",async()=>{await l({...e,value:f})},1),h(null),j(""),N(t=>{const a=new Set(t);return a.delete(e.id),a})}catch(a){}finally{d.trackInteraction.end(t,"edit-save")}},[f,l]),G=t.useCallback(e=>{const t=d.trackInteraction.start("edit-cancel");h(null),j(""),N(t=>{const a=new Set(t);return a.delete(e),a}),d.trackInteraction.end(t,"edit-cancel")},[]),O=t.useCallback(async e=>{const t=d.trackInteraction.start("delete-record");try{window.confirm("本当に削除してよろしいですか？")&&(await c("delete-record",async()=>{await m(e.id)},1),N(t=>{const a=new Set(t);return a.delete(e.id),a}))}catch(a){}finally{d.trackInteraction.end(t,"delete-record")}},[m]),F=t.useCallback(e=>{j(e)},[]),D=t.useCallback(e=>{const t=d.trackInteraction.start("toggle-text");v(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}),d.trackInteraction.end(t,"toggle-text")},[]),z=t.useCallback(e=>{const t=d.trackInteraction.start("toggle-buttons");N(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a}),d.trackInteraction.end(t,"toggle-buttons")},[]),L=t.useCallback(e=>{const t=d.trackInteraction.start("page-size-change");P(e),C(1),d.trackInteraction.end(t,"page-size-change")},[]);return t.useEffect(()=>{},[a.length,B.totalGroups,B.currentPage,B.totalPages,I]),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"一覧"}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-lg font-medium text-gray-800",children:[B.totalGroups,"件の記録グループ"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"表示件数:"}),e.jsxs("select",{value:I,onChange:e=>L(Number(e.target.value)),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:10,children:"10件"}),e.jsx("option",{value:20,children:"20件"}),e.jsx("option",{value:50,children:"50件"}),e.jsx("option",{value:100,children:"100件"})]})]})]})}),B.totalPages>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(1),disabled:1===B.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(i,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(B.currentPage-1),disabled:1===B.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(u,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"text-gray-600",children:[B.currentPage," / ",B.totalPages," ","ページ"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(B.currentPage+1),disabled:B.currentPage===B.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(B.totalPages),disabled:B.currentPage===B.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(x,{className:"w-4 h-4"})})]})]})}),0===Object.entries(B.groups).length&&e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 text-center text-gray-500",children:e.jsx("p",{className:"text-lg",children:"記録がありませんわ。"})}),e.jsx("div",{className:"space-y-8",children:Object.entries(B.groups).map(([t,a])=>e.jsx(p,{datetime:t,records:a,getField:E,sortRecordsByFieldOrder:S,editId:b,editValue:f,expandedTexts:y,showButtons:w,onEdit:V,onEditSave:$,onEditCancel:G,onDelete:O,onEditValueChange:F,onToggleTextExpansion:D,onToggleButtons:z},t))}),B.totalPages>1&&e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mt-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(1),disabled:1===B.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(i,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(B.currentPage-1),disabled:1===B.currentPage,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(u,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"text-gray-600",children:[B.currentPage," / ",B.totalPages," ","ページ"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(B.currentPage+1),disabled:B.currentPage===B.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(B.totalPages),disabled:B.currentPage===B.totalPages,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(x,{className:"w-4 h-4"})})]})]})})]})}p.displayName="RecordGroup";export{f as default};
