import{j as e}from"./ui-vendor-Z70llhoy.js";import{a as r}from"./react-vendor-DRLO6cO2.js";import{u as t,h as a,g as s,y as n,n as l,r as d,k as o,p as i,t as c,B as g,z as m,A as x,C as u,D as b,H as p}from"./index-BNZho4P3.js";import{t as h}from"./textUtils-BtQSYqdL.js";import"./icons-vendor-DbsR8xvJ.js";import"./state-vendor-Crk1RRDk.js";const y=r.memo(({record:o,field:i,editId:c,editValue:g,expandedTexts:m,showButtons:x,onEdit:u,onEditSave:b,onEditCancel:p,onDelete:y,onEditValueChange:f,onToggleTextExpansion:k,onToggleButtons:j})=>{const{t:v,getAriaLabel:w}=t(),N=c===o.id,C=m.has(o.id),I=x.has(o.id),P=r.useCallback(()=>{j(o.id)},[j,o.id]),E=r.useCallback(()=>{u(o)},[u,o]),S=r.useCallback(()=>{b(o)},[b,o]),T=r.useCallback(()=>{p(o.id)},[p,o.id]),R=r.useCallback(()=>{y(o)},[y,o]),z=r.useCallback(e=>{e.stopPropagation(),k(o.id)},[k,o.id]),B=r.useCallback(e=>{f(e.target.value)},[f]),D=r.useCallback(e=>{f(e??"")},[f]);return e.jsx("li",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200",children:N?e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>D(!0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===g?"bg-green-100 dark:bg-green-900/30 border-green-500 dark:border-green-400 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":w("setToYes",{fieldName:i.name}),children:v("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>D(!1),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===g?"bg-red-100 dark:bg-red-900/30 border-red-500 dark:border-red-400 text-red-700 dark:text-red-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":w("setToNo",{fieldName:i.name}),children:v("fields.no")}),void 0!==g&&""!==g&&e.jsx("button",{type:"button",onClick:()=>D(void 0),className:"px-2 py-1.5 rounded-lg border-2 border-gray-300 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex-shrink-0","aria-label":w("clearSelection",{fieldName:i.name}),title:v("fields.clearSelection"),children:"×"})]}):e.jsx("textarea",{value:String(g),onChange:B,className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400 w-full h-24 resize-none"})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>D(!0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===g?"bg-green-100 dark:bg-green-900/30 border-green-500 dark:border-green-400 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":w("setToYes",{fieldName:i.name}),children:v("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>D(!1),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===g?"bg-red-100 dark:bg-red-900/30 border-red-500 dark:border-red-400 text-red-700 dark:text-red-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":w("setToNo",{fieldName:i.name}),children:v("fields.no")}),void 0!==g&&""!==g&&e.jsx("button",{type:"button",onClick:()=>D(void 0),className:"px-2 py-1.5 rounded-lg border-2 border-gray-300 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors duration-200 flex-shrink-0","aria-label":w("clearSelection",{fieldName:i.name}),title:v("fields.clearSelection"),children:"×"})]}):e.jsx("input",{type:"number"===(null==i?void 0:i.type)?"number":"text",value:String(g),onChange:B,className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400 w-full"})})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:S,className:"bg-green-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(a,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.save")]}),e.jsxs("button",{onClick:T,className:"bg-gray-400 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(s,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.cancel")]})]})]}):e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 dark:text-gray-200 font-semibold pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"string"==typeof o.value&&o.value.length>30?e.jsx("button",{onClick:z,className:"text-left hover:text-blue-600 transition-colors break-words w-full",title:v("common.clickToExpand"),children:C?o.value:h(o.value)}):e.jsx("span",{className:"break-words",children:o.value})})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 items-stretch cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 dark:text-gray-200 font-semibold pl-0 sm:pl-2 text-left pt-2 sm:pt-0",children:"boolean"==typeof o.value?o.value?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-600",children:[e.jsx(a,{className:"w-6 h-6"}),v("fields.yes")]}):e.jsxs("span",{className:"inline-flex items-center gap-2 text-red-600",children:[e.jsx(n,{className:"w-6 h-6"}),v("fields.no")]}):e.jsxs("span",{className:"break-words",children:[o.value,(null==i?void 0:i.unit)&&"boolean"!=typeof o.value&&e.jsx("span",{className:"text-gray-600 dark:text-gray-400 ml-1",children:i.unit})]})})]}),I&&e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:E,className:"bg-blue-500 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(l,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.edit")]}),e.jsxs("button",{onClick:R,className:"bg-red-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(d,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),v("actions.delete")]})]})]})})});y.displayName="RecordItem";const f=r.memo(({datetime:t,records:a,getField:s,sortRecordsByFieldOrder:n,editId:l,editValue:d,expandedTexts:o,showButtons:c,onEdit:g,onEditSave:m,onEditCancel:x,onDelete:u,onEditValueChange:b,onToggleTextExpansion:h,onToggleButtons:f})=>(r.useEffect(()=>(i.trackRender.start(`RecordGroup-${t}`),()=>{i.trackRender.end(`RecordGroup-${t}`)})),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-8 border-b border-gray-200 dark:border-gray-600 pb-4 flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),t]}),e.jsx("ul",{className:"space-y-4",children:n(a).map(r=>e.jsx(y,{record:r,field:s(r.fieldId),editId:l,editValue:d,expandedTexts:o,showButtons:c,onEdit:g,onEditSave:m,onEditCancel:x,onDelete:u,onEditValueChange:b,onToggleTextExpansion:h,onToggleButtons:f},r.id))})]})));function k(){const{t:a,translateFieldName:s}=t(),{records:n,fields:l,loadRecords:d,loadFields:p,updateRecord:h,deleteRecord:y}=o(),[k,j]=r.useState(null),[v,w]=r.useState(""),[N,C]=r.useState(new Set),[I,P]=r.useState(new Set),[E,S]=r.useState(1),[T,R]=r.useState(10);r.useEffect(()=>(i.trackRender.start("RecordList"),()=>{i.trackRender.end("RecordList")})),r.useEffect(()=>{(async()=>{try{await c("load-fields",async()=>{await p()}),await c("load-records",async()=>{await d()},n.length)}catch(e){console.error("Data loading error:",e)}})()},[p,d,n.length]);const z=r.useCallback(e=>{if("notes"===e)return{fieldId:"notes",name:s("notes"),type:"string",order:0};let r=l.find(r=>r.fieldId===e);return r||(r=l.find(r=>r.name===e)),r},[l,s]),B=r.useCallback(e=>{performance.now();const r=[...e].sort((e,r)=>{const t=z(e.fieldId),a=z(r.fieldId);return((null==t?void 0:t.order)??999)-((null==a?void 0:a.order)??999)});return performance.now(),r},[z]),D=r.useMemo(()=>{performance.now();const e=[...n].sort((e,r)=>{const t=`${e.date} ${e.time}`;return`${r.date} ${r.time}`.localeCompare(t)});return performance.now(),e},[n]),M=r.useMemo(()=>{performance.now();const e=D.reduce((e,r)=>{const t=`${r.date} ${r.time}`;return e[t]||(e[t]=[]),e[t].push(r),e},{});return performance.now(),e},[D]),V=r.useMemo(()=>{performance.now();const e=Object.entries(M),r=e.length,t=Math.max(1,Math.ceil(r/T));E>t&&S(1);const a=(E-1)*T,s=a+T,n=e.slice(a,s),l={groups:Object.fromEntries(n),totalGroups:r,totalPages:t,currentPage:Math.min(E,t)};return performance.now(),l},[M,E,T]),$=r.useCallback(e=>{const r=i.trackInteraction.start("page-change");S(Math.max(1,Math.min(e,V.totalPages))),i.trackInteraction.end(r,"page-change")},[V.totalPages]),G=r.useCallback(e=>{const r=i.trackInteraction.start("edit-start");j(e.id),w(e.value),i.trackInteraction.end(r,"edit-start")},[]),F=r.useCallback(async e=>{const r=i.trackInteraction.start("edit-save");try{await c("update-record",async()=>{await h({...e,value:v})},1),j(null),w(""),P(r=>{const t=new Set(r);return t.delete(e.id),t})}catch(t){console.error("Edit save error:",t)}finally{i.trackInteraction.end(r,"edit-save")}},[v,h]),O=r.useCallback(e=>{const r=i.trackInteraction.start("edit-cancel");j(null),w(""),P(r=>{const t=new Set(r);return t.delete(e),t}),i.trackInteraction.end(r,"edit-cancel")},[]),L=r.useCallback(async e=>{const r=i.trackInteraction.start("delete-record");try{window.confirm(a("pages.list.confirmDelete"))&&(await c("delete-record",async()=>{await y(e.id)},1),P(r=>{const t=new Set(r);return t.delete(e.id),t}))}catch(t){console.error("Delete error:",t)}finally{i.trackInteraction.end(r,"delete-record")}},[y,a]),A=r.useCallback(e=>{w(e)},[]),Y=r.useCallback(e=>{const r=i.trackInteraction.start("toggle-text");C(r=>{const t=new Set(r);return t.has(e)?t.delete(e):t.add(e),t}),i.trackInteraction.end(r,"toggle-text")},[]),H=r.useCallback(e=>{const r=i.trackInteraction.start("toggle-buttons");P(r=>{const t=new Set(r);return t.has(e)?t.delete(e):t.add(e),t}),i.trackInteraction.end(r,"toggle-buttons")},[]),U=r.useCallback(e=>{const r=i.trackInteraction.start("page-size-change");R(e),S(1),i.trackInteraction.end(r,"page-size-change")},[]);return r.useEffect(()=>{},[n.length,V.totalGroups,V.currentPage,V.totalPages,T]),e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto px-2 sm:px-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-white mb-6 sm:mb-8",children:a("pages.list.title")}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 sm:p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:V.totalGroups}),e.jsx("span",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300 ml-1",children:a("pages.list.recordGroups")})]}),e.jsxs("div",{className:"flex items-center justify-center sm:justify-end gap-2",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300 whitespace-nowrap",children:a("pages.list.displayCount")}),e.jsxs("select",{value:T,onChange:e=>U(Number(e.target.value)),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg px-3 py-1.5 sm:py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 dark:focus:ring-blue-400 text-sm sm:text-base min-w-[80px]",children:[e.jsx("option",{value:10,children:a("pages.list.items10")}),e.jsx("option",{value:20,children:a("pages.list.items20")}),e.jsx("option",{value:50,children:a("pages.list.items50")}),e.jsx("option",{value:100,children:a("pages.list.items100")})]})]})]})}),V.totalPages>1&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-3 sm:p-4 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:m,onClick:()=>$(1),disabled:1===V.currentPage,"aria-label":"最初のページ",children:e.jsx("span",{className:"sr-only",children:"最初のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:x,onClick:()=>$(V.currentPage-1),disabled:1===V.currentPage,"aria-label":"前のページ",children:e.jsx("span",{className:"sr-only",children:"前のページ"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[V.currentPage," / ",V.totalPages," ",a("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:u,onClick:()=>$(V.currentPage+1),disabled:V.currentPage===V.totalPages,"aria-label":"次のページ",children:e.jsx("span",{className:"sr-only",children:"次のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:b,onClick:()=>$(V.totalPages),disabled:V.currentPage===V.totalPages,"aria-label":"最後のページ",children:e.jsx("span",{className:"sr-only",children:"最後のページ"})})]})]})}),0===Object.entries(V.groups).length&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 sm:p-8 text-center text-gray-500 dark:text-gray-400",children:e.jsx("p",{className:"text-base sm:text-lg",children:a("pages.list.noRecords")})}),e.jsx("div",{className:"space-y-8",children:Object.entries(V.groups).map(([r,t])=>e.jsx(f,{datetime:r,records:t,getField:z,sortRecordsByFieldOrder:B,editId:k,editValue:v,expandedTexts:N,showButtons:I,onEdit:G,onEditSave:F,onEditCancel:O,onDelete:L,onEditValueChange:A,onToggleTextExpansion:Y,onToggleButtons:H},r))}),V.totalPages>1&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-3 sm:p-4 mt-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:m,onClick:()=>$(1),disabled:1===V.currentPage,"aria-label":"最初のページ",children:e.jsx("span",{className:"sr-only",children:"最初のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:x,onClick:()=>$(V.currentPage-1),disabled:1===V.currentPage,"aria-label":"前のページ",children:e.jsx("span",{className:"sr-only",children:"前のページ"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[V.currentPage," / ",V.totalPages," ",a("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:u,onClick:()=>$(V.currentPage+1),disabled:V.currentPage===V.totalPages,"aria-label":"次のページ",children:e.jsx("span",{className:"sr-only",children:"次のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:b,onClick:()=>$(V.totalPages),disabled:V.currentPage===V.totalPages,"aria-label":"最後のページ",children:e.jsx("span",{className:"sr-only",children:"最後のページ"})})]})]})})]})}f.displayName="RecordGroup";export{k as default};
//# sourceMappingURL=RecordList-BP5Dy67J.js.map
