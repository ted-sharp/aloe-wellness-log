import{j as e}from"./ui-vendor-Z70llhoy.js";import{a as r}from"./react-vendor-DRLO6cO2.js";import{u as a,h as t,g as s,y as l,m as n,r as d,k as o,p as i,t as c,B as g,z as m,A as x,C as u,D as b,H as p}from"./index-_gBeLdnQ.js";import{t as h}from"./textUtils-BtQSYqdL.js";import"./icons-vendor-DbsR8xvJ.js";import"./state-vendor-Crk1RRDk.js";const y=r.memo(({record:o,field:i,editId:c,editValue:g,expandedTexts:m,showButtons:x,onEdit:u,onEditSave:b,onEditCancel:p,onDelete:y,onEditValueChange:f,onToggleTextExpansion:k,onToggleButtons:j,onToggleExclude:v})=>{const{t:w,getAriaLabel:N}=a(),C=c===o.id,E=m.has(o.id),I=x.has(o.id),P=r.useCallback(()=>{j(o.id)},[j,o.id]),T=r.useCallback(()=>{u(o)},[u,o]),S=r.useCallback(()=>{b(o)},[b,o]),R=r.useCallback(()=>{p(o.id)},[p,o.id]),G=r.useCallback(()=>{y(o)},[y,o]),F=r.useCallback(e=>{e.stopPropagation(),k(o.id)},[k,o.id]),z=r.useCallback(e=>{f(e.target.value)},[f]),B=r.useCallback(e=>{f(e??"")},[f]);return e.jsx("li",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200",children:C?e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>B(!0!==g||void 0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===g?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":N("setToYes",{fieldName:i.name}),children:w("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>B(!1===g&&void 0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===g?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":N("setToNo",{fieldName:i.name}),children:w("fields.no")})]}):e.jsx("textarea",{value:String(g),onChange:z,className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400 w-full h-24 resize-none"})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center mb-4",children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"pl-0 sm:pl-2 pt-2 sm:pt-0",children:"boolean"===(null==i?void 0:i.type)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>B(!0!==g||void 0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!0===g?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":N("setToYes",{fieldName:i.name}),children:w("fields.yes")}),e.jsx("button",{type:"button",onClick:()=>B(!1===g&&void 0),className:"px-3 py-1.5 rounded-lg border-2 text-sm font-medium transition-colors duration-200 flex-shrink-0 "+(!1===g?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),"aria-label":N("setToNo",{fieldName:i.name}),children:w("fields.no")})]}):e.jsx("input",{type:"number"===(null==i?void 0:i.type)?"number":"text",value:String(g),onChange:z,className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 dark:focus:ring-blue-400 dark:focus:border-blue-400 w-full"})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>v(o),className:(o.excludeFromGraph?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300 border-2":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600")+" min-w-[48px] h-10 px-0 text-sm rounded-lg border-2 font-medium","aria-label":w("pages.input.excludeFromGraphShort"),children:w("pages.input.excludeFromGraphShort")||"除外"})})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:S,className:"bg-green-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(t,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),w("actions.save")]}),e.jsxs("button",{onClick:R,className:"bg-gray-400 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(s,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),w("actions.cancel")]})]})]}):e.jsxs("div",{children:["notes"===(null==i?void 0:i.fieldId)?e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch gap-2 cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 flex-shrink-0 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 dark:text-gray-200 font-semibold pl-0 sm:pl-2 flex-1 min-w-0 pt-2 sm:pt-0",children:"string"==typeof o.value&&o.value.length>30?e.jsx("button",{onClick:F,className:"text-left hover:text-blue-600 transition-colors break-words w-full",title:w("common.clickToExpand"),children:E?o.value:h(o.value)}):e.jsx("span",{className:"break-words",children:o.value})})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center cursor-pointer",onClick:P,children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 dark:text-gray-200 text-left sm:text-right pr-0 sm:pr-2 border-b sm:border-b-0 sm:border-r border-gray-200 dark:border-gray-600 pb-2 sm:pb-0",children:i?i.name:o.fieldId}),e.jsx("div",{className:"text-lg text-gray-800 dark:text-gray-200 font-semibold pl-0 sm:pl-2 text-left pt-2 sm:pt-0",children:"boolean"==typeof o.value?o.value?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-600",children:[e.jsx(t,{className:"w-6 h-6"}),w("fields.yes")]}):e.jsxs("span",{className:"inline-flex items-center gap-2 text-red-600",children:[e.jsx(l,{className:"w-6 h-6"}),w("fields.no")]}):e.jsxs("span",{className:"break-words",children:[o.value,(null==i?void 0:i.unit)&&"boolean"!=typeof o.value&&e.jsx("span",{className:"text-gray-600 dark:text-gray-400 ml-1",children:i.unit})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:(o.excludeFromGraph?"bg-blue-100 dark:bg-blue-900/30 border-blue-500 dark:border-blue-400 text-blue-700 dark:text-blue-300 border-2":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300")+" min-w-[48px] h-10 px-0 text-sm rounded-lg border-2 font-medium flex items-center justify-center select-none","aria-label":w("pages.input.excludeFromGraphShort"),children:w("pages.input.excludeFromGraphShort")||"除外"})})]}),I&&e.jsxs("div",{className:"flex gap-2 sm:gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:T,className:"bg-blue-500 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(n,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),w("actions.edit")]}),e.jsxs("button",{onClick:G,className:"bg-red-600 text-white px-3 sm:px-6 py-1.5 sm:py-3 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 font-medium flex items-center gap-1.5 text-sm sm:text-base flex-1 sm:min-w-[120px] justify-center",children:[e.jsx(d,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),w("actions.delete")]})]})]})})});y.displayName="RecordItem";const f=r.memo(({datetime:a,records:t,getField:s,sortRecordsByFieldOrder:l,editId:n,editValue:d,expandedTexts:o,showButtons:c,onEdit:g,onEditSave:m,onEditCancel:x,onDelete:u,onEditValueChange:b,onToggleTextExpansion:h,onToggleButtons:f,onToggleExclude:k})=>(r.useEffect(()=>(i.trackRender.start(`RecordGroup-${a}`),()=>{i.trackRender.end(`RecordGroup-${a}`)})),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-8 border-b border-gray-200 dark:border-gray-600 pb-4 flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),a]}),e.jsx("ul",{className:"space-y-4",children:l(t).map(r=>e.jsx(y,{record:r,field:s(r.fieldId),editId:n,editValue:d,expandedTexts:o,showButtons:c,onEdit:g,onEditSave:m,onEditCancel:x,onDelete:u,onEditValueChange:b,onToggleTextExpansion:h,onToggleButtons:f,onToggleExclude:k},r.id))})]})));function k(){const{t:t,translateFieldName:s}=a(),{records:l,fields:n,loadRecords:d,loadFields:p,updateRecord:h,deleteRecord:y}=o(),[k,j]=r.useState(null),[v,w]=r.useState(""),[N,C]=r.useState(new Set),[E,I]=r.useState(new Set),[P,T]=r.useState(1),[S,R]=r.useState(10);r.useEffect(()=>(i.trackRender.start("RecordList"),()=>{i.trackRender.end("RecordList")})),r.useEffect(()=>{(async()=>{try{await c("load-fields",async()=>{await p()}),await c("load-records",async()=>{await d()},l.length)}catch(e){console.error("Data loading error:",e)}})()},[p,d,l.length]);const G=r.useCallback(e=>{if("notes"===e)return{fieldId:"notes",name:s("notes"),type:"string",order:0};let r=n.find(r=>r.fieldId===e);return r||(r=n.find(r=>r.name===e)),r},[n,s]),F=r.useCallback(e=>{performance.now();const r=[...e].sort((e,r)=>{const a=G(e.fieldId),t=G(r.fieldId);return((null==a?void 0:a.order)??999)-((null==t?void 0:t.order)??999)});return performance.now(),r},[G]),z=r.useMemo(()=>{performance.now();const e=[...l].sort((e,r)=>{const a=`${e.date} ${e.time}`;return`${r.date} ${r.time}`.localeCompare(a)});return performance.now(),e},[l]),B=r.useMemo(()=>{performance.now();const e=z.reduce((e,r)=>{const a=`${r.date} ${r.time}`;return e[a]||(e[a]=[]),e[a].push(r),e},{});return performance.now(),e},[z]),D=r.useMemo(()=>{performance.now();const e=Object.entries(B),r=e.length,a=Math.max(1,Math.ceil(r/S));P>a&&T(1);const t=(P-1)*S,s=t+S,l=e.slice(t,s),n={groups:Object.fromEntries(l),totalGroups:r,totalPages:a,currentPage:Math.min(P,a)};return performance.now(),n},[B,P,S]),M=r.useCallback(e=>{const r=i.trackInteraction.start("page-change");T(Math.max(1,Math.min(e,D.totalPages))),i.trackInteraction.end(r,"page-change")},[D.totalPages]),V=r.useCallback(e=>{const r=i.trackInteraction.start("edit-start");j(e.id),w(e.value),i.trackInteraction.end(r,"edit-start")},[]),$=r.useCallback(async e=>{const r=i.trackInteraction.start("edit-save");try{await c("update-record",async()=>{await h({...e,value:v})},1),j(null),w(""),I(r=>{const a=new Set(r);return a.delete(e.id),a})}catch(a){console.error("Edit save error:",a)}finally{i.trackInteraction.end(r,"edit-save")}},[v,h]),O=r.useCallback(e=>{const r=i.trackInteraction.start("edit-cancel");j(null),w(""),I(r=>{const a=new Set(r);return a.delete(e),a}),i.trackInteraction.end(r,"edit-cancel")},[]),L=r.useCallback(async e=>{const r=i.trackInteraction.start("delete-record");try{window.confirm(t("pages.list.confirmDelete"))&&(await c("delete-record",async()=>{await y(e.id)},1),I(r=>{const a=new Set(r);return a.delete(e.id),a}))}catch(a){console.error("Delete error:",a)}finally{i.trackInteraction.end(r,"delete-record")}},[y,t]),A=r.useCallback(e=>{w(e)},[]),Y=r.useCallback(e=>{const r=i.trackInteraction.start("toggle-text");C(r=>{const a=new Set(r);return a.has(e)?a.delete(e):a.add(e),a}),i.trackInteraction.end(r,"toggle-text")},[]),H=r.useCallback(e=>{const r=i.trackInteraction.start("toggle-buttons");I(r=>{const a=new Set(r);return a.has(e)?a.delete(e):a.add(e),a}),i.trackInteraction.end(r,"toggle-buttons")},[]),U=r.useCallback(async e=>{try{await h({...e,excludeFromGraph:!e.excludeFromGraph})}catch(r){console.error("Exclude toggle error:",r)}},[h]),q=r.useCallback(e=>{const r=i.trackInteraction.start("page-size-change");R(e),T(1),i.trackInteraction.end(r,"page-size-change")},[]);return r.useEffect(()=>{},[l.length,D.totalGroups,D.currentPage,D.totalPages,S]),e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto px-2 sm:px-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-white mb-6 sm:mb-8",children:t("pages.list.title")}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 sm:p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:D.totalGroups}),e.jsx("span",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300 ml-1",children:t("pages.list.recordGroups")})]}),e.jsxs("div",{className:"flex items-center justify-center sm:justify-end gap-2",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300 whitespace-nowrap",children:t("pages.list.displayCount")}),e.jsxs("select",{value:S,onChange:e=>q(Number(e.target.value)),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg px-3 py-1.5 sm:py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 dark:focus:ring-blue-400 text-sm sm:text-base min-w-[80px]",children:[e.jsx("option",{value:10,children:t("pages.list.items10")}),e.jsx("option",{value:20,children:t("pages.list.items20")}),e.jsx("option",{value:50,children:t("pages.list.items50")}),e.jsx("option",{value:100,children:t("pages.list.items100")})]})]})]})}),D.totalPages>1&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-3 sm:p-4 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:m,onClick:()=>M(1),disabled:1===D.currentPage,"aria-label":"最初のページ",children:e.jsx("span",{className:"sr-only",children:"最初のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:x,onClick:()=>M(D.currentPage-1),disabled:1===D.currentPage,"aria-label":"前のページ",children:e.jsx("span",{className:"sr-only",children:"前のページ"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[D.currentPage," / ",D.totalPages," ",t("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:u,onClick:()=>M(D.currentPage+1),disabled:D.currentPage===D.totalPages,"aria-label":"次のページ",children:e.jsx("span",{className:"sr-only",children:"次のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:b,onClick:()=>M(D.totalPages),disabled:D.currentPage===D.totalPages,"aria-label":"最後のページ",children:e.jsx("span",{className:"sr-only",children:"最後のページ"})})]})]})}),0===Object.entries(D.groups).length&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 sm:p-8 text-center text-gray-500 dark:text-gray-400",children:e.jsx("p",{className:"text-base sm:text-lg",children:t("pages.list.noRecords")})}),e.jsx("div",{className:"space-y-8",children:Object.entries(D.groups).map(([r,a])=>e.jsx(f,{datetime:r,records:a,getField:G,sortRecordsByFieldOrder:F,editId:k,editValue:v,expandedTexts:N,showButtons:E,onEdit:V,onEditSave:$,onEditCancel:O,onDelete:L,onEditValueChange:A,onToggleTextExpansion:Y,onToggleButtons:H,onToggleExclude:U},r))}),D.totalPages>1&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-3 sm:p-4 mt-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:m,onClick:()=>M(1),disabled:1===D.currentPage,"aria-label":"最初のページ",children:e.jsx("span",{className:"sr-only",children:"最初のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:x,onClick:()=>M(D.currentPage-1),disabled:1===D.currentPage,"aria-label":"前のページ",children:e.jsx("span",{className:"sr-only",children:"前のページ"})})]}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap",children:[D.currentPage," / ",D.totalPages," ",t("pages.list.page")]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(g,{variant:"primary",size:"sm",icon:u,onClick:()=>M(D.currentPage+1),disabled:D.currentPage===D.totalPages,"aria-label":"次のページ",children:e.jsx("span",{className:"sr-only",children:"次のページ"})}),e.jsx(g,{variant:"primary",size:"sm",icon:b,onClick:()=>M(D.totalPages),disabled:D.currentPage===D.totalPages,"aria-label":"最後のページ",children:e.jsx("span",{className:"sr-only",children:"最後のページ"})})]})]})})]})}f.displayName="RecordGroup";export{k as default};
