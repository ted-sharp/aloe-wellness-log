import{j as e}from"./ui-vendor-Bfl5gO4l.js";import{a as t}from"./react-vendor-BOksNuje.js";import{H as a,a as s,b as r,c as l,u as d,g as n,d as i,e as c,p as o,i as x,f as m,B as h,h as g,j as u,k as f,l as p,m as b,n as j,o as y,q as w,r as N}from"./index-foCK2tXp.js";import"./icons-vendor-CuPH0hr8.js";import"./dnd-vendor-MWhKAIwc.js";import"./state-vendor-BSG_ROek.js";const v={success:{containerClass:"bg-green-50 border-green-200 text-green-700",iconClass:"text-green-600",defaultIcon:l},error:{containerClass:"bg-red-50 border-red-200 text-red-700",iconClass:"text-red-600",defaultIcon:r},warning:{containerClass:"bg-amber-50 border-amber-200 text-amber-700",iconClass:"text-amber-600",defaultIcon:s},info:{containerClass:"bg-blue-50 border-blue-200 text-blue-700",iconClass:"text-blue-600",defaultIcon:a}},k="p-4 rounded-lg border font-medium flex items-start gap-3 shadow-sm",S=({type:a,message:s,autoHide:r=!1,hideDelay:l=3e3,onHide:d,className:n="",icon:i})=>{const[c,o]=t.useState(!0),x=v[a],m=i||x.defaultIcon;if(t.useEffect(()=>{if(r&&l>0){const e=setTimeout(()=>{o(!1),null==d||d()},l);return()=>clearTimeout(e)}},[r,l,d]),!c)return null;const h=[k,x.containerClass,n].join(" ");return e.jsxs("div",{className:h,role:"alert","aria-live":"polite",children:[e.jsx(m,{className:`w-5 h-5 ${x.iconClass} flex-shrink-0 mt-0.5`,"aria-hidden":"true"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm leading-relaxed",children:s})})]})},R=t=>e.jsx(S,{type:"success",...t}),$=t=>e.jsx(S,{type:"error",...t}),C=t=>e.jsx(S,{type:"info",...t});function E({showTipsModal:a}){const{deleteAllData:r}=d(),[l,v]=t.useState(null),[k,S]=t.useState(null),[E,A]=t.useState(0),[I,O]=t.useState(!1),[T,J]=t.useState(null),[F,L]=t.useState(0),[U,D]=t.useState(0),[H,W]=t.useState(0),[z,M]=t.useState(""),[P,V]=t.useState(""),[B,q]=t.useState("");if(t.useEffect(()=>{n().then(e=>{if(L(e.length),e.length>0){const t=e.map(e=>e.date).sort();M(`${t[0]} 〜 ${t[t.length-1]}`)}else M("データなし")}),i().then(e=>{if(D(e.length),e.length>0){const t=e.map(e=>e.date).sort();V(`${t[0]} 〜 ${t[t.length-1]}`)}else V("データなし")}),c().then(e=>{if(W(e.length),e.length>0){const t=e.map(e=>e.date).sort();q(`${t[0]} 〜 ${t[t.length-1]}`)}else q("データなし")})},[]),T)throw T;t.useEffect(()=>(o.trackRender.start("RecordExport"),()=>{o.trackRender.end("RecordExport")})),t.useEffect(()=>{},[l,k,E,I]);return e.jsxs("div",{className:"max-w-full sm:max-w-4xl mx-auto sm:px-0",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:"データの詳細"}),e.jsxs("div",{className:"text-base text-gray-600 dark:text-gray-300 space-y-3",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:"体重レコード数"})," ",F,e.jsx("span",{className:"ml-4 text-sm text-gray-500 dark:text-gray-400",children:z})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:"日課レコード数"})," ",U,e.jsx("span",{className:"ml-4 text-sm text-gray-500 dark:text-gray-400",children:P})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("strong",{className:"text-gray-800 dark:text-white",children:"血圧レコード数"})," ",H,e.jsx("span",{className:"ml-4 text-sm text-gray-500 dark:text-gray-400",children:B})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:"データのエクスポート"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:"体重・血圧・日課（記録・項目）すべてを1つのJSONファイル（V2形式）でエクスポートします。"}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsx(h,{variant:"purple",size:"lg",icon:g,onClick:async()=>{const[e,t,a,s]=await Promise.all([n(),c(),i(),b()]),r={weightRecords:e,bpRecords:t,dailyRecords:a,dailyFields:s},l=JSON.stringify(r,null,2),d=new Blob([l],{type:"application/json"}),o=URL.createObjectURL(d),x=document.createElement("a");var m;x.href=o,x.download=`records-v2-${m=new Date,`${m.getFullYear()}${String(m.getMonth()+1).padStart(2,"0")}${String(m.getDate()).padStart(2,"0")}${String(m.getHours()).padStart(2,"0")}${String(m.getMinutes()).padStart(2,"0")}${String(m.getSeconds()).padStart(2,"0")}`}.json`,x.click(),URL.revokeObjectURL(o)},fullWidth:!1,"data-testid":"download-json-btn",children:"JSON形式でエクスポート"})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:"データのインポート"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6",children:"体重・血圧・日課（記録・項目）すべてを1つのJSONファイル（V2形式）でインポートします。"}),l&&e.jsxs("div",{className:"mb-6",children:[l.includes("✅")&&e.jsx(R,{message:l.replace("✅ ","")}),l.includes("❌")&&e.jsx($,{message:l.replace("❌ ","")}),!l.includes("✅")&&!l.includes("❌")&&e.jsx(C,{message:l})]}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".json",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){if(!a.name.toLowerCase().endsWith(".json"))return v("サポートされていないファイル形式です"),setTimeout(()=>v(null),3e3),void(e.target.value="");(async e=>{v("データをインポート中...");try{const a=await e.text(),s=JSON.parse(a);if(!(s&&"object"==typeof s&&Array.isArray(s.weightRecords)&&Array.isArray(s.bpRecords)&&Array.isArray(s.dailyRecords)&&Array.isArray(s.dailyFields)))throw new Error("V2 JSON file format is incorrect");let r=0;for(const e of s.weightRecords)try{await j(e),r++}catch(t){}for(const e of s.bpRecords)try{await y(e),r++}catch(t){}for(const e of s.dailyFields)try{await w(e)}catch(t){}for(const e of s.dailyRecords)try{let t=0;1===e.value?t=1:.5===e.value&&(t=.5);const{id:a,date:s,fieldId:l}=e;await N({id:a,date:s,fieldId:l,value:t}),r++}catch(t){}v(`✅ ${r}件のデータをインポートしました`),setTimeout(()=>v(null),3e3)}catch(t){const e=t instanceof Error?t:new Error("Unknown error");v(`❌ データのインポートに失敗しました: ${e.message}`),setTimeout(()=>v(null),5e3)}})(a)}e.target.value=""},className:"hidden",id:"data-import"}),e.jsxs("label",{htmlFor:"data-import",className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-medium shadow-md hover:bg-purple-700 hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2 w-auto cursor-pointer",children:[e.jsx(u,{className:"w-5 h-5"}),"ファイルを選択"]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-4",children:"TIPS"}),e.jsx(h,{variant:"purple",size:"lg",icon:f,onClick:()=>a&&a(),fullWidth:!0,children:"TIPSを表示"})]}),x,x,e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-2xl shadow-md p-6 mb-8",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-red-800 dark:text-red-400 mb-6 flex items-center gap-2",children:[e.jsx(s,{className:"w-6 h-6 text-red-600 dark:text-red-500"}),"危険ゾーン"]}),e.jsx("div",{className:"mb-6 text-left",children:e.jsx("p",{className:"text-base text-red-700 dark:text-red-300 mb-3",children:"すべてのデータを削除してもよろしいですか？この操作は元に戻せません。"})}),e.jsx(h,{variant:"danger",size:"lg",icon:p,onClick:async()=>{if(window.confirm("すべてのデータを削除してもよろしいですか？")){if(window.confirm("本当に削除してもよろしいですか？この操作は元に戻せません。"))try{await r(),alert("すべてのデータを削除しました")}catch(e){alert("データの削除に失敗しました")}}},fullWidth:!1,children:"すべてのデータを削除"})]})]})}export{E as default};
