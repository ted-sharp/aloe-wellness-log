import{j as e,z as t,L as s}from"./ui-vendor-NppzeDv9.js";import{r as a}from"./react-vendor-C0LY84C9.js";import{H as r,a as l,b as n,c as i,d,e as o,f as c,u,g as m,h as g,i as x,j as h,k as f,l as b,m as p}from"./index-C5oYGPPY.js";import{u as y,a as w,D as v,c as j,S as N,v as S,s as F,K as C,P as k,b as E,C as I,d as D}from"./dnd-vendor-PFeBR1-y.js";import"./icons-vendor-dw3RmBrp.js";import"./state-vendor-B_eAjXv5.js";const T=({recordDate:t,recordTime:s,onDateChange:a,onTimeChange:n,onSetCurrentDateTime:i})=>e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-md",children:e.jsxs("fieldset",{className:"space-y-4",children:[e.jsxs("legend",{className:"text-2xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(r,{className:"w-6 h-6 text-blue-600","aria-hidden":"true"}),"記録日時"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"record-date",className:"block text-base font-medium text-gray-700 mb-2",children:"日付"}),e.jsx("input",{id:"record-date",type:"date",value:t,onChange:e=>a(e.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600","aria-describedby":"record-date-desc",required:!0,"aria-required":"true"}),e.jsx("div",{id:"record-date-desc",className:"sr-only",children:"記録する日付を選択してください"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"record-time",className:"block text-base font-medium text-gray-700 mb-2",children:"時刻"}),e.jsx("input",{id:"record-time",type:"time",value:s,onChange:e=>n(e.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600","aria-describedby":"record-time-desc",required:!0,"aria-required":"true"}),e.jsx("div",{id:"record-time-desc",className:"sr-only",children:"記録する時刻を選択してください"})]}),e.jsxs("div",{className:"flex items-end",children:[e.jsxs("button",{type:"button",onClick:i,className:"bg-blue-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":"現在の日時を設定","aria-describedby":"current-time-desc",children:[e.jsx(l,{className:"w-5 h-5","aria-hidden":"true"}),"現在時刻"]}),e.jsx("div",{id:"current-time-desc",className:"sr-only",children:"クリックすると現在の日付と時刻が自動的に設定されます"})]})]})]})}),O=({value:t,onChange:s,maxLength:a=500,placeholder:r="その時の体調、気づき、特記事項など（任意）"})=>{const l=t.length,i=l>.8*a;return e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{htmlFor:"notes-input",className:"text-2xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(n,{className:"w-6 h-6 text-blue-600","aria-hidden":"true"}),"備考・メモ"]}),e.jsxs("div",{children:[e.jsx("textarea",{id:"notes-input",value:t,onChange:e=>s(e.target.value),placeholder:r,className:"w-full border border-gray-300 rounded-lg px-4 py-2 h-24 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 resize-none",maxLength:a,"aria-describedby":"notes-char-count notes-description","aria-label":"備考・メモを入力"}),e.jsxs("div",{id:"notes-description",className:"sr-only",children:["体調や状況についてのメモを自由に入力できます。最大",a,"文字まで入力可能です。"]}),e.jsxs("div",{id:"notes-char-count",className:"text-right text-sm mt-2 "+(i?"text-orange-600 font-medium":"text-gray-600"),"aria-live":"polite","aria-label":`${l}文字入力済み、残り${a-l}文字`,children:[l,"/",a,"文字",i&&e.jsxs("span",{className:"ml-2 text-orange-600",children:["(残り",a-l,"文字)"]})]})]})]})})};function $({field:t,onToggleDisplay:s}){const{attributes:a,listeners:r,setNodeRef:l,transform:n,transition:i,isDragging:d}=E({id:t.fieldId}),o={transform:I.Transform.toString(n),transition:i,opacity:d?.5:1},u=e=>{e.stopPropagation(),e.preventDefault(),s(t.fieldId)};return e.jsx("div",{ref:l,style:o,className:"bg-white border border-gray-200 rounded-lg p-3 hover:shadow-md transition-all duration-200 hover:border-purple-300",...a,children:e.jsxs("div",{className:"grid gap-3 items-center",style:{gridTemplateColumns:"auto 1fr 1fr auto"},children:[e.jsx("div",{className:"text-center border-r border-gray-200 pr-3",children:t.defaultDisplay?e.jsx("div",{onClick:u,className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:bg-green-200 transition-colors duration-150",title:"クリックで非表示にする",children:"表示中"}):e.jsx("div",{onClick:u,className:"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:bg-gray-200 transition-colors duration-150",title:"クリックで表示にする",children:"非表示"})}),e.jsx("div",{className:"text-lg font-medium text-gray-700 border-r border-gray-200 pr-3 text-right",children:t.name}),e.jsx("div",{className:"text-gray-600 border-r border-gray-200 pr-3 text-left",children:t.unit?`(${t.unit})`:"―"}),e.jsx("div",{className:"flex justify-center cursor-move",...r,children:e.jsx(c,{className:"w-5 h-5 text-gray-400 hover:text-gray-600 transition-colors duration-150"})})]})})}const M=({isOpen:r,onClose:l,fields:n,onDragEnd:c,onSave:u,onToggleDisplay:m})=>{const g=y(w(k),w(C,{coordinateGetter:F}));return e.jsx(t,{appear:!0,show:r,as:a.Fragment,children:e.jsxs(s,{as:"div",className:"relative z-50",onClose:l,children:[e.jsx(t.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0",style:{backgroundColor:"rgba(0, 0, 0, 0.3)"}})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(t.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(s.Panel,{className:"w-auto min-w-[500px] max-w-2xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[e.jsxs(s.Title,{as:"h3",className:"text-2xl font-bold leading-6 text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(i,{className:"w-6 h-6 text-purple-600"}),"項目の並び替え"]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-gray-600 text-sm",children:"ドラッグ&ドロップで項目の表示順序を変更できます。右端のハンドルをドラッグしてください。"})}),e.jsx(v,{sensors:g,collisionDetection:j,onDragEnd:c,children:e.jsx(N,{items:n.map(e=>e.fieldId),strategy:S,children:e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-2",children:n.map(t=>e.jsx($,{field:t,onToggleDisplay:m},t.fieldId))})})}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsxs("button",{type:"button",className:"bg-gray-400 text-white px-6 py-2 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-2",onClick:l,children:[e.jsx(d,{className:"w-4 h-4"}),"キャンセル"]}),e.jsxs("button",{type:"button",className:"bg-purple-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-purple-700 transition-colors duration-200 font-medium flex items-center gap-2",onClick:u,children:[e.jsx(o,{className:"w-4 h-4"}),"保存"]})]})]})})})})]})})};var A=(e=>(e.CONNECTION_FAILED="connection_failed",e.TRANSACTION_FAILED="transaction_failed",e.DATA_CORRUPTED="data_corrupted",e.QUOTA_EXCEEDED="quota_exceeded",e.VERSION_ERROR="version_error",e.UNKNOWN="unknown",e))(A||{});function _(){const{showError:e,showWarning:t}=u(),s=a.useCallback((s,a={})=>{const{showToast:r=!0,logToConsole:l=!0,context:n,fallbackMessage:i}=a,d=function(e){if(e&&"object"==typeof e&&"type"in e&&"retryable"in e&&"message"in e){const t=e;if(Object.values(A).includes(t.type)){const t=e;return{type:"database",message:t.message,originalError:t.originalError,context:{dbErrorType:t.type,retryable:t.retryable}}}}if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("indexeddb")||t.includes("database")||t.includes("store")?{type:"database",message:"データベース操作でエラーが発生しました",originalError:e}:t.includes("parse")||t.includes("json")||t.includes("csv")?{type:"parse",message:"データの解析でエラーが発生しました",originalError:e}:t.includes("validation")||t.includes("必須")||t.includes("形式")?{type:"validation",message:e.message,originalError:e}:t.includes("network")||t.includes("fetch")||t.includes("request")?{type:"network",message:"ネットワークエラーが発生しました",originalError:e}:{type:"unknown",message:e.message,originalError:e}}return{type:"unknown",message:"予期しないエラーが発生しました",context:{originalError:e}}}(s);l&&function(e){var t;e.message,e.originalError,"database"===e.type&&(null==(t=e.context)||t.dbErrorType)}(d);const o=i||function(e){var t;switch(e.type){case"validation":return e.message;case"database":if(null==(t=e.context)?void 0:t.dbErrorType){const t=e.context.dbErrorType,s=e.context.retryable;switch(t){case"quota_exceeded":return"ストレージ容量が不足しています。不要なデータを削除してから再度お試しくださいませ。";case"connection_failed":return s?"データベース接続に失敗しました。しばらく待ってから再度お試しくださいませ。":"データベース接続に問題があります。ページを再読み込みしてお試しくださいませ。";case"transaction_failed":return"データベース処理中にエラーが発生しました。もう一度お試しくださいませ。";case"data_corrupted":return"データが破損している可能性があります。管理画面からデータの確認をお勧めいたします。";case"version_error":return"データベースの更新中です。ページを再読み込みしてお試しくださいませ。";default:return e.message||"データベース操作でエラーが発生いたしました。"}}return"データの保存・読み込みに失敗いたしました。もう一度お試しくださいませ。";case"parse":return"ファイルの形式が正しくありません。ファイルの内容をご確認くださいませ。";case"network":return"ネットワーク接続に問題があります。接続状況をご確認くださいませ。";case"permission":return"この操作を実行する権限がありません。";default:return e.message||"予期しないエラーが発生いたしました。"}}(d);return r&&("validation"===d.type?t(o):e(o)),d},[e,t]),r=a.useCallback(async(e,t={})=>{try{return await e()}catch(a){return s(a,t),null}},[s]),l=a.useCallback((e,t={})=>e.map(({error:e,context:a})=>s(e,{...t,context:a})),[s]);return{handleError:s,handleAsyncError:r,handleBatchErrors:l}}const B=[{value:"number",label:"数値"},{value:"string",label:"文字列"},{value:"boolean",label:"成否"}];function q(){const{fields:t,loadFields:s,addRecord:r,loadRecords:l,records:c}=m(),{showSuccess:y}=u(),{handleAsyncError:w}=_(),v=function(){const{fields:e,loadFields:t,addField:s,updateField:r,deleteField:l}=m(),{showSuccess:n}=u(),{handleAsyncError:i}=_(),[d,o]=a.useState(!1),[c,g]=a.useState(!1),[x,h]=a.useState({name:"",type:"number",unit:""}),[f,b]=a.useState(null),[p,y]=a.useState({}),[w,v]=a.useState(null),[j,N]=a.useState(null),[S,F]=a.useState({}),[C,k]=a.useState(new Set),[E,I]=a.useState(new Set),[T,O]=a.useState(new Set),[$,M]=a.useState(!1),[A,B]=a.useState([]),q=a.useRef([]),R=a.useCallback(()=>0===e.length?1:Math.max(...e.map(e=>e.order||0))+1,[e]),P=a.useCallback(()=>e.filter(e=>!1===e.defaultDisplay).sort((e,t)=>(e.order||999)-(t.order||999)),[e]),H=a.useCallback(async a=>{if(a.preventDefault(),v(null),!x.name.trim())return void v("項目名を入力してください");if(e.some(e=>e.name===x.name.trim()))return void v("同じ名前の項目が既に存在します");const r=x.name.trim().replace(/\s+/g,"_").toLowerCase();await i(async()=>{var e;return await s({fieldId:r,name:x.name.trim(),type:x.type,unit:(null==(e=x.unit)?void 0:e.trim())||void 0,order:R(),defaultDisplay:!1}),k(e=>new Set([...e,r])),h({name:"",type:"number",unit:""}),g(!1),o(!1),await t(),!0},{context:"項目追加",fallbackMessage:"項目の追加に失敗しました"})&&n("項目を追加しましたわ")},[x,e,s,R,i,t,n]),L=a.useCallback(e=>{b(e.fieldId),y({name:e.name,unit:e.unit})},[]),z=a.useCallback(async()=>{var s;if(!f||!(null==(s=p.name)?void 0:s.trim()))return b(null),y({}),void I(new Set);const a=e.find(e=>e.fieldId===f);a&&(await i(async()=>{var e;return await r({...a,name:p.name.trim(),unit:(null==(e=p.unit)?void 0:e.trim())||void 0}),await t(),!0},{context:"項目編集",fallbackMessage:"項目の編集に失敗しました"})&&n("項目を編集しましたわ"),b(null),y({}),I(new Set))},[f,p,e,r,i,t,n]),U=a.useCallback(t=>{e.find(e=>e.fieldId===t)&&(k(e=>new Set([...e,t])),o(!1),O(new Set),n("項目を一時表示に追加しましたわ"))},[e,n]),K=a.useCallback(async s=>{const a=e.find(e=>e.fieldId===s);a&&await i(async()=>(await r({...a,defaultDisplay:!0}),k(e=>{const t=new Set(e);return t.delete(s),t}),O(new Set),await t(),!0),{context:"表示状態変更",fallbackMessage:"表示状態の変更に失敗しました"})&&n("項目を表示状態に変更しましたわ")},[e,r,i,t,n]),W=a.useCallback(e=>{N(e.fieldId),F({name:e.name,unit:e.unit}),O(new Set)},[]),G=a.useCallback(async()=>{var s;if(!j||!(null==(s=S.name)?void 0:s.trim()))return N(null),F({}),void O(new Set);const a=e.find(e=>e.fieldId===j);a&&(await i(async()=>{var e;return await r({...a,name:S.name.trim(),unit:(null==(e=S.unit)?void 0:e.trim())||void 0,order:a.order,defaultDisplay:a.defaultDisplay}),await t(),!0},{context:"既存項目編集",fallbackMessage:"項目の編集に失敗しました"})&&n("項目を編集しましたわ"),N(null),F({}),O(new Set))},[j,S,e,r,i,t,n]),Q=a.useCallback(async e=>{window.confirm(`項目「${e.name}」を削除してもよろしいですか？\n\nこの項目に関連するすべての記録データも削除されます。`)&&await i(async()=>(await l(e.fieldId),await t(),O(new Set),!0),{context:"項目削除",fallbackMessage:"項目の削除に失敗しました"})&&n("項目を削除しましたわ")},[l,i,t,n]),V=a.useCallback(e=>{I(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),X=a.useCallback(e=>E.has(e),[E]),J=a.useCallback(()=>{I(new Set)},[]),Y=a.useCallback(e=>{O(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),Z=a.useCallback(e=>T.has(e),[T]),ee=a.useCallback(()=>{O(new Set)},[]),te=a.useCallback(()=>{const t=[...e].sort((e,t)=>(e.order||999)-(t.order||999));B(t),q.current=t,M(!0)},[e]),se=a.useCallback(e=>{const{active:t,over:s}=e;if(s&&t.id!==s.id){const e=A.findIndex(e=>e.fieldId===t.id),a=A.findIndex(e=>e.fieldId===s.id),r=D(A,e,a);B(r),q.current=r}},[A]),ae=a.useCallback(async()=>{await i(async()=>{const e=q.current.map((e,t)=>{const s={...e,order:t+1};return r(s)});return await Promise.all(e),await new Promise(e=>setTimeout(e,50)),await t(),M(!1),!0},{context:"並び順保存",fallbackMessage:"並び順の保存に失敗しました"})&&n("並び順を保存しましたわ")},[r,i,t,n]),re=a.useCallback(async e=>{await i(async()=>(await r({...e,defaultDisplay:!1}),k(t=>{const s=new Set(t);return s.delete(e.fieldId),s}),I(new Set),await t(),!0),{context:"項目非表示",fallbackMessage:"項目の非表示に失敗しました"})&&n("項目を非表示にしましたわ")},[r,i,t,n]),le=a.useCallback(async t=>{const s=A.find(e=>e.fieldId===t);if(!s)return;const a={...s,defaultDisplay:!s.defaultDisplay};await i(async()=>{await r(a);const s=A.map(e=>e.fieldId===t?a:e);B(s),q.current=s;const l=e.map(e=>e.fieldId===t?a:e);return m.setState({fields:l}),a.defaultDisplay?k(e=>{const s=new Set(e);return s.delete(t),s}):e.some(e=>e.fieldId===t&&(e.defaultDisplay||C.has(t)))&&k(e=>new Set([...e,t])),!0},{context:"モーダル内表示状態変更",fallbackMessage:"表示状態の変更に失敗しました"})},[A,e,C,r,i]);return{showSelectField:d,setShowSelectField:o,showAddField:c,setShowAddField:g,newField:x,setNewField:h,editFieldId:f,setEditFieldId:b,editField:p,setEditField:y,addFieldError:w,editingExistingFieldId:j,setEditingExistingFieldId:N,editingExistingField:S,setEditingExistingField:F,temporaryDisplayFields:C,showSortModal:$,setShowSortModal:M,sortableFields:A,getHiddenFields:P,handleAddField:H,handleEditField:L,handleEditFieldSave:z,handleShowExistingField:U,handleShowExistingFieldPermanently:K,handleEditExistingField:W,handleEditExistingFieldSave:G,handleDeleteExistingField:Q,toggleButtons:V,areButtonsShown:X,toggleSelectButtons:Y,areSelectButtonsShown:Z,handleOpenSortModal:te,handleDragEnd:se,handleSaveSortOrder:ae,handleHideField:re,handleToggleDisplayInModal:le,clearButtons:J,clearSelectButtons:ee}}(),[j,N]=a.useState({}),[S,F]=a.useState(null),[C,k]=a.useState(()=>(new Date).toISOString().slice(0,10)),[E,I]=a.useState(()=>(new Date).toTimeString().slice(0,5)),[$,A]=a.useState("");a.useEffect(()=>{s(),l()},[s,l]);const q=(e,t)=>"number"===e.type?void 0!==t&&""!==t&&!isNaN(Number(t)):"string"===e.type?void 0!==t&&""!==t&&""!==String(t).trim():"boolean"===e.type&&!0===t,R=e=>{const t=[...c].reverse().find(t=>t.fieldId===e);return t?t.value:""};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-sky-50 to-blue-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-2",children:"健康記録入力"}),e.jsx("p",{className:"text-gray-600",children:"項目をクリックすると操作ボタンが表示されます"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),F(null);const s=(()=>{for(const e of t){const t=j[e.fieldId];if(q(e,t)&&"number"===e.type&&isNaN(Number(t)))return`${e.name}は正しい数値で入力してください`}return null})();if(s)return void F(s);await w(async()=>{const e=new Date(`${C}T${E}:00`),s=Date.now();for(const a of t){const t=j[a.fieldId];q(a,t)&&await r({id:`${e.toISOString()}-${a.fieldId}-${s}`,date:C,time:E,datetime:e.toISOString(),fieldId:a.fieldId,value:t})}return $.trim()&&await r({id:`${e.toISOString()}-notes-${s}`,date:C,time:E,datetime:e.toISOString(),fieldId:"notes",value:$.trim()}),!0},{context:"記録保存",fallbackMessage:"保存に失敗いたしましたわ。もう一度お試しくださいませ。"})&&(y("記録を保存いたしましたわ"),N({}),v.temporaryDisplayFields.clear(),A(""))},className:"space-y-8 mb-12",children:[e.jsx(T,{recordDate:C,recordTime:E,onDateChange:k,onTimeChange:I,onSetCurrentDateTime:()=>{const e=new Date;k(e.toISOString().slice(0,10)),I(e.toTimeString().slice(0,5))}}),e.jsx(O,{value:$,onChange:A}),[...t].filter(e=>!1!==e.defaultDisplay||v.temporaryDisplayFields.has(e.fieldId)).sort((e,t)=>(e.order||999)-(t.order||999)).map(t=>e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-md",children:v.editFieldId===t.fieldId?e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-stretch mb-4",children:[e.jsx("div",{className:"text-right pr-2 border-r border-gray-200",children:e.jsx("input",{type:"text",value:v.editField.name??"",onChange:e=>v.setEditField(t=>({...t,name:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:"項目名"})}),e.jsx("div",{className:"pl-2",children:"boolean"===t.type?e.jsx("div",{className:"h-full"}):e.jsx("input",{type:"text",value:v.editField.unit??"",onChange:e=>v.setEditField(t=>({...t,unit:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:"単位（例: kg）"})})]}),e.jsxs("div",{className:"flex gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:v.handleEditFieldSave,className:"bg-green-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"}),"保存"]}),e.jsxs("button",{type:"button",onClick:()=>{v.setEditFieldId(null),v.setEditField({}),v.clearButtons()},className:"bg-gray-400 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"}),"キャンセル"]})]})]}):e.jsxs("div",{children:[e.jsxs("fieldset",{className:"grid grid-cols-2 gap-2 items-stretch cursor-pointer",onClick:()=>v.toggleButtons(t.fieldId),children:[e.jsxs("legend",{className:"sr-only",children:[t.name,"の入力フィールド"]}),e.jsxs("label",{htmlFor:`field-${t.fieldId}`,className:"text-xl font-medium text-gray-700 text-right pr-2 border-r border-gray-200 cursor-pointer",children:[t.name,"boolean"!==t.type&&S&&S.includes(t.name)&&e.jsx("span",{className:"text-red-600 ml-1","aria-hidden":"true",children:"*"})]}),e.jsx("div",{className:"text-lg text-gray-800 font-semibold pl-2 text-left",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:`field-${t.fieldId}`,type:"number"===t.type?"number":"boolean"===t.type?"checkbox":"text",value:"boolean"===t.type?void 0:String(j[t.fieldId]??""),checked:"boolean"===t.type?!!j[t.fieldId]:void 0,onChange:e=>{var s,a;e.stopPropagation(),s=t.fieldId,a="boolean"===t.type?e.currentTarget.checked:e.currentTarget.value,N(e=>({...e,[s]:a}))},onClick:e=>e.stopPropagation(),className:"boolean"===t.type?"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 focus:ring-offset-2 block":"border border-gray-300 rounded-lg px-4 py-2 w-32 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600","aria-invalid":S&&S.includes(t.name)?"true":"false","aria-describedby":t.unit?`${t.fieldId}-unit`:void 0,"aria-label":"boolean"===t.type?`${t.name}をチェックする`:`${t.name}を入力`}),t.unit&&e.jsx("span",{id:`${t.fieldId}-unit`,className:"text-gray-600 font-medium","aria-label":`単位: ${t.unit}`,children:t.unit})]})})]}),v.areButtonsShown(t.fieldId)&&e.jsxs("div",{className:"flex gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{type:"button",className:"bg-sky-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-sky-600 transition-colors duration-200 font-medium flex items-center gap-2",onClick:()=>N(e=>({...e,[t.fieldId]:R(t.fieldId)})),children:[e.jsx(g,{className:"w-4 h-4"}),"前回値"]}),e.jsxs("button",{type:"button",onClick:()=>v.handleEditField(t),className:"bg-blue-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),"編集"]}),e.jsxs("button",{type:"button",onClick:()=>v.handleHideField(t),className:"bg-red-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"非表示"]})]})]})},t.fieldId)),S&&e.jsxs("div",{id:"form-error",className:"text-red-600 font-semibold bg-red-50 p-4 rounded-lg border border-red-200",role:"alert","aria-live":"polite",children:[e.jsx("span",{className:"sr-only",children:"エラー: "}),S]}),e.jsxs("button",{type:"submit",className:"bg-green-600 text-white px-8 py-4 rounded-lg font-bold text-xl shadow-md hover:bg-green-700 hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-3 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-2","aria-describedby":S?"form-error":void 0,children:[e.jsx(n,{className:"w-6 h-6","aria-hidden":"true"}),"記録する"]})]}),e.jsx("div",{className:"mb-8",children:v.showSelectField?e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-md",children:[e.jsxs("h3",{className:"text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(g,{className:"w-6 h-6 text-blue-600"}),"項目を選択・表示"]}),e.jsxs("div",{className:"space-y-4",children:[v.getHiddenFields().length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-xl font-medium text-gray-700 text-left",children:"既存の項目から選択:"}),e.jsx("div",{className:"space-y-3",children:v.getHiddenFields().map(t=>e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:v.editingExistingFieldId===t.fieldId?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-stretch",children:[e.jsx("div",{className:"text-right pr-2 border-r border-gray-200",children:e.jsx("input",{type:"text",value:v.editingExistingField.name??"",onChange:e=>v.setEditingExistingField(t=>({...t,name:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:"項目名"})}),e.jsx("div",{className:"pl-2",children:e.jsx("input",{type:"text",value:v.editingExistingField.unit??"",onChange:e=>v.setEditingExistingField(t=>({...t,unit:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:"単位（例: kg）"})})]}),e.jsxs("div",{className:"flex gap-2 justify-center pt-2 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:v.handleEditExistingFieldSave,className:"bg-green-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"}),"保存"]}),e.jsxs("button",{type:"button",onClick:()=>{v.setEditingExistingFieldId(null),v.clearSelectButtons()},className:"bg-gray-400 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"}),"キャンセル"]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-stretch cursor-pointer",onClick:()=>v.toggleSelectButtons(t.fieldId),children:[e.jsx("div",{className:"text-xl font-medium text-gray-700 text-right pr-2 border-r border-gray-200",children:t.name}),e.jsx("div",{className:"text-lg text-gray-800 font-semibold pl-2 text-left",children:t.unit?`(${t.unit})`:""})]}),v.areSelectButtonsShown(t.fieldId)&&e.jsxs("div",{className:"flex gap-3 justify-center mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:()=>v.handleShowExistingFieldPermanently(t.fieldId),className:"bg-green-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"}),"表示"]}),e.jsxs("button",{type:"button",onClick:()=>v.handleShowExistingField(t.fieldId),className:"bg-teal-400 text-white px-4 py-2 rounded-lg shadow-md hover:bg-teal-500 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"追加"]}),e.jsxs("button",{type:"button",onClick:()=>v.handleEditExistingField(t),className:"bg-blue-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),"編集"]}),e.jsxs("button",{type:"button",onClick:()=>v.handleDeleteExistingField(t),className:"bg-red-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"削除"]})]})]})},t.fieldId))})]}),v.showAddField&&e.jsxs("form",{onSubmit:v.handleAddField,className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-xl font-medium text-gray-700 mb-4 text-left flex items-center gap-2",children:[e.jsx(f,{className:"w-6 h-6 text-green-600","aria-hidden":"true"}),"新しい項目を追加"]}),e.jsxs("fieldset",{className:"space-y-4",children:[e.jsx("legend",{className:"sr-only",children:"新規項目の詳細情報"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"new-field-name",className:"block text-sm font-medium text-gray-700 mb-1",children:["項目名"," ",e.jsx("span",{className:"text-red-600","aria-label":"必須",children:"*"})]}),e.jsx("input",{id:"new-field-name",type:"text",value:v.newField.name,onChange:e=>v.setNewField(t=>({...t,name:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:"例: 体重",required:!0,"aria-required":"true","aria-describedby":"new-field-name-desc","aria-invalid":v.addFieldError&&v.addFieldError.includes("項目名")?"true":"false"}),e.jsx("div",{id:"new-field-name-desc",className:"sr-only",children:"記録したい項目の名前を入力してください"})]}),e.jsxs("div",{className:"w-full sm:w-32",children:[e.jsxs("label",{htmlFor:"new-field-type",className:"block text-sm font-medium text-gray-700 mb-1",children:["データ型"," ",e.jsx("span",{className:"text-red-600","aria-label":"必須",children:"*"})]}),e.jsx("select",{id:"new-field-type",value:v.newField.type,onChange:e=>v.setNewField(t=>({...t,type:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",required:!0,"aria-required":"true","aria-describedby":"new-field-type-desc",children:B.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("div",{id:"new-field-type-desc",className:"sr-only",children:"項目に入力するデータの種類を選択してください"})]}),e.jsxs("div",{className:"w-full sm:w-32",children:[e.jsx("label",{htmlFor:"new-field-unit",className:"block text-sm font-medium text-gray-700 mb-1",children:"単位（任意）"}),e.jsx("input",{id:"new-field-unit",type:"text",value:v.newField.unit,onChange:e=>v.setNewField(t=>({...t,unit:e.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600",placeholder:"例: kg","aria-describedby":"new-field-unit-desc"}),e.jsx("div",{id:"new-field-unit-desc",className:"sr-only",children:"項目の単位を入力してください（例: kg、mmHg）"})]})]}),v.addFieldError&&e.jsxs("div",{id:"add-field-error",className:"text-red-600 font-semibold bg-red-50 p-3 rounded-lg border border-red-200",role:"alert","aria-live":"polite",children:[e.jsx("span",{className:"sr-only",children:"エラー: "}),v.addFieldError]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs("button",{type:"submit",className:"bg-teal-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-teal-600 transition-colors duration-200 font-medium flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2","aria-describedby":v.addFieldError?"add-field-error":void 0,children:[e.jsx(f,{className:"w-4 h-4","aria-hidden":"true"}),"追加"]}),e.jsxs("button",{type:"button",onClick:()=>v.setShowAddField(!1),className:"bg-gray-400 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-500 transition-colors duration-200 font-medium flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2",children:[e.jsx(d,{className:"w-4 h-4","aria-hidden":"true"}),"キャンセル"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[!v.showAddField&&e.jsxs("button",{type:"button",onClick:()=>v.setShowAddField(!0),className:"bg-teal-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-teal-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"新しい項目を追加"]}),e.jsxs("button",{type:"button",onClick:()=>v.setShowSelectField(!1),className:"bg-gray-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5"}),"戻る"]})]})]})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>v.setShowSelectField(!0),className:"bg-blue-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"項目を選択・表示"]}),e.jsxs("button",{type:"button",onClick:v.handleOpenSortModal,className:"bg-purple-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-purple-600 transition-colors duration-200 font-medium flex items-center gap-2",children:[e.jsx(i,{className:"w-5 h-5"}),"並び替え"]})]})}),e.jsx(M,{isOpen:v.showSortModal,onClose:()=>v.setShowSortModal(!1),fields:v.sortableFields,onDragEnd:v.handleDragEnd,onSave:v.handleSaveSortOrder,onToggleDisplay:v.handleToggleDisplayInModal})]})})}export{q as default};
