import{j as e}from"./ui-vendor-CVK7Hqa1.js";import{r as t}from"./react-vendor-C0LY84C9.js";import{v as a,w as s,n as r,e as l,g as n,x as i,H as d,h as o,y as c,z as m,A as h,l as x}from"./index-CEbaiSpp.js";import"./icons-vendor-dw3RmBrp.js";import"./state-vendor-B_eAjXv5.js";const u={primary:"bg-blue-500 hover:bg-blue-600 focus:ring-blue-500 text-white",success:"bg-green-600 hover:bg-green-700 focus:ring-green-600 text-white",warning:"bg-amber-500 hover:bg-amber-600 focus:ring-amber-500 text-white",danger:"bg-red-600 hover:bg-red-700 focus:ring-red-600 text-white",secondary:"bg-gray-400 hover:bg-gray-500 focus:ring-gray-400 text-white",purple:"bg-purple-600 hover:bg-purple-700 focus:ring-purple-600 text-white",teal:"bg-teal-500 hover:bg-teal-600 focus:ring-teal-500 text-white",sky:"bg-sky-500 hover:bg-sky-600 focus:ring-sky-500 text-white"},f={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},g="rounded-lg font-medium shadow-md transition-all duration-200 flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",p=({variant:t="primary",size:a="md",icon:s,iconPosition:r="left",loading:l=!1,fullWidth:n=!1,className:i="",children:d,disabled:o,...c})=>{const m=o||l,h=[g,u[t],f[a],n?"w-full":"w-auto","hover:shadow-lg",i].join(" "),x="lg"===a?"w-6 h-6":"sm"===a?"w-4 h-4":"w-5 h-5";return e.jsx("button",{className:h,disabled:m,...c,children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`animate-spin rounded-full border-2 border-current border-t-transparent ${x}`}),"読み込み中..."]}):e.jsxs(e.Fragment,{children:[s&&"left"===r&&e.jsx(s,{className:x,"aria-hidden":"true"}),d,s&&"right"===r&&e.jsx(s,{className:x,"aria-hidden":"true"})]})})},b={primary:"bg-blue-600",success:"bg-green-600",warning:"bg-amber-500",error:"bg-red-600"},j={sm:"h-2",md:"h-3",lg:"h-4"},v=({value:t,max:a=100,showPercentage:s=!0,showValue:r=!1,label:l,size:n="md",variant:i="primary",className:d="",animated:o=!0})=>{const c=Math.min(Math.max(t,0),a),m=c/a*100,h=["w-full bg-gray-200 rounded-full overflow-hidden",j[n],d].join(" "),x=["h-full transition-all duration-300 ease-out",b[i],o?"transition-all duration-300":""].join(" ");return e.jsxs("div",{className:"w-full",children:[(l||s||r)&&e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:l}),e.jsxs("div",{className:"text-sm text-gray-600 flex gap-2",children:[r&&e.jsxs("span",{children:[c," / ",a]}),s&&e.jsxs("span",{children:[Math.round(m),"%"]})]})]}),e.jsx("div",{className:h,role:"progressbar","aria-valuenow":c,"aria-valuemin":0,"aria-valuemax":a,children:e.jsx("div",{className:x,style:{width:`${m}%`}})})]})},w={success:{containerClass:"bg-green-50 border-green-200 text-green-700",iconClass:"text-green-600",defaultIcon:l},error:{containerClass:"bg-red-50 border-red-200 text-red-700",iconClass:"text-red-600",defaultIcon:r},warning:{containerClass:"bg-amber-50 border-amber-200 text-amber-700",iconClass:"text-amber-600",defaultIcon:s},info:{containerClass:"bg-blue-50 border-blue-200 text-blue-700",iconClass:"text-blue-600",defaultIcon:a}},y="p-4 rounded-lg border font-medium flex items-start gap-3 shadow-sm",N=({type:a,message:s,autoHide:r=!1,hideDelay:l=3e3,onHide:n,className:i="",icon:d})=>{const[o,c]=t.useState(!0),m=w[a],h=d||m.defaultIcon;if(t.useEffect(()=>{if(r&&l>0){const e=setTimeout(()=>{c(!1),null==n||n()},l);return()=>clearTimeout(e)}},[r,l,n]),!o)return null;const x=[y,m.containerClass,i].join(" ");return e.jsxs("div",{className:x,role:"alert","aria-live":"polite",children:[e.jsx(h,{className:`w-5 h-5 ${m.iconClass} flex-shrink-0 mt-0.5`,"aria-hidden":"true"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm leading-relaxed",children:s})})]})},M=t=>e.jsx(N,{type:"success",...t}),$=t=>e.jsx(N,{type:"error",...t}),S=t=>e.jsx(N,{type:"info",...t});function I(e){return e.toISOString().replace(/[-:T]/g,"").slice(0,15)}function C(){var a,r;const{records:l,fields:u,loadRecords:f,loadFields:g,deleteAllData:b,initializeFields:j,addRecord:w}=n(),[y,N]=t.useState(null),[C,O]=t.useState(null),[E,k]=t.useState(0),[R,z]=t.useState(!1);t.useEffect(()=>{g(),f()},[g,f]);const D=[...l].sort((e,t)=>{const a=`${e.date} ${e.time}`;return`${t.date} ${t.time}`.localeCompare(a)}),L=async(e,t)=>{N("インポート中...");try{const s=await e.text();let r;if("json"===t){if(r=JSON.parse(s),!Array.isArray(r))throw new Error("JSONファイルの形式が正しくありません")}else r=(e=>{const t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim().split("\n");if(t.length<2)throw new Error("CSVファイルが空または形式が正しくありません");const a=e=>{const t=[];let a="",s=!1,r=0;for(;r<e.length;){const l=e[r];'"'===l?s&&'"'===e[r+1]?(a+='"',r+=2):(s=!s,r++):","!==l||s?(a+=l,r++):(t.push(a),a="",r++)}return t.push(a),t},s=a(t[0]),r=["id","date","time","datetime","fieldId","fieldName","value"];if(!r.every(e=>s.includes(e)))throw new Error(`CSVファイルの形式が正しくありません。必要な列: ${r.join(", ")}`);const l=[];for(let i=1;i<t.length;i++)try{if(!t[i].trim())continue;const e=a(t[i]);if(e.length!==s.length)continue;const r={id:e[s.indexOf("id")],date:e[s.indexOf("date")],time:e[s.indexOf("time")],datetime:e[s.indexOf("datetime")],fieldId:e[s.indexOf("fieldId")],value:e[s.indexOf("value")]};if(!(r.id&&r.date&&r.time&&r.fieldId))continue;"あり"===r.value?r.value=!0:"なし"===r.value?r.value=!1:isNaN(Number(r.value))||""===r.value||(r.value=Number(r.value)),l.push(r)}catch(n){throw new Error(`${i}行目の処理でエラーが発生しました: ${n instanceof Error?n.message:"不明なエラー"}`)}return l})(s);for(const e of r)if(!(e.id&&e.date&&e.time&&e.fieldId))throw new Error("データに必須項目が不足しています");let l=0;for(const e of r)try{await w(e),l++}catch(a){}await f(),N(`✅ ${l}件のレコードをインポートしました`),setTimeout(()=>N(null),3e3)}catch(a){const e=a instanceof Error?a:new Error("不明なエラー");N(`❌ インポートに失敗しました: ${e.message}`),setTimeout(()=>N(null),5e3)}};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-12",children:"管理"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"データ詳細"}),e.jsxs("div",{className:"text-base text-gray-600 space-y-3",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-5 h-5 text-blue-600"}),e.jsx("strong",{className:"text-gray-800",children:"対象レコード数:"})," ",D.length,"件"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5 text-blue-600"}),e.jsx("strong",{className:"text-gray-800",children:"期間:"})," ",D.length>0?`${null==(a=D[D.length-1])?void 0:a.date} 〜 ${null==(r=D[0])?void 0:r.date}`:"データなし"]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-blue-600"}),e.jsx("strong",{className:"text-gray-800",children:"対象項目:"})," ","すべての健康記録項目"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"テスト用データ"}),C&&e.jsxs("div",{className:"mb-6",children:[C.includes("✅")&&e.jsx(M,{message:C.replace("✅ ","")}),C.includes("❌")&&e.jsx($,{message:C.replace("❌ ","")}),!C.includes("✅")&&!C.includes("❌")&&e.jsx(S,{message:C})]}),R&&e.jsx("div",{className:"mb-6",children:e.jsx(v,{value:E,label:"テストデータ生成進捗",showPercentage:!0,variant:"primary",size:"md"})}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsx(p,{variant:"purple",size:"lg",icon:c,onClick:()=>{window.confirm("🧪 テストデータを生成しますか？\n\n過去30日分のランダムなデータを約100件作成します。\n既存のデータに追加されます。")&&(async()=>{O("テストデータを生成中..."),z(!0),k(0);try{if(await g(),0===u.length)throw new Error("項目が存在しません。先に項目を初期化してください。");const t=100,a=30;let s=0;for(let r=0;r<t;r++){const l=Math.floor(Math.random()*a),n=new Date;n.setDate(n.getDate()-l);const i=n.toISOString().split("T")[0],d=Math.floor(24*Math.random()),o=Math.floor(60*Math.random()),c=`${d.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`,m=`${i} ${c}`,h=u[Math.floor(Math.random()*u.length)];let x;if("boolean"===h.type)x=Math.random()>.5;else if("number"===h.type)x="weight"===h.fieldId?Math.round(10*(50+50*Math.random()))/10:"systolic_bp"===h.fieldId?Math.round(90+60*Math.random()):"diastolic_bp"===h.fieldId?Math.round(60+40*Math.random()):"heart_rate"===h.fieldId?Math.round(60+60*Math.random()):"body_temperature"===h.fieldId?Math.round(10*(35.5+2*Math.random()))/10:Math.round(100*Math.random()*10)/10;else if("notes"===h.fieldId){const e=["今日は調子が良い","少し疲れている","運動後でスッキリ","食事が美味しかった","早めに寝たい","天気が良くて気分爽快","仕事が忙しかった","久しぶりの休日",""];x=e[Math.floor(Math.random()*e.length)]}else x=`テスト値${Math.floor(1e3*Math.random())}`;const f={id:`test_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,date:i,time:c,datetime:m,fieldId:h.fieldId,value:x};try{await w(f),s++}catch(e){}k((r+1)/t*100),(r+1)%10==0&&O(`テストデータを生成中... ${r+1}/${t}`)}await f(),O(`✅ ${s}件のテストデータを生成しました`),setTimeout(()=>{O(null),k(0)},3e3)}catch(e){O(`❌ テストデータの生成に失敗しました: ${e instanceof Error?e.message:"不明なエラー"}`),setTimeout(()=>{O(null),k(0)},5e3)}finally{z(!1)}})()},fullWidth:!1,disabled:R,loading:R,children:"テストデータを生成（約100件）"})}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1 text-left",children:[e.jsx("p",{children:"• 過去30日分のランダムなデータを約100件作成します。"}),e.jsx("p",{children:"• 各項目について適切な値の範囲でランダム生成されます。"}),e.jsx("p",{children:"• 既存のデータに追加されます。"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"データエクスポート"}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsx(p,{variant:"purple",size:"lg",icon:m,onClick:()=>{const e=function(e,t){return[["id","date","time","datetime","fieldId","fieldName","value"],...e.map(e=>{const a=t.find(t=>t.fieldId===e.fieldId);return[e.id,e.date,e.time,e.datetime,e.fieldId,a?a.name:"","boolean"==typeof e.value?e.value?"あり":"なし":e.value]})].map(e=>e.map(String).map(e=>`"${e.replace(/"/g,'""')}"`).join(",")).join("\r\n")}(D,u),t=new Blob([e],{type:"text/csv"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`records-${I(new Date)}.csv`,s.click(),URL.revokeObjectURL(a)},fullWidth:!1,children:"CSV形式でダウンロード"}),e.jsx(p,{variant:"purple",size:"lg",icon:m,onClick:()=>{const e=JSON.stringify(D,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`records-${I(new Date)}.json`,s.click(),URL.revokeObjectURL(a)},fullWidth:!1,children:"JSON形式でダウンロード"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1 text-left",children:[e.jsx("p",{children:"• CSV形式: Excel等での分析に適しています。"}),e.jsx("p",{children:"• JSON形式: プログラムでの処理やバックアップに適しています。"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"データインポート"}),y&&e.jsxs("div",{className:"mb-6",children:[y.includes("✅")&&e.jsx(M,{message:y.replace("✅ ","")}),y.includes("❌")&&e.jsx($,{message:y.replace("❌ ","")}),!y.includes("✅")&&!y.includes("❌")&&e.jsx(S,{message:y})]}),e.jsx("div",{className:"flex flex-col gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".csv,.json",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){const t=a.name.toLowerCase();let s;if(t.endsWith(".csv"))s="csv";else{if(!t.endsWith(".json"))return N("❌ サポートされていないファイル形式です（.csv または .json のみ）"),setTimeout(()=>N(null),3e3),void(e.target.value="");s="json"}L(a,s)}e.target.value=""},className:"hidden",id:"data-import"}),e.jsxs("label",{htmlFor:"data-import",className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-medium shadow-md hover:bg-purple-700 hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2 w-auto cursor-pointer",children:[e.jsx(h,{className:"w-5 h-5"}),"データをインポート（CSV・JSON）"]})]})}),e.jsx("div",{className:"text-sm text-gray-600 space-y-1 text-left",children:e.jsx("p",{children:"• 既存のデータに追加されます。（重複IDは上書き）"})})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-2xl shadow-md p-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-red-800 mb-6 flex items-center gap-2",children:[e.jsx(s,{className:"w-6 h-6 text-red-600"}),"危険な操作"]}),e.jsx("div",{className:"mb-6 text-left",children:e.jsxs("p",{className:"text-base text-red-700 mb-3",children:[e.jsx("strong",{children:"全データ削除:"})," 記録データが完全に削除されます。"]})}),e.jsx(p,{variant:"danger",size:"lg",icon:x,onClick:async()=>{if(window.confirm("⚠️ 警告: すべてのデータ（記録・項目）が完全に削除されます。\n\nこの操作は取り消すことができません。\n\n本当にすべてのデータを削除してもよろしいですか？")){if(window.confirm("🚨 最終確認: 本当にすべてのデータを削除しますか？\n\nデータのバックアップを取ることをお勧めします。"))try{await b(),await j(),alert("✅ すべてのデータが削除され、初期項目が復元されました。")}catch(e){alert("❌ データの削除に失敗しました。")}}},fullWidth:!1,children:"全データを削除"})]})]})}export{C as default};
