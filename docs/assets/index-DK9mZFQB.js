const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RecordExport-D_XAE2Tv.js","assets/ui-vendor-C-Wy2eYm.js","assets/react-vendor-C-KyEapP.js","assets/icons-vendor-DjdN70Ov.js","assets/dnd-vendor-BRc0Lj2o.js","assets/state-vendor-JWNWXe5-.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,r,a)=>((t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a)(t,"symbol"!=typeof r?r+"":r,a);import{j as r,r as a,C as n,F as s,u as o,a as l,b as i,c as d,d as c,o as u,f as g,s as f,R as m,L as h,e as p,X as x,g as b,Y as y,T as v,h as w}from"./ui-vendor-C-Wy2eYm.js";import{e as k,a as j,r as N,g as S,d as D,f as C,h as I,N as E,u as M,L as T,B as R}from"./react-vendor-C-KyEapP.js";import{G as O}from"./icons-vendor-DjdN70Ov.js";import{u as L,a as A,b as $,C as B,D as _,c as P,S as z,v as F,d as H,P as W}from"./dnd-vendor-BRc0Lj2o.js";import{c as Z}from"./state-vendor-JWNWXe5-.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var V,G={};var U=function(){if(V)return G;V=1;var e=k();return G.createRoot=e.createRoot,G.hydrateRoot=e.hydrateRoot,G}();const q={},K={primary:"bg-blue-500 hover:bg-blue-600 focus:ring-blue-500 text-white",success:"bg-green-600 hover:bg-green-700 focus:ring-green-600 text-white",warning:"bg-amber-500 hover:bg-amber-600 focus:ring-amber-500 text-white",danger:"bg-red-600 hover:bg-red-700 focus:ring-red-600 text-white",secondary:"bg-gray-400 hover:bg-gray-500 focus:ring-gray-400 text-white",purple:"bg-purple-600 hover:bg-purple-700 focus:ring-purple-600 text-white",teal:"bg-teal-500 hover:bg-teal-600 focus:ring-teal-500 text-white",sky:"bg-sky-500 hover:bg-sky-600 focus:ring-sky-500 text-white"},Y={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},X="rounded-lg font-medium shadow-md transition-all duration-200 flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",Q=({variant:e="primary",size:t="md",icon:a,iconPosition:n="left",loading:s=!1,fullWidth:o=!1,className:l="",children:i,disabled:d,...c})=>{const u=d||s,g=[X,K[e],Y[t],o?"w-full":"w-auto","hover:shadow-lg",l].join(" "),f="lg"===t?"w-6 h-6":"sm"===t?"w-4 h-4":"w-5 h-5";return r.jsx("button",{className:g,disabled:u,...c,children:s?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`animate-spin rounded-full border-2 border-current border-t-transparent ${f}`}),"読み込み中..."]}):r.jsxs(r.Fragment,{children:[a&&"left"===n&&r.jsx(a,{className:f,"aria-hidden":"true"}),i,a&&"right"===n&&r.jsx(a,{className:f,"aria-hidden":"true"})]})})},J=({className:e="",onInstall:t,onCancel:a,debug:n=!1})=>{const[s,o]=j.useState(null),[l,i]=j.useState(!1),[d,c]=j.useState(!1),[u,g]=j.useState(!1);j.useEffect(()=>{(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=!0===navigator.standalone;(e||t)&&g(!0)})();const e=e=>{e.preventDefault(),o(e),i(!0)},r=()=>{g(!0),i(!1),o(null),null==t||t()};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",r),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",r)}},[t]);return n||u||!l?null:r.jsxs("button",{onClick:async()=>{if(s){c(!0);try{await s.prompt();const{outcome:e}=await s.userChoice;"dismissed"===e&&(null==a||a()),o(null),i(!1)}catch(e){console.error("Installation failed:",e)}finally{c(!1)}}},disabled:d,className:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 ${e}`,"aria-label":"アプリをインストール",title:"アプリをインストール",children:[r.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),d?"インストール中...":"アプリをインストール"]})};function ee(e){return O({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M2 2h2v2H2z"},child:[]},{tag:"path",attr:{d:"M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"},child:[]},{tag:"path",attr:{d:"M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"},child:[]},{tag:"path",attr:{d:"M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"},child:[]},{tag:"path",attr:{d:"M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"},child:[]}]})(e)}function te(e){return O({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m289.94 256 95-95A24 24 0 0 0 351 127l-95 95-95-95a24 24 0 0 0-34 34l95 95-95 95a24 24 0 1 0 34 34l95-95 95 95a24 24 0 0 0 34-34z"},child:[]}]})(e)}var re,ae,ne,se,oe,le,ie,de,ce,ue,ge,fe,me,he,pe,xe,be,ye,ve={};function we(){return ae?re:(ae=1,re={L:1,M:0,Q:3,H:2})}function ke(){return se?ne:(se=1,ne={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8})}function je(){if(fe)return ge;fe=1;for(var e={glog:function(t){if(t<1)throw new Error("glog("+t+")");return e.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return e.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)e.EXP_TABLE[t]=1<<t;for(t=8;t<256;t++)e.EXP_TABLE[t]=e.EXP_TABLE[t-4]^e.EXP_TABLE[t-5]^e.EXP_TABLE[t-6]^e.EXP_TABLE[t-8];for(t=0;t<255;t++)e.LOG_TABLE[e.EXP_TABLE[t]]=t;return ge=e}function Ne(){if(he)return me;he=1;var e=je();function t(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var r=0;r<e.length&&0==e[r];)r++;this.num=new Array(e.length-r+t);for(var a=0;a<e.length-r;a++)this.num[a]=e[a+r]}return t.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(r){for(var a=new Array(this.getLength()+r.getLength()-1),n=0;n<this.getLength();n++)for(var s=0;s<r.getLength();s++)a[n+s]^=e.gexp(e.glog(this.get(n))+e.glog(r.get(s)));return new t(a,0)},mod:function(r){if(this.getLength()-r.getLength()<0)return this;for(var a=e.glog(this.get(0))-e.glog(r.get(0)),n=new Array(this.getLength()),s=0;s<this.getLength();s++)n[s]=this.get(s);for(s=0;s<r.getLength();s++)n[s]^=e.gexp(e.glog(r.get(s))+a);return new t(n,0).mod(r)}},me=t}function Se(){if(ye)return be;ye=1;var e=function(){if(le)return oe;le=1;var e=ke();function t(t){this.mode=e.MODE_8BIT_BYTE,this.data=t}return t.prototype={getLength:function(e){return this.data.length},write:function(e){for(var t=0;t<this.data.length;t++)e.put(this.data.charCodeAt(t),8)}},oe=t}(),t=function(){if(de)return ie;de=1;var e=we();function t(e,t){this.totalCount=e,this.dataCount=t}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(e,r){var a=t.getRsBlockTable(e,r);if(null==a)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+r);for(var n=a.length/3,s=new Array,o=0;o<n;o++)for(var l=a[3*o+0],i=a[3*o+1],d=a[3*o+2],c=0;c<l;c++)s.push(new t(i,d));return s},t.getRsBlockTable=function(r,a){switch(a){case e.L:return t.RS_BLOCK_TABLE[4*(r-1)+0];case e.M:return t.RS_BLOCK_TABLE[4*(r-1)+1];case e.Q:return t.RS_BLOCK_TABLE[4*(r-1)+2];case e.H:return t.RS_BLOCK_TABLE[4*(r-1)+3];default:return}},ie=t}(),r=function(){if(ue)return ce;function e(){this.buffer=new Array,this.length=0}return ue=1,e.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},ce=e}(),a=function(){if(xe)return pe;xe=1;var e=ke(),t=Ne(),r=je(),a=0,n=1,s=2,o=3,l=4,i=5,d=6,c=7,u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;u.getBCHDigit(t)-u.getBCHDigit(u.G15)>=0;)t^=u.G15<<u.getBCHDigit(t)-u.getBCHDigit(u.G15);return(e<<10|t)^u.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;u.getBCHDigit(t)-u.getBCHDigit(u.G18)>=0;)t^=u.G18<<u.getBCHDigit(t)-u.getBCHDigit(u.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return u.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,r){switch(e){case a:return(t+r)%2==0;case n:return t%2==0;case s:return r%3==0;case o:return(t+r)%3==0;case l:return(Math.floor(t/2)+Math.floor(r/3))%2==0;case i:return t*r%2+t*r%3==0;case d:return(t*r%2+t*r%3)%2==0;case c:return(t*r%3+(t+r)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var a=new t([1],0),n=0;n<e;n++)a=a.multiply(new t([1,r.gexp(n)],0));return a},getLengthInBits:function(t,r){if(1<=r&&r<10)switch(t){case e.MODE_NUMBER:return 10;case e.MODE_ALPHA_NUM:return 9;case e.MODE_8BIT_BYTE:case e.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(r<27)switch(t){case e.MODE_NUMBER:return 12;case e.MODE_ALPHA_NUM:return 11;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(r<41))throw new Error("type:"+r);switch(t){case e.MODE_NUMBER:return 14;case e.MODE_ALPHA_NUM:return 13;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),r=0,a=0;a<t;a++)for(var n=0;n<t;n++){for(var s=0,o=e.isDark(a,n),l=-1;l<=1;l++)if(!(a+l<0||t<=a+l))for(var i=-1;i<=1;i++)n+i<0||t<=n+i||0==l&&0==i||o==e.isDark(a+l,n+i)&&s++;s>5&&(r+=3+s-5)}for(a=0;a<t-1;a++)for(n=0;n<t-1;n++){var d=0;e.isDark(a,n)&&d++,e.isDark(a+1,n)&&d++,e.isDark(a,n+1)&&d++,e.isDark(a+1,n+1)&&d++,0!=d&&4!=d||(r+=3)}for(a=0;a<t;a++)for(n=0;n<t-6;n++)e.isDark(a,n)&&!e.isDark(a,n+1)&&e.isDark(a,n+2)&&e.isDark(a,n+3)&&e.isDark(a,n+4)&&!e.isDark(a,n+5)&&e.isDark(a,n+6)&&(r+=40);for(n=0;n<t;n++)for(a=0;a<t-6;a++)e.isDark(a,n)&&!e.isDark(a+1,n)&&e.isDark(a+2,n)&&e.isDark(a+3,n)&&e.isDark(a+4,n)&&!e.isDark(a+5,n)&&e.isDark(a+6,n)&&(r+=40);var c=0;for(n=0;n<t;n++)for(a=0;a<t;a++)e.isDark(a,n)&&c++;return r+Math.abs(100*c/t/t-50)/5*10}};return pe=u}(),n=Ne();function s(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var o=s.prototype;return o.addData=function(t){var r=new e(t);this.dataList.push(r),this.dataCache=null},o.isDark=function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},o.getModuleCount=function(){return this.moduleCount},o.make=function(){if(this.typeNumber<1){var e=1;for(e=1;e<40;e++){for(var n=t.getRSBlocks(e,this.errorCorrectLevel),s=new r,o=0,l=0;l<n.length;l++)o+=n[l].dataCount;for(l=0;l<this.dataList.length;l++){var i=this.dataList[l];s.put(i.mode,4),s.put(i.getLength(),a.getLengthInBits(i.mode,e)),i.write(s)}if(s.getLengthInBits()<=8*o)break}this.typeNumber=e}this.makeImpl(!1,this.getBestMaskPattern())},o.makeImpl=function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var a=0;a<this.moduleCount;a++)this.modules[r][a]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=s.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},o.setupPositionProbePattern=function(e,t){for(var r=-1;r<=7;r++)if(!(e+r<=-1||this.moduleCount<=e+r))for(var a=-1;a<=7;a++)t+a<=-1||this.moduleCount<=t+a||(this.modules[e+r][t+a]=0<=r&&r<=6&&(0==a||6==a)||0<=a&&a<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=a&&a<=4)},o.getBestMaskPattern=function(){for(var e=0,t=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=a.getLostPoint(this);(0==r||e>n)&&(e=n,t=r)}return t},o.createMovieClip=function(e,t,r){var a=e.createEmptyMovieClip(t,r);this.make();for(var n=0;n<this.modules.length;n++)for(var s=1*n,o=0;o<this.modules[n].length;o++){var l=1*o;this.modules[n][o]&&(a.beginFill(0,100),a.moveTo(l,s),a.lineTo(l+1,s),a.lineTo(l+1,s+1),a.lineTo(l,s+1),a.endFill())}return a},o.setupTimingPattern=function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},o.setupPositionAdjustPattern=function(){for(var e=a.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var r=0;r<e.length;r++){var n=e[t],s=e[r];if(null==this.modules[n][s])for(var o=-2;o<=2;o++)for(var l=-2;l<=2;l++)this.modules[n+o][s+l]=-2==o||2==o||-2==l||2==l||0==o&&0==l}},o.setupTypeNumber=function(e){for(var t=a.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var n=!e&&1==(t>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!e&&1==(t>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},o.setupTypeInfo=function(e,t){for(var r=this.errorCorrectLevel<<3|t,n=a.getBCHTypeInfo(r),s=0;s<15;s++){var o=!e&&1==(n>>s&1);s<6?this.modules[s][8]=o:s<8?this.modules[s+1][8]=o:this.modules[this.moduleCount-15+s][8]=o}for(s=0;s<15;s++){o=!e&&1==(n>>s&1);s<8?this.modules[8][this.moduleCount-s-1]=o:s<9?this.modules[8][15-s-1+1]=o:this.modules[8][15-s-1]=o}this.modules[this.moduleCount-8][8]=!e},o.mapData=function(e,t){for(var r=-1,n=this.moduleCount-1,s=7,o=0,l=this.moduleCount-1;l>0;l-=2)for(6==l&&l--;;){for(var i=0;i<2;i++)if(null==this.modules[n][l-i]){var d=!1;o<e.length&&(d=1==(e[o]>>>s&1)),a.getMask(t,n,l-i)&&(d=!d),this.modules[n][l-i]=d,-1==--s&&(o++,s=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}},s.PAD0=236,s.PAD1=17,s.createData=function(e,n,o){for(var l=t.getRSBlocks(e,n),i=new r,d=0;d<o.length;d++){var c=o[d];i.put(c.mode,4),i.put(c.getLength(),a.getLengthInBits(c.mode,e)),c.write(i)}var u=0;for(d=0;d<l.length;d++)u+=l[d].dataCount;if(i.getLengthInBits()>8*u)throw new Error("code length overflow. ("+i.getLengthInBits()+">"+8*u+")");for(i.getLengthInBits()+4<=8*u&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(!1);for(;!(i.getLengthInBits()>=8*u||(i.put(s.PAD0,8),i.getLengthInBits()>=8*u));)i.put(s.PAD1,8);return s.createBytes(i,l)},s.createBytes=function(e,t){for(var r=0,s=0,o=0,l=new Array(t.length),i=new Array(t.length),d=0;d<t.length;d++){var c=t[d].dataCount,u=t[d].totalCount-c;s=Math.max(s,c),o=Math.max(o,u),l[d]=new Array(c);for(var g=0;g<l[d].length;g++)l[d][g]=255&e.buffer[g+r];r+=c;var f=a.getErrorCorrectPolynomial(u),m=new n(l[d],f.getLength()-1).mod(f);i[d]=new Array(f.getLength()-1);for(g=0;g<i[d].length;g++){var h=g+m.getLength()-i[d].length;i[d][g]=h>=0?m.get(h):0}}var p=0;for(g=0;g<t.length;g++)p+=t[g].totalCount;var x=new Array(p),b=0;for(g=0;g<s;g++)for(d=0;d<t.length;d++)g<l[d].length&&(x[b++]=l[d][g]);for(g=0;g<o;g++)for(d=0;d<t.length;d++)g<i[d].length&&(x[b++]=i[d][g]);return x},be=s}var De,Ce,Ie={};function Ee(){if(De)return Ie;De=1,Object.defineProperty(Ie,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},t=s(a()),r=N(),n=s(r);function s(e){return e&&e.__esModule?e:{default:e}}var o={bgColor:t.default.oneOfType([t.default.object,t.default.string]).isRequired,bgD:t.default.string.isRequired,fgColor:t.default.oneOfType([t.default.object,t.default.string]).isRequired,fgD:t.default.string.isRequired,size:t.default.number.isRequired,title:t.default.string,viewBoxSize:t.default.number.isRequired,xmlns:t.default.string},l=(0,r.forwardRef)(function(t,r){var a=t.bgColor,s=t.bgD,o=t.fgD,l=t.fgColor,i=t.size,d=t.title,c=t.viewBoxSize,u=t.xmlns,g=void 0===u?"http://www.w3.org/2000/svg":u,f=function(e,t){var r={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r}(t,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return n.default.createElement("svg",e({},f,{height:i,ref:r,viewBox:"0 0 "+c+" "+c,width:i,xmlns:g}),d?n.default.createElement("title",null,d):null,n.default.createElement("path",{d:s,fill:a}),n.default.createElement("path",{d:o,fill:l}))});return l.displayName="QRCodeSvg",l.propTypes=o,Ie.default=l,Ie}const Me=S(function(){if(Ce)return ve;Ce=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.QRCode=void 0;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},t=i(a()),r=i(we()),n=i(Se()),s=N(),o=i(s),l=i(Ee());function i(e){return e&&e.__esModule?e:{default:e}}var d={bgColor:t.default.oneOfType([t.default.object,t.default.string]),fgColor:t.default.oneOfType([t.default.object,t.default.string]),level:t.default.string,size:t.default.number,value:t.default.string.isRequired},c=(0,s.forwardRef)(function(t,a){var s=t.bgColor,i=void 0===s?"#FFFFFF":s,d=t.fgColor,c=void 0===d?"#000000":d,u=t.level,g=void 0===u?"L":u,f=t.size,m=void 0===f?256:f,h=t.value,p=function(e,t){var r={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r}(t,["bgColor","fgColor","level","size","value"]),x=new n.default(-1,r.default[g]);x.addData(h),x.make();var b=x.modules;return o.default.createElement(l.default,e({},p,{bgColor:i,bgD:b.map(function(e,t){return e.map(function(e,r){return e?"":"M "+r+" "+t+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:c,fgD:b.map(function(e,t){return e.map(function(e,r){return e?"M "+r+" "+t+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:a,size:m,viewBoxSize:b.length}))});return ve.QRCode=c,c.displayName="QRCode",c.propTypes=d,ve.default=c,ve}()),Te=({url:e="https://ted-sharp.github.io/aloe-wellness-log/",className:t=""})=>{const[a,n]=j.useState(!1),s=()=>n(!1);return r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>n(!0),className:`inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:ring-offset-2 transition-colors ${t}`,title:"QRコードを表示",children:[r.jsx(ee,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"QRコード"})]}),a&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.3)"},children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 m-4 max-w-sm w-full shadow-xl",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"QRコードを表示"}),r.jsx("button",{onClick:s,className:"bg-gray-200/80 dark:bg-gray-700/70 text-gray-400 dark:text-gray-300 hover:bg-gray-300/90 dark:hover:bg-gray-600/80 transition-colors rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":"閉じる",children:r.jsx(te,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[r.jsx("div",{className:"bg-white dark:bg-gray-700 p-4 rounded-lg shadow-inner border border-gray-200 dark:border-gray-600",children:r.jsx(Me,{value:e,size:200,style:{height:"auto",maxWidth:"100%",width:"100%"},viewBox:"0 0 256 256"})}),r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"QRコードをスキャン"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 break-all",children:e})]}),r.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e);const t=document.activeElement,r=t.textContent;t.textContent="コピーしました！",setTimeout(()=>{t.textContent=r},2e3)},className:"px-4 py-2 text-sm font-medium text-emerald-700 dark:text-emerald-300 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-700 rounded-md hover:bg-emerald-100 dark:hover:bg-emerald-900/30 focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:ring-offset-2 transition-colors",children:"URLをコピー"})]}),r.jsx("button",{onClick:s,className:"w-full mt-4 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 dark:focus:ring-gray-400 focus:ring-offset-2 transition-colors",children:"閉じる"})]})})]})},Re=({open:e,onClose:t,tipText:a})=>{const[n,s]=j.useState(!1);j.useEffect(()=>{s("1"===localStorage.getItem("disableTips"))},[e]);return e?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-2 sm:px-0 backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.3)"},onClick:t,children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 max-w-md w-full flex flex-col items-center",onClick:e=>e.stopPropagation(),children:[r.jsx("h2",{className:"text-xl font-bold mb-3 text-gray-800 dark:text-white",children:"本日のTIPS"}),r.jsx("div",{className:"text-gray-700 dark:text-gray-200 mb-6 text-left whitespace-pre-line",children:a}),r.jsxs("div",{className:"flex items-center mt-2",children:[r.jsx("input",{id:"modal-disable-tips-checkbox",type:"checkbox",className:"mr-2 w-5 h-5 accent-purple-600",checked:n,onChange:e=>{s(e.target.checked),localStorage.setItem("disableTips",e.target.checked?"1":"0")}}),r.jsx("label",{htmlFor:"modal-disable-tips-checkbox",className:"text-sm text-gray-800 dark:text-gray-200 select-none cursor-pointer",children:"今後TIPSを自動表示しない"})]})]})}):null},Oe=["夕食は寝る3時間前までに済ませましょう。 遅い時間の食事は空腹感を強め、消費カロリーを減らし、脂肪の蓄積を促す可能性があります。寝る直前の食事を避けることで、体脂肪の増加リスクを下げる効果が期待できます。","砂糖入り飲料は控えて水やお茶に置き換えましょう。 清涼飲料水やジュースなど甘い飲み物の摂取は体重増加や肥満と強く関連しており、日常的に水を飲む人は総摂取カロリーが約9%少ないとの報告があります。水や無糖のお茶で水分補給する習慣がダイエットに役立ちます。","食事の30分前にコップ1杯の水を飲みましょう。 食前に水を500ml程度飲むと満腹感が高まり、同じ食事制限でもより体重が減少しやすいことが研究で示されています。食事前の水分摂取は食べ過ぎ防止に効果的です。","食物繊維をたっぷり摂取しましょう。 野菜、果物、全粒穀物、豆類などに多く含まれる食物繊維は満腹感を持続させ、総カロリー摂取を抑える効果があります。食物繊維の摂取量が多い人ほど減量中の体重減少幅が大きく、ダイエットの継続率も高いと報告されています。","毎食にタンパク質を含めましょう。 肉・魚・卵・大豆製品・乳製品など良質なたんぱく質は、満腹ホルモンの分泌を促し、筋肉量を維持するのに役立ちます。高タンパク食は脂肪を減らしつつ筋肉の減少を抑えることで代謝低下を防ぎ、減量やリバウンド防止に有効とされています。","極端な食事抜きは避け、朝食を含め規則正しく食べましょう。 朝食を抜く習慣は肥満や生活習慣病のリスク増加と関連しており、朝食を全く食べない人は肥満になるリスクが高いとのメタ分析結果があります。一日3食バランスよく摂ることで過度な空腹を防ぎ、ドカ食いの予防につながります。","ゆっくり、よく噛んで食べましょう。 食事に20分以上かけてゆっくり噛むことで満腹シグナルが脳に伝わりやすくなり、結果として食事量を減らせます。実際に早食いの人はゆっくり食べる人より肥満になりやすい傾向があり、よく噛むことで摂取カロリーが約10～15%減少したとの研究もあります","「ながら食べ」をやめ、食事に集中しましょう。 テレビを見たりスマホを操作しながらの食事は、自分がどれだけ食べているか気づきにくくなり、食べ過ぎにつながります。研究でも、食事中のテレビ視聴はその後の食事での余分なカロリー摂取を増やすことが報告されています。","野菜やスープから先に手をつけましょう。 食事の最初にサラダや野菜スープなど低カロリー食品を摂ると、早い段階で満腹感が得られて食べ過ぎを防ぎやすくなります。ボリュームのある野菜から食べ始めることで、後に続く主菜や高カロリー食品の摂取量を自然に減らす効果が期待できます。","高カロリー食品は小皿に取り分けて食べましょう。 大きなお皿や袋から直接食べると適量を超えて摂取しがちです。小さい器に盛り付けることで見た目の満足感が得られ、実際に提供量を減らすと1日の総摂取カロリーが平均235kcal減少したという報告もあります。お菓子も小分け包装のものを選ぶなど工夫しましょう。","外食はメニュー選びと食べ方に工夫をしましょう。 外食時には揚げ物よりも焼き物・蒸し物を選ぶ、ソースやドレッシングは別添えにして必要な分だけ使う、主菜の一部を残すか持ち帰るなどの工夫でカロリーを大幅に減らせます。外食の頻度そのものも適度に抑えると、総摂取カロリー管理に役立ちます。","甘い物や好物も計画的に少量楽しみましょう。 大好きなスイーツなどを完全に我慢し続けるとストレスが溜まり暴食につながることがあります。例えば「週末に一度だけ少し食べる」などルールを決め、少量を味わって満足することで、長期的に見るとダイエットの継続に寄与します。","アルコールの摂取量に気をつけましょう。 アルコール飲料はカロリーが高いうえ食欲を刺激しがちです。飲む場合も頻度や量を控えめにし、糖分の多いカクテルより蒸留酒のソーダ割りや辛口ワインなど比較的低カロリーな選択をするといった工夫を心がけてください。","栄養密度の高い食品を選びましょう。 同じカロリーなら、ビタミン・ミネラルや食物繊維を多く含む食品（例えばポテトチップではなく果物やナッツ類）を選ぶことで、身体に必要な栄養を摂取しつつ満足感を得られます。栄養バランスの良い食事は空腹感を和らげ、間食の欲求を減らす効果があります。","加工度の低い「ホールフード」を中心に摂りましょう。 ケーキやスナック菓子、ファストフードなどの超加工食品ばかりの食事では、知らず知らずのうちにカロリー過多になり体重増加を招きやすいです。一方、未加工またはシンプルに調理した食品中心の食事に切り替えると自然と摂取カロリーが減り、体重減少につながることが示されています。食品選択の際は原材料のシンプルなものを優先しましょう。","中等度の有酸素運動を週150分以上目指しましょう。 ウォーキングや軽いジョギング、サイクリングなどの有酸素運動は、消費エネルギーを増やすだけでなく食欲や血糖コントロールの改善にも役立ちます。定期的な運動習慣を身につけることが長期的な体重管理成功の最良の予測因子の一つであることが知られています。","筋力トレーニングを週2～3回取り入れましょう。 抵抗運動（ウェイトトレーニングなど）は筋肉量の維持・増加に役立ち、基礎代謝の低下を防ぎます。減量中に筋トレを組み合わせると筋肉の減少が抑えられ、脂肪だけを効率的に減らすことにつながります。また筋力が向上し、引き締まった体づくりにも有効です。","日常生活でこまめに身体を動かす工夫をしましょう。 エレベーターではなく階段を使う、バス停や駅では一つ手前で降りて歩く、家事や掃除で体を動かすなど、日常の中で非運動性熱産生（NEAT）を増やすことが大切です。小さな積み重ねでも1日の消費カロリーを底上げし、脂肪が蓄積しにくい体質づくりに役立ちます。","長時間座りっぱなしを避けましょう。 デスクワークなどで何時間も座ったままでいるとエネルギー消費が低下しがちです。1時間に一度は立ち上がってストレッチをしたり数分歩いたりして、血行や代謝をリセットしましょう。こまめに姿勢を変える習慣が、体重増加の予防に繋がります。","自分が楽しめる運動を見つけましょう。 ランニングが苦手ならダンスや水泳、サイクリングなど他の有酸素運動を、ジム通いが続かないなら自宅でできるエクササイズや動画プログラムを試すなど、好きになれる身体活動を探してみてください。楽しいと感じる運動は習慣化しやすく、消費カロリーの継続的な増加に寄与します。","「ながら運動」で日常に活動量をプラスしましょう。 テレビを見ながらストレッチをする、電話しながら足踏みする、通勤時に一駅分歩くなど、日常生活の中に運動を組み込む工夫をします。忙しい人でも小さな運動を積み重ねることで、一日の総消費エネルギーを増やすことができます。","運動の頻度・強度は徐々に高めましょう。 運動習慣のない人がいきなりハードな運動を始めるとケガや挫折の原因になります。最初は軽い運動から始め、慣れてきたら少しずつ時間や強度を上げていきましょう。例えば最初は1回15分のウォーキングから開始し、徐々に30分に延ばすなど段階的に負荷を上げると安全かつ効果的です。","日々の歩数を記録し、目標設定しましょう。 スマホのアプリや万歩計を使って自分の平均歩数を把握し、少し高い目標歩数（例：プラス1000歩/日）を設定します。歩数目標を意識することで通勤や買い物で歩く機会を増やせて、結果的に消費カロリーアップに繋がります。","達成可能な減量目標を立てましょう。最初の目標は現在体重の5～10%減を目安にし、ペースは1週間あたり0.5～1kg減量程度が適切です。急激に体重を減らそうとすると筋肉まで落ちたりリバウンドしやすくなります。無理のない目標設定が長続きのコツです。","体重は定期的に測定しましょう。毎日または少なくとも週1回は同じ条件で体重を測り、記録します。頻繁な自己計測によって体重の変化に早く気づきやすくなり、週1回以上体重測定する人はそうでない人に比べ体重管理が良好であることが示されています。増加傾向にいち早く対処できるため、リバウンド防止にも有用です。","食事内容や活動量を記録する習慣をつけましょう。手書きの食事日記やスマホアプリで、毎日の食事・間食・運動を記録します。自分の行動を「見える化」する自己モニタリングは行動変容の中心的手法であり、記録を付ける人は付けない人より一貫して減量効果が高いことが報告されています。書き出すことで思わぬ過食に気づきやすくなり、改善に役立ちます。","十分な睡眠時間を確保しましょう。大人は1日7～9時間の睡眠が推奨されており、慢性的な睡眠不足は食欲ホルモンのバランスを崩し過食を招きやすくなります。実際、睡眠時間の短い人ほど太りやすい傾向があり、逆に適切な睡眠は減量中の空腹感を和らげ体重管理を助けます。毎晩規則的な睡眠リズムを心がけてください。","ストレスを上手に発散しましょう。慢性的なストレスはコルチゾールというホルモンの分泌を増やし、食欲増進や脂肪蓄積を招くことが分かっています。ストレスを感じたときは深呼吸やストレッチ、散歩、趣味の時間を持つなど食べ物以外の方法で発散する工夫をしましょう。ストレス解消はメンタルヘルスだけでなくダイエット成功にも重要です。","周囲のサポートを活用しましょう。家族や友人にダイエット宣言をして協力してもらったり、一緒に運動する仲間を見つけたりすると継続しやすくなります。社会的サポートは減量の成功率を高める強力な要因です。恥ずかしがらず周囲に目標を共有し、励まし合える環境を整えましょう。","「完璧主義」より「継続」を目指しましょう。時には計画通りにいかない日があっても落ち込みすぎず、すぐ気持ちを切り替えて軌道修正することが大切です。減量の過程では停滞期や体重の小さな増減は誰にでも起こります。一度の挫折で投げ出さず、長い目で良い習慣を積み重ねることが成功への近道です。","食べる以外の「ストレス解消法」を持ちましょう。悩んだり退屈したりしたときにお菓子に手が伸びてしまう人は、代わりにできる行動（音楽を聴く、日記を書く、短い散歩をする、人に話す等）をあらかじめ用意しておきます。ストレスによるやけ食いを防ぐには、食以外のコーピング手段を持つことが有効です。","空腹のサインに耳を傾けましょう。お腹が空いているときだけ食べ、満腹感を得たら残りは保存する習慣をつけます。「まだ食べられるけど満腹ではない（腹八分目）」段階で箸を置くよう意識することで、総摂取カロリーを減らすことができます。自分の身体の空腹・満腹信号を尊重することが大切です。","食事は決まった場所・環境でとりましょう。例えば「仕事中はデスクで食べず、ダイニングテーブルで食べる」「歩きながら物を食べない」などルールを決めます。食べることに集中できる環境を整えると満足感が高まり、知らぬ間の過剰摂取を防げます。","ご褒美は食べ物以外で設定しましょう。減量目標の達成や運動継続のご褒美に、服や本、マッサージなど自分の好きな非食物報酬を与えるとモチベーション維持に効果的です。「○kg減ったら新しい靴を買う」など具体的なご褒美プランを立てておくと、日々の努力の励みになります。","環境を整えて「つい食べ」を防ぎましょう。家ではお菓子やジャンクフードをテーブルの上など見える場所に置かないようにし、代わりにフルーツやナッツを置いておくといった工夫をします。人は目に付く食べ物につられて食べがちなので、視界に入るものをヘルシーな食品に変えることで自然と摂取カロリーを減らせます。","買い物は満腹時に計画的に行いましょう。空腹の状態でスーパーに行くと高カロリーのお菓子や出来合い食品を衝動買いしやすくなります。事前に購入リストを作り、食後に買い物に行くようにすることで不要な高カロリー食品の購入を減らせます。健康的な食材を常備しやすくなり、結果的にダイエットの助けとなります。","減量方法は「続けられるか」で判断しましょう。特定の食品だけに頼るダイエットや極端な短期集中減量法はリスクが高く、減った体重を維持できる人はごくわずか（1～3%程度）であるとされています。「明日も明後日も続けられる習慣か？」を基準に取り入れる方法を選びましょう。ダイエットは一過性の努力ではなく、生活習慣の改善として捉えることが成功の秘訣です。","停滞期も想定しておきましょう。減量を続けていると、ある程度体重が減ったところで体重がなかなか動かなくなる停滞期が訪れることがあります。これは身体が新しい状態に慣れ適応しているサインです。停滞期に入っても焦らず、今までの良い習慣を継続してください。必要に応じて食事内容や運動強度を見直しつつ、身体の変化を根気強く待ちましょう。","減量後も健康的な習慣を続けましょう。目標体重に到達した後こそ、リバウンド防止の正念場です。達成したからといって元の生活に戻すのではなく、取り入れた良い習慣（例えば定期的な運動や野菜中心の食事、体重測定など）はそのまま維持しましょう。減量期と維持期ではアプローチを多少調整しつつも、「習慣自体は一生続ける」つもりでいることが大切です。","ポジティブ思考を持ちましょう。体重の数値や見た目の変化ばかりにとらわれず、健康的な行動ができた自分を褒める習慣を持ってください。階段を上っただけでも「よくやった」と自分に声をかけ、小さな成功体験の積み重ねを意識します。前向きなマインドはストレスを減らし、長期的な減量の成功率を高めます。"];function Le(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M12 2.25a.75.75 0 0 1 .75.75v11.69l3.22-3.22a.75.75 0 1 1 1.06 1.06l-4.5 4.5a.75.75 0 0 1-1.06 0l-4.5-4.5a.75.75 0 1 1 1.06-1.06l3.22 3.22V3a.75.75 0 0 1 .75-.75Zm-9 13.5a.75.75 0 0 1 .75.75v2.25a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5V16.5a.75.75 0 0 1 1.5 0v2.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V16.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"},child:[]}]})(e)}function Ae(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"},child:[]}]})(e)}function $e(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M12.75 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM7.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM8.25 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM9.75 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM10.5 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM12.75 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM14.25 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z",clipRule:"evenodd"},child:[]}]})(e)}function Be(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6Zm4.5 7.5a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0v-2.25a.75.75 0 0 1 .75-.75Zm3.75-1.5a.75.75 0 0 0-1.5 0v4.5a.75.75 0 0 0 1.5 0V12Zm2.25-3a.75.75 0 0 1 .75.75v6.75a.75.75 0 0 1-1.5 0V9.75A.75.75 0 0 1 13.5 9Zm3.75-1.5a.75.75 0 0 0-1.5 0v9a.75.75 0 0 0 1.5 0v-9Z",clipRule:"evenodd"},child:[]}]})(e)}function _e(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"},child:[]}]})(e)}function Pe(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z",clipRule:"evenodd"},child:[]}]})(e)}function ze(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625Z"},child:[]},{tag:"path",attr:{d:"M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"},child:[]}]})(e)}function Fe(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"},child:[]}]})(e)}function He(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z"},child:[]},{tag:"path",attr:{d:"M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z"},child:[]},{tag:"path",attr:{d:"M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z"},child:[]}]})(e)}function We(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z",clipRule:"evenodd"},child:[]}]})(e)}function Ze(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"},child:[]}]})(e)}function Ve(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"m6.72 5.66 11.62 11.62A8.25 8.25 0 0 0 6.72 5.66Zm10.56 12.68L5.66 6.72a8.25 8.25 0 0 0 11.62 11.62ZM5.105 5.106c3.807-3.808 9.98-3.808 13.788 0 3.808 3.807 3.808 9.98 0 13.788-3.807 3.808-9.98 3.808-13.788 0-3.808-3.807-3.808-9.98 0-13.788Z",clipRule:"evenodd"},child:[]}]})(e)}function Ge(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32L19.513 8.2Z"},child:[]}]})(e)}function Ue(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"},child:[]}]})(e)}function qe(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M9 4.5a.75.75 0 0 1 .721.544l.813 2.846a3.75 3.75 0 0 0 2.576 2.576l2.846.813a.75.75 0 0 1 0 1.442l-2.846.813a3.75 3.75 0 0 0-2.576 2.576l-.813 2.846a.75.75 0 0 1-1.442 0l-.813-2.846a3.75 3.75 0 0 0-2.576-2.576l-2.846-.813a.75.75 0 0 1 0-1.442l2.846-.813A3.75 3.75 0 0 0 7.466 7.89l.813-2.846A.75.75 0 0 1 9 4.5ZM18 1.5a.75.75 0 0 1 .728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 0 1 0 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 0 1-1.456 0l-.258-1.036a2.625 2.625 0 0 0-1.91-1.91l-1.036-.258a.75.75 0 0 1 0-1.456l1.036-.258a2.625 2.625 0 0 0 1.91-1.91l.258-1.036A.75.75 0 0 1 18 1.5ZM16.5 15a.75.75 0 0 1 .712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 0 1 0 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 0 1-1.422 0l-.395-1.183a1.5 1.5 0 0 0-.948-.948l-1.183-.395a.75.75 0 0 1 0-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0 1 16.5 15Z",clipRule:"evenodd"},child:[]}]})(e)}function Ke(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z",clipRule:"evenodd"},child:[]}]})(e)}function Ye(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z",clipRule:"evenodd"},child:[]}]})(e)}function Xe(e){return O({attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"},child:[]}]})(e)}const Qe=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,Je=e=>`${e.getDate()}`,et=e=>["日","月","火","水","木","金","土"][e.getDay()],tt=({selectedDate:e,setSelectedDate:t,centerDate:a,setCenterDate:s,today:o=new Date,isRecorded:l})=>{const[i,d]=j.useState(!1),c=j.useRef(null),u=j.useRef(null),[g,f]=j.useState(()=>{const e=new Date(a);return e.setDate(a.getDate()-90),e}),[m,h]=j.useState(()=>{const e=new Date(a);return e.setDate(a.getDate()+90),e}),p=j.useRef(null),x=j.useRef(0),[b,y]=j.useState(!1);j.useEffect(()=>{y(!0)},[]);const v=((e,t)=>{const r=[],a=new Date(e);for(;a<=t;)r.push(new Date(a)),a.setDate(a.getDate()+1);return r})(g,m);return j.useEffect(()=>{const e=e=>{const t=u.current;t&&Math.abs(e.deltaY)>Math.abs(e.deltaX)&&(t.scrollLeft+=e.deltaY,e.preventDefault())},t=c.current,r=u.current;return t&&t.addEventListener("wheel",e,{passive:!1}),r&&r.addEventListener("wheel",e,{passive:!1}),()=>{t&&t.removeEventListener("wheel",e),r&&r.removeEventListener("wheel",e)}},[]),j.useEffect(()=>{const e=c.current;if(!e)return;let t=null,r=null;const n=e=>{const a=e.touches[0];t=a.clientX,r=a.clientY},o=e=>{if(null===t||null===r)return;const n=e.changedTouches[0],o=n.clientX-t,l=n.clientY-r;if(Math.abs(o)>Math.abs(l)&&Math.abs(o)>30){const e=64,t=Math.round(Math.abs(o)/e)||1,r=new Date(a);o<0?r.setDate(a.getDate()+t):r.setDate(a.getDate()-t),s(r)}t=null,r=null};return e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchend",o,{passive:!0}),()=>{e.removeEventListener("touchstart",n),e.removeEventListener("touchend",o)}},[a,s]),j.useEffect(()=>{const e=u.current;if(!e)return;const t=()=>{const{scrollLeft:t,scrollWidth:r,clientWidth:a}=e;t+a+60>=r&&(h(e=>{const t=new Date(e);return t.setDate(t.getDate()+30),t}),p.current="right",x.current=r),t<=60&&(f(e=>{const t=new Date(e);return t.setDate(t.getDate()-30),t}),p.current="left",x.current=r)};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)},[]),j.useEffect(()=>{a<g&&f(()=>{const e=new Date(a);return e.setDate(a.getDate()-90),e}),a>m&&h(()=>{const e=new Date(a);return e.setDate(a.getDate()+90),e})},[a,g,m]),j.useEffect(()=>{if(!b)return;const e=u.current;if(!e)return;let t=0;const r=()=>{const n=e.querySelector(`button[data-date='${Qe(a)}']`);if(n){const t=e.getBoundingClientRect(),r=n.getBoundingClientRect(),a=r.left+r.width/2-(t.left+t.width/2);e.scrollBy({left:a,behavior:"smooth"}),y(!1)}else t<10?(t++,setTimeout(r,30)):y(!1)};r()},[a,b]),j.useLayoutEffect(()=>{const e=u.current;if(!e)return;if(!p.current)return;const t=e.scrollWidth-x.current;"left"===p.current&&t>0&&(e.scrollLeft+=t),p.current=null},[g,m]),r.jsxs("div",{"data-testid":"date-picker",children:[r.jsxs("div",{ref:c,className:"w-full flex items-center justify-center pt-2 pb-2 bg-white/80 dark:bg-gray-900/80 shadow-md sticky top-0 z-10",children:[r.jsx("button",{type:"button",onClick:()=>d(!0),className:"ml-2 mr-1 flex items-center justify-center w-12 h-12 rounded-full border-2 border-blue-400 bg-white dark:bg-gray-800 hover:bg-blue-100 dark:hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"カレンダーを開く",children:r.jsx($e,{className:"w-7 h-7 text-blue-600 dark:text-blue-400"})}),r.jsxs("div",{ref:u,className:"flex-1 flex gap-1 mx-1 overflow-x-auto justify-center scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",scrollSnapType:"x mandatory",WebkitOverflowScrolling:"touch"},children:[r.jsx("style",{children:"\n            .scrollbar-hide::-webkit-scrollbar, .scrollbar-none::-webkit-scrollbar, .scrollbar-fake::-webkit-scrollbar {\n              display: none !important;\n            }\n          "}),v.map((n,s)=>{const i=Qe(n)===Qe(e),d=Qe(n)===Qe(o),c=s>0?v[s-1]:null,u=0===s||c&&n.getMonth()!==c.getMonth(),g=n.getDay(),f=0===g?"text-red-500":6===g?"text-blue-500":"",m=Qe(n)===Qe(a);return r.jsxs(D.Fragment,{children:[u&&r.jsxs("span",{className:"flex flex-col items-center justify-center min-w-14 w-14 max-w-14 h-14 px-0 py-0 m-1 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-300 text-xs font-bold select-none cursor-default border border-gray-300 dark:border-gray-600","aria-hidden":"true",style:{scrollSnapAlign:"center"},children:[n.getMonth()+1,"月"]}),r.jsxs("button",{"data-date-idx":s,"data-date":Qe(n),onClick:()=>{t(n)},className:`flex flex-col items-center justify-center min-w-12 w-12 max-w-12 h-12 px-0 py-0 mt-2 mb-2 rounded-full transition-colors duration-150 shadow-md\n                    ${i?"bg-blue-600 text-white shadow-lg scale-105 z-10":d?"bg-blue-100 text-blue-700":"bg-white text-gray-700 dark:bg-gray-800 dark:text-gray-200"}\n                    hover:bg-blue-200 dark:hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400\n                    ${m&&!i?"scale-105":""}`,style:{position:"relative",scrollSnapAlign:"center",border:"none"},"aria-current":i?"date":void 0,children:[r.jsx("span",{className:`text-xs font-medium ${f}`,children:et(n)}),r.jsx("span",{className:"text-lg font-bold",children:Je(n)}),l&&l(n)&&r.jsx("span",{className:"absolute top-2 right-2 w-1.5 h-1.5 rounded-full bg-green-500 border border-white dark:border-gray-800","aria-label":"記録済み"})]})]},Qe(n))})]})]}),i&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm",role:"dialog","aria-modal":"true",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl pt-8 p-4 sm:pt-10 sm:p-6 w-[95vw] max-w-md relative",onClick:e=>e.stopPropagation(),children:[r.jsx("button",{type:"button",onClick:()=>d(!1),className:"absolute top-0 right-0 m-2 text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 bg-transparent shadow-none border-none rounded-full transition-colors focus:outline-none hover:bg-gray-200/60 dark:hover:bg-white/10","aria-label":"閉じる",children:r.jsx("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",children:r.jsx("path",{stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6l12 12M6 18L18 6"})})}),r.jsx(n,{onChange:e=>{t(e),s(e),y(!0),d(!1)},value:e,locale:"ja-JP",className:"w-full",formatDay:(e,t)=>t.getDate().toString()})]})})]})},rt=!1,at={enableRenderTracking:!0,enableMemoryTracking:!0,enableInteractionTracking:!0,enableDatabaseTracking:!0,sampleRate:.1,reportInterval:3e4};const nt=new class{constructor(e=at){t(this,"metrics",[]),t(this,"maxMetrics",1e3),t(this,"config"),this.config=e}addMetric(e){Math.random()>this.config.sampleRate||(this.metrics.push({...e,timestamp:Date.now()}),this.metrics.length>this.maxMetrics&&(this.metrics=this.metrics.slice(-this.maxMetrics)))}getMetrics(){return[...this.metrics]}getAverageMetrics(e=3e5){const t=Date.now(),r=this.metrics.filter(r=>r.timestamp>t-e);if(0===r.length)return{};const a=r.reduce((e,t)=>({renderTime:e.renderTime+t.renderTime,componentCount:e.componentCount+t.componentCount,reRenderCount:e.reRenderCount+t.reRenderCount,loadTime:e.loadTime+t.loadTime,interactionToNext:e.interactionToNext+t.interactionToNext,inputDelay:e.inputDelay+t.inputDelay,dbOperationTime:e.dbOperationTime+t.dbOperationTime,recordCount:e.recordCount+t.recordCount}),{renderTime:0,componentCount:0,reRenderCount:0,loadTime:0,interactionToNext:0,inputDelay:0,dbOperationTime:0,recordCount:0}),n=r.length;return{renderTime:a.renderTime/n,componentCount:a.componentCount/n,reRenderCount:a.reRenderCount/n,loadTime:a.loadTime/n,interactionToNext:a.interactionToNext/n,inputDelay:a.inputDelay/n,dbOperationTime:a.dbOperationTime/n,recordCount:a.recordCount/n}}clearMetrics(){this.metrics=[]}};class st{constructor(){t(this,"renderStartTimes",new Map),t(this,"componentCounts",new Map),t(this,"reRenderCounts",new Map)}startRender(e){}endRender(e){}trackReRender(e,t){}getStats(){const e={};for(const[t,r]of this.componentCounts)e[t]={count:r,reRenders:this.reRenderCounts.get(t)||0};return e}clearStats(){this.renderStartTimes.clear(),this.componentCounts.clear(),this.reRenderCounts.clear()}}class ot{constructor(){t(this,"lastMemoryCheck",0),t(this,"memoryCheckInterval",5e3)}getCurrentMemoryUsage(){try{if("undefined"!=typeof performance&&"memory"in performance){const e=performance.memory;if(e)return{used:Math.round(e.usedJSHeapSize/1024/1024),total:Math.round(e.totalJSHeapSize/1024/1024),limit:Math.round(e.jsHeapSizeLimit/1024/1024)}}}catch(e){}return null}checkMemoryUsage(){const e=Date.now();if(e-this.lastMemoryCheck<this.memoryCheckInterval)return;this.lastMemoryCheck=e;const t=this.getCurrentMemoryUsage();if(t){const e=t.used/t.limit*100;e>80&&(t.used,e.toFixed(1))}}startMemoryMonitoring(){}}class lt{constructor(){t(this,"operationStartTimes",new Map)}startOperation(e,t){this.operationStartTimes.set(e,performance.now())}endOperation(e,t,r){const a=this.operationStartTimes.get(e);if(a){const t=performance.now()-a;return this.operationStartTimes.delete(e),t>100&&t.toFixed(2),t.toFixed(2),t}return 0}}class it{constructor(){t(this,"interactionStartTimes",new Map)}startInteraction(e){const t=`${e}-${Date.now()}`;return this.interactionStartTimes.set(t,performance.now()),t}endInteraction(e,t){const r=this.interactionStartTimes.get(e);if(r){const t=performance.now()-r;return this.interactionStartTimes.delete(e),t>100&&t.toFixed(2),t.toFixed(2),t}return 0}}const dt=new class{constructor(e=at){t(this,"renderTracker",new st),t(this,"memoryTracker",new ot),t(this,"dbTracker",new lt),t(this,"interactionTracker",new it),t(this,"config"),t(this,"reportingInterval"),t(this,"trackRender",{start:e=>{this.config.enableRenderTracking&&this.renderTracker.startRender(e)},end:e=>{this.config.enableRenderTracking&&this.renderTracker.endRender(e)},reRender:(e,t)=>{this.config.enableRenderTracking&&this.renderTracker.trackReRender(e,t)}}),t(this,"trackDatabase",{start:(e,t)=>{this.config.enableDatabaseTracking&&this.dbTracker.startOperation(e,t)},end:(e,t,r)=>this.config.enableDatabaseTracking?this.dbTracker.endOperation(e,t,r):0}),t(this,"trackInteraction",{start:e=>this.config.enableInteractionTracking?this.interactionTracker.startInteraction(e):"",end:(e,t)=>this.config.enableInteractionTracking?this.interactionTracker.endInteraction(e,t):0}),this.config=e}startMonitoring(){this.config.enableMemoryTracking&&this.memoryTracker.startMemoryMonitoring()}stopMonitoring(){this.reportingInterval&&(clearInterval(this.reportingInterval),this.reportingInterval=void 0)}getMetrics(){return nt.getMetrics()}clearMetrics(){nt.clearMetrics(),this.renderTracker.clearStats()}updateConfig(e){this.config={...this.config,...e}}};function ct(e){const t=[];if("object"!=typeof e||null===e)return t.push("レコードデータが無効です"),{isValid:!1,errors:t};const r=e;var a;return"string"==typeof r.id&&0!==r.id.length||t.push("IDが無効です"),"string"==typeof r.date&&function(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const t=new Date(e);return!isNaN(t.getTime())&&t.toISOString().slice(0,10)===e}(r.date)||t.push("日付形式が無効です (YYYY-MM-DD)"),"string"==typeof r.time&&(a=r.time,/^([01]\d|2[0-3]):([0-5]\d)$/.test(a))||t.push("時刻形式が無効です (HH:mm)"),"string"==typeof r.datetime&&0!==r.datetime.length||t.push("日時が無効です"),"string"==typeof r.fieldId&&0!==r.fieldId.length||t.push("フィールドIDが無効です"),void 0===r.value?t.push("値が設定されていません"):"number"!=typeof r.value&&"string"!=typeof r.value&&"boolean"!=typeof r.value&&t.push("値の型が無効です"),{isValid:0===t.length,data:0===t.length?r:void 0,errors:t}}const ut="records",gt="fields",ft="goal";var mt=(e=>(e.CONNECTION_FAILED="connection_failed",e.TRANSACTION_FAILED="transaction_failed",e.DATA_CORRUPTED="data_corrupted",e.QUOTA_EXCEEDED="quota_exceeded",e.VERSION_ERROR="version_error",e.UNKNOWN="unknown",e))(mt||{});class ht extends Error{constructor(e,t,r,a=!0){super(t),this.type=e,this.originalError=r,this.retryable=a,this.name="DbError"}}async function pt(e,t,r){const a=`${e}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;dt.trackDatabase.start(a,e);try{const n=await t();dt.trackDatabase.end(a,e,r);return n}catch(n){throw dt.trackDatabase.end(a,e,r),n}}function xt(e){if(e instanceof ht)return e;if(e instanceof DOMException)switch(e.name){case"QuotaExceededError":return new ht("quota_exceeded","ストレージ容量が不足しています",e,!1);case"VersionError":return new ht("version_error","データベースのバージョンが競合しています",e,!1);case"InvalidStateError":case"TransactionInactiveError":return new ht("transaction_failed","データベーストランザクションが失敗しました",e);case"DataError":case"ConstraintError":return new ht("data_corrupted","データが破損しているか、制約違反です",e,!1);default:return new ht("unknown",`データベースエラー: ${e.message}`,e)}return new ht("connection_failed","データベース接続に失敗しました",e)}async function bt(e,t=3,r=1e3){let a;for(let s=1;s<=t;s++)try{return await e()}catch(n){if(a=xt(n),!a.retryable)throw a;if(s===t)throw a;await new Promise(e=>setTimeout(e,r*s))}throw a}function yt(e){const t=function(e){const t=[],r=[];return e.forEach((e,a)=>{const n=ct(e);n.isValid&&n.data?r.push(n.data):t.push(`レコード[${a}]: ${n.errors.join(", ")}`)}),{isValid:0===t.length,data:r,errors:t}}(e);return t.isValid||t.errors,t.data||[]}async function vt(e,t,r){return bt(async()=>{const a=await bt(()=>new Promise((e,t)=>{try{const r=indexedDB.open("aloe-wellness-log",3);r.onupgradeneeded=()=>{const e=r.result;if(!e.objectStoreNames.contains(ut)){const t=e.createObjectStore(ut,{keyPath:"id"});t.createIndex("dateIndex","date",{unique:!1}),t.createIndex("fieldIdIndex","fieldId",{unique:!1}),t.createIndex("scopeIndex","scope",{unique:!1})}e.objectStoreNames.contains(gt)||e.createObjectStore(gt,{keyPath:"fieldId"}).createIndex("orderIndex","order",{unique:!1}),e.objectStoreNames.contains(ft)||e.createObjectStore(ft,{keyPath:"id"})},r.onsuccess=()=>{const t=r.result;t.onerror=e=>{console.error("Database error:",e)},t.onclose=()=>{},e(t)},r.onerror=()=>{t(new ht("connection_failed","データベースを開けませんでした",r.error))},r.onblocked=()=>{t(new ht("connection_failed","データベースが他のタブによってブロックされています",void 0,!1))}}catch(r){t(xt(r))}}));return new Promise((n,s)=>{try{const o=a.transaction(e,t),l=setTimeout(()=>{o.abort(),s(new ht("transaction_failed","トランザクションがタイムアウトしました"))},3e4);o.oncomplete=()=>{clearTimeout(l)},o.onerror=()=>{clearTimeout(l),s(xt(o.error))},o.onabort=()=>{clearTimeout(l),s(new ht("transaction_failed","トランザクションが中断されました"))};const i=Array.isArray(e)?e.map(e=>o.objectStore(e)):o.objectStore(e);r(o,i).then(n).catch(s)}catch(o){s(xt(o))}})})}async function wt(){return pt("get-all-fields",async()=>vt(gt,"readonly",async(e,t)=>{const r=t;return new Promise((e,t)=>{const a=r.getAll();a.onsuccess=()=>{const t=a.result;if(Array.isArray(t)){const r=function(e){const t=function(e){const t=[],r=[];return e.forEach((e,a)=>{const n=function(e){const t=[];if("object"!=typeof e||null===e)return t.push("フィールドデータが無効です"),{isValid:!1,errors:t};const r=e;if("string"==typeof r.fieldId&&0!==r.fieldId.length||t.push("フィールドIDが無効です"),"string"==typeof r.name&&0!==r.name.length||t.push("フィールド名が無効です"),"string"==typeof r.type&&["number","string","boolean"].includes(r.type)||t.push("フィールドタイプが無効です"),void 0!==r.unit&&"string"!=typeof r.unit&&t.push("単位が無効です"),void 0!==r.order&&"number"!=typeof r.order&&t.push("表示順序が無効です"),void 0!==r.defaultDisplay&&"boolean"!=typeof r.defaultDisplay&&t.push("デフォルト表示設定が無効です"),void 0!==r.default&&"string"==typeof r.type)switch(r.type){case"number":"number"!=typeof r.default&&t.push("デフォルト値が数値型と一致しません");break;case"string":"string"!=typeof r.default&&t.push("デフォルト値が文字列型と一致しません");break;case"boolean":"boolean"!=typeof r.default&&t.push("デフォルト値がブール型と一致しません")}return{isValid:0===t.length,data:0===t.length?r:void 0,errors:t}}(e);n.isValid&&n.data?r.push(n.data):t.push(`フィールド[${a}]: ${n.errors.join(", ")}`)}),{isValid:0===t.length,data:r,errors:t}}(e);return t.isValid||t.errors,t.data||[]}(t);e(r)}else e([])},a.onerror=()=>t(xt(a.error))})}))}async function kt(e){return pt("batch-update-fields",async()=>vt(gt,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{let n=0;const s=e.length;if(0===s)return void t();const o=()=>{n++,n===s&&t()};for(const l of e){const e=a.put(l);e.onsuccess=o,e.onerror=()=>r(xt(e.error))}})}),e.length)}const jt=[{fieldId:"weight",unit:"kg",type:"number",order:1,defaultDisplay:!0,scope:"weight"},{fieldId:"body_fat",unit:"%",type:"number",order:1.5,defaultDisplay:!1,scope:"weight"},{fieldId:"systolic_bp",unit:"mmHg",type:"number",order:1,defaultDisplay:!0,scope:"bp"},{fieldId:"diastolic_bp",unit:"mmHg",type:"number",order:2,defaultDisplay:!0,scope:"bp"},{fieldId:"heart_rate",unit:"bpm",type:"number",order:4,defaultDisplay:!1,scope:"bp"},{fieldId:"body_temperature",unit:"℃",type:"number",order:5,defaultDisplay:!1,scope:"bp"},{fieldId:"exercise",name:"運動🏃‍♂️",type:"boolean",order:6,defaultDisplay:!0,scope:"daily"},{fieldId:"meal",name:"食事🍽",type:"boolean",order:7,defaultDisplay:!0,scope:"daily"},{fieldId:"sleep",name:"睡眠🛌",type:"boolean",order:8,defaultDisplay:!0,scope:"daily"},{fieldId:"smoke",type:"boolean",order:9,defaultDisplay:!1,scope:"daily"},{fieldId:"alcohol",type:"boolean",order:10,defaultDisplay:!1,scope:"daily"}],Nt=[{fieldId:"weight",name:"体重",unit:"kg",type:"number",order:1,defaultDisplay:!0,scope:"weight"},{fieldId:"body_fat",name:"体脂肪",unit:"%",type:"number",order:1.5,defaultDisplay:!1,scope:"weight"},{fieldId:"systolic_bp",name:"最高血圧",unit:"mmHg",type:"number",order:1,defaultDisplay:!0,scope:"bp"},{fieldId:"diastolic_bp",name:"最低血圧",unit:"mmHg",type:"number",order:2,defaultDisplay:!0,scope:"bp"},{fieldId:"heart_rate",name:"心拍数",unit:"bpm",type:"number",order:4,defaultDisplay:!1,scope:"bp"},{fieldId:"body_temperature",name:"体温",unit:"℃",type:"number",order:5,defaultDisplay:!1,scope:"bp"},{fieldId:"exercise",name:"運動",type:"boolean",order:6,defaultDisplay:!0,scope:"daily"},{fieldId:"meal",name:"食事",type:"boolean",order:7,defaultDisplay:!0,scope:"daily"},{fieldId:"sleep",name:"睡眠",type:"boolean",order:8,defaultDisplay:!0,scope:"daily"},{fieldId:"smoke",name:"喫煙",type:"boolean",order:9,defaultDisplay:!1,scope:"daily"},{fieldId:"alcohol",name:"飲酒",type:"boolean",order:10,defaultDisplay:!1,scope:"daily"}],St=Z((e,t)=>({records:[],fields:[],recordsOperation:{loading:!1,error:null},fieldsOperation:{loading:!1,error:null},clearRecordsError:()=>{e(e=>({recordsOperation:{...e.recordsOperation,error:null}}))},clearFieldsError:()=>{e(e=>({fieldsOperation:{...e.fieldsOperation,error:null}}))},loadRecords:async()=>{e(e=>({recordsOperation:{loading:!0,error:null}}));try{const t=await async function(){return pt("get-all-records",async()=>vt(ut,"readonly",async(e,t)=>{const r=t;return new Promise((e,t)=>{const a=r.getAll();a.onsuccess=()=>{const t=a.result;if(Array.isArray(t)){const r=yt(t);e(r)}else e([])},a.onerror=()=>t(xt(a.error))})}))}();e({records:t,recordsOperation:{loading:!1,error:null}})}catch(t){const r=t instanceof ht?t:new ht(mt.UNKNOWN,"レコード読み込みに失敗しました",t);throw e(e=>({recordsOperation:{loading:!1,error:r}})),r}},addRecord:async t=>{e(e=>({records:[...e.records,t],recordsOperation:{loading:!0,error:null}}));try{await async function(e){return pt("add-record",async()=>vt(ut,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{const n=a.put(e);n.onsuccess=()=>t(),n.onerror=()=>r(xt(n.error))})}),1)}(t),e(e=>({recordsOperation:{loading:!1,error:null}}))}catch(r){throw e(e=>({records:e.records.filter(e=>e.id!==t.id),recordsOperation:{loading:!1,error:r instanceof ht?r:new ht(mt.UNKNOWN,"レコード追加に失敗しました",r)}})),r}},loadFields:async()=>{e(e=>({fieldsOperation:{loading:!0,error:null}}));try{let t=await wt(),r=!1;const a={weight:1,body_fat:1.5,systolic_bp:1,diastolic_bp:2,heart_rate:4,body_temperature:5,exercise:6,meal:7,sleep:8,smoke:9,alcohol:10},n={weight:!0,body_fat:!1,systolic_bp:!0,diastolic_bp:!0,heart_rate:!1,body_temperature:!1,exercise:!0,meal:!0,sleep:!0,smoke:!1,alcohol:!1},s=t.map(e=>{const t={...e};if(void 0===e.order){const n=a[e.fieldId];r=!0,t.order=n||999}if(void 0===e.defaultDisplay){r=!0;const a=n[e.fieldId];t.defaultDisplay=void 0===a||a}return t});r&&(await kt(s),t=s),e({fields:t,fieldsOperation:{loading:!1,error:null}})}catch(t){const r=t instanceof ht?t:new ht(mt.UNKNOWN,"フィールド読み込みに失敗しました",t);throw e(e=>({fieldsOperation:{loading:!1,error:r}})),r}},addField:async t=>{e(e=>({fields:[...e.fields,t],fieldsOperation:{loading:!0,error:null}}));try{await async function(e){return pt("add-field",async()=>vt(gt,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{const n=a.put(e);n.onsuccess=()=>t(),n.onerror=()=>r(xt(n.error))})}),1)}(t),e(e=>({fieldsOperation:{loading:!1,error:null}}))}catch(r){throw e(e=>({fields:e.fields.filter(e=>e.fieldId!==t.fieldId),fieldsOperation:{loading:!1,error:r instanceof ht?r:new ht(mt.UNKNOWN,"フィールド追加に失敗しました",r)}})),r}},initializeFields:async()=>{0===(await wt()).length&&(await kt(Nt),e({fields:Nt}))},initializeFieldsWithTranslation:async t=>{e(e=>({fieldsOperation:{loading:!0,error:null}}));try{const r=await wt();if(0===r.length){const r=jt.map(e=>({...e,name:t(e.fieldId)}));await kt(r),e({fields:r,fieldsOperation:{loading:!1,error:null}})}else e({fields:r,fieldsOperation:{loading:!1,error:null}})}catch(r){const t=r instanceof ht?r:new ht(mt.UNKNOWN,"フィールド初期化に失敗しました",r);throw e(e=>({fieldsOperation:{loading:!1,error:t}})),t}},updateField:async r=>{const a=t().fields;e(e=>({fields:e.fields.map(e=>e.fieldId===r.fieldId?r:e),fieldsOperation:{loading:!0,error:null}}));try{await async function(e){return pt("update-field",async()=>vt(gt,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{const n=a.put(e);n.onsuccess=()=>t(),n.onerror=()=>r(xt(n.error))})}),1)}(r),e(e=>({fieldsOperation:{loading:!1,error:null}}))}catch(n){throw e({fields:a,fieldsOperation:{loading:!1,error:n instanceof ht?n:new ht(mt.UNKNOWN,"フィールド更新に失敗しました",n)}}),n}},updateRecord:async r=>{const a=t().records;e(e=>({records:e.records.map(e=>e.id===r.id?r:e),recordsOperation:{loading:!0,error:null}}));try{await async function(e){return pt("update-record",async()=>vt(ut,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{const n=a.put(e);n.onsuccess=()=>t(),n.onerror=()=>r(xt(n.error))})}),1)}(r),e(e=>({recordsOperation:{loading:!1,error:null}}))}catch(n){throw e({records:a,recordsOperation:{loading:!1,error:n instanceof ht?n:new ht(mt.UNKNOWN,"レコード更新に失敗しました",n)}}),n}},deleteRecord:async r=>{const a=t().records,n=a.find(e=>e.id===r);e(e=>({records:e.records.filter(e=>e.id!==r),recordsOperation:{loading:!0,error:null}}));try{await async function(e){return pt("delete-record",async()=>vt(ut,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{const n=a.delete(e);n.onsuccess=()=>t(),n.onerror=()=>r(xt(n.error))})}),1)}(r),e(e=>({recordsOperation:{loading:!1,error:null}}))}catch(s){throw e({records:n?[...a]:a,recordsOperation:{loading:!1,error:s instanceof ht?s:new ht(mt.UNKNOWN,"レコード削除に失敗しました",s)}}),s}},deleteField:async r=>{const a=t().fields,n=a.find(e=>e.fieldId===r);e(e=>({fields:e.fields.filter(e=>e.fieldId!==r),fieldsOperation:{loading:!0,error:null}}));try{await async function(e){return pt("delete-field",async()=>vt(gt,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{const n=a.delete(e);n.onsuccess=()=>t(),n.onerror=()=>r(xt(n.error))})}),1)}(r),e(e=>({fieldsOperation:{loading:!1,error:null}}))}catch(s){throw e({fields:n?[...a]:a,fieldsOperation:{loading:!1,error:s instanceof ht?s:new ht(mt.UNKNOWN,"フィールド削除に失敗しました",s)}}),s}},deleteAllRecords:async()=>{const r=t().records;e({records:[],recordsOperation:{loading:!0,error:null}});try{await async function(){return pt("delete-all-records",async()=>vt(ut,"readwrite",async(e,t)=>{const r=t;return new Promise((e,t)=>{const a=r.clear();a.onsuccess=()=>e(),a.onerror=()=>t(xt(a.error))})}))}(),e(e=>({recordsOperation:{loading:!1,error:null}}))}catch(a){throw e({records:r,recordsOperation:{loading:!1,error:a instanceof ht?a:new ht(mt.UNKNOWN,"全レコード削除に失敗しました",a)}}),a}},deleteAllFields:async()=>{const r=t().fields;e({fields:[],fieldsOperation:{loading:!0,error:null}});try{await async function(){return pt("delete-all-fields",async()=>vt(gt,"readwrite",async(e,t)=>{const r=t;return new Promise((e,t)=>{const a=r.clear();a.onsuccess=()=>e(),a.onerror=()=>t(xt(a.error))})}))}(),e(e=>({fieldsOperation:{loading:!1,error:null}}))}catch(a){throw e({fields:r,fieldsOperation:{loading:!1,error:a instanceof ht?a:new ht(mt.UNKNOWN,"全フィールド削除に失敗しました",a)}}),a}},deleteAllData:async()=>{const r=t().records,a=t().fields;e({records:[],fields:[],recordsOperation:{loading:!0,error:null},fieldsOperation:{loading:!0,error:null}});try{await async function(){return pt("delete-all-data",async()=>vt([ut,gt],"readwrite",async(e,t)=>{const[r,a]=t;return new Promise((e,t)=>{let n=0;const s=()=>{n++,2===n&&e()},o=r.clear();o.onsuccess=s,o.onerror=()=>t(xt(o.error));const l=a.clear();l.onsuccess=s,l.onerror=()=>t(xt(l.error))})}))}(),e({recordsOperation:{loading:!1,error:null},fieldsOperation:{loading:!1,error:null}})}catch(n){const t=n instanceof ht?n:new ht(mt.UNKNOWN,"全データ削除に失敗しました",n);throw e({records:r,fields:a,recordsOperation:{loading:!1,error:t},fieldsOperation:{loading:!1,error:t}}),n}},batchUpdateRecords:async r=>{const a=t().records,n=new Map(a.map(e=>[e.id,e]));r.forEach(e=>{n.set(e.id,e)}),e({records:Array.from(n.values()),recordsOperation:{loading:!0,error:null}});try{await async function(e){return pt("batch-update-records",async()=>vt(ut,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{let n=0;const s=e.length;if(0===s)return void t();const o=()=>{n++,n===s&&t()};for(const l of e){const e=a.put(l);e.onsuccess=o,e.onerror=()=>r(xt(e.error))}})}),e.length)}(r),e(e=>({recordsOperation:{loading:!1,error:null}}))}catch(s){throw e({records:a,recordsOperation:{loading:!1,error:s instanceof ht?s:new ht(mt.UNKNOWN,"バッチレコード更新に失敗しました",s)}}),s}},batchUpdateFields:async r=>{const a=t().fields,n=new Map(a.map(e=>[e.fieldId,e]));r.forEach(e=>{n.set(e.fieldId,e)}),e({fields:Array.from(n.values()),fieldsOperation:{loading:!0,error:null}});try{await kt(r),e(e=>({fieldsOperation:{loading:!1,error:null}}))}catch(s){throw e({fields:a,fieldsOperation:{loading:!1,error:s instanceof ht?s:new ht(mt.UNKNOWN,"バッチフィールド更新に失敗しました",s)}}),s}}})),Dt=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,Ct=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`,It="shared_selected_date",Et=()=>{const e=new Date,[t,a]=j.useState(()=>{const t=localStorage.getItem(It);return t?new Date(t):e}),[n,s]=j.useState(()=>{const t=localStorage.getItem(It);return t?new Date(t):e}),{fields:o,addRecord:l,updateRecord:i,deleteRecord:d,records:c,addField:u,loadRecords:g,deleteField:f,updateField:m,loadFields:h}=St(),[p,x]=j.useState(!1),[b,y]=j.useState(""),[v,w]=j.useState(""),[k,N]=j.useState(""),[S,C]=j.useState(!1),I=j.useMemo(()=>S?o.filter(e=>"number"===e.type&&"bp"===e.scope).slice().sort((e,t)=>e.order!==t.order?(e.order??0)-(t.order??0):e.fieldId.localeCompare(t.fieldId)):o.filter(e=>"number"===e.type&&"bp"===e.scope&&e.defaultDisplay).slice().sort((e,t)=>e.order!==t.order?(e.order??0)-(t.order??0):e.fieldId.localeCompare(t.fieldId)),[o,S]),[E,M]=j.useState(()=>I.map(e=>({...e}))),[T,R]=j.useState(()=>I.map(e=>e.fieldId)),[O,Z]=j.useState([]),V=L(A(W)),G=Dt(n),U=(q=n,`${String(q.getHours()).padStart(2,"0")}:${String(q.getMinutes()).padStart(2,"0")}`);var q;const K=e=>c.find(t=>t.fieldId===e&&t.date===G),[Y,X]=j.useState({});j.useEffect(()=>{const e={};I.forEach(t=>{const r=K(t.fieldId);e[t.fieldId]=r?String(r.value):""}),X(e)},[o,S,c,G,I]);const J=async e=>{const t=Y[e];if(!t)return;const r=Number(t);if(isNaN(r))return;const a=K(e);if(a)await i({...a,value:r});else{const t=new Date;await l({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fieldId:e,value:r,date:G,time:U,datetime:Ct(t)})}await g()},ee=async e=>{const t=K(e);t&&(await d(t.id),await g())};j.useEffect(()=>{if(S){const e=o.filter(e=>"number"===e.type&&"bp"===e.scope).slice().sort((e,t)=>e.order!==t.order?(e.order??0)-(t.order??0):e.fieldId.localeCompare(t.fieldId));M(e.map(e=>({...e}))),R(e.map(e=>e.fieldId)),Z([])}},[S,o]);const[te,re]=j.useState(null),ae=j.useRef({}),ne=j.useRef({});j.useEffect(()=>{if(!te)return;const e=ae.current[te];if(e){const t=ne.current[te]??{start:e.value.length,end:e.value.length};e.setSelectionRange(t.start,t.end)}},[te]);const se=D.memo(function({field:e,isEditing:t,onStartEdit:a,onEndEdit:n,onNameChange:s,onUnitChange:o,onDelete:l,onToggleDisplay:i,inputRef:d,unitInputRef:c}){const{attributes:u,listeners:g,setNodeRef:f,transform:m,transition:h,isDragging:p}=$({id:e.fieldId}),x={...p?{transform:B.Transform.toString(m),transition:h}:{},opacity:p?.5:1,background:p?"#f3f4f6":void 0},[b,y]=D.useState(e.name),[v,w]=D.useState(e.unit||"");return D.useEffect(()=>{t&&(y(e.name),w(e.unit||""))},[t,e.name,e.unit]),r.jsxs("div",{ref:f,style:x,className:"flex items-center gap-2 rounded-xl shadow p-4 mb-2 transition-colors "+(!1===e.defaultDisplay?"bg-gray-100 dark:bg-gray-700 text-gray-400":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"),children:[t?r.jsxs(r.Fragment,{children:[r.jsx("input",{ref:d,type:"text",value:b,onChange:t=>{y(t.target.value);const r=t.target.selectionStart??t.target.value.length,a=t.target.selectionEnd??t.target.value.length;ne.current[e.fieldId]={start:r,end:a}},onSelect:t=>{const r=t.target;ne.current[e.fieldId]={start:r.selectionStart??r.value.length,end:r.selectionEnd??r.value.length}},onBlur:()=>{s(b),n()},onKeyDown:e=>{"Enter"===e.key&&(s(b),n())},className:"flex-1 border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg font-semibold min-w-[5em] bg-inherit "+(!1===e.defaultDisplay?"border-gray-200 dark:border-gray-600 text-gray-400 bg-gray-50 dark:bg-gray-800":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200")}),r.jsx("input",{ref:c,type:"text",value:v,onChange:e=>w(e.target.value),onBlur:()=>o(v),placeholder:"単位",className:"w-20 border rounded-lg px-2 py-2 ml-2 focus:outline-none focus:ring-2 focus:ring-blue-400 text-base bg-inherit border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"flex-1 text-lg font-semibold min-w-[5em] cursor-pointer",onClick:a,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||a()},role:"button","aria-label":"項目名を編集",tabIndex:0,children:e.name}),e.unit&&r.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-300 whitespace-nowrap",children:e.unit})]}),r.jsx("button",{type:"button",onClick:()=>{window.confirm("本当に削除しますか？\n（保存すると確定されます。）")&&l()},className:"text-red-500 hover:text-red-700 p-2","aria-label":"削除",children:r.jsx(Ke,{className:"w-6 h-6"})}),r.jsx("button",{type:"button",onClick:i,className:"p-2 "+(!1===e.defaultDisplay?"text-gray-400 hover:text-blue-400":"text-blue-500 hover:text-blue-700"),"aria-label":!1===e.defaultDisplay?"表示項目にする":"非表示項目にする",children:!1===e.defaultDisplay?r.jsx(He,{className:"w-6 h-6"}):r.jsx(We,{className:"w-6 h-6"})}),r.jsx("span",{className:"cursor-move p-2","aria-label":"並び替えハンドル",style:{touchAction:"none"},...u,...g,tabIndex:0,children:r.jsx(Ae,{className:"w-6 h-6 text-gray-400"})})]})}),oe=j.useCallback(e=>{Z(t=>[...t,e]),M(t=>t.filter(t=>t.fieldId!==e))},[]),le=j.useCallback(e=>{M(t=>t.map(t=>t.fieldId===e?{...t,defaultDisplay:!t.defaultDisplay}:t))},[]),ie=e=>c.some(t=>t.date===Dt(e)&&I.some(e=>e.fieldId===t.fieldId));return j.useEffect(()=>{localStorage.setItem(It,n.toISOString())},[n]),r.jsxs("div",{className:"bg-transparent",children:[r.jsx(tt,{"data-testid":"date-picker",selectedDate:n,setSelectedDate:s,centerDate:t,setCenterDate:a,isRecorded:ie}),r.jsx("div",{className:"w-full max-w-md mx-auto mt-3 mb-3 flex justify-start pl-4",children:r.jsxs("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:[Dt(n),ie(n)&&r.jsx(Pe,{className:"inline-block w-6 h-6 text-green-500 ml-2 align-middle","aria-label":"入力済み"})]})}),r.jsxs("div",{className:"flex flex-col items-center justify-start min-h-[60vh]",children:[r.jsx("div",{className:"flex flex-col gap-6 w-full max-w-md",children:S?r.jsx(_,{sensors:V,collisionDetection:P,onDragEnd:e=>{const{active:t,over:r}=e;if(!r)return;const a=String(t.id),n=String(r.id);if(a!==n){const e=T.indexOf(a),t=T.indexOf(n);R(H(T,e,t))}},children:r.jsx(z,{items:T,strategy:F,children:T.map(e=>{const t=E.find(t=>t.fieldId===e);if(!t)return null;const a=te===t.fieldId;return r.jsx(se,{field:t,isEditing:a,onStartEdit:()=>re(t.fieldId),onEndEdit:()=>re(null),onNameChange:e=>M(r=>r.map(r=>r.fieldId===t.fieldId?{...r,name:e}:r)),onUnitChange:e=>M(r=>r.map(r=>r.fieldId===t.fieldId?{...r,unit:e}:r)),onDelete:()=>oe(t.fieldId),onToggleDisplay:()=>le(t.fieldId),inputRef:e=>ae.current[t.fieldId]=e,unitInputRef:()=>{}},t.fieldId)})})}):I.map(e=>{const t=Y[e.fieldId]??"";return r.jsxs("div",{className:"flex items-center gap-4 bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[r.jsx("span",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 min-w-[5em]",children:e.name}),r.jsxs("div",{className:"flex flex-1 min-w-0 items-center",children:[r.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:"0",className:"flex-1 min-w-0 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg font-semibold bg-inherit text-gray-700 dark:text-gray-200",value:t,onChange:t=>X(r=>({...r,[e.fieldId]:t.target.value})),onBlur:()=>{t?J(e.fieldId):ee(e.fieldId)},onKeyDown:r=>{"Enter"===r.key&&(t?J(e.fieldId):ee(e.fieldId))},placeholder:e.unit?`例: 0.0 (${e.unit})`:"例: 0.0","data-testid":`${e.fieldId}-input`}),e.unit&&r.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-300 whitespace-nowrap shrink-0 overflow-hidden",children:e.unit})]})]},e.fieldId)})}),S&&r.jsxs("div",{className:"w-full max-w-md mt-6 mb-2",children:[p?r.jsxs("div",{className:"flex items-center gap-2 mb-2 bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[r.jsxs("div",{className:"flex flex-1 min-w-0 gap-2",children:[r.jsx("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"flex-1 min-w-0 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"新しい項目名",maxLength:20}),r.jsx("input",{type:"text",value:v,onChange:e=>w(e.target.value),className:"w-20 shrink-0 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"単位",maxLength:10})]}),r.jsx(Q,{variant:"primary",size:"md",icon:Pe,"aria-label":"保存",onClick:async()=>{N("");const e=b.trim(),t=v.trim();if(!e)return void N("項目名を入力してください");if(o.some(t=>t.name===e&&"bp"===t.scope))return void N("同じ名前の項目が既に存在します");const r={fieldId:`custom_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,name:e,unit:t,type:"number",order:10*(o.length+1),defaultDisplay:!0,scope:"bp"};await u(r),x(!1),y(""),w("")},disabled:!b.trim(),"data-testid":"save-btn",children:""}),r.jsx(Q,{variant:"secondary",size:"md",icon:Xe,"aria-label":"キャンセル",onClick:()=>{x(!1),y(""),w(""),N("")},children:""})]}):r.jsx(Q,{variant:"teal",size:"md",icon:Ue,fullWidth:!0,onClick:()=>x(!0),children:"新規項目"}),k&&r.jsx("div",{className:"text-red-500 text-sm mt-1",children:k})]}),r.jsx("div",{className:"w-full max-w-md mt-6",children:S?r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Q,{variant:"success",size:"md",icon:_e,onClick:async()=>{for(const e of O)await f(e);for(let e=0;e<T.length;++e){const t=E.find(t=>t.fieldId===T[e]);t&&await m({...t,order:10*e})}await h(),C(!1)},fullWidth:!0,children:"保存"}),r.jsx(Q,{variant:"secondary",size:"md",icon:Xe,onClick:()=>{C(!1)},fullWidth:!0,children:"キャンセル"})]}):r.jsx(Q,{variant:"teal",size:"md",icon:Ge,fullWidth:!0,onClick:()=>C(!0),children:"編集"})})]})]})};function Mt(e){return O({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497.941 273.941c18.745-18.745 18.745-49.137 0-67.882l-160-160c-18.745-18.745-49.136-18.746-67.883 0l-256 256c-18.745 18.745-18.745 49.137 0 67.882l96 96A48.004 48.004 0 0 0 144 480h356c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12H355.883l142.058-142.059zm-302.627-62.627l137.373 137.373L265.373 416H150.628l-80-80 124.686-124.686z"},child:[]}]})(e)}function Tt(e){return O({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M216 23.86c0-23.8-30.65-32.77-44.15-13.04C48 191.85 224 200 224 288c0 35.63-29.11 64.46-64.85 63.99-35.17-.45-63.15-29.77-63.15-64.94v-85.51c0-21.7-26.47-32.23-41.43-16.5C27.8 213.16 0 261.33 0 320c0 105.87 86.13 192 192 192s192-86.13 192-192c0-170.29-168-193-168-296.14z"},child:[]}]})(e)}function Rt(e){return O({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 35.7 22.5 72.4 61.9 100.7 31.5 22.7 69.8 37.1 110 41.7C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6c40.3-4.6 78.6-19 110-41.7 39.3-28.3 61.9-65 61.9-100.7V88c0-13.3-10.7-24-24-24zM99.3 192.8C74.9 175.2 64 155.6 64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-15.1-5.2-29.2-12.4-41.7-21.4zM512 144c0 16.1-17.7 36.1-35.3 48.8-12.5 9-26.7 16.2-41.8 21.4 7-25 11.8-53.6 12.8-86.2H512v16z"},child:[]}]})(e)}const Ot=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,Lt=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`,At="shared_selected_date";function $t(e,t=800){const[r,a]=D.useState(0);return D.useEffect(()=>{if("number"!=typeof e||isNaN(e))return;const r=performance.now();requestAnimationFrame(function n(s){const o=s-r,l=Math.min(o/t,1);a(0+(e-0)*l),l<1?requestAnimationFrame(n):a(e)})},[e,t]),r}function Bt({field:e,value:t,stats:a,onAchieve:n,onUnachieve:s}){const o=$t(a.percent);return r.jsxs("div",{className:"flex flex-col gap-1 bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-2",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 min-w-[5em]",children:e.name}),r.jsx(Q,{variant:!0===t?"primary":"secondary",size:"md",onClick:n,"aria-pressed":!0===t,className:"flex-1","data-testid":`daily-input-${e.fieldId}`,children:"達成"}),r.jsx(Q,{variant:!1===t?"primary":"secondary",size:"md",onClick:s,"aria-pressed":!1===t,className:"flex-1","data-testid":`daily-input-${e.fieldId}`,children:"未達"})]}),r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[r.jsx("span",{className:"text-base font-semibold text-blue-700 dark:text-blue-200 align-middle",children:"直近2週間の達成率："}),a.total>0?r.jsxs(r.Fragment,{children:[r.jsxs("span",{className:"ml-4 text-base font-semibold text-blue-700 dark:text-blue-200 align-middle",children:[r.jsx("span",{style:{display:"inline-block",minWidth:"3ch",textAlign:"right",fontFamily:"monospace"},children:o.toFixed(0)}),"%"]}),r.jsxs("span",{className:"ml-2 text-base font-semibold text-blue-700 dark:text-blue-200 align-middle",children:["(",a.success,"/",a.total,"日)"]})]}):"記録なし"]})]})}const _t=()=>{const e=new Date,[t,a]=j.useState(()=>{const t=localStorage.getItem(At);return t?new Date(t):e}),[n,s]=j.useState(()=>{const t=localStorage.getItem(At);return t?new Date(t):e}),{fields:o,addRecord:l,updateRecord:i,deleteRecord:d,records:c,addField:u,loadRecords:g,deleteField:f,updateField:m,loadFields:h}=St(),[p,x]=j.useState(!1),[b,y]=j.useState(""),[v,w]=j.useState(""),[k,N]=j.useState(!1),S=k?o.filter(e=>"boolean"===e.type).slice().sort((e,t)=>e.order!==t.order?(e.order??0)-(t.order??0):e.fieldId.localeCompare(t.fieldId)):o.filter(e=>"boolean"===e.type&&e.defaultDisplay).slice().sort((e,t)=>e.order!==t.order?(e.order??0)-(t.order??0):e.fieldId.localeCompare(t.fieldId)),[C,I]=j.useState(()=>S.map(e=>({...e}))),[E,M]=j.useState(()=>S.map(e=>e.fieldId)),[T,R]=j.useState([]),O=L(A(W)),Z=Ot(n),V=(G=n,`${String(G.getHours()).padStart(2,"0")}:${String(G.getMinutes()).padStart(2,"0")}`);var G;const U=e=>c.find(t=>t.fieldId===e&&t.date===Z),q=e=>{const t=Ot(e),r=o.filter(e=>"daily"===e.scope).map(e=>e.fieldId);return c.some(e=>e.date===t&&r.includes(e.fieldId))},K=async(e,t)=>{const r=U(e);if(r&&r.value===t)await d(r.id),await g();else if(r)await i({...r,value:t}),await g();else{const r=new Date,a=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;await l({id:a,fieldId:e,value:t,date:Z,time:V,datetime:Lt(r)}),await g()}};j.useEffect(()=>{if(k){const e=o.filter(e=>"boolean"===e.type).slice().sort((e,t)=>e.order!==t.order?(e.order??0)-(t.order??0):e.fieldId.localeCompare(t.fieldId));I(e.map(e=>({...e}))),M(e.map(e=>e.fieldId)),R([])}},[k]);const[Y,X]=j.useState(null),J=j.useRef({}),ee=j.useRef({});j.useEffect(()=>{if(!Y)return;const e=J.current[Y];if(e){const t=ee.current[Y]??{start:e.value.length,end:e.value.length};e.setSelectionRange(t.start,t.end)}},[Y]);const te=D.memo(function({field:e,isEditing:t,onStartEdit:a,onEndEdit:n,onNameChange:s,onDelete:o,onToggleDisplay:l,inputRef:i}){const{attributes:d,listeners:c,setNodeRef:u,transform:g,transition:f,isDragging:m}=$({id:e.fieldId}),h={...m?{transform:B.Transform.toString(g),transition:f}:{},opacity:m?.5:1,background:m?"#f3f4f6":void 0},[p,x]=D.useState(e.name);return D.useEffect(()=>{t&&x(e.name)},[t,e.name]),r.jsxs("div",{ref:u,style:h,className:"flex items-center gap-2 rounded-xl shadow p-4 mb-2 transition-colors "+(!1===e.defaultDisplay?"bg-gray-100 dark:bg-gray-700 text-gray-400":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"),children:[t?r.jsx("input",{ref:i,type:"text",value:p,onChange:t=>{x(t.target.value);const r=t.target.selectionStart??t.target.value.length,a=t.target.selectionEnd??t.target.value.length;ee.current[e.fieldId]={start:r,end:a}},onSelect:t=>{const r=t.target;ee.current[e.fieldId]={start:r.selectionStart??r.value.length,end:r.selectionEnd??r.value.length}},onBlur:()=>{s(p),n()},onKeyDown:e=>{"Enter"===e.key&&(s(p),n())},className:"flex-1 border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg font-semibold min-w-[5em] bg-inherit "+(!1===e.defaultDisplay?"border-gray-200 dark:border-gray-600 text-gray-400 bg-gray-50 dark:bg-gray-800":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200"),"data-testid":`daily-input-${e.fieldId}`}):r.jsx("span",{className:"flex-1 text-lg font-semibold min-w-[5em] cursor-pointer",onClick:a,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||a()},role:"button","aria-label":"項目名を編集",tabIndex:0,children:e.name}),r.jsx("button",{type:"button",onClick:()=>{window.confirm("本当に削除しますか？\n（保存すると確定されます。）")&&o()},className:"text-red-500 hover:text-red-700 p-2","aria-label":"削除","data-testid":`delete-btn-${e.fieldId}`,children:r.jsx(Ke,{className:"w-6 h-6"})}),r.jsx("button",{type:"button",onClick:l,className:"p-2 "+(!1===e.defaultDisplay?"text-gray-400 hover:text-blue-400":"text-blue-500 hover:text-blue-700"),"aria-label":!1===e.defaultDisplay?"表示項目にする":"非表示項目にする","data-testid":`toggle-btn-${e.fieldId}`,children:!1===e.defaultDisplay?r.jsx(He,{className:"w-6 h-6"}):r.jsx(We,{className:"w-6 h-6"})}),r.jsx("span",{className:"cursor-move p-2","aria-label":"並び替えハンドル",style:{touchAction:"none"},...d,...c,tabIndex:0,children:r.jsx(Ae,{className:"w-6 h-6 text-gray-400"})})]})}),re=j.useCallback(e=>{R(t=>[...t,e]),I(t=>t.filter(t=>t.fieldId!==e)),M(t=>t.filter(t=>t!==e))},[]),ae=j.useCallback(e=>{I(t=>t.map(t=>t.fieldId===e?{...t,defaultDisplay:!t.defaultDisplay}:t))},[]),ne=e=>{const t=(()=>{const e=[],t=new Date;for(let r=0;r<14;r++){const a=new Date(t);a.setDate(t.getDate()-r),e.push(Ot(a))}return e.reverse()})();let r=0,a=0;return t.forEach(t=>{const n=c.find(r=>r.fieldId===e&&r.date===t);"boolean"==typeof(null==n?void 0:n.value)&&(r++,!0===n.value&&a++)}),{total:r,success:a,percent:r>0?Math.round(a/r*100):0}},se=(e=>{let t=0;for(let r=0;r<365;r++){const a=new Date(e);a.setDate(e.getDate()-r);const n=Ot(a);if(!o.filter(e=>"daily"===e.scope).some(e=>c.some(t=>t.fieldId===e.fieldId&&t.date===n&&!0===t.value)))break;t++}return t})(n),oe=$t(se);return j.useEffect(()=>{localStorage.setItem(At,n.toISOString())},[n]),r.jsxs("div",{className:"bg-transparent",children:[r.jsx(tt,{selectedDate:n,setSelectedDate:s,centerDate:t,setCenterDate:a,isRecorded:q,"data-testid":"date-picker"}),r.jsx("div",{className:"w-full max-w-md mx-auto mt-3 mb-3 flex justify-start pl-4",children:r.jsxs("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:[Ot(n),q(n)&&r.jsx(Pe,{className:"inline-block w-6 h-6 text-green-500 ml-2 align-middle","aria-label":"入力済み"}),se>0&&r.jsxs("span",{className:"ml-3 px-2 py-0.5 rounded-full bg-orange-500 text-white text-xs font-bold inline-flex items-center",title:"連続達成日数",children:[r.jsx(Tt,{className:"inline-block mr-1",style:{fontSize:"1em"}}),r.jsx("span",{style:{display:"inline-block",minWidth:"3ch",textAlign:"right"},children:oe.toFixed(0)}),"日継続中"]})]})}),r.jsxs("div",{className:"flex flex-col items-center justify-start min-h-[60vh]",children:[r.jsx("div",{className:"flex flex-col gap-6 w-full max-w-md",children:k?r.jsx(_,{sensors:O,collisionDetection:P,onDragEnd:e=>{const{active:t,over:r}=e;if(!r)return;const a=String(t.id),n=String(r.id);if(a!==n){const e=E.indexOf(a),t=E.indexOf(n);M(H(E,e,t))}},children:r.jsx(z,{items:E,strategy:F,children:E.map(e=>{const t=C.find(t=>t.fieldId===e);if(!t)return null;const a=Y===t.fieldId;return r.jsx(te,{field:t,isEditing:a,onStartEdit:()=>X(t.fieldId),onEndEdit:()=>X(null),onNameChange:e=>I(r=>r.map(r=>r.fieldId===t.fieldId?{...r,name:e}:r)),onDelete:()=>re(t.fieldId),onToggleDisplay:()=>ae(t.fieldId),inputRef:e=>J.current[t.fieldId]=e},t.fieldId)})})}):S.map(e=>{const t=(e=>{const t=U(e);return"boolean"==typeof(null==t?void 0:t.value)?t.value:void 0})(e.fieldId),a=ne(e.fieldId);return r.jsx(Bt,{field:e,value:t,stats:a,onAchieve:async()=>{if(!0===t){const t=U(e.fieldId);t&&(await d(t.id),await g())}else await K(e.fieldId,!0)},onUnachieve:async()=>{if(!1===t){const t=U(e.fieldId);t&&(await d(t.id),await g())}else await K(e.fieldId,!1)}},e.fieldId)})}),k&&r.jsxs("div",{className:"w-full max-w-md mt-6 mb-2",children:[p?r.jsxs("div",{className:"flex items-center gap-2 mb-2 bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[r.jsx("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"新しい項目名",maxLength:20,"data-testid":"daily-input-2"}),r.jsx(Q,{variant:"primary",size:"md",icon:Pe,"aria-label":"保存",onClick:async()=>{w("");const e=b.trim();if(!e)return void w("項目名を入力してください");if(o.some(t=>t.name===e))return void w("同じ名前の項目が既に存在します");const t=`custom_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,r={fieldId:t,name:e,type:"boolean",order:10*(o.length+1),defaultDisplay:!0,scope:"daily"};await u(r),k&&(I(e=>[...e,{...r}]),M(e=>[...e,t])),x(!1),y("")},disabled:!b.trim(),"data-testid":"save-btn",children:""}),r.jsx(Q,{variant:"secondary",size:"md",icon:Xe,"aria-label":"キャンセル",onClick:()=>{x(!1),y(""),w("")},children:""})]}):r.jsx(Q,{variant:"teal",size:"md",icon:Ue,fullWidth:!0,onClick:()=>x(!0),"data-testid":"add-btn",children:"新規項目"}),v&&r.jsx("div",{className:"text-red-500 text-sm mt-1",children:v})]}),r.jsx("div",{className:"w-full max-w-md mt-6",children:k?r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Q,{variant:"success",size:"md",icon:_e,onClick:async()=>{for(const e of T)await f(e);for(let e=0;e<E.length;++e){const t=C.find(t=>t.fieldId===E[e]);t&&await m({...t,order:10*e})}await h(),N(!1)},fullWidth:!0,children:"保存"}),r.jsx(Q,{variant:"secondary",size:"md",icon:Xe,onClick:()=>{N(!1)},fullWidth:!0,children:"キャンセル"})]}):r.jsx(Q,{variant:"teal",size:"md",icon:Ge,fullWidth:!0,onClick:()=>N(!0),children:"編集"})})]})]})},Pt=Z(e=>({goal:null,setGoal:async t=>{await async function(e){return pt("set-goal",async()=>vt(ft,"readwrite",async(t,r)=>{const a=r;return new Promise((t,r)=>{const n=a.put({...e,id:"singleton"});n.onsuccess=()=>t(),n.onerror=()=>r(xt(n.error))})}))}(t),e({goal:t})},clearGoal:async()=>{await async function(){return pt("clear-goal",async()=>vt(ft,"readwrite",async(e,t)=>{const r=t;return new Promise((e,t)=>{const a=r.delete("singleton");a.onsuccess=()=>e(),a.onerror=()=>t(xt(a.error))})}))}(),e({goal:null})},loadGoal:async()=>{const t=await async function(){return pt("get-goal",async()=>vt(ft,"readonly",async(e,t)=>{const r=t;return new Promise((e,t)=>{const a=r.get("singleton");a.onsuccess=()=>{const t=a.result;if(t&&"object"==typeof t){const{id:r,...a}=t;e(a)}else e(null)},a.onerror=()=>t(xt(a.error))})}))}();e({goal:t})}})),zt=(new Date).getFullYear(),Ft=["毎日ラジオ体操(第2まで)をする","なるべく階段を使う","通勤で早歩きする","一駅歩く","毎日30分歩く","毎日5000歩歩く","毎日ジョギングをする"],Ht=["清涼飲料水を 0 cal にする","間食、夜食を控える","野菜を多く食べる","よく噛んで20分以上かける","夜はお米を食べない","毎食ご飯を半分にする"],Wt=["7時間以上寝る","23時までに就寝する","就寝90分前に入浴し体温調節をする","寝室の温度を 18–22 ℃ に保つ","寝室の照明を 300 lx 以下に落とす","寝る前にスマホを見ない"],Zt=["家では吸わない","会社では吸わない","電子タバコへ移行し本数を半減する","1週間に1本ずつ減らす","禁煙外来に通う"],Vt=["休肝日を作る","1日1杯までにする","週2回までにする","飲み会は月1回まで","ノンアルコール飲料にする"],Gt=[{value:"male",label:"男性"},{value:"female",label:"女性"},{value:"unknown",label:"未回答"}];function Ut(){const[e,t]=j.useState(!1),{refs:r,floatingStyles:a,context:n}=o({open:e,onOpenChange:t,middleware:[u(6),g(),f()],placement:"bottom-end"}),s=l(n),m=i(n),h=d(n),{getReferenceProps:p,getFloatingProps:x}=c([s,m,h]);return{open:e,setOpen:t,refs:r,floatingStyles:a,getReferenceProps:p,getFloatingProps:x}}function qt(){const{goal:e,setGoal:t,loadGoal:a}=Pt(),{records:n}=St(),[o,l]=j.useState("unknown"),[i,d]=j.useState(""),[c,u]=j.useState(""),[g,f]=j.useState(""),[m,h]=j.useState(""),[p,x]=j.useState(""),[b,y]=j.useState(""),[v,w]=j.useState(""),[k,N]=j.useState(""),[S,D]=j.useState(""),[C,I]=j.useState(""),[E,M]=j.useState(""),[T,R]=j.useState(!1),[O,L]=j.useState(!1),[A,$]=j.useState(!1),[B,_]=j.useState(!1),[P,z]=j.useState(!1),F=j.useRef(null),H=j.useRef(null),W=j.useRef(null),Z=j.useRef(null),V=j.useRef(null),G=Ut(),U=Ut(),q=Ut(),K=Ut(),Y=Ut();j.useEffect(()=>{a().then(()=>{e?(l(e.gender||"unknown"),d(e.birthYear.toString()),u(e.height.toString()),f(void 0!==e.startWeight?e.startWeight.toString():null!==J?J.toString():""),h(e.targetStart),x(e.targetEnd),y(e.targetWeight.toString()),w(e.exerciseGoal||""),N(e.dietGoal||""),D(e.sleepGoal||""),I(e.smokingGoal||""),M(e.alcoholGoal||"")):f(null!==J?J.toString():"")})},[]),j.useEffect(()=>{e&&(l(e.gender||"unknown"),d(e.birthYear.toString()),u(e.height.toString()),f(void 0!==e.startWeight?e.startWeight.toString():null!==J?J.toString():""),h(e.targetStart),x(e.targetEnd),y(e.targetWeight.toString()),w(e.exerciseGoal||""),N(e.dietGoal||""),D(e.sleepGoal||""),I(e.smokingGoal||""),M(e.alcoholGoal||""))},[e]);j.useEffect(()=>{o&&i&&c&&g&&m&&p&&b&&!(!i||isNaN(Number(i))||Number(i)<1900||Number(i)>zt||(!c||isNaN(Number(c))||Number(c)<100||Number(c)>250||(!g||isNaN(Number(g))||Number(g)<30||Number(g)>200||(!m||!/^\d{4}-\d{2}-\d{2}$/.test(m)||(!p||!/^\d{4}-\d{2}-\d{2}$/.test(p)||(m>p||!!(!b||isNaN(Number(b))||Number(b)<30||Number(b)>200)))))))&&t({gender:o,birthYear:Number(i),height:Number(c),startWeight:Number(g),targetStart:m,targetEnd:p,targetWeight:Number(b),exerciseGoal:v,dietGoal:k,sleepGoal:S,smokingGoal:C,alcoholGoal:E})},[o,i,c,g,m,p,b,v,k,S,C,E]);const X=Number(c)||170,J=(()=>{const e=n.filter(e=>"weight"===e.fieldId&&"number"==typeof e.value).sort((e,t)=>{const r=e.datetime||`${e.date}T${e.time}`;return(t.datetime||`${t.date}T${t.time}`).localeCompare(r)});return e.length>0?Number(e[0].value):null})();j.useEffect(()=>{if(!T)return;const e=e=>{const t=document.querySelector('[aria-label="運動目標の例を表示"]'),r=F.current;t&&!t.contains(e.target)&&r&&!r.contains(e.target)&&R(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[T]),j.useEffect(()=>{if(O){const e=e=>{const t=document.querySelector('[aria-label="減食目標の例を表示"]'),r=H.current;t&&!t.contains(e.target)&&r&&!r.contains(e.target)&&L(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}},[O]),j.useEffect(()=>{if(A){const e=e=>{const t=document.querySelector('[aria-label="睡眠目標の例を表示"]'),r=W.current;t&&!t.contains(e.target)&&r&&!r.contains(e.target)&&$(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}},[A]),j.useEffect(()=>{if(B){const e=e=>{const t=document.querySelector('[aria-label="喫煙目標の例を表示"]'),r=Z.current;t&&!t.contains(e.target)&&r&&!r.contains(e.target)&&_(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}},[B]),j.useEffect(()=>{if(P){const e=e=>{const t=document.querySelector('[aria-label="飲酒目標の例を表示"]'),r=V.current;t&&!t.contains(e.target)&&r&&!r.contains(e.target)&&z(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}},[P]);const ee="female"===o?7e3:6500;return r.jsx("div",{className:"flex flex-col items-center justify-start py-0 bg-transparent",children:r.jsxs("form",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-6 w-full max-w-md flex flex-col gap-4",children:[r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"性別"}),r.jsx("div",{className:"flex gap-4 mt-1",children:Gt.map(e=>r.jsxs("label",{className:"flex items-center gap-1 text-base",children:[r.jsx("input",{type:"radio",name:"gender",value:e.value,checked:o===e.value,onChange:()=>l(e.value),className:"accent-blue-500"}),e.label]},e.value))})]}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"生年（例: 1990）"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",min:"1900",max:zt,value:i,onChange:e=>d(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 1990"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>d((zt-40).toString()),children:"40"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>d((Number(i)-5).toString()),children:"-5"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>d((Number(i)+5).toString()),children:"+5"})]})]}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"身長[cm] (例: 165.0)"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",min:"100",max:"250",value:c,onChange:e=>u(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 165.0"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>u("170"),children:"170"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>u((X-5).toString()),children:"-5"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>u((X+5).toString()),children:"+5"})]})]}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"開始体重[kg] (例: 68.0)"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",min:"30",max:"200",step:"0.1",value:g,onChange:e=>f(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 68.0","data-testid":"goal-weight-input"}),null!==J&&r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>f(J.toString()),children:"最新体重"})]})]}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"目標体重[kg] (例: 75.0)"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",min:"30",max:"200",step:"0.1",value:b,onChange:e=>y(e.target.value),className:"border rounded px-3 py-2 text-base w-32",required:!0,placeholder:"例: 75.0"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>{g&&!isNaN(Number(g))&&y((Math.round(10*(Number(g)-2))/10).toString())},children:"-2kg"}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>{g&&!isNaN(Number(g))&&y((Math.round(10*(Number(g)-5))/10).toString())},children:"-5kg"})]})]}),g&&b&&!isNaN(Number(g))&&!isNaN(Number(b))&&Number(b)<Number(g)&&r.jsxs("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:["あと",(Number(g)-Number(b)).toFixed(1),"kg減らすには約",Math.round((Number(g)-Number(b))*ee).toLocaleString(),"kcalの消費が必要です"]}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"目標開始日"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"date",value:m,onChange:e=>h(e.target.value),className:"border rounded px-3 py-2 text-base",required:!0}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>h((new Date).toISOString().slice(0,10)),children:"今日"})]})]}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"目標終了日"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"date",value:p,onChange:e=>x(e.target.value),className:"border rounded px-3 py-2 text-base",required:!0}),r.jsx(Q,{type:"button",size:"sm",variant:"secondary",onClick:()=>{const e=m?new Date(m):new Date;e.setMonth(e.getMonth()+3),x(e.toISOString().slice(0,10))},children:"3か月後"})]})]}),g&&b&&m&&p&&!isNaN(Number(g))&&!isNaN(Number(b))&&Number(b)<Number(g)&&/^\d{4}-\d{2}-\d{2}$/.test(m)&&/^\d{4}-\d{2}-\d{2}$/.test(p)&&new Date(p)>=new Date(m)&&(()=>{const e=(Number(g)-Number(b))*ee,t=new Date(m),a=new Date(p),n=Math.floor((a.getTime()-t.getTime())/864e5)+1;if(n>0){const t=Math.round(e/n);return r.jsxs("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:["期間中に一日あたり約",t.toLocaleString(),"kcalの消費が必要です"]})}return null})(),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"運動目標 (例: なるべく階段を使う)"}),r.jsxs("div",{className:"relative flex items-center gap-2",children:[r.jsx("input",{type:"text",value:v,onChange:e=>w(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 毎日30分歩く"}),r.jsx("div",{ref:G.refs.setReference,...G.getReferenceProps({}),className:"absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"定型文を挿入",onClick:()=>G.setOpen(e=>!e),children:r.jsx(qe,{className:"w-6 h-6"})}),G.open&&r.jsx(s,{children:r.jsx("div",{ref:G.refs.setFloating,style:G.floatingStyles,...G.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:Ft.map(e=>r.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{w(e),G.setOpen(!1)},children:e},e))})})]})]}),g&&b&&m&&p&&!isNaN(Number(g))&&!isNaN(Number(b))&&Number(b)<Number(g)&&/^\d{4}-\d{2}-\d{2}$/.test(m)&&/^\d{4}-\d{2}-\d{2}$/.test(p)&&new Date(p)>=new Date(m)&&(()=>{const e=(Number(g)-Number(b))*ee,t=new Date(m),a=new Date(p),n=Math.floor((a.getTime()-t.getTime())/864e5)+1;if(n>0){const t=Math.round(e/n),a=Math.round(t/2);return r.jsxs("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:["運動で一日あたり約",a.toLocaleString(),"kcalの消費を目標にしましょう。"]})}return null})(),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"減食目標 (例: 間食を控える)"}),r.jsxs("div",{className:"relative flex items-center gap-2",children:[r.jsx("input",{type:"text",value:k,onChange:e=>N(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 間食を控える"}),r.jsx("div",{ref:U.refs.setReference,...U.getReferenceProps({}),className:"absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"定型文を挿入",onClick:()=>U.setOpen(e=>!e),children:r.jsx(qe,{className:"w-6 h-6"})}),U.open&&r.jsx(s,{children:r.jsx("div",{ref:U.refs.setFloating,style:U.floatingStyles,...U.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:Ht.map(e=>r.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{N(e),U.setOpen(!1)},children:e},e))})})]})]}),g&&b&&m&&p&&!isNaN(Number(g))&&!isNaN(Number(b))&&Number(b)<Number(g)&&/^\d{4}-\d{2}-\d{2}$/.test(m)&&/^\d{4}-\d{2}-\d{2}$/.test(p)&&new Date(p)>=new Date(m)&&(()=>{const e=(Number(g)-Number(b))*ee,t=new Date(m),a=new Date(p),n=Math.floor((a.getTime()-t.getTime())/864e5)+1;if(n>0){const t=Math.round(e/n),a=Math.round(t/2);return r.jsxs("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:["減食で一日あたり約",a.toLocaleString(),"kcalの消費を目標にしましょう。"]})}return null})(),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"睡眠目標 (例: 23時までに就寝する)"}),r.jsxs("div",{className:"relative flex items-center gap-2",children:[r.jsx("input",{type:"text",value:S,onChange:e=>D(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 7時間以上寝る"}),r.jsx("div",{ref:q.refs.setReference,...q.getReferenceProps({}),className:"absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"定型文を挿入",onClick:()=>q.setOpen(e=>!e),children:r.jsx(qe,{className:"w-6 h-6"})}),q.open&&r.jsx(s,{children:r.jsx("div",{ref:q.refs.setFloating,style:q.floatingStyles,...q.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:Wt.map(e=>r.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{D(e),q.setOpen(!1)},children:e},e))})})]})]}),r.jsx("div",{className:"text-blue-700 dark:text-blue-300 text-sm font-semibold mb-2",children:"十分な睡眠(7時間以上)をとると痩せやすくなります。"}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"喫煙目標 (例: 1日○本までにする)"}),r.jsxs("div",{className:"relative flex items-center gap-2",children:[r.jsx("input",{type:"text",value:C,onChange:e=>I(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 1日○本までにする"}),r.jsx("div",{ref:K.refs.setReference,...K.getReferenceProps({}),className:"absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"定型文を挿入",onClick:()=>K.setOpen(e=>!e),children:r.jsx(qe,{className:"w-6 h-6"})}),K.open&&r.jsx(s,{children:r.jsx("div",{ref:K.refs.setFloating,style:K.floatingStyles,...K.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:Zt.map(e=>r.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{I(e),K.setOpen(!1)},children:e},e))})})]})]}),r.jsxs("label",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:"飲酒目標 (例: 週2回までにする)"}),r.jsxs("div",{className:"relative flex items-center gap-2",children:[r.jsx("input",{type:"text",value:E,onChange:e=>M(e.target.value),className:"border rounded px-3 py-2 text-base flex-1 pr-10",placeholder:"例: 週2回までにする"}),r.jsx("div",{ref:Y.refs.setReference,...Y.getReferenceProps({}),className:"absolute right-2 top-1/2 -translate-y-1/2 w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"定型文を挿入",onClick:()=>Y.setOpen(e=>!e),children:r.jsx(qe,{className:"w-6 h-6"})}),Y.open&&r.jsx(s,{children:r.jsx("div",{ref:Y.refs.setFloating,style:Y.floatingStyles,...Y.getFloatingProps({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[180px] py-1"}),children:Vt.map(e=>r.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{M(e),Y.setOpen(!1)},children:e},e))})})]})]}),r.jsx(Q,{type:"submit",size:"lg",variant:"primary","data-testid":"save-btn",children:"保存"})]})})}const Kt=[{label:"2週間",days:14},{label:"1か月半",days:45},{label:"3か月",days:90},{label:"全データ",days:null}],Yt={exercise:"🏃",meal:"🍽",sleep:"🛌"};function Xt({label:e,stats:t}){const a=function(e,t=800){const[r,a]=D.useState(0);return D.useEffect(()=>{if("number"!=typeof e||isNaN(e))return;const r=performance.now();requestAnimationFrame(function n(s){const o=s-r,l=Math.min(o/t,1);a(0+(e-0)*l),l<1?requestAnimationFrame(n):a(e)})},[e,t]),r}(t.percent);return r.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-200 whitespace-nowrap font-semibold",children:[r.jsxs("span",{className:"text-sm sm:text-base align-middle",children:[e,":"]}),t.total>0?r.jsxs(r.Fragment,{children:[r.jsxs("span",{className:"ml-1 sm:ml-2 text-sm sm:text-base align-middle",children:[a.toFixed(0),"%"]}),r.jsxs("span",{className:"ml-1 sm:ml-2 text-sm sm:text-base align-middle",children:["(",t.success,"/",t.total,"日)"]})]}):"記録なし"]})}const Qt=()=>{const{records:e,fields:t}=St(),[a,n]=j.useState(0),[s,o]=j.useState(!1),l=t.find(e=>"weight"===e.fieldId),i=j.useMemo(()=>{if(!e.length)return null;const t=e.filter(e=>"weight"===e.fieldId&&e.datetime);return t.length?Math.max(...t.map(e=>new Date(e.datetime).getTime())):null},[e]),d=j.useMemo(()=>{let t=e.filter(e=>"weight"===e.fieldId&&"number"==typeof e.value&&(s||!e.excludeFromGraph)&&e.datetime).sort((e,t)=>(e.datetime||"").localeCompare(t.datetime||"")).map(e=>({datetime:e.datetime,timestamp:new Date(e.datetime).getTime(),value:Number(e.value),excluded:!!e.excludeFromGraph}));const r=Kt[a];if(r.days&&i){const e=i-24*r.days*60*60*1e3;t=t.filter(t=>t.timestamp>=e)}return t},[e,a,i,s]),c=j.useMemo(()=>{if(!d.length)return[];const e=new Date(d[0].timestamp),t=new Date(d[d.length-1].timestamp);e.setHours(0,0,0,0),t.setHours(0,0,0,0);const r=[];for(let a=new Date(e);a<=t;a.setDate(a.getDate()+1))r.push(new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0).getTime());return r},[d]),u=j.useMemo(()=>{if(!d.length)return["auto","auto"];const e=new Date(d[0].timestamp),t=new Date(d[d.length-1].timestamp);return e.setHours(0,0,0,0),t.setHours(23,59,59,999),[e.getTime(),t.getTime()]},[d]),g=j.useMemo(()=>{if(0!==a||!d.length)return;const e=new Date(d[0].timestamp),t=new Date(d[d.length-1].timestamp);e.setHours(0,0,0,0),t.setHours(0,0,0,0);const r=[];for(let a=new Date(e);a<=t;a.setDate(a.getDate()+1))r.push(new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0).getTime());return r},[d,a]),f=e=>{const t=new Date(e);return`${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},k=j.useMemo(()=>{if(d.length<2)return null;const e=d.length;let t=0,r=0,a=0,n=0;for(const f of d)t+=f.timestamp,r+=f.value,a+=f.timestamp*f.timestamp,n+=f.timestamp*f.value;const s=t/e,o=r/e,l=a-t*s;if(0===l)return null;const i=(n-t*o)/l,c=o-i*s,u=d[0].timestamp,g=d[d.length-1].timestamp;return[{timestamp:u,value:i*u+c},{timestamp:g,value:i*g+c}]},[d]),N=j.useMemo(()=>{const t={};return e.forEach(e=>{var r,a,n,s;if(!["exercise","meal","sleep"].includes(e.fieldId))return;const o=e.date;t[o]||(t[o]={exercise:!1,meal:!1,sleep:!1}),"boolean"==typeof e.value&&((r=t[o])[a=e.fieldId]||(r[a]=e.value)),"number"==typeof e.value&&((n=t[o])[s=e.fieldId]||(n[s]=!!e.value))}),t},[e]),S=t=>{const r=(()=>{if(!e.length)return[];let t=null,r=null;if(Kt[a].days&&i&&(r=new Date(i),t=new Date(i),t.setDate(r.getDate()-Kt[a].days+1)),!t||!r)return[];const n=[],s=new Date(t);for(;s<=r;)n.push(`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`),s.setDate(s.getDate()+1);return n})();let n=0,s=0;return r.forEach(e=>{const r=N[e];"boolean"==typeof(null==r?void 0:r[t])&&(n++,r[t]&&s++)}),{total:n,success:s,percent:n>0?Math.round(s/n*100):0}};return r.jsxs("div",{className:"flex flex-col items-center justify-start py-4 bg-transparent","data-testid":"record-graph",children:[r.jsx("div",{className:"flex flex-wrap gap-3 mb-4 items-center w-full",children:Kt.map((e,t)=>r.jsx("button",{className:"w-auto min-w-[64px] px-4 py-1 rounded-full border-2 text-xs sm:text-sm font-bold transition-colors duration-100\n              "+(a===t?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-gray-700 text-blue-700 dark:text-white border-blue-300 hover:bg-blue-100 dark:hover:bg-blue-800"),onClick:()=>n(t),children:e.label},e.label))}),r.jsxs("div",{className:"w-full h-[400px] bg-white dark:bg-gray-800 rounded-xl shadow p-1 relative",children:[r.jsxs("label",{className:"flex items-center absolute right-0 top-0 bg-white/80 dark:bg-gray-800/80 px-1 py-0 h-6 min-h-0 rounded-none leading-tight text-xs font-bold z-10 w-auto cursor-pointer select-none",children:[r.jsx("input",{type:"checkbox",className:"form-checkbox accent-blue-600 mr-1",checked:s,onChange:e=>o(e.target.checked)}),"除外値も表示"]}),r.jsx(m,{width:"100%",height:"100%",children:r.jsxs(h,{data:d,margin:{top:20,right:30,left:0,bottom:20},children:[r.jsx(p,{stroke:"#eee",strokeDasharray:"5 5"}),r.jsx(x,{dataKey:"timestamp",type:"number",domain:u,tick:0===a?e=>{const{x:t=0,y:a=0,payload:n}=e,s=n.value,o=new Date(s);return r.jsx("g",{children:r.jsx("text",{x:t,y:a+10,textAnchor:"middle",fontSize:"12",children:`${o.getMonth()+1}/${o.getDate()}`})})}:void 0,tickFormatter:0===a?void 0:f,ticks:g}),0===a&&c.map(e=>r.jsx(b,{x:e,stroke:"#888",strokeDasharray:"2 2"},e)),r.jsx(y,{domain:["auto","auto"],unit:(null==l?void 0:l.unit)||"kg"}),r.jsx(v,{content:({active:t,payload:a,label:n})=>{var s;if(!t||!a||!a.length)return null;const o=null==(s=a[0])?void 0:s.payload,i=null==o?void 0:o.timestamp,d=i?new Date(i):null,c=d?`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`:"";return r.jsxs("div",{style:{background:"#fff",border:"1px solid #ccc",padding:8,borderRadius:8},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:o?f(o.timestamp):""}),(a??[]).filter(e=>e&&"#f59e42"!==e.color).map((e,t)=>r.jsxs("div",{style:{color:e.color,fontSize:14},children:["number"==typeof e.value?e.value.toFixed(2):e.value,(null==l?void 0:l.unit)||"kg"]},t)),r.jsx("div",{style:{marginTop:6,fontSize:13},children:[{key:"exercise",label:"🏃‍♂️"},{key:"meal",label:"🍽"},{key:"sleep",label:"🛌"}].map(({key:t,label:a})=>{const n=e.find(e=>e.fieldId===t&&e.date===c);return void 0===n?null:"boolean"==typeof n.value?r.jsxs("span",{style:{marginRight:8,verticalAlign:"middle",fontSize:"1.1em",display:"inline-flex",alignItems:"center"},children:[a,n.value?r.jsx(Pe,{style:{color:"#38bdf8",fontSize:"1.3em",marginLeft:2,verticalAlign:"middle"}}):r.jsx(Xe,{style:{color:"#bbb",fontSize:"1.3em",marginLeft:2,verticalAlign:"middle"}})]},t):null})})]})}}),r.jsx(w,{type:"monotone",dataKey:"value",data:d,stroke:"#38bdf8",strokeWidth:3,dot:({cx:e,cy:t,payload:a})=>r.jsx("circle",{cx:e,cy:t,r:4,fill:a.excluded?"#f87171":"#38bdf8",stroke:"#fff",strokeWidth:1},(null==a?void 0:a.timestamp)??`${e}-${t}`),activeDot:!1}),k&&r.jsx(w,{type:"linear",data:k,dataKey:"value",stroke:"#f59e42",strokeWidth:3,dot:!1,activeDot:!1,isAnimationActive:!1,strokeDasharray:"6 6",legendType:"none"})]})})]}),r.jsx("div",{className:"w-full flex flex-wrap justify-center gap-2 sm:gap-6 mt-4 mb-2",children:["exercise","meal","sleep"].map(e=>{const t=S(e);return r.jsx(Xt,{label:Yt[e],stats:t},e)})})]})};function Jt(e){return O({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,208a8,8,0,0,1-8,8H32a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V60.69l56,56,26.34-26.35a8,8,0,0,1,11.32,0L192,148.69V128a8,8,0,0,1,16,0v40a7,7,0,0,1,0,.8c0,.11,0,.21-.05.32s0,.3-.07.46a2.83,2.83,0,0,1-.09.37c0,.13-.06.26-.1.39s-.08.23-.12.35l-.14.39-.15.31c-.06.13-.12.27-.19.4s-.11.18-.16.28l-.24.39-.21.28-.26.35c-.11.14-.24.27-.36.4l-.16.18-.17.15a4.83,4.83,0,0,1-.42.37,3.92,3.92,0,0,1-.32.25l-.3.22-.38.23a2.91,2.91,0,0,1-.3.17l-.37.19-.34.15-.36.13a2.84,2.84,0,0,1-.38.13l-.36.1c-.14,0-.26.07-.4.09l-.42.07-.35.05a7,7,0,0,1-.79,0H160a8,8,0,0,1,0-16h20.69L128,107.31l-26.34,26.35a8,8,0,0,1-11.32,0L40,83.31V200H224A8,8,0,0,1,232,208Z"},child:[]}]})(e)}function er(e){return O({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 17h1m16 0h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7m-9.7 5.7a4 4 0 0 1 8 0"},child:[]},{tag:"path",attr:{d:"M3 21l18 0"},child:[]},{tag:"path",attr:{d:"M12 9v-6l3 3m-6 0l3 -3"},child:[]}]})(e)}const tr="shared_selected_date",rr=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,ar=({showTipsModal:e})=>{const t=new Date,[a,n]=j.useState(()=>{const e=localStorage.getItem(tr);return e?new Date(e):t}),[m,h]=j.useState(()=>{const e=localStorage.getItem(tr);return e?new Date(e):t}),{fields:p,addRecord:x,updateRecord:b,deleteRecord:y,records:v,loadRecords:w}=St(),{goal:k,loadGoal:N}=Pt(),[S,D]=j.useState(!1),[C,I]=j.useState(""),[E,M]=j.useState(""),[T,R]=j.useState(""),O=rr(m),L=e=>{const t=rr(e);return v.some(e=>e.date===t&&"weight"===e.fieldId)},A=()=>{const e=new Date;return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},[$,B]=j.useState(""),[_,P]=j.useState(A()),[z,F]=j.useState(""),H=j.useMemo(()=>p.filter(e=>"number"===e.type&&"weight"===e.scope&&e.defaultDisplay).slice().sort((e,t)=>e.order!==t.order?(e.order??0)-(t.order??0):e.fieldId.localeCompare(t.fieldId)),[p]),W=(()=>{const e=v.filter(e=>"weight"===e.fieldId&&e.date===O&&"number"==typeof e.value).sort((e,t)=>(t.time||"").localeCompare(e.time||""));return e.length>0?Number(e[0].value):null})(),Z=W&&k&&k.height?W/Math.pow(k.height/100,2):null,V="number"!=typeof Z||isNaN(Z)?0:Z,G=[{min:0,max:18.5,color:"#6ec6f1",label:"低体重",range:"<18.5"},{min:18.5,max:25,color:"#7edfa0",label:"普通体重",range:"18.5-24.9"},{min:25,max:30,color:"#b6d97a",label:"肥満(1度)",range:"25-29.9"},{min:30,max:35,color:"#ffe066",label:"肥満(2度)",range:"30-34.9"},{min:35,max:40,color:"#ff9800",label:"肥満(3度)",range:"35-39.9"},{min:40,max:100,color:"#f44336",label:"肥満(4度)",range:"40.0+"}],U=(()=>{if(null===Z)return 0;let e=0;for(let t=0;t<G.length;t++){const r=G[t];if(Z<r.max){return e+100/G.length*((Z-r.min)/(r.max-r.min))}e+=100/G.length}return 100})(),[q,K]=j.useState(0);j.useEffect(()=>{if("number"!=typeof Z||isNaN(Z))return;const e=performance.now();requestAnimationFrame(function t(r){const a=r-e,n=Math.min(a/800,1);K(0+(V-0)*n),n<1?requestAnimationFrame(t):K(V)})},[V]);const[Y,X]=j.useState(0);j.useEffect(()=>{if(k&&void 0!==k.startWeight&&null!==W&&W-k.startWeight<0){let e=function(s){const o=s-n,l=Math.min(o/a,1);X(r+(t-r)*l),l<1?requestAnimationFrame(e):X(t)};const t=W-k.startWeight,r=0,a=800,n=performance.now();requestAnimationFrame(e)}else X(0)},[k,W]),j.useEffect(()=>{k&&k.height||N()},[k,N]),j.useEffect(()=>{localStorage.setItem(tr,m.toISOString())},[m]),j.useEffect(()=>{n(m)},[m]);const[J,ee]=j.useState(!1),{refs:te,floatingStyles:re,context:ae}=o({open:J,onOpenChange:ee,middleware:[u(6),g(),f()],placement:"bottom-end"}),ne=l(ae),se=i(ae),oe=d(ae),{getReferenceProps:le,getFloatingProps:ie}=c([ne,se,oe]);j.useEffect(()=>{},[a,m]);const de=(e,t)=>{const r="string"==typeof e?new Date(e):new Date(e.getTime()),[a,n]=t.split(":").map(Number);return r.setHours(a||0,n||0,0,0),(e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`)(r)};return r.jsxs("div",{className:"bg-transparent",children:[r.jsx(tt,{selectedDate:m,setSelectedDate:h,centerDate:a,setCenterDate:n,today:t,isRecorded:L,"data-testid":"date-picker"}),r.jsx("div",{className:"w-full max-w-md mx-auto mt-3 mb-3 flex justify-start pl-4",children:r.jsxs("span",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:[rr(m),L(m)&&r.jsx(Pe,{className:"inline-block w-6 h-6 text-green-500 ml-2 align-middle","aria-label":"入力済み"}),null!==Z&&k&&k.height&&r.jsxs("span",{className:"ml-4 text-base font-semibold text-blue-700 dark:text-blue-200 align-middle",style:{display:"inline-block",minWidth:"4.2em",textAlign:"right"},children:["BMI"," ",r.jsx("span",{style:{display:"inline-block",minWidth:"3.5ch",textAlign:"right",fontFamily:"monospace"},children:q.toFixed(1)}),void 0!==k.startWeight&&null!==W&&W-k.startWeight<0&&r.jsxs("span",{className:"ml-3 align-middle inline-flex items-center",title:"開始体重との差分",children:[r.jsx(Rt,{className:"inline-block mr-1",style:{color:"#FFD700",fontSize:"1.1em",verticalAlign:"middle"}}),r.jsxs("span",{className:"font-bold",style:{color:"#FFD700"},children:[r.jsx("span",{style:{display:"inline-block",minWidth:"2.8em",textAlign:"right",fontFamily:"monospace"},children:Y.toFixed(1)}),"kg"]})]})]})]})}),Z&&k&&k.height&&r.jsxs("div",{className:"w-full max-w-md mx-auto flex flex-col items-center mb-2",children:[r.jsxs("div",{className:"relative w-full h-8 flex rounded overflow-hidden shadow",style:{minWidth:240},children:[G.map(e=>r.jsx("div",{className:"flex-1 flex flex-col items-center justify-center",style:{background:e.color,minWidth:0},children:r.jsx("span",{className:"text-[10px] font-bold text-gray-800 dark:text-gray-900 select-none",style:{lineHeight:1},children:e.label})},e.label)),r.jsx("div",{className:"absolute left-0 top-0 w-full pointer-events-none",style:{height:"100%"},children:r.jsx("div",{style:{position:"absolute",left:`calc(${U}% - 0.65em)`,top:"50%",transform:"translateY(-50%)",color:"#222",fontSize:"1.5em",textShadow:"0 0 2px #fff, 0 0 2px #fff, 1px 1px 2px #0002",zIndex:2},"aria-label":"現在のBMI位置",children:"▼"})})]}),r.jsx("div",{className:"w-full flex justify-between mt-1 px-1",children:G.map(e=>r.jsx("span",{className:"text-[10px] text-gray-700 dark:text-gray-200",style:{minWidth:0},children:e.range},e.label+"-range"))})]}),r.jsxs("div",{className:"flex flex-col items-center justify-start min-h-[60vh]",children:[r.jsx("div",{className:"flex flex-col gap-6 w-full max-w-md",children:H.map(t=>{const a=v.filter(e=>e.fieldId===t.fieldId&&e.date===O).sort((e,t)=>(e.time||"").localeCompare(t.time||""));return r.jsxs("div",{className:"flex flex-col gap-4 bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-4",children:[r.jsx("span",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 min-w-[5em] mb-2",children:t.name}),a.length>0&&a.map(e=>r.jsxs("div",{className:"flex flex-col gap-1 w-full relative",children:[r.jsxs("div",{className:"flex items-center gap-2 w-full",children:[r.jsx("input",{type:"time",className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-inherit text-gray-700 dark:text-gray-200 w-[6.5em]",defaultValue:e.time||"08:00",onBlur:async t=>{t.target.value!==e.time&&(await b({...e,time:t.target.value,datetime:de(e.date,t.target.value)}),await w())}}),r.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:"0",className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-lg font-semibold bg-inherit text-gray-700 dark:text-gray-200 w-[7em]",defaultValue:"string"==typeof e.value||"number"==typeof e.value?e.value:"",onBlur:async t=>{Number(t.target.value)!==e.value&&(await b({...e,value:Number(t.target.value),datetime:de(e.date,e.time||"00:00")}),await w())},"data-testid":"weight-input"}),r.jsxs("div",{className:"flex gap-1 ml-auto",children:[r.jsx(Q,{variant:"danger",size:"sm",icon:Ke,"aria-label":"削除",onClick:async()=>{window.confirm("本当に削除しますか？")&&(await y(e.id),await w())},children:""}),r.jsx(Q,{variant:!0===e.excludeFromGraph?"secondary":"sky",size:"sm","aria-label":!0===e.excludeFromGraph?"グラフ除外":"グラフ表示",onClick:async()=>{await b({...e,excludeFromGraph:!e.excludeFromGraph}),await w()},children:r.jsxs("span",{className:"relative inline-block w-5 h-5",children:[r.jsx(Jt,{className:"w-5 h-5 text-white"}),!0===e.excludeFromGraph&&r.jsx(Ve,{className:"w-5 h-5 text-red-500 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"})]})})]})]}),r.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full mt-1",rows:1,defaultValue:e.note||"",onBlur:async t=>{(t.target.value||"")!==(e.note||"")&&(await b({...e,note:t.target.value}),await w())},placeholder:"補足・メモ（任意）"})]},e.id)),r.jsxs("div",{className:"flex flex-col gap-1 w-full mt-2",children:[r.jsxs("div",{className:"flex items-center gap-2 w-full",children:[r.jsx("input",{type:"time",className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-inherit text-gray-700 dark:text-gray-200 w-[6.5em]",value:_,onChange:e=>P(e.target.value)}),r.jsx("button",{type:"button",className:"ml-1 w-12 h-10 min-w-0 min-h-0 p-0 inline-flex items-center justify-center rounded-full bg-yellow-100 hover:bg-yellow-200 dark:bg-yellow-300/20 dark:hover:bg-yellow-300/40 border border-yellow-300 text-yellow-500 dark:text-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400 shadow-sm overflow-hidden",title:"朝7時にセット","aria-label":"朝7時にセット",onClick:()=>P("07:00"),children:r.jsx(er,{className:"w-6 h-6"})}),r.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:"0",className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-lg font-semibold bg-inherit text-gray-700 dark:text-gray-200 w-[7em]",value:$,onChange:e=>B(e.target.value),placeholder:t.unit?`例: 0.0 (${t.unit})`:"例: 0.0"}),r.jsx(Q,{variant:"success",size:"sm",icon:Pe,"aria-label":"保存",className:"ml-auto",onClick:async()=>{if(!$)return;await x({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fieldId:t.fieldId,value:Number($),date:O,time:_,datetime:de(m,_),note:z}),B(""),P(A()),F(""),await w();const r="1"===localStorage.getItem("disableTips"),a=new Date,n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,s=localStorage.getItem("lastTipsDate");!r&&s!==n&&e&&e()},"data-testid":"save-btn",children:""})]}),r.jsxs("div",{className:"relative w-full mt-1",children:[r.jsx("textarea",{className:"h-10 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-inherit text-gray-700 dark:text-gray-200 resize-none w-full pr-16",rows:1,value:z,onChange:e=>F(e.target.value),placeholder:"補足・メモ（任意）"}),r.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[r.jsxs("div",{className:"relative group",children:[r.jsx("div",{ref:te.setReference,...le({}),className:"w-6 h-6 flex items-center justify-center text-yellow-400 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"定型文を挿入",onClick:()=>ee(e=>!e),children:r.jsx(qe,{className:"w-6 h-6"})}),J&&r.jsx(s,{children:r.jsx("div",{ref:te.setFloating,style:re,...ie({className:"z-30 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg min-w-[120px] py-1"}),children:["朝一","朝食後","昼食前","昼食後","夕食前","夕食後","運動後"].map(e=>r.jsx("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 dark:hover:bg-yellow-900",onClick:()=>{F(z?z+" "+e:e),ee(!1)},children:e},e))})})]}),r.jsx("div",{className:"w-6 h-6 flex items-center justify-center text-pink-300 hover:text-pink-500 transition-colors duration-150 cursor-pointer align-middle hover:opacity-80 focus:outline-none",tabIndex:0,"aria-label":"メモを消去（消しゴム）",onClick:()=>F(""),children:r.jsx(Mt,{className:"w-6 h-6"})})]})]})]})]},t.fieldId)})}),S&&r.jsxs("div",{className:"w-full max-w-md mt-6 mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2 bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[r.jsx("input",{type:"text",value:C,onChange:e=>I(e.target.value),className:"flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"新しい項目名",maxLength:20}),r.jsx("input",{type:"text",value:E,onChange:e=>M(e.target.value),className:"w-20 border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"単位",maxLength:10}),r.jsx(Q,{variant:"primary",size:"md",icon:Pe,"aria-label":"保存",onClick:async()=>{D(!1),I(""),M(""),R("")},disabled:!C.trim(),children:""}),r.jsx(Q,{variant:"secondary",size:"md",icon:Xe,"aria-label":"キャンセル",onClick:()=>{D(!1),I(""),M(""),R("")},children:""})]}),T&&r.jsx("div",{className:"text-red-500 text-sm mt-1",children:T})]}),r.jsx("div",{className:"w-full max-w-md mx-auto mb-2 px-4",children:r.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400 text-yellow-800 dark:text-yellow-100 p-3 rounded shadow-sm text-sm text-left",children:[r.jsx("strong",{children:"【ワンポイント】"})," ","体重はできるだけ毎日同じタイミング（例：朝起きてトイレ後、食事前など）で測ると、日々の変化がより正確にわかります。"]})})]})]})},nr=({pageName:e})=>r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-300 font-medium",children:e?`${e}を読み込み中...`:"ページを読み込み中..."}),rt]})});function sr(){const e=M(),[t,a]=j.useState(!1),n=()=>{a(!1)};j.useEffect(()=>{const e=e=>{"Escape"===e.key&&t&&n()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t]),j.useEffect(()=>{if(t){const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[t]);const s=[{path:"/weight",label:"体重",color:"teal"},{path:"/daily",label:"日課",color:"teal"},{path:"/bp",label:"血圧",color:"teal"},{path:"/graph",label:"グラフ",color:"blue"},{path:"/goal",label:"目標",color:"teal"},{path:"/export",label:"管理",color:"purple"}],o=t=>e.pathname===t;return r.jsxs("div",{className:"relative",children:[r.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-blue-600 text-white px-4 py-2 rounded-lg z-50 font-medium",children:"スキップリンク"}),r.jsxs("nav",{className:"hidden md:flex justify-between items-center gap-4 mb-12 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg mx-4 mt-4",role:"navigation","aria-label":"メインへ移動",children:[r.jsx("div",{className:"flex gap-4",children:s.map(e=>r.jsxs(T,{to:e.path,className:("purple"===e.color?"bg-purple-600 border-purple-600 hover:bg-purple-700 hover:border-purple-700":"bg-blue-500 border-blue-500 hover:bg-blue-600 hover:border-blue-600")+" !text-white px-4 py-2 rounded-lg shadow-md transition-colors duration-200 font-medium text-base border-2 hover:!text-white visited:!text-white active:!text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500","aria-current":o(e.path)?"page":void 0,"aria-label":e.label,children:[e.label,o(e.path)&&r.jsx("span",{className:"sr-only",children:"現在のページ"})]},e.path))}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Te,{}),r.jsx(J,{className:"ml-2",debug:!1})]})]}),r.jsx("div",{className:"md:hidden flex w-full mb-4",children:r.jsxs("nav",{className:"flex w-full",children:[["/weight","/daily","/bp","/graph"].map((e,t,a)=>{const l=s.find(t=>t.path===e);return l?r.jsx(T,{to:l.path,className:`flex-1 text-center py-3 font-bold text-base transition-colors duration-200\n                  ${o(l.path)?"bg-blue-600 text-white mobile-nav-current":"bg-gray-100 dark:bg-gray-700 text-blue-700 dark:text-white hover:bg-blue-100 dark:hover:bg-blue-800 mobile-nav-link"}\n                  ${0===t?"rounded-l-xl":""}\n                  ${t===a.length?"rounded-r-xl":""}\n                  rounded-none focus:outline-none focus:ring-0 border-0`,"aria-current":o(l.path)?"page":void 0,"aria-label":l.label,style:{minWidth:0},onClick:n,children:l.label},l.path):null}),r.jsx("button",{onClick:()=>{a(!t)},className:"flex-1 text-center py-3 font-bold text-base bg-gray-100 dark:bg-gray-700 text-blue-700 dark:text-blue-200 hover:bg-blue-100 dark:hover:bg-blue-800 rounded-r-xl border-0 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2","aria-label":t?"メニューを閉じる":"メニューを開く","aria-expanded":t,"aria-controls":"mobile-menu",style:{minWidth:0},children:r.jsx("span",{className:"inline-block align-middle",children:r.jsxs("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("rect",{y:"5",width:"24",height:"2",rx:"1",fill:"currentColor"}),r.jsx("rect",{y:"11",width:"24",height:"2",rx:"1",fill:"currentColor"}),r.jsx("rect",{y:"17",width:"24",height:"2",rx:"1",fill:"currentColor"})]})})})]})}),t&&r.jsx("div",{id:"mobile-menu",className:"md:hidden absolute top-full left-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg z-40 mb-4",role:"dialog","aria-modal":"true","aria-label":"モバイルメニュー",children:r.jsx("nav",{role:"navigation","aria-label":"モバイルメインナビゲーション",children:r.jsxs("div",{className:"flex flex-col",children:[s.map(e=>r.jsxs(T,{to:e.path,onClick:n,className:"px-4 py-3 font-medium text-base hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 border-b border-gray-100 dark:border-gray-600 "+(o(e.path)?"bg-blue-600 text-white":"purple"===e.color?"!text-purple-600 dark:!text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 focus:bg-purple-50 dark:focus:bg-purple-900/20 hover:!text-purple-600 dark:hover:!text-purple-400 visited:!text-purple-600 dark:visited:!text-purple-400 active:!text-purple-600 dark:active:!text-purple-400":"!text-blue-500 dark:!text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 focus:bg-blue-50 dark:focus:bg-blue-900/20 hover:!text-blue-500 dark:hover:!text-blue-400 visited:!text-blue-500 dark:visited:!text-blue-400 active:!text-blue-500 dark:active:!text-blue-400"),"aria-current":o(e.path)?"page":void 0,"aria-label":e.label,children:[e.label,o(e.path)&&r.jsx("span",{className:"sr-only",children:"現在のページ"})]},e.path)),r.jsxs("div",{className:"flex justify-center gap-2 px-4 py-3 border-t border-gray-100 dark:border-gray-600",children:[r.jsx(Te,{className:"text-sm px-3 py-2"}),r.jsx(J,{className:"text-sm px-3 py-2",debug:!1})]})]})})}),t&&r.jsx("div",{className:"md:hidden fixed inset-0 z-30 backdrop-blur-sm",style:{backgroundColor:"rgba(0, 0, 0, 0.3)"},onClick:n,"aria-hidden":"true"})]})}const or=j.lazy(()=>function(e,t){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),n=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));r=e(t.map(e=>{if((e=function(e){return"/aloe-wellness-log/"+e}(e))in q)return;q[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,n&&a.setAttribute("nonce",n),document.head.appendChild(a),t?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})}(()=>import("./RecordExport-D_XAE2Tv.js"),__vite__mapDeps([0,1,2,3,4,5])).then(e=>e).catch(e=>(console.error("Failed to load RecordExport:",e),{default:function(){return r.jsxs("div",{className:"p-8 text-center",children:[r.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"ロードエラー"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"エクスポートページのロードに失敗しました。"}),r.jsx(Q,{variant:"primary",size:"md",onClick:()=>window.location.reload(),children:"ページを再読み込み"})]})}})));function lr(){const{initializeFields:e,loadFields:t,fieldsOperation:a,recordsOperation:n,loadRecords:s}=St(),[o,l]=j.useState(!1),[i,d]=j.useState(""),c=()=>{const e=Oe[Math.floor(Math.random()*Oe.length)];d(e),l(!0)};j.useEffect(()=>{try{rt,e().then(()=>{t()})}catch(r){console.error("❌ App initialization failed:",r);try{e()}catch(a){console.error("❌ Fallback initialization also failed:",a)}}},[e,t]),j.useEffect(()=>{a.loading||s()},[a.loading,s]),j.useEffect(()=>{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,r=localStorage.getItem("lastTipsDate");"1"===localStorage.getItem("disableTips")||r===t||c()},[]);return r.jsxs("div",{children:[r.jsx(Re,{open:o,onClose:()=>{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;localStorage.setItem("lastTipsDate",t),l(!1)},tipText:i}),r.jsx("header",{role:"banner",children:r.jsx(sr,{})}),r.jsx("main",{id:"main-content",role:"main",tabIndex:-1,children:a&&n&&(a.loading||n.loading)?r.jsx(nr,{pageName:"初期化中"}):r.jsx(j.Suspense,{fallback:r.jsx(nr,{pageName:"日課"}),children:r.jsxs(C,{children:[r.jsx(I,{path:"/goal",element:r.jsx(j.Suspense,{fallback:r.jsx(nr,{pageName:"目標"}),children:r.jsx(qt,{})})}),r.jsx(I,{path:"/daily",element:r.jsx(j.Suspense,{fallback:r.jsx(nr,{pageName:"日課"}),children:r.jsx(_t,{})})}),r.jsx(I,{path:"/weight",element:r.jsx(j.Suspense,{fallback:r.jsx(nr,{pageName:"体重"}),children:r.jsx(ar,{showTipsModal:c})})}),r.jsx(I,{path:"/bp",element:r.jsx(j.Suspense,{fallback:r.jsx(nr,{pageName:"血圧"}),children:r.jsx(Et,{})})}),r.jsx(I,{path:"/graph",element:r.jsx(j.Suspense,{fallback:r.jsx(nr,{pageName:"グラフ"}),children:r.jsx(Qt,{})})}),r.jsx(I,{path:"/export",element:r.jsx(j.Suspense,{fallback:r.jsx(nr,{pageName:"管理"}),children:r.jsx(or,{showTipsModal:c})})}),r.jsx(I,{path:"*",element:r.jsx(E,{to:"/weight",replace:!0})})]})})})]})}function ir(e){return r.jsx(dr,{...e})}class dr extends j.Component{constructor(e){super(e),t(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),t(this,"handleReload",()=>{window.location.reload()}),t(this,"handleCopy",async()=>{const{error:e,errorInfo:t}=this.state;if(!e)return;const r=`エラー名: ${e.name}\nエラーメッセージ: ${e.message}\n`+(t?`スタックトレース:\n${t.componentStack}`:"");await navigator.clipboard.writeText(r),this.setState({copied:!0}),setTimeout(()=>this.setState({copied:!1}),1500)}),this.state={hasError:!1,error:null,errorInfo:null,copied:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({errorInfo:t})}render(){const{hasError:e,error:t,errorInfo:a}=this.state,{children:n,fallback:s}=this.props;return e&&t?s?s(t,this.handleReset):r.jsxs("div",{className:"flex flex-col items-center justify-center p-8 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[r.jsx("h2",{className:"text-xl font-bold text-red-800 dark:text-red-200 mb-2 text-center",children:"エラーが発生しました"}),r.jsxs("p",{className:"text-red-700 dark:text-red-300 mb-6 text-center max-w-md",children:["申し訳ありません。予期しないエラーが発生しました。",r.jsx("br",{}),"ページを再読み込みしてください。"]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[r.jsx("button",{onClick:this.handleReset,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",children:"再試行"}),r.jsx("button",{onClick:this.handleReload,className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-colors duration-200",children:"再読み込み"})]}),r.jsxs("details",{className:"mt-6 w-full max-w-2xl text-left",children:[r.jsxs("summary",{className:"cursor-pointer text-sm text-red-600 dark:text-red-400 font-medium flex items-center justify-between",children:[r.jsx("span",{children:"詳細"}),r.jsx("button",{type:"button",onClick:this.handleCopy,className:"ml-4 px-2 py-1 text-xs rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",style:{minWidth:60},children:this.state.copied?"コピーしました":"コピー"})]}),r.jsxs("div",{className:"mt-2 p-4 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded text-xs font-mono overflow-auto max-h-40 text-left",children:[r.jsxs("div",{className:"mb-2 text-left",children:[r.jsx("strong",{children:"エラー名:"})," ",t.name]}),r.jsxs("div",{className:"mb-2 text-left",children:[r.jsx("strong",{children:"エラーメッセージ:"})," ",t.message]}),a&&r.jsxs("div",{className:"text-left",children:[r.jsx("strong",{children:"スタックトレース:"}),r.jsx("pre",{className:"whitespace-pre-wrap text-xs mt-1 text-left",children:a.componentStack})]})]})]})]}):n}}const cr=Z((e,t)=>({toasts:[],showToast:(r,a="info",n=3e3)=>{const s=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o={id:s,type:a,message:r,duration:n};e(e=>({toasts:[...e.toasts,o]})),n&&n>0&&setTimeout(()=>{t().removeToast(s)},n)},showSuccess:(e,r=2e3)=>{t().showToast(e,"success",r)},showError:(e,r=5e3)=>{t().showToast(e,"error",r)},showWarning:(e,r=4e3)=>{t().showToast(e,"warning",r)},showInfo:(e,r=3e3)=>{t().showToast(e,"info",r)},removeToast:t=>{e(e=>({toasts:e.toasts.filter(e=>e.id!==t)}))},clearAll:()=>{e({toasts:[]})}})),ur=()=>{const{toasts:e,removeToast:t}=cr(),a=j.useRef(null);j.useEffect(()=>{if(e.length>0){const t=e[e.length-1];if("error"===t.type||"warning"===t.type){const e=document.querySelector(`[data-toast-id="${t.id}"]`);e&&e.focus()}}},[e]);const n=e=>{switch(e){case"success":return r.jsx(_e,{className:"w-5 h-5 text-green-600 dark:text-green-400","aria-hidden":"true"});case"error":return r.jsx(Ye,{className:"w-5 h-5 text-red-600 dark:text-red-400","aria-hidden":"true"});case"warning":return r.jsx(Fe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400","aria-hidden":"true"});case"info":return r.jsx(Ze,{className:"w-5 h-5 text-blue-600 dark:text-blue-400","aria-hidden":"true"})}},s=e=>{switch(e){case"success":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-700 text-green-800 dark:text-green-200";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-700 text-red-800 dark:text-red-200";case"warning":return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700 text-yellow-800 dark:text-yellow-200";case"info":return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700 text-blue-800 dark:text-blue-200"}},o=e=>{switch(e){case"success":return"成功";case"error":return"エラー";case"warning":return"警告";case"info":return"情報"}};return 0===e.length?null:r.jsx("div",{ref:a,className:"fixed top-4 right-4 z-50 space-y-2",role:"region","aria-label":"情報","aria-live":"polite","aria-atomic":"false",children:e.map(e=>r.jsx("div",{"data-toast-id":e.id,className:`${s(e.type)} border rounded-lg p-4 shadow-lg max-w-sm transform transition-all duration-300 ease-in-out animate-in slide-in-from-right-5 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400`,role:"error"===e.type||"warning"===e.type?"alert":"status","aria-label":`${o(e.type)}: ${e.message}`,tabIndex:"error"===e.type||"warning"===e.type?0:-1,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0",children:n(e.type)}),r.jsx("div",{className:"flex-1 min-w-0",children:r.jsxs("p",{className:"text-sm font-medium leading-5",children:[r.jsxs("span",{className:"sr-only",children:[o(e.type),": "]}),e.message]})}),r.jsx("button",{onClick:()=>t(e.id),className:"flex-shrink-0 text-gray-400 dark:text-slate-400 bg-gray-100 dark:bg-slate-700 hover:text-gray-600 dark:hover:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400 rounded-full p-1","aria-label":"閉じる",children:r.jsx(Xe,{className:"w-4 h-4","aria-hidden":"true"})})]})},e.id))})},gr=31536e6,fr="error";function mr(e,t="partial"){if(null==e)return"---";const r=String(e);switch(t){case"full":return"*".repeat(r.length);case"hash":{let e=0;for(let t=0;t<r.length;t++){e=(e<<5)-e+r.charCodeAt(t),e&=e}return`#${Math.abs(e).toString(16)}`}default:return r.length<=3?"*".repeat(r.length):r.length<=8?r.slice(0,1)+"*".repeat(r.length-2)+r.slice(-1):r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2)}}function hr(e){const t={};for(const[r,a]of Object.entries(e))pr(r)?t[r]=mr(a):t[r]="object"==typeof a&&null!==a?Array.isArray(a)?a.map(e=>"object"==typeof e?hr(e):e):hr(a):a;return t}function pr(e){return[/password/i,/token/i,/secret/i,/key/i,/auth/i,/session/i,/cookie/i,/email/i,/phone/i,/address/i,/ssn/i,/credit/i].some(t=>t.test(e))}function xr(e,t,r){if(!("error"===e||"warn"===e&&["debug","info","warn"].includes(fr)||"info"===e&&["debug","info"].includes(fr)||"debug"===e&&"debug"===fr))return;const a=`[${(new Date).toISOString()}][PRIVACY][${e.toUpperCase()}]`;r&&"object"==typeof r?console[e](`${a} ${t}`,hr(r)):r?console[e](`${a} ${t}`,mr(r)):console[e](`${a} ${t}`)}function br(e,t=gr){return Date.now()-e>t}async function yr(){try{xr("info","Starting automatic data cleanup"),"indexedDB"in window&&await async function(){xr("debug","IndexedDB cleanup completed")}(),function(){const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);if(r){const t=localStorage.getItem(r);if(t)try{const a=JSON.parse(t);a.timestamp&&br(a.timestamp)&&e.push(r)}catch{(localStorage.getItem(r)&&r.startsWith("cache_")||r.startsWith("temp_"))&&e.push(r)}}}e.forEach(e=>{localStorage.removeItem(e),xr("debug",`Removed expired localStorage item: ${e}`)})}(),function(){const e=[];for(let t=0;t<sessionStorage.length;t++){const r=sessionStorage.key(t);r&&(r.startsWith("temp_")||r.startsWith("cache_"))&&e.push(r)}e.forEach(e=>{sessionStorage.removeItem(e),xr("debug",`Removed sessionStorage item: ${e}`)})}(),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEANUP_EXPIRED_CACHE"}),xr("info","Automatic data cleanup completed")}catch(e){xr("error","Data cleanup failed",e)}}xr("info","Initializing privacy settings"),setInterval(yr,36e5),window.addEventListener("beforeunload",()=>{yr().catch(e=>{xr("error","Cleanup on unload failed",e)})}),window.addEventListener("securitypolicyviolation",e=>{xr("error","Security Policy Violation detected",{directive:e.violatedDirective,blockedURI:e.blockedURI,disposition:e.disposition})}),xr("info","Privacy settings initialized successfully"),document.addEventListener("contextmenu",e=>{});const vr={open:!1};setInterval(function(){window.outerHeight-window.innerHeight>160||window.outerWidth-window.innerWidth>160?vr.open||(vr.open=!0):vr.open=!1},500);const wr=(e,t)=>{"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent(`performance:${e}`,{detail:t}))},kr=performance.now(),jr=e=>{var t;let r;if(console.error("Global error:",e),r=e instanceof ErrorEvent?{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:null==(t=e.error)?void 0:t.stack,timestamp:(new Date).toLocaleString(),userAgent:navigator.userAgent,url:window.location.href}:{reason:e.reason,promise:String(e.promise),timestamp:(new Date).toLocaleString(),userAgent:navigator.userAgent,url:window.location.href},"undefined"!=typeof performance){const e={timing:performance.timing,navigation:performance.navigation,memory:performance.memory};r.performance=e}const a={...r,userAgent:navigator.userAgent.substring(0,100),url:new URL(window.location.href).pathname};wr("error",a)};window.addEventListener("error",jr),window.addEventListener("unhandledrejection",jr);const Nr=(()=>{const e="/aloe-wellness-log/";return e.replace(/\/$/,"")})();function Sr(e){const t=document.createElement("div");t.style.position="fixed",t.style.bottom="32px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.zIndex="9999",document.body.appendChild(t),t.innerHTML='\n    <div style="background:#059669;color:#fff;padding:16px 24px;border-radius:12px;box-shadow:0 2px 8px #0002;display:flex;align-items:center;gap:16px;font-size:1rem;">\n      <span>新しいバージョンがあります。<br>再読み込みで最新に更新できます。</span>\n      <button id="sw-update-btn" style="background:#fff;color:#059669;font-weight:bold;padding:8px 16px;border:none;border-radius:8px;cursor:pointer;">再読み込み</button>\n    </div>\n  ';t.querySelector("#sw-update-btn").onclick=()=>{e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload()}}U.createRoot(document.getElementById("root")).render(r.jsxs(ir,{children:[r.jsx(ur,{}),r.jsx(R,{basename:Nr,children:r.jsx(lr,{})})]})),window.addEventListener("load",()=>{const e=performance.now()-kr;wr("initialLoad",{loadTime:e})}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{const e=`${"/aloe-wellness-log/".replace(/\/$/,"")}/sw.js`;navigator.serviceWorker.register(e).then(e=>{e.waiting&&Sr(e),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&Sr(e)})})}).catch(e=>{console.error("❌ Service Worker registration failed:",e)})}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});export{Q as B,Ze as H,Fe as a,Ye as b,_e as c,Be as d,$e as e,ze as f,Le as g,qe as h,rt as i,Ke as j,dt as p,St as u};
